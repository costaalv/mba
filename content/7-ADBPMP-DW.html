

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Análise de Dados com Base em Processamento Massivo em Paralelo &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/7-ADBPMP-DW';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.1-ADBPMP-Slides+ASs" href="7.1-ADBPMP-Slides%2BASs.html" />
    <link rel="prev" title="Estatística para Ciência de Dados" href="6-ECD-Estatistica.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    MBA - Ciência de Dados - 2023
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">1. ICD - Introdução à Ciência de Dados</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1-ICD-Introducao_Ciencia_%20de_Dados.html">Aula 1</a></li>
















</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">2. PCD - Programação para Ciência de dados</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2-PCD-Programacao_para_Ciencia_de_dados.html"><span style="color:blue">Python Parte I</span></a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">3. AD - Aprendizado Dinâmico</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="3-AD-Aprendizado_dinamico.html">Aprendizado Dinâmico</a></li>
































</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">4. TACTD - Técnicas Avancadas</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="4-TACTD-Tecnicas_avancadas.html"><span style="color:darkred">Dados estruturados e não estruturados e problemas típicos em bases de dados</span></a></li>



































</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">5. AM - Aprendizado de Máquina</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="5-AM-Aprendizado_de_maquina.html">Prática 1: Visão Geral da Biblioteca Sklearn</a></li>

























</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">5.1 AM - Slides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="5.1-AM-Slides.html">5.1-AM-Slides</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">6. ECD - Estatística</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="6-ECD-Estatistica.html">Estatística para Ciência de Dados</a></li>























</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">7. ADBPMP - DW</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><span style="color:blue">Análise de Dados com Base em Processamento Massivo em Paralelo</span></a></li>




















































</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">7.1 ADBPMP - Slides + ASs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="7.1-ADBPMP-Slides%2BASs.html">7.1-ADBPMP-Slides+ASs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">8. RNAP - Redes Neurais</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="8-RNAP-Redes_neurais.html">Redes Neurais e Aprendizado Profundo</a></li>











</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">9. Revisões</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="9-REVISOES.html">1 - APRENDIZADO DE MÁQUINA - AM</a></li>































</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/7-ADBPMP-DW.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><span style="color:blue">Análise de Dados com Base em Processamento Massivo em Paralelo</span></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#"><span style="color:blue">Análise de Dados com Base em Processamento Massivo em Paralelo</span></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-03-processo-de-etl-elt-span"><span style="color:blue">Aula 03: Processo de ETL/ELT</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-exemplo-usando-pandas-span"><span style="color:blue">Exemplo usando Pandas</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fontes-de-dados">1 Fontes de Dados</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-do-data-mart">2 Projeto do <em>Data Mart</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importacao-usando-pandas">3 Importação usando Pandas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integracao-de-esquemas">4 Integração de Esquemas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conflitos-de-nome-sinonimo">4.1 Conflitos de nome (sinônimo)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conflito-semantico">4.2 Conflito semântico</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#padronizacao-das-colunas">4.3 Padronização das colunas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integracao-de-instancias">5 Integração de Instâncias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerando-a-fonte-de-dados-funcionariorelacional">5.1 Considerando a fonte de dados funcionarioRelacional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerando-a-fonte-de-dados-colaboradorjson">5.2 Considerando a fonte de dados colaboradorJSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrando-as-instancias">5.4 Integrando as instâncias</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-dos-dados-no-data-mart">6 Carga dos Dados no <em>Data Mart</em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-03-lista-exercicios-processo-de-etl-elt-span"><span style="color:blue">Aula 03: Lista exercícios - Processo de ETL/ELT</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><span style="color:blue">Exemplo usando Pandas</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1 Fontes de Dados</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2 Projeto do <em>Data Mart</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">3 Importação usando Pandas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-1">Exercício 1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">4 Integração de Esquemas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">4.1 Conflitos de nome (sinônimo)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-2">Exercício 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">4.2 Conflito semântico</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-3">Exercício 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">4.3 Padronização das colunas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-4">Exercício 4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">5 Integração de Instâncias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">5.1 Considerando a fonte de dados funcionarioRelacional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">5.2 Considerando a fonte de dados colaboradorJSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerando-a-fonte-de-dados-empregadoplanilha">5.3 Considerando a fonte de dados empregadoPlanilha</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-5">Exercício 5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">5.4 Integrando as instâncias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-6">Exercício 6</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-7">Exercício 7</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">6 Carga dos Dados no <em>Data Mart</em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-8">Exercício 8</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-9">Exercício 9</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-10">Exercício 10</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-03-plantao-edesio-processo-de-etl-elt-span"><span style="color:blue">Aula 03: Plantão Edesio - Processo de ETL/ELT</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-retomando-conceitos-de-classe-e-a-ferramenta-pandas-merge-span"><span style="color:blue">Retomando conceitos de Classe e a ferramenta Pandas (merge)</span></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-05-consultas-olap-span"><span style="color:blue">Aula 05: Consultas OLAP</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14"><span style="color:blue">Exemplo usando Pandas</span></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introducao">1 Introdução</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esquema-estrela-pagamento">1.1 Esquema Estrela Pagamento</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esquema-estrela-negociacao">1.2 Esquema Estrela Negociacao</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constelacao-de-fatos">1.3 Constelação de Fatos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#juncao-estrela">1.4 Junção Estrela</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-das-tabelas-de-dimensao-e-das-tabelas-de-fatos">2 Carregamento das Tabelas de Dimensão e das Tabelas de Fatos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-das-tabelas-de-dimensao">2.1 Carregamento das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-das-tabelas-de-fatos">2.2 Carregamento das Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#execucao-de-consultas-com-foco-nas-operacoes-olap">3 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacao-slice-and-dice">3.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacoes-drill-down-e-roll-up">3.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacao-pivot">3.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacao-drill-across">3.4 Operação Drill-Across</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#execucao-de-consultas-com-foco-na-tomada-de-decisao">3 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-1">3.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-2">3.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-3">3.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-05-lista-de-exercicios-consultas-olap-span"><span style="color:blue">Aula 05: Lista de exercícios - Consultas OLAP</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15"><span style="color:blue">Exemplo usando Pandas</span></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">1 Introdução</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">1.1 Esquema Estrela Pagamento</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">1.2 Esquema Estrela Negociacao</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">1.3 Constelação de Fatos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">1.4 Junção Estrela</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">2 Carregamento das Tabelas de Dimensão e das Tabelas de Fatos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">2.1 Carregamento das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">2.2 Carregamento das Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">3 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">3.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">3.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">3.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">3.4 Operação Drill-Across</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">3 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">3.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">3.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">3.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicios">4 Exercícios</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">Exercício 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">Exercício 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">Exercício 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">Exercício 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">Exercício 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">Exercício 6</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">Exercício 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">Exercício 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">Exercício 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">Exercício 10</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-dados-com-base-em-processamento-massivo-em-paralelo">Análise de Dados com Base em Processamento Massivo em Paralelo</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#aula-05-plantao-leonardo-pipeline-utilizando-luigi">Aula 05 - Plantão Leonardo - Pipeline utilizando Luigi</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#luigi">Luigi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pros-e-contras">Prós e Contras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pros">Prós</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contras">Contras</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-do-luigi">Estrutura do Luigi</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-pipeline">do Pipeline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-codigo">do Código</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exemplo-1">Exemplo 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exemplo-2">Exemplo 2</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-06-processamento-paralelo-e-distribuido-span"><span style="color:blue">Aula 06: Processamento Paralelo e Distribuído</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-apache-spark-rdd-span"><span style="color:blue">Apache Spark RDD</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id43"><strong>1 Introdução</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apache-spark-cluster"><strong>2 Apache Spark Cluster</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arquitetura">2.1 Arquitetura</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-uma-aplicacao-spark">2.2 Criação de uma Aplicação Spark</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#instalacao">2.3 Instalação</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conexao">2.4 Conexão</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-apache-spark-rdd"><strong>3 API Apache Spark RDD</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conjuntos-de-dados">3.1 Conjuntos de Dados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-rdds">3.2 Criação de RDDs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-parallelize">Método parallelize()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-textfile">Método textFile()</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacoes">3.2 Transformações</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-map">Método map()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-flatmap">Método flatMap()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-mapvalues">Método mapValues()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-filter">Método filter()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-join">Método join()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-reducebykey">Método reduceByKey()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-sortbykey">Método sortByKey()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-sortby">Método sortBy()</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acoes">3.3 Ações</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-collect-take-e-first">Métodos collect(), take() e first()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-max-min-mean-count">Métodos  max(), min(), mean(), count()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-reduce">Método reduce()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contador-de-palavras"><strong>4 Contador de Palavras</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#persistencia-dos-rdds">5 Persistência dos RDDs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#aula-06-lista-de-exercicios-processamento-paralelo-e-distribuido">Aula 06 - Lista de Exercícios - Processamento Paralelo e Distribuído</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id44">1 Introdução</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#apache-spark-cluster-instalacao-e-configuracao">2 Apache Spark Cluster: instalação e configuração</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-dos-dados-da-aplicacao-da-bi-solutions">3 Carregamento dos Dados da Aplicação da BI Solutions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id45"><strong>Exercícios</strong></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id46"><strong>Exercício 1</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id47"><strong>Exercício 2</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id48"><strong>Exercício 3</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id49"><strong>Exercício 4</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id50"><strong>Exercício 5</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id51"><strong>Exercício 6</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id52"><strong>Exercício 7</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id53"><strong>Exercício 8</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id54"><strong>Exercício 9</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id55"><strong>Exercício 10</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-11"><strong>Exercício 11</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-07-consultas-olap-usando-spark-sql-span"><span style="color:blue">Aula 07: Consultas OLAP usando Spark SQL</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-apache-spark-sql-span"><span style="color:blue">Apache Spark SQL</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plano-de-consulta">1.1 Plano de Consulta</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#constelacao-de-fatos-da-bi-solutions">2 Constelação de Fatos da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baixando-o-modulo-wget">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtencao-dos-dados-das-tabelas-de-dimensao">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtencao-dos-dados-tabelas-de-fatos">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id56">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id57">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id58">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preparacao-dos-dados">4 Preparação dos Dados</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes">4.1 Geração dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-visoes-temporarias">4.2 Criação de Visões Temporárias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id59">5 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id60">5.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id61">5.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id62">5.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id63">5.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extensoes-rollup-cube-e-grouping-sets">5.5 Extensões ROLLUP, CUBE e GROUPING SETS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id64">6 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id65">6.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id66">6.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id67">6.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id68"><span style="color:blue">Aula 07: Consultas OLAP usando Spark SQL</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id69"><span style="color:blue">Apache Spark SQL</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id70">1.1 Plano de Consulta</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id71">2 Constelação de Fatos da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id72">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id73">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id74">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id75">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id76">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id77">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id78">4 Preparação dos Dados</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id79">4.1 Geração dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id80">4.2 Criação de Visões Temporárias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id81">5 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id82">5.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id83">5.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id84">5.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id85">5.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id86">5.5 Extensões ROLLUP, CUBE e GROUPING SETS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id87">6 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id88">6.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id89">6.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id90">6.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id91">7 Exercícios</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id92">Exercício 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id93">Exercício 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id94">Exercício 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id95">Exercício 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id96">Exercício 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id97">Exercício 6</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id98">Exercício 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id99">Exercício 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id100">Exercício 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id101">Exercício 10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id102">Exercício 11</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criando-uma-base-de-dados">Criando uma Base de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criando-tabela">Criando tabela</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inserindo-dados">Inserindo Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consultando-tabela">Consultando Tabela</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-tabela">Update Tabela</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-linha">Delete linha</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deletar-tabela">Deletar Tabela</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-08-explorando-o-modulo-pyspark-sql-span"><span style="color:blue">Aula 08: Explorando o Módulo pyspark.sql</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-metodos-de-interesse-e-consultas-olap-span"><span style="color:blue">Métodos de Interesse e Consultas OLAP</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id103">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id104">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id105">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id106">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id107">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id108">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes-da-bi-solutions">4 Geração dos DataFrames da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-para-leitura-e-escrita">4.1 Métodos para Leitura e Escrita</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-spark-read-csv">Método spark.read.csv()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-show">Método show()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-printschema">Método printSchema()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-write-csv">Método write.csv()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-dos-dataframes">4.2 Criação dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulacao-da-tipagem-dos-dados">4.3 Manipulação da Tipagem dos Dados</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-cast">Método cast()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-withcolumn">Método withColumn()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#atualizacao-dos-tipos-de-dados">4.4 Atualização dos Tipos de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-basica-do-comando-select">5.1 Estrutura Básica do Comando SELECT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-select">Método select()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-selectexpr">Método selectExpr()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-distinct">Método distinct()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id109">Método filter()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-where">Método where()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-between">Método between()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-isnull-e-isnotnull">Métodos isNull() e isNotNull()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-isin">Método isin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-like">Método like()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-withcolumnrenamed">Método withColumnRenamed()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-crossjoin">Método crossJoin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id110">Método join()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-orderby">Método orderBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agregacao-e-agrupamento">5.2 Agregação e Agrupamento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-sum">Método sum()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-min">Método min()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-max">Método max()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-avg">Método avg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-mean">Método mean()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-agg">Método agg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-groupby">Método groupBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-sobre-conjuntos">5.3 Métodos sobre Conjuntos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-union-unionall-e-unionbyname">Métodos union(), unionAll() e unionByName()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-intersect-e-intersectall">Métodos intersect() e intersectAll()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-subtract-e-exceptall">Métodos subtract() e exceptAll()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id111">6 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id112">6.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id113">6.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id114">6.3 Operação Pivot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-pivot">Método pivot()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id115">6.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extensoes-rollup-e-cube">5.5 Extensões ROLLUP e CUBE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-rollup">Método rollup()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-cube">Método cube()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id116">7 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id117">7.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id118">7.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id119">7.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-08-lista-de-exercicios-explorando-o-modulo-pyspark-sql-span"><span style="color:blue"> Aula 08 - Lista de exercícios - Explorando o Módulo pyspark.sql</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-respostas-dos-exercicios-span"><span style="color:blue">Respostas dos Exercícios</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id120">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id121">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id122">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id123">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id124">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id125">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id126">4 Geração dos DataFrames da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id127">4.1 Métodos para Leitura e Escrita</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id128">Método spark.read.csv()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id129">Método show()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id130">Método printSchema()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id131">Método write.csv()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id132">4.2 Criação dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id133">4.3 Manipulação da Tipagem dos Dados</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id134">Método cast()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id135">Método withColumn()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id136">4.4 Atualização dos Tipos de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id137">5.1 Estrutura Básica do Comando SELECT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id138">Método select()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id139">Método selectExpr()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id140">Método distinct()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id141">Método filter()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id142">Método where()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id143">Método between()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id144">Métodos isNull() e isNotNull()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id145">Método isin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id146">Método like()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id147">Método withColumnRenamed()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id148">Método crossJoin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id149">Método join()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id150">Método orderBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id151">5.2 Agregação e Agrupamento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id152">Método sum()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id153">Método min()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id154">Método max()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id155">Método avg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id156">Método mean()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id157">Método agg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id158">Método groupBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id159">5.3 Métodos sobre Conjuntos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id160">Métodos union(), unionAll() e unionByName()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id161">Métodos intersect() e intersectAll()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id162">Métodos subtract() e exceptAll()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id163">6 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id164">6.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id165">6.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id166">6.3 Operação Pivot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id167">Método pivot()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id168">6.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id169">5.5 Extensões ROLLUP e CUBE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id170">Método rollup()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id171">Método cube()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id172">7 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id173">7.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id174">7.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id175">7.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id176">8 Exercícios</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id177">Exercício 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id178">Exercício 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id179">Exercício 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id180">Exercício 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id181">Exercício 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id182">Exercício 6</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id183">Exercício 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id184">Exercício 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id185">Exercício 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id186">Exercício 10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id187">Exercício 11</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-avaliacao-final-notebook-span"><span style="color:blue">Avaliação Final - Notebook </span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id188">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id189">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id190">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id191">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id192">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id193">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes-em-pandas-da-bi-solutions">4 Geração dos DataFrames em Pandas da BI Solutions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes-em-spark-da-bi-solutions">5 Geração dos DataFrames em Spark da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id194">5.1 Criação dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id195">5.2 Atualização dos Tipos de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id196">5.3 Criação de Visões Temporárias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#respostas">6 Respostas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacao-da-consulta-analitica-da-questao-8">Especificação da Consulta Analítica da Questão 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacao-da-consulta-analitica-da-questao-9">Especificação da Consulta Analítica da Questão 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacao-da-consulta-analitica-da-questao-10">Especificação da Consulta Analítica da Questão 10</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-analise-de-dados-com-base-em-processamento-massivo-em-paralelo-span">
<h1><span style="color:blue">Análise de Dados com Base em Processamento Massivo em Paralelo</span><a class="headerlink" href="#span-style-color-blue-analise-de-dados-com-base-em-processamento-massivo-em-paralelo-span" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-03-processo-de-etl-elt-span">
<h1><span style="color:blue">Aula 03: Processo de ETL/ELT</span><a class="headerlink" href="#span-style-color-blue-aula-03-processo-de-etl-elt-span" title="Permalink to this heading">#</a></h1>
<section id="span-style-color-blue-exemplo-usando-pandas-span">
<h2><span style="color:blue">Exemplo usando Pandas</span><a class="headerlink" href="#span-style-color-blue-exemplo-usando-pandas-span" title="Permalink to this heading">#</a></h2>
<p><strong>Conteúdo</strong></p>
<ol class="arabic">
<li><p>Fontes de Dados</p></li>
<li><p>Projeto do <em>Data Mart</em></p></li>
<li><p>Importação usando Pandas</p></li>
<li><p>Integração de esquemas</p>
<p>4.1. Conflito de nome (sinônimos)</p>
<p>4.2. Conflito semântico</p>
<p>4.3. Padronização das colunas</p>
</li>
<li><p>Integração de instâncias</p>
<p>5.1. Considerando a fonte de dados funcionarioRelacional</p>
<p>5.2. Considerando a fonte de dados colaboradorJSON</p>
</li>
<li><p>Carga dos dados no <em>Data Mart</em></p></li>
</ol>
<section id="fontes-de-dados">
<h3>1 Fontes de Dados<a class="headerlink" href="#fontes-de-dados" title="Permalink to this heading">#</a></h3>
<p>Os dados dos funcionários estão armazenados em três fontes diferentes.</p>
<p><strong>Fonte 1</strong>. <em>funcionarioRelacional.csv</em>: referente a um banco de dados relacional. Essa fonte armazena os funcionários da área de Engenharia.</p>
<p><strong>Fonte 2</strong>. <em>colaboradorJSON.json</em>: arquivo JSON referente a uma base de dados NoSQL (Not Only SQL). Essa fonte armazena os funcionários da área de <em>Marketing</em>.</p>
<p><strong>Fonte 3</strong>. <em>empregadoPlanilha.xlsx</em>: arquivo referente a uma planilha Excel. Essa fonte armazena os funcionários da área de Recursos Humanos.</p>
<p>Na parte da aula, serão usadas as fontes 1 (funcionarioRelacional) e 2 (colaboradorJSON). A fonte 3 (empregadoPlanilha) será usada na lista de exercícios.</p>
</section>
</section>
<section id="projeto-do-data-mart">
<h2>2 Projeto do <em>Data Mart</em><a class="headerlink" href="#projeto-do-data-mart" title="Permalink to this heading">#</a></h2>
<p>O projeto do <strong>data mart</strong> refere-se ao esquema de relação <em>funcionario</em>. Esse esquema é definido a seguir, sendo que a chave primária é representada pelo atributo funcPK.</p>
<p>funcionario (<ins>funcPK</ins>, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p>
</section>
<section id="importacao-usando-pandas">
<h2>3 Importação usando Pandas<a class="headerlink" href="#importacao-usando-pandas" title="Permalink to this heading">#</a></h2>
<p>As fontes de dados são importadas por meio da estrutura <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code>. Essa estrutura permite a leitura das diferentes fontes consideradas: <code class="docutils literal notranslate"><span class="pre">csv</span></code>, <code class="docutils literal notranslate"><span class="pre">json</span></code> e <code class="docutils literal notranslate"><span class="pre">xlsx</span></code>. Quando essas fontes são importadas, elas são unificadas em um formato único, o formato do <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code>, facilitando a manipulação.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir realiza a importação dos dados dos funcionários armazenados em <em>funcionarioRelacional.csv</em> e armazena o resultado no <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> chamado funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/ETL_Funcionarios/main/funcionarioRelacional.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir exibem a quantidade de funcionários importados e os primeiros elementos de funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de funcionários importados da Fonte 1 (funcionarioRelacional.csv): &#39;</span><span class="p">,</span> <span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir realiza a importação dos dados dos funcionários armazenados em <em>colaboradorJSON.json</em> e armazena o resultado no <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> chamado colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/ETL_Funcionarios/main/colaboradorJSON.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir exibem a quantidade de funcionários importados e os primeiros elementos de colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de funcionários importados da Fonte 2 (colaboradorJSON.json): &#39;</span><span class="p">,</span> <span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="integracao-de-esquemas">
<h2>4 Integração de Esquemas<a class="headerlink" href="#integracao-de-esquemas" title="Permalink to this heading">#</a></h2>
<p>Analisando-se as três fontes de dados, verifica-se que existem vários conflitos de nome e um conflito semântico. Todos esses conflitos devem ser tratados na integração de esquemas, conforme descrito a seguir.</p>
<section id="conflitos-de-nome-sinonimo">
<h3>4.1 Conflitos de nome (sinônimo)<a class="headerlink" href="#conflitos-de-nome-sinonimo" title="Permalink to this heading">#</a></h3>
<p>Um conflito de nome (sinônimo) ocorre quando diferentes nomes são aplicados ao mesmo elemento. funcionarioRelacional, colaboradorJSON e empregadoPlanilha armazenam dados de funcionários. Existem vários conflitos de nome quando  os nomes dos atributos do esquema de relação <em>funcionario</em> são comparados com os nomes das colunas oriundas das respectivas fontes de dados.</p>
<p>A partir da identificação dos conflitos, são definidas as correspondências existentes entre as fontes de dados e o esquema de relação do <em>data mart</em>. Essas correspondências são as mesmas que as identificadas no documento textual que acompanha esta aula. Elas são repetidas aqui por completude.</p>
<p>As correspondências entre os esquemas de <em>funcionario</em> e funcionarioRelacional são:</p>
<ol class="arabic simple">
<li><p><em>funcionario</em> <span class="math notranslate nohighlight">\(\equiv\)</span> funcionarioRelacional</p></li>
</ol>
<blockquote>
<div><p>(a) funcMatricula = funcMatricula</p>
</div></blockquote>
<blockquote>
<div><p>(b) funcNome = funcNome</p>
</div></blockquote>
<blockquote>
<div><p>(c) funcSexo = funcSexo</p>
</div></blockquote>
<blockquote>
<div><p>(d) funcDataNascimento = funcDataNasc</p>
</div></blockquote>
<blockquote>
<div><p>(e) funcCidade = funcCidade</p>
</div></blockquote>
<blockquote>
<div><p>(f) funcEstadoSigla = funcEstado</p>
</div></blockquote>
<blockquote>
<div><p>(g) funcPaisNome = funcPais</p>
</div></blockquote>
<p>De acordo com essas correspondências, o comando a seguir mapeia os nomes das colunas de funcionarioRelacional para os nomes dos atributos de <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">,</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">,</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">,</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir exibe a nova estrutura e o primeiro elemento de funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As correspondências entre os esquemas de funcionario e colaboradorJSON são:</p>
<ol class="arabic simple" start="2">
<li><p><em>funcionario</em> <span class="math notranslate nohighlight">\(\equiv\)</span> colaboradorJSON</p></li>
</ol>
<blockquote>
<div><p>(a) funcMatricula = colab_matricula</p>
</div></blockquote>
<blockquote>
<div><p>(b) funcNome = colab_nome</p>
</div></blockquote>
<blockquote>
<div><p>(c) funcSexo = colab_sexo</p>
</div></blockquote>
<blockquote>
<div><p>(d) funcDataNascimento = colab_data_nasc</p>
</div></blockquote>
<blockquote>
<div><p>(e) funcCidade = colab_cidade</p>
</div></blockquote>
<blockquote>
<div><p>(f) funcEstadoSigla = colab_estado</p>
</div></blockquote>
<blockquote>
<div><p>(g) funcPaisSigla = colab_pais</p>
</div></blockquote>
<p>De acordo com essas correspondências, o comando a seguir mapeia os nomes das colunas de colaboradorJSON para os nomes dos atributos de <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">,</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">,</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">,</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir exibe a nova estrutura e o primeiro elemento de colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="conflito-semantico">
<h3>4.2 Conflito semântico<a class="headerlink" href="#conflito-semantico" title="Permalink to this heading">#</a></h3>
<p>Um conflito semântico ocorre quando o mesmo elemento é modelado em diferentes esquemas, porém representando conjuntos que se sobrepõem. Como definido anteriormente, funcionarioRelacional armazena os funcionários da área de Engenharia, enquanto que colaboradorJSON armazena os funcionários da área de <em>Marketing</em>. É importante notar que: (i) existem funcionários que são diferentes entre si; (ii) o mesmo funcionário pode estar armazenado em mais do que uma fonte de dados, desde que ele mudou de área de atuação durante a sua trajetória.</p>
<p>Assim, devem ser identificados os funcionários que correspondem à mesma entidade do mundo real. Nesta aplicação de <em>data warehousing</em>, isso é feito por meio das <strong>matrículas</strong> dos funcionários, ou seja, considera-se a identificação unívoca das entidades. Considera-se também que os valores referentes à matricula dos funcionários já foram analisados na operação de limpeza dos dados e representam valores acurados. Portanto, <code class="docutils literal notranslate"><span class="pre">funcMatricula</span></code> pode ser usado para identificar os funcionários.</p>
<p>O comando a seguir mostra a quantidade de funcionários que aparecem em ambos funcionarioRelacional e colaboradorJSON, bem como detalhes desses funcionários. Isso significa que o funcionário transitou entre as áreas de Engenharia e <em>Marketing</em>. O sufixo <code class="docutils literal notranslate"><span class="pre">_x</span></code> indica colunas de funcionarioRelacional, enquanto que o sufixo <code class="docutils literal notranslate"><span class="pre">_y</span></code> indica colunas de colaboradorJSON. Como resultado, o <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> funcionario_colaborador possui os funcionários presentes em ambas fontes de dados. Os conflitos têm que ser resolvidos, o que será realizado durante a integração de instâncias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario_colaborador</span> <span class="o">=</span> <span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">colaboradorJSON</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de mesmos funcionários cadastrados nas fontes 1 e 2: &#39;</span><span class="p">,</span> <span class="n">funcionario_colaborador</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># renomeando algumas colunas sem sufixo</span>
<span class="n">funcionario_colaborador</span> <span class="o">=</span> <span class="n">funcionario_colaborador</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">:</span> <span class="s1">&#39;funcPaisSigla_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">:</span> <span class="s1">&#39;funcPaisNome_x&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># monstrando algumas colunas do conflito</span>
<span class="n">colunas_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla_y&#39;</span><span class="p">]</span>
<span class="n">funcionario_colaborador</span><span class="p">[</span><span class="n">colunas_display</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="padronizacao-das-colunas">
<h3>4.3 Padronização das colunas<a class="headerlink" href="#padronizacao-das-colunas" title="Permalink to this heading">#</a></h3>
<p>O esquema de relação <em>funcionario</em> possui vários atributos que não estão presentes nas fontes de dados. Os comandos a seguir visam acrescentar colunas a funcionarioRelacional e colaboradorJSON. É atributído valor NULO para os valores dessas colunas.</p>
<p>Os comandos a seguir realizam as seguintes ações para funcionarioRelacional. Primeiro, é mostrada a estrutura atual. Depois, são adicionadas as novas colunas, ou seja, as colunas faltantes. Por fim, é exibida a estrutura final.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcRegiaoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam as seguintes ações para colaboradorJSON. Primeiro, é mostrada a estrutura atual. Depois, são adicionadas as novas colunas, ou seja, as colunas faltantes. Por fim, é exibida a estrutura final.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcRegiaoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="integracao-de-instancias">
<h2>5 Integração de Instâncias<a class="headerlink" href="#integracao-de-instancias" title="Permalink to this heading">#</a></h2>
<p>Após a integração dos esquemas, é necessário realizar a integração de instâncias. Todas as instâncias presentes em funcionarioRelacional e em colaboradorJSON têm que ser integradas em <em>funcionario</em>, considerando o tipo de dados e o formato dos atributos desse esquema de relação.</p>
<p>Os seguintes tipos de dados e formatos são considerados para os atributos de <em>funcionario</em>:</p>
<p>a) funcMatricula: numérico;</p>
<p>b) funcNome: alfanumérico, com todas as letras maiúsculas;</p>
<p>c) funcSexo: alfanumérico de 1 caractere, com M indicando masculino e F indicando feminino;</p>
<p>d) funcDataNascimento: alfanumérico, com formato <code class="docutils literal notranslate"><span class="pre">dia/mês/ano</span></code>;</p>
<p>e) funcCidade: alfanumérico, com todas as letras maiúsculas;</p>
<p>f) funcEstadoNome: alfanumérico, com todas as letras maiúsculas;</p>
<p>g) funcEstadoSigla: alfanumérico de 2 caracteres, com todas as letras maiúsculas;</p>
<p>h) funcPaisNome: alfanumérico, com todas as letras maiúsculas;</p>
<p>i) funcPaisSigla: alfanumérico de 3 letras, com todas as letras maiúsculas;</p>
<section id="considerando-a-fonte-de-dados-funcionariorelacional">
<h3>5.1 Considerando a fonte de dados funcionarioRelacional<a class="headerlink" href="#considerando-a-fonte-de-dados-funcionariorelacional" title="Permalink to this heading">#</a></h3>
<p>O comando a seguir exemplifica instâncias de funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Para facilitar as manipulações que devem ser realizadas nas instâncias de  funcionarioRelacional, é criada uma classe em Python chamada <code class="docutils literal notranslate"><span class="pre">ProcessamentoFonteRelacional</span></code>. Nessa classe, são criados vários métodos. Cada método é responsável pela tranformação de um dos atributos do conjunto de dados. Para essa fonte foram aplicados os seguintes mapeamentos: e (funcCidade), g (funcEstadoSigla), h (funcPaisNome).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProcessamentoFonteRelacional</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Realiza a tranformacao de um dataframe com formato da fonte </span>
<span class="sd">  funcionarioRelacional para um dataframe que segue os padrões definidos </span>
<span class="sd">  para o esquema de relação funcionario.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_funcionario</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span> <span class="o">=</span> <span class="n">dados_funcionario</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">processar_cidade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cidade</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a cidade em funcionarioRelacional precisa ser</span>
<span class="sd">    transformado para caracteres maiúsculos. Esta função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">cidade</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">cidade</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">processar_estado_sigla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estado</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a sigla do estado em funcionarioRelacional </span>
<span class="sd">    precisa ser transformado para caracteres maiúsculos. Essa função realiza </span>
<span class="sd">    essa transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">estado</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">estado</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">processar_pais_nome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paisNome</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa o nome do país em funcionarioRelacional precisa </span>
<span class="sd">    ser transformado para caracteres maiúsculos. Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">paisNome</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">paisNome</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">executar_transformacoes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Essa função processa cada atributo do dataframe composto pelos dados da </span>
<span class="sd">    fonte funcionarioRelacional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_cidade</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_estado_sigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_pais_nome</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span>
</pre></div>
</div>
</div>
</div>
<p>O primeiro comando a seguir realiza o processamento da fonte funcionarioRelacional, enquanto que o segundo comando mostra alguns funcionários de funcionarioRelacional depois de ser realizado o mapeamento para o tipo de dados e o formato de funcionario.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_funcionario_relacional</span> <span class="o">=</span> <span class="n">ProcessamentoFonteRelacional</span><span class="p">(</span><span class="n">funcionarioRelacional</span><span class="p">)</span><span class="o">.</span><span class="n">executar_transformacoes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_funcionario_relacional</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="considerando-a-fonte-de-dados-colaboradorjson">
<h3>5.2 Considerando a fonte de dados colaboradorJSON<a class="headerlink" href="#considerando-a-fonte-de-dados-colaboradorjson" title="Permalink to this heading">#</a></h3>
<p>O comando a seguir exemplifica instâncias de colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Para facilitar as manipulações que devem ser realizadas nas instâncias de  colaboradorJSON, foi criada uma classe em Python chamada <code class="docutils literal notranslate"><span class="pre">ProcessamentoFonteJSON</span></code>. Nessa classe, são criados vários métodos. Cada método é responsável pela tranformação de um dos atributos do conjunto de dados. Para essa fonte foram aplicados os seguintes mapeamentos: b (funcNome), c (funcSexo), d (funcDataNascimento), e (funcCidade), g (funcEstadoSigla), i (funcPaisSigla).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProcessamentoFonteJSON</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Realiza a tranformacao de um dataframe com formato da fonte colaboradorJSON </span>
<span class="sd">  para um dataframe que segue os padrões definidos pelo esquema de </span>
<span class="sd">  relação funcionario.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_funcionario</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span> <span class="o">=</span> <span class="n">dados_funcionario</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">processar_nome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a o nome do funcionário em colaboradorJSON </span>
<span class="sd">    precisa ser transformado para caracteres maiúsculos. Essa função realiza </span>
<span class="sd">    essa transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">nome</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">nome</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">processar_sexo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sexo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa sexo em colaboradorJSON utiliza uma representação</span>
<span class="sd">    binária, na qual o valor 0 representa masculino e 1 representa feminino. </span>
<span class="sd">    Essa função é responsável por representar os valores de sexo como M e F,</span>
<span class="sd">    respectivamente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">sexo</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="s1">&#39;M&#39;</span> <span class="k">if</span> <span class="n">sexo</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;F&#39;</span>

  <span class="k">def</span> <span class="nf">processar_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a data de nascimento em colaboradorJSON precisa </span>
<span class="sd">    ser transformado para o formato &#39;dia/mês/ano&#39;.  Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>
      
    <span class="n">ano</span><span class="p">,</span> <span class="n">mes</span><span class="p">,</span> <span class="n">dia</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%02d</span><span class="s1">/</span><span class="si">%02d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dia</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mes</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ano</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">processar_cidade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cidade</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa o nome da cidade em colaboradorJSON precisa ser</span>
<span class="sd">    transformado para caracteres minúsculos. Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">cidade</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">cidade</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">processar_estado_sigla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estado</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a sigla do estado em colaboradorJSON precisa ser</span>
<span class="sd">    transformado para caracteres minúsculos. Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">estado</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">estado</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">processar_pais_sigla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pais</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a sigla do pais em colaboradorJSON </span>
<span class="sd">    segue o mesmo padrão adotado pelo atributo funcPaisSigla de funcionario. </span>
<span class="sd">    Portanto, não há necessidade de realizar transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">pais</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">pais</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">executar_transformacoes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Essa função processa cada atributo do dataframe composto pelos dados da </span>
<span class="sd">    fonte colaboradorJSON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_nome</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_sexo</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_data</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_cidade</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_estado_sigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_pais_sigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span>
</pre></div>
</div>
</div>
</div>
<p>O primeiro comando a seguir realiza o processamento da fonte colaboradorJSON,  enquanto que o segundo comando mostra alguns funcionários de colaborador JSON depois de ser realizado o mapeamento para o tipo de dados e o formato de <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_colaborador_JSON</span> <span class="o">=</span> <span class="n">ProcessamentoFonteJSON</span><span class="p">(</span><span class="n">colaboradorJSON</span><span class="p">)</span><span class="o">.</span><span class="n">executar_transformacoes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_colaborador_JSON</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="integrando-as-instancias">
<h3>5.4 Integrando as instâncias<a class="headerlink" href="#integrando-as-instancias" title="Permalink to this heading">#</a></h3>
<p>Todas as instâncias presentes em novo_funcionario_relacional e novo_colaborador_JSON devem ser integradas.</p>
<p>Apenas para relembrar, existem funcionários presentes tanto em funcionarioRelacional quanto em colaboradorJSON. O comando a seguir mostra alguns exemplos de colunas que possuem valores diferentes de atributos. Colunas com sufixo <code class="docutils literal notranslate"><span class="pre">_x</span></code> representam colunas de novo_funcionario_relacional, enquanto que colunas com sufixo <code class="docutils literal notranslate"><span class="pre">_y</span></code> representam colunas de novo_colaborador_JSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colunas_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla_y&#39;</span><span class="p">]</span>
<span class="n">novo_funcionario_relacional</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">novo_colaborador_JSON</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">)[</span><span class="n">colunas_display</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Para facilitar o processo, a coluna <code class="docutils literal notranslate"><span class="pre">funcMatricula</span></code> é transformada em índice do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocessamento_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Clona o DataFrame, e altera o indice para funcMatricula</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">ndf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ndf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_funcionario_relacional</span> <span class="o">=</span> <span class="n">preprocessamento_dataframe</span><span class="p">(</span><span class="n">novo_funcionario_relacional</span><span class="p">)</span>
<span class="n">novo_colaborador_JSON</span> <span class="o">=</span> <span class="n">preprocessamento_dataframe</span><span class="p">(</span><span class="n">novo_colaborador_JSON</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Um aspecto importante considerado na integração de instâncias é a confiabilidade das fontes, definida da seguinte forma: a fonte 1 é a mais confiável, seguida pela fonte 2.</p>
<p>O comando a seguir escolhe o valor do atributo mais confiável tendo como entrada 2 fontes representadas por A e B.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">processar_conflitos</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">fonte_A</span><span class="p">,</span> <span class="n">fonte_B</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Processa os conflitos das fontes com base na confiabilidade das mesmas,</span>
<span class="sd">  sendo a fonte_A a mais confiável.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">columns</span> <span class="o">=</span> <span class="n">fonte_A</span><span class="o">.</span><span class="n">columns</span>
  <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">fonte_A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">fonte_B</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
      <span class="n">fonte_A</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">column</span><span class="p">])</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">fonte_A</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir integra instâncias presentes tanto em novo_funcionario_relacional quanto em novo_colaborador_JSON usando como base a confiabilidade das fontes. Os valores dos atributos do primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> são escolhidos a menos que sejam valores nulos. Nesse caso, são escolhidos os valores dos atributos do segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Note que, em <code class="docutils literal notranslate"><span class="pre">df_processado</span></code>, são armazenados todos os funcionários da fonte funcionarioRelacional, sendo que, para os funcionários presentes também em colaboradorJSON, ocorre a resolução dos valores dos atributos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># indices do conflito da fonte 1 (mais confiável) e fonte 2</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">funcionario_colaborador</span><span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_processado</span> <span class="o">=</span> <span class="n">processar_conflitos</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">novo_funcionario_relacional</span><span class="p">,</span> <span class="n">novo_colaborador_JSON</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_processado</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">][[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>O esquema de relação <em>funcionario</em> a ser armazenado no <em>data mart</em> deve conter todos os funcionários. Entretanto, como resultado do último comando, esse esquema contém apenas os funcionários presentes na fonte funcionarioRelacional. O comando a seguir incorpora também a <em>funcionario</em> todos os funcionários presentes na fonte colaboradorJSON, com exceção dos funcionários já considerados anteriormente. Como resultado, são geradas todas as instâncias de <em>funcionario</em>. Na sequência, o próximo comando ilustra algumas linhas geradas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">interseccao_indices</span><span class="p">(</span><span class="n">lst1</span><span class="p">,</span> <span class="n">lst2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Retornar os indices duplicados</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst1</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lst2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">gera_funcionario</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Realiza a uniao dos dataframes</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">indices1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
  <span class="n">indices2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
  <span class="c1"># remove os indices duplicados</span>
  <span class="n">indices_drop</span> <span class="o">=</span> <span class="n">interseccao_indices</span><span class="p">(</span><span class="n">indices1</span><span class="p">,</span> <span class="n">indices2</span><span class="p">)</span>
  <span class="n">df2_drop</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices_drop</span><span class="p">)</span>
  <span class="c1"># retorna a uniao dos dois dataframes</span>
  <span class="k">return</span> <span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2_drop</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span> <span class="o">=</span> <span class="n">gera_funcionario</span><span class="p">(</span><span class="n">df_processado</span><span class="p">,</span> <span class="n">novo_colaborador_JSON</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tamanho da fonte final: &#39;</span><span class="p">,</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="carga-dos-dados-no-data-mart">
<h2>6 Carga dos Dados no <em>Data Mart</em><a class="headerlink" href="#carga-dos-dados-no-data-mart" title="Permalink to this heading">#</a></h2>
<p>Antes dos dados serem carregados no <em>data mart</em>, devem ser realizados processamentos adicionais. Esses processamentos referem-se a: (i) verificação de valores nulos; e (ii) geração automática de dados para preencher colunas que não foram preenchidas pelos dados oriundos das fontes.</p>
<p>O comando a seguir verifica a presença de valores nulos e também valores de colunas que não foram preenchidas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir realiza o preenchimento de dados nas colunas de <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code> usando como base <code class="docutils literal notranslate"><span class="pre">funcEstadoSigla</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_estados_nome</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RJ&#39;</span><span class="p">:</span><span class="s1">&#39;RIO DE JANEIRO&#39;</span><span class="p">,</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span><span class="s1">&#39;SAO PAULO&#39;</span><span class="p">,</span>\
                  <span class="s1">&#39;PR&#39;</span><span class="p">:</span><span class="s1">&#39;PARANA&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">:</span><span class="s1">&#39;PERNAMBUCO&#39;</span><span class="p">,</span> <span class="s1">&#39;MG&#39;</span><span class="p">:</span><span class="s1">&#39;MINAS GERAIS&#39;</span><span class="p">}</span>
<span class="n">funcEstadoNome</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">mapear_estados_nome</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">funcEstadoNome</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir realiza o preenchimento de dados nas colunas de <code class="docutils literal notranslate"><span class="pre">funcEstadoSigla</span></code> usando como base <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_estados_sigla</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RIO DE JANEIRO&#39;</span><span class="p">:</span><span class="s1">&#39;RJ&#39;</span><span class="p">,</span> <span class="s1">&#39;SAO PAULO&#39;</span><span class="p">:</span><span class="s1">&#39;SP&#39;</span><span class="p">,</span>\
                  <span class="s1">&#39;PARANA&#39;</span><span class="p">:</span><span class="s1">&#39;PR&#39;</span><span class="p">,</span> <span class="s1">&#39;PERNAMBUCO&#39;</span><span class="p">:</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;MINAS GERAIS&#39;</span><span class="p">:</span><span class="s1">&#39;MG&#39;</span><span class="p">}</span>
<span class="n">funcEstadoSigla</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">mapear_estados_sigla</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">funcEstadoSigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam o preenchimento de dados nas colunas <code class="docutils literal notranslate"><span class="pre">funcPaisSigla</span></code> e <code class="docutils literal notranslate"><span class="pre">funcPais</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BRA&#39;</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BRASIL&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir verifica novamente a presença de valores nulos e também valores de colunas que não foram preenchidas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam o preenchimento de dados nas colunas   <code class="docutils literal notranslate"><span class="pre">funcDiaNascimento</span></code> e <code class="docutils literal notranslate"><span class="pre">funcMesNascimento</span></code>, e <code class="docutils literal notranslate"><span class="pre">funcAnoNascimento</span></code>. Para tanto, são usados os valores presentes em <code class="docutils literal notranslate"><span class="pre">funcDataNascimento</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extraindo o dia, mês e ano de nascimento</span>
<span class="n">dataNascimento</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DIA&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;MES&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ANO&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">processa_data_nascimento</span><span class="p">(</span><span class="n">dataNascimento</span><span class="p">,</span> <span class="n">campo</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">dataNascimento</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">dataNascimento</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="n">campo</span><span class="p">]</span>


<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">processa_data_nascimento</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">],</span> <span class="n">dataNascimento</span><span class="p">[</span><span class="s1">&#39;DIA&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">processa_data_nascimento</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">],</span> <span class="n">dataNascimento</span><span class="p">[</span><span class="s1">&#39;MES&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">processa_data_nascimento</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">],</span> <span class="n">dataNascimento</span><span class="p">[</span><span class="s1">&#39;ANO&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam o preenchimento de dados nas colunas funcRegiaoNome e funcRegiaoSigla.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_regiao_nome</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RJ&#39;</span><span class="p">:</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">,</span>\
                  <span class="s1">&#39;PR&#39;</span><span class="p">:</span><span class="s1">&#39;SUL&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">:</span><span class="s1">&#39;NORDESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;MG&#39;</span><span class="p">:</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mapear_regiao_nome</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_regiao_sigla</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">:</span><span class="s1">&#39;SE&#39;</span><span class="p">,</span> <span class="s1">&#39;SUL&#39;</span><span class="p">:</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;NORDESTE&#39;</span><span class="p">:</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcRegiaoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mapear_regiao_sigla</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, tem-se a coluna <code class="docutils literal notranslate"><span class="pre">funcPK</span></code>. Em <em>funcionario</em>, já existe a coluna <code class="docutils literal notranslate"><span class="pre">funcMatricula</span></code>, que identifica univocamente cada funcionário. Entretanto, pode ser que o valor dessa coluna seja preenchido com dados muito grandes, contendo letras e números. Nesse caso, quando se projeta o esquema do <em>data mart</em>, acrescenta-se uma coluna adicional para representar a chave primária, a qual é preenchida com valores incrementados de 1 em 1 em ordem crescente.</p>
<p>O comando a seguir acrescenta a coluna funcPK a funcionario.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir ilustra a nova estrutura do esquema de relação <em>funcionario</em>, bem como alguns de seus dados</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">funcionario</span><span class="p">[[</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcSexo&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span> <span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir verifica a presença de valores nulos em funcionario. Esses valores serão preenchidos com a integração dos dados da fonte de dados 3. Realizar essa integração é a lista de exercícios da aula.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Como o <em>data mart</em> é armazenado seguindo o modelo relacional, o comando a seguir gera um arquivo <em>.csv</em> referente a <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;funcionario.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-03-lista-exercicios-processo-de-etl-elt-span">
<h1><span style="color:blue">Aula 03: Lista exercícios - Processo de ETL/ELT</span><a class="headerlink" href="#span-style-color-blue-aula-03-lista-exercicios-processo-de-etl-elt-span" title="Permalink to this heading">#</a></h1>
<section id="id1">
<h2><span style="color:blue">Exemplo usando Pandas</span><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p><strong>Essa lista de exercícios contém 10 exercícios, os quais estão espalhados ao longo do texto. Por favor, procurem por “Exercício” para encontrar a especificação dos exercícios e também o local no qual os comandos devem ser inseridos.</strong></p>
<p><strong>Recomenda-se fortemente que a lista de exercícios seja respondida antes de se consultar as respostas dos exercícios.</strong></p>
<p><strong>Conteúdo</strong></p>
<ol class="arabic">
<li><p>Fontes de Dados</p></li>
<li><p>Projeto do <em>Data Mart</em></p></li>
<li><p>Importação usando Pandas</p></li>
<li><p>Integração de esquemas</p>
<p>4.1. Conflito de nome (sinônimos)</p>
<p>4.2. Conflito semântico</p>
<p>4.3. Padronização das colunas</p>
</li>
<li><p>Integração de instâncias</p>
<p>5.1. Considerando a fonte de dados funcionarioRelacional</p>
<p>5.2. Considerando a fonte de dados colaboradorJSON</p>
</li>
<li><p>Carga dos dados no <em>Data Mart</em></p></li>
</ol>
<section id="id2">
<h3>1 Fontes de Dados<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>Os dados dos funcionários estão armazenados em três fontes diferentes.</p>
<p><strong>Fonte 1</strong>. <em>funcionarioRelacional.csv</em>: referente a um banco de dados relacional. Essa fonte armazena os funcionários da área de Engenharia.</p>
<p><strong>Fonte 2</strong>. <em>colaboradorJSON.json</em>: arquivo JSON referente a uma base de dados NoSQL (Not Only SQL). Essa fonte armazena os funcionários da área de <em>Marketing</em>.</p>
<p><strong>Fonte 3</strong>. <em>empregadoPlanilha.xlsx</em>: arquivo referente a uma planilha Excel. Essa fonte armazena os funcionários da área de Recursos Humanos.</p>
<p>Na parte da aula, serão usadas as fontes 1 (funcionarioRelacional) e 2 (colaboradorJSON). A fonte 3 (empregadoPlanilha) será usada na lista de exercícios.</p>
</section>
</section>
<section id="id3">
<h2>2 Projeto do <em>Data Mart</em><a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>O projeto do <strong>data mart</strong> refere-se ao esquema de relação <em>funcionario</em>. Esse esquema é definido a seguir, sendo que a chave primária é representada pelo atributo funcPK.</p>
<p>funcionario (<ins>funcPK</ins>, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p>
</section>
<section id="id4">
<h2>3 Importação usando Pandas<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>As fontes de dados são importadas por meio da estrutura <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code>. Essa estrutura permite a leitura das diferentes fontes consideradas: <code class="docutils literal notranslate"><span class="pre">csv</span></code>, <code class="docutils literal notranslate"><span class="pre">json</span></code> e <code class="docutils literal notranslate"><span class="pre">xlsx</span></code>. Quando essas fontes são importadas, elas são unificadas em um formato único, o formato do <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code>, facilitando a manipulação.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir realiza a importação dos dados dos funcionários armazenados em <em>funcionarioRelacional.csv</em> e armazena o resultado no <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> chamado funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/ETL_Funcionarios/main/funcionarioRelacional.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir exibem a quantidade de funcionários importados e os primeiros elementos de funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de funcionários importados da Fonte 1 (funcionarioRelacional.csv): &#39;</span><span class="p">,</span> <span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantidade de funcionários importados da Fonte 1 (funcionarioRelacional.csv):  56
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNasc</th>
      <th>funcCidade</th>
      <th>funcEstado</th>
      <th>funcPais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>sao paulo</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaN</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>campinas</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>santos</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ADA BARBOSA</td>
      <td>NaN</td>
      <td>4/4/1990</td>
      <td>santo andre</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>5/5/1990</td>
      <td>piracicaba</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>O comando a seguir realiza a importação dos dados dos funcionários armazenados em <em>colaboradorJSON.json</em> e armazena o resultado no <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> chamado colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/ETL_Funcionarios/main/colaboradorJSON.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir exibem a quantidade de funcionários importados e os primeiros elementos de colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de funcionários importados da Fonte 2 (colaboradorJSON.json): &#39;</span><span class="p">,</span> <span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantidade de funcionários importados da Fonte 2 (colaboradorJSON.json):  31
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>colab_matricula</th>
      <th>colab_nome</th>
      <th>colab_sexo</th>
      <th>colab_data_nasc</th>
      <th>colab_cidade</th>
      <th>colab_estado</th>
      <th>colab_pais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>Arao Alves</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>None</td>
      <td>1.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>None</td>
      <td>NaN</td>
      <td>1990-08-08</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13</td>
      <td>Arao Alves</td>
      <td>0.0</td>
      <td>None</td>
      <td>None</td>
      <td>RJ</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52</td>
      <td>Adailton Costa</td>
      <td>0.0</td>
      <td>1951-04-21</td>
      <td>Recife</td>
      <td>PE</td>
      <td>BRA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="exercicio-1">
<h3>Exercício 1<a class="headerlink" href="#exercicio-1" title="Permalink to this heading">#</a></h3>
<p>Realize a importação dos dados dos funcionários armazenados em empregadoPlanilha.xlsx. Considere que essa fonte está localizada na URL <a class="github reference external" href="https://github.com/GuiMuzziUSP/ETL_Funcionarios/blob/main/empregadoPlanilha.xlsx?raw=true">GuiMuzziUSP/ETL_Funcionarios</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">empregadoPlanilha</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;https://github.com/GuiMuzziUSP/ETL_Funcionarios/blob/main/empregadoPlanilha.xlsx?raw=true&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imprima a quantidade de instâncias em &#39;empregadoPlanilha&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de funcionários importados da Fonte 3 (empregadoPlanilha.xlsx): &#39;</span><span class="p">,</span> <span class="n">empregadoPlanilha</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantidade de funcionários importados da Fonte 3 (empregadoPlanilha.xlsx):  29
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imprima as 10 primeiras instâncias de &#39;empregadoPlanilha&#39;</span>
<span class="n">display</span><span class="p">(</span><span class="n">empregadoPlanilha</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Matrícula do Empregado</th>
      <th>Nome do Empregado</th>
      <th>Sexo do Empregado</th>
      <th>Data de Nascimento</th>
      <th>Cidade de Residência</th>
      <th>Estado de Residência</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13</td>
      <td>Dias, Abdiel</td>
      <td>NaN</td>
      <td>13/01/1990</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Praia Seca</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32</td>
      <td>Costa, Abdiel</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Piracicaba</td>
      <td>Sao Paulo</td>
    </tr>
    <tr>
      <th>3</th>
      <td>66</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>05/06/1965</td>
      <td>NaN</td>
      <td>Sao Paulo</td>
    </tr>
    <tr>
      <th>4</th>
      <td>67</td>
      <td>Borges, Adelma</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>5</th>
      <td>77</td>
      <td>Ferreira, Abener</td>
      <td>Masculino</td>
      <td>16/5/1976</td>
      <td>Guaratuba</td>
      <td>Parana</td>
    </tr>
    <tr>
      <th>6</th>
      <td>78</td>
      <td>Garcia, Adenir</td>
      <td>Masculino</td>
      <td>17/6/1977</td>
      <td>Morretes</td>
      <td>Parana</td>
    </tr>
    <tr>
      <th>7</th>
      <td>79</td>
      <td>Gomes, Adenil</td>
      <td>Masculino</td>
      <td>18/7/1978</td>
      <td>Recife</td>
      <td>Pernambuco</td>
    </tr>
    <tr>
      <th>8</th>
      <td>80</td>
      <td>Lima, Abener</td>
      <td>Masculino</td>
      <td>19/8/1979</td>
      <td>Recife</td>
      <td>Pernambuco</td>
    </tr>
    <tr>
      <th>9</th>
      <td>81</td>
      <td>Almeida, Adenevaldo</td>
      <td>Masculino</td>
      <td>20/9/1980</td>
      <td>Recife</td>
      <td>Pernambuco</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="id5">
<h2>4 Integração de Esquemas<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<p>Analisando-se as três fontes de dados, verifica-se que existem vários conflitos de nome e um conflito semântico. Todos esses conflitos devem ser tratados na integração de esquemas, conforme descrito a seguir.</p>
<section id="id6">
<h3>4.1 Conflitos de nome (sinônimo)<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<p>Um conflito de nome (sinônimo) ocorre quando diferentes nomes são aplicados ao mesmo elemento. funcionarioRelacional, colaboradorJSON e empregadoPlanilha armazenam dados de funcionários. Existem vários conflitos de nome quando  os nomes dos atributos do esquema de relação <em>funcionario</em> são comparados com os nomes das colunas oriundas das respectivas fontes de dados.</p>
<p>A partir da identificação dos conflitos, são definidas as correspondências existentes entre as fontes de dados e o esquema de relação do <em>data mart</em>. Essas correspondências são as mesmas que as identificadas no documento textual que acompanha esta aula. Elas são repetidas aqui por completude.</p>
<p>As correspondências entre os esquemas de <em>funcionario</em> e funcionarioRelacional são:</p>
<ol class="arabic simple">
<li><p><em>funcionario</em> <span class="math notranslate nohighlight">\(\equiv\)</span> funcionarioRelacional</p></li>
</ol>
<blockquote>
<div><p>(a) funcMatricula = funcMatricula</p>
</div></blockquote>
<blockquote>
<div><p>(b) funcNome = funcNome</p>
</div></blockquote>
<blockquote>
<div><p>(c) funcSexo = funcSexo</p>
</div></blockquote>
<blockquote>
<div><p>(d) funcDataNascimento = funcDataNasc</p>
</div></blockquote>
<blockquote>
<div><p>(e) funcCidade = funcCidade</p>
</div></blockquote>
<blockquote>
<div><p>(f) funcEstadoSigla = funcEstado</p>
</div></blockquote>
<blockquote>
<div><p>(g) funcPaisNome = funcPais</p>
</div></blockquote>
<p>De acordo com essas correspondências, o comando a seguir mapeia os nomes das colunas de funcionarioRelacional para os nomes dos atributos de <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">,</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">,</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">,</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir exibe a nova estrutura e o primeiro elemento de funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>sao paulo</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As correspondências entre os esquemas de funcionario e colaboradorJSON são:</p>
<ol class="arabic simple" start="2">
<li><p><em>funcionario</em> <span class="math notranslate nohighlight">\(\equiv\)</span> colaboradorJSON</p></li>
</ol>
<blockquote>
<div><p>(a) funcMatricula = colab_matricula</p>
</div></blockquote>
<blockquote>
<div><p>(b) funcNome = colab_nome</p>
</div></blockquote>
<blockquote>
<div><p>(c) funcSexo = colab_sexo</p>
</div></blockquote>
<blockquote>
<div><p>(d) funcDataNascimento = colab_data_nasc</p>
</div></blockquote>
<blockquote>
<div><p>(e) funcCidade = colab_cidade</p>
</div></blockquote>
<blockquote>
<div><p>(f) funcEstadoSigla = colab_estado</p>
</div></blockquote>
<blockquote>
<div><p>(g) funcPaisSigla = colab_pais</p>
</div></blockquote>
<p>De acordo com essas correspondências, o comando a seguir mapeia os nomes das colunas de colaboradorJSON para os nomes dos atributos de <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">,</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">,</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">,</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir exibe a nova estrutura e o primeiro elemento de colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>Arao Alves</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="exercicio-2">
<h3>Exercício 2<a class="headerlink" href="#exercicio-2" title="Permalink to this heading">#</a></h3>
<p>Considere as correspondências entre os esquemas de funcionario e empregadoPlanilha definidas a seguir:</p>
<ol class="arabic simple" start="3">
<li><p><em>funcionario</em> <span class="math notranslate nohighlight">\(\equiv\)</span> empregadoPlanilha</p></li>
</ol>
<blockquote>
<div><p>(a) funcMatricula = Matrícula do Empregado</p>
</div></blockquote>
<blockquote>
<div><p>(b) funcNome = Nome do Empregado</p>
</div></blockquote>
<blockquote>
<div><p>(c) funcSexo = Sexo do Empregado</p>
</div></blockquote>
<blockquote>
<div><p>(d) funcDataNascimento = Data de Nascimento</p>
</div></blockquote>
<blockquote>
<div><p>(e) funcCidade = Cidade de Residência</p>
</div></blockquote>
<blockquote>
<div><p>(f) funcEstadoNome = Estado de Residência</p>
</div></blockquote>
<p>De acordo com essas regras correspondências,</p>
<p><strong>Exercício 2a.</strong> Realize o mapeamento dos nomes das colunas de empregadoPlanilha para os nomes dos atributos de <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realize o mapeamento em &#39;empregadoPlanilha&#39;, de acordo com as instrucoes acima</span>
<span class="n">empregadoPlanilha</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">,</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">,</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercício 2b.</strong> Exiba a nova estrutura e o primeiro elemento de empregadoPlanilha.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imprima a primeira instância de &#39;empregadoPlanilha&#39;</span>
<span class="n">empregadoPlanilha</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13</td>
      <td>Dias, Abdiel</td>
      <td>NaN</td>
      <td>13/01/1990</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id7">
<h3>4.2 Conflito semântico<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<p>Um conflito semântico ocorre quando o mesmo elemento é modelado em diferentes esquemas, porém representando conjuntos que se sobrepõem. Como definido anteriormente, funcionarioRelacional armazena os funcionários da área de Engenharia, enquanto que colaboradorJSON armazena os funcionários da área de <em>Marketing</em>. É importante notar que: (i) existem funcionários que são diferentes entre si; (ii) o mesmo funcionário pode estar armazenado em mais do que uma fonte de dados, desde que ele mudou de área de atuação durante a sua trajetória.</p>
<p>Assim, devem ser identificados os funcionários que correspondem à mesma entidade do mundo real. Nesta aplicação de <em>data warehousing</em>, isso é feito por meio das <strong>matrículas</strong> dos funcionários, ou seja, considera-se a identificação unívoca das entidades. Considera-se também que os valores referentes à matricula dos funcionários já foram analisados na operação de limpeza dos dados e representam valores acurados. Portanto, <code class="docutils literal notranslate"><span class="pre">funcMatricula</span></code> pode ser usado para identificar os funcionários.</p>
<p>O comando a seguir mostra a quantidade de funcionários que aparecem em ambos funcionarioRelacional e colaboradorJSON, bem como detalhes desses funcionários. Isso significa que o funcionário transitou entre as áreas de Engenharia e <em>Marketing</em>. O sufixo <code class="docutils literal notranslate"><span class="pre">_x</span></code> indica colunas de funcionarioRelacional, enquanto que o sufixo <code class="docutils literal notranslate"><span class="pre">_y</span></code> indica colunas de colaboradorJSON. Como resultado, o <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> funcionario_colaborador possui os funcionários presentes em ambas fontes de dados. Os conflitos têm que ser resolvidos, o que será realizado durante a integração de instâncias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario_colaborador</span> <span class="o">=</span> <span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">colaboradorJSON</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de mesmos funcionários cadastrados nas fontes 1 e 2: &#39;</span><span class="p">,</span> <span class="n">funcionario_colaborador</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># renomeando algumas colunas sem sufixo</span>
<span class="n">funcionario_colaborador</span> <span class="o">=</span> <span class="n">funcionario_colaborador</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">:</span> <span class="s1">&#39;funcPaisSigla_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">:</span> <span class="s1">&#39;funcPaisNome_x&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># apresente o resultado do conflito</span>
<span class="n">colunas_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla_y&#39;</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario_colaborador</span><span class="p">[</span><span class="n">colunas_display</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantidade de mesmos funcionários cadastrados nas fontes 1 e 2:  7
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome_x</th>
      <th>funcNome_y</th>
      <th>funcCidade_x</th>
      <th>funcCidade_y</th>
      <th>funcPaisNome_x</th>
      <th>funcPaisSigla_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>NaN</td>
      <td>Arao Alves</td>
      <td>campinas</td>
      <td>None</td>
      <td>brasil</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>ADA BARBOSA</td>
      <td>None</td>
      <td>santo andre</td>
      <td>None</td>
      <td>brasil</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>ABADIAS CAMPOS</td>
      <td>None</td>
      <td>ilha bela</td>
      <td>None</td>
      <td>brasil</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13</td>
      <td>ABDIEL DIAS</td>
      <td>Arao Alves</td>
      <td>rio de janeiro</td>
      <td>None</td>
      <td>brasil</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>4</th>
      <td>64</td>
      <td>ABILIO BARBOSA</td>
      <td>None</td>
      <td>NaN</td>
      <td>Osasco</td>
      <td>NaN</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>5</th>
      <td>67</td>
      <td>ADELMA BORGES</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>brasil</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>83</td>
      <td>ADENIAS ANDRADE</td>
      <td>Adenias Andrade</td>
      <td>campinas</td>
      <td>None</td>
      <td>NaN</td>
      <td>BRA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="exercicio-3">
<h3>Exercício 3<a class="headerlink" href="#exercicio-3" title="Permalink to this heading">#</a></h3>
<p>Especifique comandos similares aos comandos definidos acima para funcionario_colaborador, considerando as seguintes aspectos:</p>
<p><strong>Exercício 3a.</strong> Gere o DataFrame funcionario_empregado, o qual contém os funcionários que aparecem em ambos funcionarioRelacional e empregadoPlanilha. Nesse exercício você utilizará as fontes <code class="docutils literal notranslate"><span class="pre">funcionarioRelacional</span></code> e <code class="docutils literal notranslate"><span class="pre">empregadoPlanilha</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario_empregado</span> <span class="o">=</span> <span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">empregadoPlanilha</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>

<span class="c1"># apresente o resultado do conflito</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de mesmos funcionários cadastrados nas fontes 1 e 3: &#39;</span><span class="p">,</span> <span class="n">funcionario_empregado</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario_empregado</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantidade de mesmos funcionários cadastrados nas fontes 1 e 3:  7
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome_x</th>
      <th>funcSexo_x</th>
      <th>funcDataNascimento_x</th>
      <th>funcCidade_x</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisNome</th>
      <th>funcNome_y</th>
      <th>funcSexo_y</th>
      <th>funcDataNascimento_y</th>
      <th>funcCidade_y</th>
      <th>funcEstadoNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13</td>
      <td>ABDIEL DIAS</td>
      <td>M</td>
      <td>13/1/1990</td>
      <td>rio de janeiro</td>
      <td>rj</td>
      <td>brasil</td>
      <td>Dias, Abdiel</td>
      <td>NaN</td>
      <td>13/01/1990</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16</td>
      <td>ABDALLA FERNANDES</td>
      <td>M</td>
      <td>16/4/1990</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>brasil</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Praia Seca</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32</td>
      <td>NaN</td>
      <td>M</td>
      <td>1/8/1990</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Costa, Abdiel</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Piracicaba</td>
      <td>Sao Paulo</td>
    </tr>
    <tr>
      <th>3</th>
      <td>86</td>
      <td>ADENILDE BARROS</td>
      <td>NaN</td>
      <td>25/2/1985</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Barros, Adenilde</td>
      <td>Feminino</td>
      <td>NaN</td>
      <td>Piracicaba</td>
      <td>Sao Paulo</td>
    </tr>
    <tr>
      <th>4</th>
      <td>90</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>29/6/1989</td>
      <td>sao jose do rio preto</td>
      <td>sp</td>
      <td>brasil</td>
      <td>Carvalho, Adenilton</td>
      <td>Masculino</td>
      <td>29/6/1989</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>67</td>
      <td>ADELMA BORGES</td>
      <td>M</td>
      <td>6/7/1966</td>
      <td>NaN</td>
      <td>rj</td>
      <td>brasil</td>
      <td>Borges, Adelma</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>6</th>
      <td>83</td>
      <td>ADENIAS ANDRADE</td>
      <td>NaN</td>
      <td>22/11/1982</td>
      <td>campinas</td>
      <td>sp</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Masculino</td>
      <td>22/11/1982</td>
      <td>Campinas</td>
      <td>Sao Paulo</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Exercício 3b.</strong> Gere o DataFrame colaborador_empregado, o qual contém os funcionários que aparecem em ambos colaboradorJSON e empregadoPlanilha. Nesse exercício você utilizará as fontes <code class="docutils literal notranslate"><span class="pre">colaboradorJSON</span></code> e <code class="docutils literal notranslate"><span class="pre">empregadoPlanilha</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaborador_empregado</span> <span class="o">=</span> <span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">empregadoPlanilha</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>

<span class="c1"># apresente o resultado do conflito</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de mesmos funcionários cadastrados nas fontes 2 e 3: &#39;</span><span class="p">,</span> <span class="n">colaborador_empregado</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">colaborador_empregado</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantidade de mesmos funcionários cadastrados nas fontes 2 e 3:  5
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome_x</th>
      <th>funcSexo_x</th>
      <th>funcDataNascimento_x</th>
      <th>funcCidade_x</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisSigla</th>
      <th>funcNome_y</th>
      <th>funcSexo_y</th>
      <th>funcDataNascimento_y</th>
      <th>funcCidade_y</th>
      <th>funcEstadoNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13</td>
      <td>Arao Alves</td>
      <td>0.0</td>
      <td>None</td>
      <td>None</td>
      <td>RJ</td>
      <td>BRA</td>
      <td>Dias, Abdiel</td>
      <td>NaN</td>
      <td>13/01/1990</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>1</th>
      <td>66</td>
      <td>Adelita Barros</td>
      <td>1.0</td>
      <td>None</td>
      <td>Barueri</td>
      <td>None</td>
      <td>BRA</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>05/06/1965</td>
      <td>NaN</td>
      <td>Sao Paulo</td>
    </tr>
    <tr>
      <th>2</th>
      <td>67</td>
      <td>None</td>
      <td>0.0</td>
      <td>1966-07-06</td>
      <td>None</td>
      <td>RJ</td>
      <td>None</td>
      <td>Borges, Adelma</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>3</th>
      <td>83</td>
      <td>Adenias Andrade</td>
      <td>0.0</td>
      <td>1982-11-22</td>
      <td>None</td>
      <td>None</td>
      <td>BRA</td>
      <td>NaN</td>
      <td>Masculino</td>
      <td>22/11/1982</td>
      <td>Campinas</td>
      <td>Sao Paulo</td>
    </tr>
    <tr>
      <th>4</th>
      <td>99</td>
      <td>Adercio Gomes</td>
      <td>0.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7/3/1998</td>
      <td>Araguari</td>
      <td>Minas Gerais</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Exercício 3c.</strong> Gere o DataFrame funcionario_colaborador_empregado, o qual contém os funcionários que aparecem em todas as fontes de dados. Nesse exercício você utilizará os DataFrame <code class="docutils literal notranslate"><span class="pre">funcionario_colaborador</span></code> e <code class="docutils literal notranslate"><span class="pre">empregadoPlanilha</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario_colaborador_empregado</span> <span class="o">=</span> <span class="n">funcionario_colaborador</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">empregadoPlanilha</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>

<span class="c1"># apresente o resultado do conflito</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quantidade de mesmos funcionários cadastrados nas fontes 1, 2 e 3: &#39;</span><span class="p">,</span> <span class="n">funcionario_colaborador_empregado</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario_colaborador_empregado</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Quantidade de mesmos funcionários cadastrados nas fontes 1, 2 e 3:  3
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome_x</th>
      <th>funcSexo_x</th>
      <th>funcDataNascimento_x</th>
      <th>funcCidade_x</th>
      <th>funcEstadoSigla_x</th>
      <th>funcPaisNome_x</th>
      <th>funcNome_y</th>
      <th>funcSexo_y</th>
      <th>funcDataNascimento_y</th>
      <th>funcCidade_y</th>
      <th>funcEstadoSigla_y</th>
      <th>funcPaisSigla_y</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13</td>
      <td>ABDIEL DIAS</td>
      <td>M</td>
      <td>13/1/1990</td>
      <td>rio de janeiro</td>
      <td>rj</td>
      <td>brasil</td>
      <td>Arao Alves</td>
      <td>0.0</td>
      <td>None</td>
      <td>None</td>
      <td>RJ</td>
      <td>BRA</td>
      <td>Dias, Abdiel</td>
      <td>NaN</td>
      <td>13/01/1990</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>1</th>
      <td>67</td>
      <td>ADELMA BORGES</td>
      <td>M</td>
      <td>6/7/1966</td>
      <td>NaN</td>
      <td>rj</td>
      <td>brasil</td>
      <td>None</td>
      <td>0.0</td>
      <td>1966-07-06</td>
      <td>None</td>
      <td>RJ</td>
      <td>None</td>
      <td>Borges, Adelma</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
    </tr>
    <tr>
      <th>2</th>
      <td>83</td>
      <td>ADENIAS ANDRADE</td>
      <td>NaN</td>
      <td>22/11/1982</td>
      <td>campinas</td>
      <td>sp</td>
      <td>NaN</td>
      <td>Adenias Andrade</td>
      <td>0.0</td>
      <td>1982-11-22</td>
      <td>None</td>
      <td>None</td>
      <td>BRA</td>
      <td>NaN</td>
      <td>Masculino</td>
      <td>22/11/1982</td>
      <td>Campinas</td>
      <td>Sao Paulo</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id8">
<h3>4.3 Padronização das colunas<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<p>O esquema de relação <em>funcionario</em> possui vários atributos que não estão presentes nas fontes de dados. Os comandos a seguir visam acrescentar colunas a funcionarioRelacional e colaboradorJSON. É atributído valor NULO para os valores dessas colunas.</p>
<p>Os comandos a seguir realizam as seguintes ações para funcionarioRelacional. Primeiro, é mostrada a estrutura atual. Depois, são adicionadas as novas colunas, ou seja, as colunas faltantes. Por fim, é exibida a estrutura final.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcPaisNome&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcRegiaoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">funcionarioRelacional</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcPaisNome&#39;,
 &#39;funcDiaNascimento&#39;,
 &#39;funcMesNascimento&#39;,
 &#39;funcAnoNascimento&#39;,
 &#39;funcEstadoNome&#39;,
 &#39;funcRegiaoNome&#39;,
 &#39;funcRegiaoSigla&#39;,
 &#39;funcPaisSigla&#39;]
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam as seguintes ações para colaboradorJSON. Primeiro, é mostrada a estrutura atual. Depois, são adicionadas as novas colunas, ou seja, as colunas faltantes. Por fim, é exibida a estrutura final.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcPaisSigla&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcRegiaoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">colaboradorJSON</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcPaisSigla&#39;,
 &#39;funcDiaNascimento&#39;,
 &#39;funcMesNascimento&#39;,
 &#39;funcAnoNascimento&#39;,
 &#39;funcEstadoNome&#39;,
 &#39;funcRegiaoNome&#39;,
 &#39;funcRegiaoSigla&#39;,
 &#39;funcPaisNome&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercicio-4">
<h3>Exercício 4<a class="headerlink" href="#exercicio-4" title="Permalink to this heading">#</a></h3>
<p>Adicione as colunas faltantes em empregadoPlanilha, de forma similar aos comandos anteriores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apresente as colunas de &#39;empregadoPlanilha&#39;</span>
<span class="n">empregadoPlanilha</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoNome&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adicione as colunas faltantes em &#39;empregadoPlanilha&#39;</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcRegiaoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">empregadoPlanilha</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apresente todas as colunas atuais de &#39;empregadoPlanilha&#39;</span>
<span class="n">empregadoPlanilha</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoNome&#39;,
 &#39;funcDiaNascimento&#39;,
 &#39;funcMesNascimento&#39;,
 &#39;funcAnoNascimento&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcRegiaoNome&#39;,
 &#39;funcRegiaoSigla&#39;,
 &#39;funcPaisNome&#39;,
 &#39;funcPaisSigla&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id9">
<h2>5 Integração de Instâncias<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h2>
<p>Após a integração dos esquemas, é necessário realizar a integração de instâncias. Todas as instâncias presentes em funcionarioRelacional e em colaboradorJSON têm que ser integradas em <em>funcionario</em>, considerando o tipo de dados e o formato dos atributos desse esquema de relação.</p>
<p>Os seguintes tipos de dados e formatos são considerados para os atributos de <em>funcionario</em>:</p>
<p>a) funcMatricula: numérico;</p>
<p>b) funcNome: alfanumérico, com todas as letras maiúsculas;</p>
<p>c) funcSexo: alfanumérico de 1 caractere, com M indicando masculino e F indicando feminino;</p>
<p>d) funcDataNascimento: alfanumérico, com formato <code class="docutils literal notranslate"><span class="pre">dia/mês/ano</span></code>;</p>
<p>e) funcCidade: alfanumérico, com todas as letras maiúsculas;</p>
<p>f) funcEstadoNome: alfanumérico, com todas as letras maiúsculas;</p>
<p>g) funcEstadoSigla: alfanumérico de 2 caracteres, com todas as letras maiúsculas;</p>
<p>h) funcPaisNome: alfanumérico, com todas as letras maiúsculas;</p>
<p>i) funcPaisSigla: alfanumérico de 3 letras, com todas as letras maiúsculas;</p>
<section id="id10">
<h3>5.1 Considerando a fonte de dados funcionarioRelacional<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<p>O comando a seguir exemplifica instâncias de funcionarioRelacional.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionarioRelacional</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisNome</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcEstadoNome</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>sao paulo</td>
      <td>sp</td>
      <td>brasil</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaN</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>campinas</td>
      <td>sp</td>
      <td>brasil</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>santos</td>
      <td>sp</td>
      <td>brasil</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Para facilitar as manipulações que devem ser realizadas nas instâncias de  funcionarioRelacional, é criada uma classe em Python chamada <code class="docutils literal notranslate"><span class="pre">ProcessamentoFonteRelacional</span></code>. Nessa classe, são criados vários métodos. Cada método é responsável pela tranformação de um dos atributos do conjunto de dados. Para essa fonte foram aplicados os seguintes mapeamentos: e (funcCidade), g (funcEstadoSigla), h (funcPaisNome).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProcessamentoFonteRelacional</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Realiza a tranformacao de um dataframe com formato da fonte </span>
<span class="sd">  funcionarioRelacional para um dataframe que segue os padrões definidos </span>
<span class="sd">  para o esquema de relação funcionario.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_funcionario</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span> <span class="o">=</span> <span class="n">dados_funcionario</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">processar_cidade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cidade</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a cidade em funcionarioRelacional precisa ser</span>
<span class="sd">    transformado para caracteres maiúsculos. Esta função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">cidade</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">cidade</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">processar_estado_sigla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estado</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a sigla do estado em funcionarioRelacional </span>
<span class="sd">    precisa ser transformado para caracteres maiúsculos. Essa função realiza </span>
<span class="sd">    essa transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">estado</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">estado</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">processar_pais_nome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paisNome</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa o nome do país em funcionarioRelacional precisa </span>
<span class="sd">    ser transformado para caracteres maiúsculos. Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">paisNome</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">paisNome</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">executar_transformacoes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Essa função processa cada atributo do dataframe composto pelos dados da </span>
<span class="sd">    fonte funcionarioRelacional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_cidade</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_estado_sigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_pais_nome</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span>
</pre></div>
</div>
</div>
</div>
<p>O primeiro comando a seguir realiza o processamento da fonte funcionarioRelacional, enquanto que o segundo comando mostra alguns funcionários de funcionarioRelacional depois de ser realizado o mapeamento para o tipo de dados e o formato de funcionario.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_funcionario_relacional</span> <span class="o">=</span> <span class="n">ProcessamentoFonteRelacional</span><span class="p">(</span><span class="n">funcionarioRelacional</span><span class="p">)</span><span class="o">.</span><span class="n">executar_transformacoes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_funcionario_relacional</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisNome</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcEstadoNome</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaN</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>CAMPINAS</td>
      <td>SP</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>SANTOS</td>
      <td>SP</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id11">
<h3>5.2 Considerando a fonte de dados colaboradorJSON<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h3>
<p>O comando a seguir exemplifica instâncias de colaboradorJSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colaboradorJSON</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisSigla</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcEstadoNome</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>Arao Alves</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>None</td>
      <td>1.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>None</td>
      <td>NaN</td>
      <td>1990-08-08</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Para facilitar as manipulações que devem ser realizadas nas instâncias de  colaboradorJSON, foi criada uma classe em Python chamada <code class="docutils literal notranslate"><span class="pre">ProcessamentoFonteJSON</span></code>. Nessa classe, são criados vários métodos. Cada método é responsável pela tranformação de um dos atributos do conjunto de dados. Para essa fonte foram aplicados os seguintes mapeamentos: b (funcNome), c (funcSexo), d (funcDataNascimento), e (funcCidade), g (funcEstadoSigla), i (funcPaisSigla).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProcessamentoFonteJSON</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Realiza a tranformacao de um dataframe com formato da fonte colaboradorJSON </span>
<span class="sd">  para um dataframe que segue os padrões definidos pelo esquema de </span>
<span class="sd">  relação funcionario.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_funcionario</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span> <span class="o">=</span> <span class="n">dados_funcionario</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">processar_nome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a o nome do funcionário em colaboradorJSON </span>
<span class="sd">    precisa ser transformado para caracteres maiúsculos. Essa função realiza </span>
<span class="sd">    essa transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">nome</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">nome</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">processar_sexo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sexo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa sexo em colaboradorJSON utiliza uma representação</span>
<span class="sd">    binária, na qual o valor 0 representa masculino e 1 representa feminino. </span>
<span class="sd">    Essa função é responsável por representar os valores de sexo como M e F,</span>
<span class="sd">    respectivamente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">sexo</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="s1">&#39;M&#39;</span> <span class="k">if</span> <span class="n">sexo</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;F&#39;</span>

  <span class="k">def</span> <span class="nf">processar_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a data de nascimento em colaboradorJSON precisa </span>
<span class="sd">    ser transformado para o formato &#39;dia/mês/ano&#39;.  Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>
      
    <span class="n">ano</span><span class="p">,</span> <span class="n">mes</span><span class="p">,</span> <span class="n">dia</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%02d</span><span class="s1">/</span><span class="si">%02d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dia</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mes</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ano</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">processar_cidade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cidade</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa o nome da cidade em colaboradorJSON precisa ser</span>
<span class="sd">    transformado para caracteres minúsculos. Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">cidade</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">cidade</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">processar_estado_sigla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estado</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a sigla do estado em colaboradorJSON precisa ser</span>
<span class="sd">    transformado para caracteres minúsculos. Essa função realiza essa</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">estado</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">estado</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">processar_pais_sigla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pais</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a sigla do pais em colaboradorJSON </span>
<span class="sd">    segue o mesmo padrão adotado pelo atributo funcPaisSigla de funcionario. </span>
<span class="sd">    Portanto, não há necessidade de realizar transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">pais</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">pais</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">executar_transformacoes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Essa função processa cada atributo do dataframe composto pelos dados da </span>
<span class="sd">    fonte colaboradorJSON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_nome</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_sexo</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_data</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_cidade</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_estado_sigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_pais_sigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span>
</pre></div>
</div>
</div>
</div>
<p>O primeiro comando a seguir realiza o processamento da fonte colaboradorJSON,  enquanto que o segundo comando mostra alguns funcionários de colaborador JSON depois de ser realizado o mapeamento para o tipo de dados e o formato de <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_colaborador_JSON</span> <span class="o">=</span> <span class="n">ProcessamentoFonteJSON</span><span class="p">(</span><span class="n">colaboradorJSON</span><span class="p">)</span><span class="o">.</span><span class="n">executar_transformacoes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_colaborador_JSON</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisSigla</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcEstadoNome</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>ARAO ALVES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>None</td>
      <td>F</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>None</td>
      <td>None</td>
      <td>08/08/1990</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="considerando-a-fonte-de-dados-empregadoplanilha">
<h3>5.3 Considerando a fonte de dados empregadoPlanilha<a class="headerlink" href="#considerando-a-fonte-de-dados-empregadoplanilha" title="Permalink to this heading">#</a></h3>
</section>
<section id="exercicio-5">
<h3>Exercício 5<a class="headerlink" href="#exercicio-5" title="Permalink to this heading">#</a></h3>
<p>Para facilitar as manipulações que devem ser realizadas nas instâncias de  empregadoPlanilha, crie uma classe em Python chamada <code class="docutils literal notranslate"><span class="pre">ProcessamentoFontePlanilha</span></code>. Nessa classe, devem criados vários métodos. Cada método deve ser responsável pela tranformação de um dos atributos do conjunto de dados. Para essa fonte devem ser aplicados os seguintes mapeamentos: b) (funcNome), c (funcSexo), e (funcCidade), f (funcEstadoNome).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize a estrutura atual, para em seguida definir como criar a classe de processamento</span>
<span class="n">empregadoPlanilha</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcEstadoSigla</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13</td>
      <td>Dias, Abdiel</td>
      <td>NaN</td>
      <td>13/01/1990</td>
      <td>Rio De Janeiro</td>
      <td>Rio de Janeiro</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Praia Seca</td>
      <td>Rio de Janeiro</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32</td>
      <td>Costa, Abdiel</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Piracicaba</td>
      <td>Sao Paulo</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProcessamentoFontePlanilha</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Realiza a tranformacao de um dataframe com formato da fonte 3 (Planilha) para</span>
<span class="sd">  um dataframe que segue os padrões definidos pelo data warehouse</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_funcionario</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span> <span class="o">=</span> <span class="n">dados_funcionario</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">processar_nome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Os nomes coletados a partir da fonte 3 (Planilha) seguem um padrão em que o </span>
<span class="sd">    último nome vêm antes do primeiro. Portanto, esta função é responsável</span>
<span class="sd">    por deixar todo o nome capitalizado (em upper case), aplicando o padrão do </span>
<span class="sd">    data warehouse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">nome</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="n">ultimo</span><span class="p">,</span> <span class="n">primeiro</span> <span class="o">=</span> <span class="n">nome</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nome</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">primeiro</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ultimo</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">nome</span>

  <span class="k">def</span> <span class="nf">processar_sexo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sexo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo sexo coletados a partir da fonte 3 (Planilha) segue uma</span>
<span class="sd">    representação textual, contendo os valores Masculino e Feminino.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">sexo</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="s1">&#39;M&#39;</span> <span class="k">if</span> <span class="n">sexo</span> <span class="o">==</span> <span class="s1">&#39;Masculino&#39;</span> <span class="k">else</span> <span class="s1">&#39;F&#39;</span>

  <span class="k">def</span> <span class="nf">processar_cidade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cidade</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa a cidade na fonte 3 (Planilha) necessita ser</span>
<span class="sd">    transformado para caracteres minúsculos; essa função realiza tal</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">cidade</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">cidade</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">processar_estado</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estado</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    O atributo que representa o estado na fonte 3 (Planilha) necessita ser</span>
<span class="sd">    transformado para caracteres minúsculos; essa função realiza tal</span>
<span class="sd">    transformação.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">estado</span><span class="p">):</span>
      <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">estado</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>


  <span class="k">def</span> <span class="nf">executar_transformacoes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Processa cada atributo do dataframe composto por dados da fonte 3 (Planilha)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_nome</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_sexo</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_cidade</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcCidade&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processar_estado</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonte_dados</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize o resultado</span>
<span class="n">novo_empregado_planilha</span> <span class="o">=</span> <span class="n">ProcessamentoFontePlanilha</span><span class="p">(</span><span class="n">empregadoPlanilha</span><span class="p">)</span><span class="o">.</span><span class="n">executar_transformacoes</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize o resultado</span>
<span class="n">novo_empregado_planilha</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcEstadoSigla</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13</td>
      <td>ABDIEL DIAS</td>
      <td>None</td>
      <td>13/01/1990</td>
      <td>RIO DE JANEIRO</td>
      <td>RIO DE JANEIRO</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>PRAIA SECA</td>
      <td>RIO DE JANEIRO</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32</td>
      <td>ABDIEL COSTA</td>
      <td>None</td>
      <td>NaN</td>
      <td>PIRACICABA</td>
      <td>SAO PAULO</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id12">
<h3>5.4 Integrando as instâncias<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h3>
<p>Todas as instâncias presentes em novo_funcionario_relacional e novo_colaborador_JSON devem ser integradas.</p>
<p>Apenas para relembrar, existem funcionários presentes tanto em funcionarioRelacional quanto em colaboradorJSON. O comando a seguir mostra alguns exemplos de colunas que possuem valores diferentes de atributos. Colunas com sufixo <code class="docutils literal notranslate"><span class="pre">_x</span></code> representam colunas de novo_funcionario_relacional, enquanto que colunas com sufixo <code class="docutils literal notranslate"><span class="pre">_y</span></code> representam colunas de novo_colaborador_JSON.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colunas_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;funcNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade_y&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome_x&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla_y&#39;</span><span class="p">]</span>
<span class="n">novo_funcionario_relacional</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">novo_colaborador_JSON</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">)[</span><span class="n">colunas_display</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcNome_x</th>
      <th>funcNome_y</th>
      <th>funcCidade_x</th>
      <th>funcCidade_y</th>
      <th>funcPaisNome_x</th>
      <th>funcPaisSigla_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>ARAO ALVES</td>
      <td>CAMPINAS</td>
      <td>None</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ADA BARBOSA</td>
      <td>None</td>
      <td>SANTO ANDRE</td>
      <td>None</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ABADIAS CAMPOS</td>
      <td>None</td>
      <td>ILHA BELA</td>
      <td>None</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ABDIEL DIAS</td>
      <td>ARAO ALVES</td>
      <td>RIO DE JANEIRO</td>
      <td>None</td>
      <td>BRASIL</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ABILIO BARBOSA</td>
      <td>None</td>
      <td>None</td>
      <td>OSASCO</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ADELMA BORGES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ADENIAS ANDRADE</td>
      <td>ADENIAS ANDRADE</td>
      <td>CAMPINAS</td>
      <td>None</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Para facilitar o processo, a coluna <code class="docutils literal notranslate"><span class="pre">funcMatricula</span></code> é transformada em índice do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocessamento_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Clona o DataFrame, e altera o indice para funcMatricula</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">ndf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ndf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">novo_funcionario_relacional</span> <span class="o">=</span> <span class="n">preprocessamento_dataframe</span><span class="p">(</span><span class="n">novo_funcionario_relacional</span><span class="p">)</span>
<span class="n">novo_colaborador_JSON</span> <span class="o">=</span> <span class="n">preprocessamento_dataframe</span><span class="p">(</span><span class="n">novo_colaborador_JSON</span><span class="p">)</span>
<span class="n">novo_empregado_planilha</span> <span class="o">=</span> <span class="n">preprocessamento_dataframe</span><span class="p">(</span><span class="n">novo_empregado_planilha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Um aspecto importante considerado na integração de instâncias é a confiabilidade das fontes, definida da seguinte forma: a fonte 1 é a mais confiável, seguida pela fonte 2, seguida pela fonte 3 que é a fonte menos confiável.</p>
<p>O comando a seguir escolhe o valor do atributo mais confiável tendo como entrada 2 fontes representadas por A e B.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">processar_conflitos</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">fonte_A</span><span class="p">,</span> <span class="n">fonte_B</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Processa os conflitos das fontes com base na confiabilidade das mesmas,</span>
<span class="sd">  Sendo a fonte_A a mais confiável.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">columns</span> <span class="o">=</span> <span class="n">fonte_A</span><span class="o">.</span><span class="n">columns</span>
  <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">fonte_A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">fonte_B</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
      <span class="n">fonte_A</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">column</span><span class="p">])</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">fonte_A</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir integra instâncias presentes tanto em novo_funcionario_relacional quanto em novo_colaborador_JSON usando como base a confiabilidade das fontes. Os valores dos atributos do primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> são escolhidos a menos que sejam valores nulos. Nesse caso, são escolhidos os valores dos atributos do segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Note que, em <code class="docutils literal notranslate"><span class="pre">df_processado</span></code>, são armazenados todos os funcionários da fonte funcionarioRelacional, sendo que, para os funcionários presentes também em colaboradorJSON, ocorre a resolução dos valores dos atributos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># comandos para resolver indices do conflito da fonte 1 (mais confiável) e fonte 2</span>
<span class="c1"># DataFrame de conflito entre a fonte 1 e fonte 2</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">funcionario_colaborador</span><span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># processa a integracao</span>
<span class="n">df_processado</span> <span class="o">=</span> <span class="n">processar_conflitos</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">novo_funcionario_relacional</span><span class="p">,</span> <span class="n">novo_colaborador_JSON</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualiza o resultado da integração, adicao de valores a fonte 1, provenientes da fonte 2</span>
<span class="n">df_processado</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">][[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcNome</th>
      <th>funcCidade</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
    <tr>
      <th>funcMatricula</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>ARAO ALVES</td>
      <td>CAMPINAS</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ADA BARBOSA</td>
      <td>SANTO ANDRE</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ABADIAS CAMPOS</td>
      <td>ILHA BELA</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>ABDIEL DIAS</td>
      <td>RIO DE JANEIRO</td>
      <td>BRASIL</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>64</th>
      <td>ABILIO BARBOSA</td>
      <td>OSASCO</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>67</th>
      <td>ADELMA BORGES</td>
      <td>None</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ADENIAS ANDRADE</td>
      <td>CAMPINAS</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="exercicio-6">
<h3>Exercício 6<a class="headerlink" href="#exercicio-6" title="Permalink to this heading">#</a></h3>
<p>Realize comandos para integrar as instâncias, conforme especificado a seguir.</p>
<p><strong>Exercício 6a.</strong> Realize os dois comandos que aparecem no comentário # comandos para resolver indices …, porém, considerando conflitos entre a fonte 1 (mais confiável) e a fonte 3 (menos confiável). Para gerar <code class="docutils literal notranslate"><span class="pre">df_processado</span></code>, deve ser usado duas fontes: <code class="docutils literal notranslate"><span class="pre">df_processado</span></code> e <code class="docutils literal notranslate"><span class="pre">novo_empregado_planilha</span></code>. Além disso, utilize o <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> resultante do conflito da fonte 1 e fonte 3 para identificar os <code class="docutils literal notranslate"><span class="pre">indices</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># comandos para resolver indices do conflito da fonte 1 e fonte 3</span>
<span class="c1"># DataFrame de conflito entre a fonte 1 e fonte 3</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">funcionario_empregado</span><span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># processa a integracao</span>
<span class="n">df_processado</span> <span class="o">=</span> <span class="n">processar_conflitos</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">df_processado</span><span class="p">,</span> <span class="n">novo_empregado_planilha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_processado</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">][[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcNome</th>
      <th>funcCidade</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
    <tr>
      <th>funcMatricula</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>ABDIEL DIAS</td>
      <td>RIO DE JANEIRO</td>
      <td>BRASIL</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ABDALLA FERNANDES</td>
      <td>PRAIA SECA</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>32</th>
      <td>ABDIEL COSTA</td>
      <td>PIRACICABA</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>86</th>
      <td>ADENILDE BARROS</td>
      <td>PIRACICABA</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>90</th>
      <td>ADENILTON CARVALHO</td>
      <td>SAO JOSE DO RIO PRETO</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>67</th>
      <td>ADELMA BORGES</td>
      <td>RIO DE JANEIRO</td>
      <td>BRASIL</td>
      <td>None</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ADENIAS ANDRADE</td>
      <td>CAMPINAS</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Exercício 6b.</strong> Realize os dois comandos que aparecem no comentário # comandos para resolver indices …, porém, considerando conflitos entre a fonte 2 (mais confiável) e a fonte 3 (menos confiável). Para gerar <code class="docutils literal notranslate"><span class="pre">df_processado2</span></code>, deve ser usado duas fontes: <code class="docutils literal notranslate"><span class="pre">novo_colaborador_JSON</span></code> e <code class="docutils literal notranslate"><span class="pre">novo_empregado_planilha</span></code>. Além disso, utilize o <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> resultante do conflito da fonte 1 e fonte 3 para identificar os <code class="docutils literal notranslate"><span class="pre">indices</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># comandos para resolver indices do conflito da fonte 2 e fonte 3</span>
<span class="c1"># DataFrame de conflito entre a fonte 2 e fonte 3</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">colaborador_empregado</span><span class="p">[</span><span class="s1">&#39;funcMatricula&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># processa a integracao</span>
<span class="n">df_processado2</span> <span class="o">=</span> <span class="n">processar_conflitos</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">novo_colaborador_JSON</span><span class="p">,</span> <span class="n">novo_empregado_planilha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_processado2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">][[</span><span class="s1">&#39;funcNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcNome</th>
      <th>funcCidade</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
    <tr>
      <th>funcMatricula</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>ARAO ALVES</td>
      <td>RIO DE JANEIRO</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>66</th>
      <td>ADELITA BARROS</td>
      <td>BARUERI</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>67</th>
      <td>ADELMA BORGES</td>
      <td>RIO DE JANEIRO</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ADENIAS ANDRADE</td>
      <td>CAMPINAS</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>99</th>
      <td>ADERCIO GOMES</td>
      <td>ARAGUARI</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>O esquema de relação <em>funcionario</em> a ser armazenado no <em>data mart</em> deve conter todos os funcionários. Entretanto, como resultado do último comando, esse esquema contém apenas os funcionários presentes na fonte funcionarioRelacional. O comando a seguir incorpora também a <em>funcionario</em> todos os funcionários presentes na fonte colaboradorJSON, com exceção dos funcionários já considerados anteriormente. Como resultado, são geradas todas as instâncias de <em>funcionario</em>. Na sequência, o próximo comando ilustra algumas linhas geradas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">interseccao_indices</span><span class="p">(</span><span class="n">lst1</span><span class="p">,</span> <span class="n">lst2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Retornar os indices duplicados</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst1</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lst2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">combina_funcionario</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Realiza a uniao dos dataframes</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">indices1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
  <span class="n">indices2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
  <span class="c1"># remove os indices duplicados</span>
  <span class="n">indices_drop</span> <span class="o">=</span> <span class="n">interseccao_indices</span><span class="p">(</span><span class="n">indices1</span><span class="p">,</span> <span class="n">indices2</span><span class="p">)</span>
  <span class="n">df2_drop</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices_drop</span><span class="p">)</span>
  <span class="c1"># retorna a uniao dos dois dataframes</span>
  <span class="k">return</span> <span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2_drop</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span> <span class="o">=</span> <span class="n">combina_funcionario</span><span class="p">(</span><span class="n">df_processado</span><span class="p">,</span> <span class="n">df_processado2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercicio-7">
<h3>Exercício 7<a class="headerlink" href="#exercicio-7" title="Permalink to this heading">#</a></h3>
<p>Especifique um comando que incorpore também a <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> todos os funcionarios presentes na fonte <code class="docutils literal notranslate"><span class="pre">novo_empregado_planilha</span></code> (dica: usar a função <code class="docutils literal notranslate"><span class="pre">combina_funcionario</span></code> e a variável <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> produzida acima).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span> <span class="o">=</span> <span class="n">combina_funcionario</span><span class="p">(</span><span class="n">funcionario</span><span class="p">,</span> <span class="n">novo_empregado_planilha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Função para embaralhar os funcionários, e visualização da fonte final (dica: deve conter 100 instâncias).</p>
<p>Nessa etapa, embaralhamos os dados para simular a extração de dados, visto que os dados usualmente veem “bagunçados”. Independentemente de <code class="docutils literal notranslate"><span class="pre">funcMatricula</span></code> estar ordenado, algo que raramente ocorre, será atribuído <u>funcPK</u> na fonte final.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tamanho da fonte final: &#39;</span><span class="p">,</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tamanho da fonte final:  100
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoSigla</th>
      <th>funcPaisNome</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcEstadoNome</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>62</th>
      <td>63</td>
      <td>ADELINO ANDRADE</td>
      <td>M</td>
      <td>02/03/1962</td>
      <td>SAO JOSE DO RIO PRETO</td>
      <td>SP</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>46</th>
      <td>47</td>
      <td>ABEDON BORGES</td>
      <td>M</td>
      <td>16/11/1990</td>
      <td>MONTE VERDE</td>
      <td>MG</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>40</th>
      <td>41</td>
      <td>ADER ALMEIDA</td>
      <td>M</td>
      <td>10/5/1990</td>
      <td>ILHEUS</td>
      <td>RJ</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>99</th>
      <td>100</td>
      <td>ABERLADO LIMA</td>
      <td>M</td>
      <td>8/4/1999</td>
      <td>OURO PRETO</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>MINAS GERAIS</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>50</th>
      <td>51</td>
      <td>ADEILDO CASTRO</td>
      <td>M</td>
      <td>20/3/1950</td>
      <td>MORRETES</td>
      <td>PR</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>22</th>
      <td>23</td>
      <td>ABDENICO ANDRADE</td>
      <td>M</td>
      <td>23/11/1990</td>
      <td>GUARATUBA</td>
      <td>PR</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>59</th>
      <td>60</td>
      <td>ADELICE LIMA</td>
      <td>F</td>
      <td>29/12/1959</td>
      <td>SAO CARLOS</td>
      <td>SP</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>93</th>
      <td>94</td>
      <td>ADENIZA DUARTE</td>
      <td>F</td>
      <td>2/10/1993</td>
      <td>RIO DE JANEIRO</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>RIO DE JANEIRO</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>69</th>
      <td>70</td>
      <td>ADILSON CARVALHO</td>
      <td>M</td>
      <td>09/10/1969</td>
      <td>PRAIA SECA</td>
      <td>RJ</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>BRA</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>SANTOS</td>
      <td>SP</td>
      <td>BRASIL</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 14 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="id13">
<h2>6 Carga dos Dados no <em>Data Mart</em><a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h2>
<p>Antes dos dados serem carregados no <em>data mart</em>, devem ser realizados processamentos adicionais. Esses processamentos referem-se a: (i) verificação de valores nulos; e (ii) geração automática de dados para preencher colunas que não foram preenchidas pelos dados oriundos das fontes.</p>
<p>O comando a seguir verifica a presença de valores nulos e também valores de colunas que não foram preenchidas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 100 entries, 62 to 2
Data columns (total 14 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   funcMatricula       100 non-null    int64 
 1   funcNome            100 non-null    object
 2   funcSexo            100 non-null    object
 3   funcDataNascimento  100 non-null    object
 4   funcCidade          100 non-null    object
 5   funcEstadoSigla     75 non-null     object
 6   funcPaisNome        52 non-null     object
 7   funcDiaNascimento   0 non-null      object
 8   funcMesNascimento   0 non-null      object
 9   funcAnoNascimento   0 non-null      object
 10  funcEstadoNome      28 non-null     object
 11  funcRegiaoNome      0 non-null      object
 12  funcRegiaoSigla     0 non-null      object
 13  funcPaisSigla       26 non-null     object
dtypes: int64(1), object(13)
memory usage: 11.7+ KB
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir realiza o preenchimento de dados nas colunas de <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code> usando como base <code class="docutils literal notranslate"><span class="pre">funcEstadoSigla</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;SP&#39;, &#39;MG&#39;, &#39;RJ&#39;, None, &#39;PR&#39;, &#39;PE&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_estados_nome</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RJ&#39;</span><span class="p">:</span><span class="s1">&#39;RIO DE JANEIRO&#39;</span><span class="p">,</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span><span class="s1">&#39;SAO PAULO&#39;</span><span class="p">,</span>\
                  <span class="s1">&#39;PR&#39;</span><span class="p">:</span><span class="s1">&#39;PARANA&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">:</span><span class="s1">&#39;PERNAMBUCO&#39;</span><span class="p">,</span> <span class="s1">&#39;MG&#39;</span><span class="p">:</span><span class="s1">&#39;MINAS GERAIS&#39;</span><span class="p">}</span>
<span class="n">funcEstadoNome</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">mapear_estados_nome</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">funcEstadoNome</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir realiza o preenchimento de dados nas colunas de <code class="docutils literal notranslate"><span class="pre">funcEstadoSigla</span></code> usando como base <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code>.</p>
<section id="exercicio-8">
<h3>Exercício 8<a class="headerlink" href="#exercicio-8" title="Permalink to this heading">#</a></h3>
<p>Implemente o mapeamento de <code class="docutils literal notranslate"><span class="pre">funcEstadoSigla</span></code> utilizando os dados de <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_estados_sigla</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RIO DE JANEIRO&#39;</span><span class="p">:</span><span class="s1">&#39;RJ&#39;</span><span class="p">,</span> <span class="s1">&#39;SAO PAULO&#39;</span><span class="p">:</span><span class="s1">&#39;SP&#39;</span><span class="p">,</span>\
                  <span class="s1">&#39;PARANA&#39;</span><span class="p">:</span><span class="s1">&#39;PR&#39;</span><span class="p">,</span> <span class="s1">&#39;PERNAMBUCO&#39;</span><span class="p">:</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;MINAS GERAIS&#39;</span><span class="p">:</span><span class="s1">&#39;MG&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">funcEstadoSigla</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">mapear_estados_sigla</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">funcEstadoSigla</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam o preenchimento de dados nas colunas <code class="docutils literal notranslate"><span class="pre">funcPaisSigla</span></code> e <code class="docutils literal notranslate"><span class="pre">funcPais</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;BRA&#39;, None], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([None, &#39;BRASIL&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BRA&#39;</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BRASIL&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir verifica novamente a presença de valores nulos e também valores de colunas que não foram preenchidas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 100 entries, 62 to 2
Data columns (total 14 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   funcMatricula       100 non-null    int64 
 1   funcNome            100 non-null    object
 2   funcSexo            100 non-null    object
 3   funcDataNascimento  100 non-null    object
 4   funcCidade          100 non-null    object
 5   funcEstadoSigla     100 non-null    object
 6   funcPaisNome        100 non-null    object
 7   funcDiaNascimento   0 non-null      object
 8   funcMesNascimento   0 non-null      object
 9   funcAnoNascimento   0 non-null      object
 10  funcEstadoNome      100 non-null    object
 11  funcRegiaoNome      0 non-null      object
 12  funcRegiaoSigla     0 non-null      object
 13  funcPaisSigla       100 non-null    object
dtypes: int64(1), object(13)
memory usage: 11.7+ KB
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam o preenchimento de dados nas colunas   <code class="docutils literal notranslate"><span class="pre">funcDiaNascimento</span></code> e <code class="docutils literal notranslate"><span class="pre">funcMesNascimento</span></code>, e <code class="docutils literal notranslate"><span class="pre">funcAnoNascimento</span></code>. Para tanto, são usados os valores presentes em <code class="docutils literal notranslate"><span class="pre">funcDataNascimento</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extraindo o dia, mês e ano de nascimento</span>
<span class="n">dataNascimento</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DIA&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;MES&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ANO&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">processa_data_nascimento</span><span class="p">(</span><span class="n">dataNascimento</span><span class="p">,</span> <span class="n">campo</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">dataNascimento</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">dataNascimento</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="n">campo</span><span class="p">]</span>


<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">processa_data_nascimento</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">],</span> <span class="n">dataNascimento</span><span class="p">[</span><span class="s1">&#39;DIA&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">processa_data_nascimento</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">],</span> <span class="n">dataNascimento</span><span class="p">[</span><span class="s1">&#39;MES&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">processa_data_nascimento</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcDataNascimento&#39;</span><span class="p">],</span> <span class="n">dataNascimento</span><span class="p">[</span><span class="s1">&#39;ANO&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam o preenchimento de dados nas colunas funcRegiaoNome e funcRegiaoSigla.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_regiao_nome</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RJ&#39;</span><span class="p">:</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">,</span>\
                  <span class="s1">&#39;PR&#39;</span><span class="p">:</span><span class="s1">&#39;SUL&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">:</span><span class="s1">&#39;NORDESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;MG&#39;</span><span class="p">:</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mapear_regiao_nome</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcEstadoSigla&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercicio-9">
<h3>Exercício 9<a class="headerlink" href="#exercicio-9" title="Permalink to this heading">#</a></h3>
<p>Implemente o mapeamento de <code class="docutils literal notranslate"><span class="pre">funcRegiaoSigla</span></code> utilizando os dados de <code class="docutils literal notranslate"><span class="pre">funcRegiaoNome</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapear_regiao_sigla</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SUDESTE&#39;</span><span class="p">:</span><span class="s1">&#39;SE&#39;</span><span class="p">,</span> <span class="s1">&#39;SUL&#39;</span><span class="p">:</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;NORDESTE&#39;</span><span class="p">:</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcRegiaoSigla&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mapear_regiao_sigla</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, tem-se a coluna <code class="docutils literal notranslate"><span class="pre">funcPK</span></code>. Em <em>funcionario</em>, já existe a coluna <code class="docutils literal notranslate"><span class="pre">funcMatricula</span></code>, que identifica univocamente cada funcionário. Entretanto, pode ser que o valor dessa coluna seja preenchido com dados muito grandes, contendo letras e números. Nesse caso, quando se projeta o esquema do <em>data mart</em>, acrescenta-se uma coluna adicional para representar a chave primária, a qual é preenchida com valores incrementados de 1 em 1 em ordem crescente.</p>
<p>O comando a seguir acrescenta a coluna funcPK a funcionario.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">funcionario</span><span class="p">[</span><span class="s1">&#39;funcPK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir ilustra a nova estrutura do esquema de relação <em>funcionario</em>, bem como alguns de seus dados</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">funcionario</span><span class="p">[[</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">,</span> <span class="s1">&#39;funcNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcSexo&#39;</span><span class="p">,</span> <span class="s1">&#39;funcCidade&#39;</span><span class="p">,</span> <span class="s1">&#39;funcEstadoNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcRegiaoNome&#39;</span><span class="p">,</span> <span class="s1">&#39;funcPaisNome&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcPK</th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
      <th>funcRegiaoNome</th>
      <th>funcPaisNome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>63</td>
      <td>ADELINO ANDRADE</td>
      <td>M</td>
      <td>SAO JOSE DO RIO PRETO</td>
      <td>SAO PAULO</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>47</td>
      <td>ABEDON BORGES</td>
      <td>M</td>
      <td>MONTE VERDE</td>
      <td>MINAS GERAIS</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>41</td>
      <td>ADER ALMEIDA</td>
      <td>M</td>
      <td>ILHEUS</td>
      <td>RIO DE JANEIRO</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>100</td>
      <td>ABERLADO LIMA</td>
      <td>M</td>
      <td>OURO PRETO</td>
      <td>MINAS GERAIS</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>51</td>
      <td>ADEILDO CASTRO</td>
      <td>M</td>
      <td>MORRETES</td>
      <td>PARANA</td>
      <td>SUL</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>96</td>
      <td>23</td>
      <td>ABDENICO ANDRADE</td>
      <td>M</td>
      <td>GUARATUBA</td>
      <td>PARANA</td>
      <td>SUL</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>96</th>
      <td>97</td>
      <td>60</td>
      <td>ADELICE LIMA</td>
      <td>F</td>
      <td>SAO CARLOS</td>
      <td>SAO PAULO</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>97</th>
      <td>98</td>
      <td>94</td>
      <td>ADENIZA DUARTE</td>
      <td>F</td>
      <td>RIO DE JANEIRO</td>
      <td>RIO DE JANEIRO</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>98</th>
      <td>99</td>
      <td>70</td>
      <td>ADILSON CARVALHO</td>
      <td>M</td>
      <td>PRAIA SECA</td>
      <td>RIO DE JANEIRO</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>99</th>
      <td>100</td>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>SANTOS</td>
      <td>SAO PAULO</td>
      <td>SUDESTE</td>
      <td>BRASIL</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 8 columns</p>
</div></div></div>
</div>
<p>O comando a seguir verifica a presença de valores nulos em funcionario. No vídeo de aula, ainda existiam valores nulos. Ao final desta lista de exercícios, todos os valores devem ter sido preenchidos, de forma que a coluna <code class="docutils literal notranslate"><span class="pre">Non-Null</span> <span class="pre">Count</span></code> deve sempre listar <code class="docutils literal notranslate"><span class="pre">100</span> <span class="pre">non-null</span></code>.</p>
</section>
<section id="exercicio-10">
<h3>Exercício 10<a class="headerlink" href="#exercicio-10" title="Permalink to this heading">#</a></h3>
<p>Executar o comando a seguir, e verificar se o resultado esperado foi obtido.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 100 entries, 0 to 99
Data columns (total 15 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   funcMatricula       100 non-null    int64 
 1   funcNome            100 non-null    object
 2   funcSexo            100 non-null    object
 3   funcDataNascimento  100 non-null    object
 4   funcCidade          100 non-null    object
 5   funcEstadoSigla     100 non-null    object
 6   funcPaisNome        100 non-null    object
 7   funcDiaNascimento   100 non-null    object
 8   funcMesNascimento   100 non-null    object
 9   funcAnoNascimento   100 non-null    object
 10  funcEstadoNome      100 non-null    object
 11  funcRegiaoNome      100 non-null    object
 12  funcRegiaoSigla     100 non-null    object
 13  funcPaisSigla       100 non-null    object
 14  funcPK              100 non-null    int64 
dtypes: int64(2), object(13)
memory usage: 11.8+ KB
</pre></div>
</div>
</div>
</div>
<p>Como o <em>data mart</em> é armazenado seguindo o modelo relacional, o comando a seguir gera um arquivo <em>.csv</em> referente a <em>funcionario</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;funcionario.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-03-plantao-edesio-processo-de-etl-elt-span">
<h1><span style="color:blue">Aula 03: Plantão Edesio - Processo de ETL/ELT</span><a class="headerlink" href="#span-style-color-blue-aula-03-plantao-edesio-processo-de-etl-elt-span" title="Permalink to this heading">#</a></h1>
<section id="span-style-color-blue-retomando-conceitos-de-classe-e-a-ferramenta-pandas-merge-span">
<h2><span style="color:blue">Retomando conceitos de Classe e a ferramenta Pandas (merge)</span><a class="headerlink" href="#span-style-color-blue-retomando-conceitos-de-classe-e-a-ferramenta-pandas-merge-span" title="Permalink to this heading">#</a></h2>
<h2> Noções básicas de classes e objetos </h2>
<p>Programação Orientada a Objeto (POO) é um paradigma de programação, i.e., um estilo de construção da estrutura e elementos de programas de computador.</p>
<p>POO pode ser vista como abordagem que modela coisas concretas do mundo real, como carro, produto, relações entre coisas e pessoas, em forma de objetos em software. Tais objetos possuem dados associados e podem executar algumas funções.</p>
<p>Noções básicas que vamos revisar:</p>
<ol>
<li> Classe </li>
<ul>
    <li> Atributos </li>
    <li> Métodos </li>
</ul>
    <li> Objeto </li>
    <li> Herança </li>
    <li> Outros conceitos importantes: </li>
    <ul>
        <li> Polimorfismo </li>
        <li> Abstração </li>
        <li> Encapsulamento </li>
    </ul>
</ol><h3> Classe </h3>
<p>Uma classe é como um protótipo (blueprint) que descreve toda a funcionalidade que um objeto pode ter.</p>
<p>Por meio de uma classe podemos criar vários objetos (diz-se instanciar). Em outras palavras, a classe é a receita usada para gerar objetos.</p>
<p>A classe descreve, por meio do código, como guardar dados, quais as funcionalidades do objeto e como manipular os dados armazenados.</p>
<center>
<img src="https://3.bp.blogspot.com/-_1WZExjBypM/WA_KhwQC47I/AAAAAAAAD8I/dypzV7ffmWQyJtdJYB-DPJIbvkhqzcwcACLcB/s1600/Blueprint%2BVolkswagen%2BBrasilia%2B1976.png" width="50%" height="50%" alt="blueprint" class="center"> <br>
Blueprint da Volkswagen Brasília 1976. Fonte: <a href="https://www.victorbravodesign.com/2016/10/auto-evolucao-volkswagen-brasilia-1976.html">Victor Bravo</a>
</center><h4> Atributos </h4>
<p>Os atributos são as propriedades que o objeto tem. Podemos ver isso como dados e informações armazenadas no objeto.</p>
<p>Por exemplo, os atributos de um carro podem ser: rodas, número de identificação, cor, marca, fabricante e etc.</p>
<h4> Métodos </h4>
<p>Os métodos são os comportamentos que o objeto tem. Podemos ver isso como as funcionalidades, i.e., o que ele pode fazer.</p>
<p>Por exemplo, os métodos de um carro poderiam ser: ligar, desligar, acelerar e freiar.</p>
<h3> Objeto </h3>
<p>Um objeto é uma instância da classe.<br>
Um objeto representa um conceito, pessoa, produto, relação ou qualquer outra coisa do mundo real no software.</p>
<center>
<p><img src="https://motortudo.com/wp-content/uploads/2018/02/Volkswagen-Brasilia-1976-Motor-Tudo-2.jpg" width="50%" height="50%" alt="blueprint" class="center"><br>
Volkswagen Brasília 1976. Fonte: <a href="https://motortudo.com/volkswagen-brasilia-1976-lideranca-absoluta/">Motorturbo</a></p>
</center><p>Na classe eu descrevo os atributos. No objeto eu tenho acesso aos atributos (dados, informações).<br>
Na classe eu descrevo os métodos. No objeto eu aplico/uso os métodos (funcionalidades).</p>
<p>Outro conceito importante é que o objeto armazena estado.
Isso porque ao longo do tempo seus atributos podem ser modificados (<b>mutabilidade</b>).</p>
<p>Exemplo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Carro</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c1"># o __init__ é uma função especial chamada de construtor. Ele ira inicializar seu objeto.</span>
    <span class="c1"># self é um ponteiro para o objeto na memória, para que as alterações possam ser feitas nele (mutável)</span>
    <span class="c1"># &#39;self.nome_do_atributo = &#39; é a forma como declaramos um atributo do objeto</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fabricante</span><span class="p">,</span> <span class="n">modelo</span><span class="p">,</span> <span class="n">ano</span><span class="p">,</span> <span class="n">cor</span><span class="p">,</span> <span class="n">velocidade_maxima</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">rodas</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">tipo_motor</span><span class="o">=</span><span class="s1">&#39;ab3&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fabricante</span> <span class="o">=</span> <span class="n">fabricante</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ano</span> <span class="o">=</span> <span class="n">ano</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelo</span> <span class="o">=</span> <span class="n">modelo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cor</span> <span class="o">=</span> <span class="n">cor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rodas</span> <span class="o">=</span> <span class="n">rodas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocidade_maxima</span> <span class="o">=</span> <span class="n">velocidade_maxima</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipo_motor</span> <span class="o">=</span> <span class="n">tipo_motor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__velocidade_atual</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ligado</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># As demais funções são os métodos desse objeto (suas funcionalidades)</span>
    <span class="k">def</span> <span class="nf">acelerar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># apenas desacelera se o carro estiver ligado</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ligado</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt; Ligue o carro! &lt;&lt;&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__velocidade_atual</span> <span class="o">+=</span> <span class="n">a</span><span class="o">*</span><span class="n">t</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__velocidade_atual</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__velocidade_atual</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">desacelerar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acelerar</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">freiar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__velocidade_atual</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">ligar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ligado</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">desligar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freiar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ligado</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">situacao</span> <span class="o">=</span> <span class="s2">&quot;LIGADO&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ligado</span> <span class="k">else</span> <span class="s2">&quot;DESLIGADO&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Carro </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fabricante</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modelo</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ano</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                <span class="sa">f</span><span class="s2">&quot;É </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cor</span><span class="si">}</span><span class="s2">, possui </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rodas</span><span class="si">}</span><span class="s2"> rodas e atinge </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">velocidade_maxima</span><span class="si">}</span><span class="s2"> km/h</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                <span class="sa">f</span><span class="s2">&quot;Neste momento o carro está </span><span class="si">{</span><span class="n">situacao</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                <span class="sa">f</span><span class="s2">&quot;Sua velocidade atual é de </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__velocidade_atual</span><span class="si">}</span><span class="s2"> km/h</span><span class="se">\n</span><span class="s2">&quot;</span>
               <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carro</span> <span class="o">=</span> <span class="n">Carro</span><span class="p">(</span><span class="s2">&quot;Volkswagen&quot;</span><span class="p">,</span> <span class="s2">&quot;Brasília&quot;</span><span class="p">,</span> <span class="s2">&quot;1976&quot;</span><span class="p">,</span> <span class="s2">&quot;vermelho&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>

<span class="n">carro</span><span class="o">.</span><span class="n">ligar</span><span class="p">()</span>
<span class="n">carro</span><span class="o">.</span><span class="n">acelerar</span><span class="p">()</span>
<span class="n">carro</span><span class="o">.</span><span class="n">acelerar</span><span class="p">()</span>
<span class="n">carro</span><span class="o">.</span><span class="n">acelerar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>

<span class="n">carro</span><span class="o">.</span><span class="n">freiar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>

<span class="n">carro</span><span class="o">.</span><span class="n">acelerar</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>

<span class="n">carro</span><span class="o">.</span><span class="n">desacelerar</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>

<span class="n">carro</span><span class="o">.</span><span class="n">desligar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está DESLIGADO.
Sua velocidade atual é de 0.0 km/h

Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está LIGADO.
Sua velocidade atual é de 30.0 km/h

Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está LIGADO.
Sua velocidade atual é de 0.0 km/h

Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está LIGADO.
Sua velocidade atual é de 100.0 km/h

Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está LIGADO.
Sua velocidade atual é de 50.0 km/h

Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está DESLIGADO.
Sua velocidade atual é de 0.0 km/h
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carro</span> <span class="o">=</span> <span class="n">Carro</span><span class="p">(</span><span class="s2">&quot;Volkswagen&quot;</span><span class="p">,</span> <span class="s2">&quot;Brasília&quot;</span><span class="p">,</span> <span class="s2">&quot;1976&quot;</span><span class="p">,</span> <span class="s2">&quot;vermelho&quot;</span><span class="p">)</span>
<span class="n">carro</span><span class="o">.</span><span class="n">fabricante</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>

<span class="n">carro</span><span class="o">.</span><span class="n">ligar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">carro</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está DESLIGADO.
Sua velocidade atual é de 0.0 km/h

Carro Volkswagen Brasília, 1976.
É vermelho, possui 4 rodas e atinge 120 km/h
Neste momento o carro está LIGADO.
Sua velocidade atual é de 0.0 km/h
</pre></div>
</div>
</div>
</div>
<h2> Como seria uma classe para processar dados ?</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">class</span> <span class="nc">processData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qtd</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
      <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">qtd</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">display</span><span class="p">(</span><span class="s2">&quot;Carregue o dataset!&quot;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Linhas= &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Colunas= &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">count_nan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">remove_nan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">upper_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">upper_it</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">upper_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">processData</span><span class="o">.</span><span class="n">upper_it</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span> <span class="o">=</span> <span class="n">processData</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/ETL_Funcionarios/main/funcionarioRelacional.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">procd</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">()</span>
<span class="n">procd</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-ebfadc5a-2e9e-4752-90ab-617185063932" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNasc</th>
      <th>funcCidade</th>
      <th>funcEstado</th>
      <th>funcPais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>sao paulo</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaN</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>campinas</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>santos</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ADA BARBOSA</td>
      <td>NaN</td>
      <td>4/4/1990</td>
      <td>santo andre</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>5/5/1990</td>
      <td>piracicaba</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>ABADI BARROS</td>
      <td>M</td>
      <td>6/6/1990</td>
      <td>sao carlos</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>ABADIA BORGES</td>
      <td>F</td>
      <td>7/7/1990</td>
      <td>ribeirao preto</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>ABADIAS CAMPOS</td>
      <td>M</td>
      <td>NaN</td>
      <td>ilha bela</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>ABADIO CARDOSO</td>
      <td>M</td>
      <td>9/9/1990</td>
      <td>sao jose do rio preto</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>ADETE CARVALHO</td>
      <td>M</td>
      <td>10/10/1990</td>
      <td>osasco</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-ebfadc5a-2e9e-4752-90ab-617185063932')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-ebfadc5a-2e9e-4752-90ab-617185063932 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-ebfadc5a-2e9e-4752-90ab-617185063932');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-a622831e-156f-4e1e-89fb-2e23a08e50d3">
  <button class="colab-df-quickchart" onclick="quickchart('df-a622831e-156f-4e1e-89fb-2e23a08e50d3')"
            title="Suggest charts."
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-a622831e-156f-4e1e-89fb-2e23a08e50d3 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linhas=  56
Colunas=  7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span><span class="o">.</span><span class="n">count_nan</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>funcMatricula    0
funcNome         3
funcSexo         4
funcDataNasc     1
funcCidade       5
funcEstado       3
funcPais         4
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span><span class="o">.</span><span class="n">remove_nan</span><span class="p">()</span>
<span class="n">procd</span><span class="o">.</span><span class="n">count_nan</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>funcMatricula    0
funcNome         0
funcSexo         0
funcDataNasc     0
funcCidade       0
funcEstado       0
funcPais         0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linhas=  46
Colunas=  7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">procd</span><span class="o">.</span><span class="n">upper_col</span><span class="p">(</span><span class="s2">&quot;funcCidade&quot;</span><span class="p">)</span>
<span class="n">procd</span><span class="o">.</span><span class="n">upper_col</span><span class="p">(</span><span class="s2">&quot;funcPais&quot;</span><span class="p">)</span>
<span class="n">procd</span><span class="o">.</span><span class="n">upper_col</span><span class="p">(</span><span class="s2">&quot;funcEstado&quot;</span><span class="p">)</span>
<span class="n">procd</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-efc2c5db-a70a-4ccf-94ff-fe502e69edbe" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNasc</th>
      <th>funcCidade</th>
      <th>funcEstado</th>
      <th>funcPais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>sao paulo</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>santos</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>5/5/1990</td>
      <td>piracicaba</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>ABADI BARROS</td>
      <td>M</td>
      <td>6/6/1990</td>
      <td>sao carlos</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>ABADIA BORGES</td>
      <td>F</td>
      <td>7/7/1990</td>
      <td>ribeirao preto</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>ABADIO CARDOSO</td>
      <td>M</td>
      <td>9/9/1990</td>
      <td>sao jose do rio preto</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>ADETE CARVALHO</td>
      <td>M</td>
      <td>10/10/1990</td>
      <td>osasco</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>ABD CASTRO</td>
      <td>M</td>
      <td>11/11/1990</td>
      <td>araraquara</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>ABDA COSTA</td>
      <td>F</td>
      <td>12/12/1990</td>
      <td>barueri</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>ABDIEL DIAS</td>
      <td>M</td>
      <td>13/1/1990</td>
      <td>rio de janeiro</td>
      <td>rj</td>
      <td>brasil</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-efc2c5db-a70a-4ccf-94ff-fe502e69edbe')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-efc2c5db-a70a-4ccf-94ff-fe502e69edbe button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-efc2c5db-a70a-4ccf-94ff-fe502e69edbe');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-5c54e3bf-3f70-46cd-a3ee-cb36ae945fa1">
  <button class="colab-df-quickchart" onclick="quickchart('df-5c54e3bf-3f70-46cd-a3ee-cb36ae945fa1')"
            title="Suggest charts."
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-5c54e3bf-3f70-46cd-a3ee-cb36ae945fa1 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div><div class="output text_html">
  <div id="df-674cf5e6-7559-4aee-a379-2d969e94d9c3" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNasc</th>
      <th>funcCidade</th>
      <th>funcEstado</th>
      <th>funcPais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>SANTOS</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>5/5/1990</td>
      <td>PIRACICABA</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>ABADI BARROS</td>
      <td>M</td>
      <td>6/6/1990</td>
      <td>SAO CARLOS</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>ABADIA BORGES</td>
      <td>F</td>
      <td>7/7/1990</td>
      <td>RIBEIRAO PRETO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>ABADIO CARDOSO</td>
      <td>M</td>
      <td>9/9/1990</td>
      <td>SAO JOSE DO RIO PRETO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>ADETE CARVALHO</td>
      <td>M</td>
      <td>10/10/1990</td>
      <td>OSASCO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>ABD CASTRO</td>
      <td>M</td>
      <td>11/11/1990</td>
      <td>ARARAQUARA</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>ABDA COSTA</td>
      <td>F</td>
      <td>12/12/1990</td>
      <td>BARUERI</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>ABDIEL DIAS</td>
      <td>M</td>
      <td>13/1/1990</td>
      <td>RIO DE JANEIRO</td>
      <td>RJ</td>
      <td>BRASIL</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-674cf5e6-7559-4aee-a379-2d969e94d9c3')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-674cf5e6-7559-4aee-a379-2d969e94d9c3 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-674cf5e6-7559-4aee-a379-2d969e94d9c3');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-5f56aaf6-ee5f-4eb7-855d-7d3f7402fdb2">
  <button class="colab-df-quickchart" onclick="quickchart('df-5f56aaf6-ee5f-4eb7-855d-7d3f7402fdb2')"
            title="Suggest charts."
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-5f56aaf6-ee5f-4eb7-855d-7d3f7402fdb2 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">procd</span><span class="o">.</span><span class="n">read_dataset</span><span class="p">()</span>
<span class="n">procd</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">procd</span><span class="o">.</span><span class="n">remove_nan</span><span class="p">()</span>
<span class="n">procd</span><span class="o">.</span><span class="n">upper_cols</span><span class="p">([</span><span class="s2">&quot;funcCidade&quot;</span><span class="p">,</span> <span class="s2">&quot;funcPais&quot;</span><span class="p">,</span> <span class="s2">&quot;funcEstado&quot;</span><span class="p">])</span>
<span class="n">procd</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-0562332b-0caa-4996-b9c0-f812e490b14e" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNasc</th>
      <th>funcCidade</th>
      <th>funcEstado</th>
      <th>funcPais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>sao paulo</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaN</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>campinas</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>santos</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ADA BARBOSA</td>
      <td>NaN</td>
      <td>4/4/1990</td>
      <td>santo andre</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>5/5/1990</td>
      <td>piracicaba</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>ABADI BARROS</td>
      <td>M</td>
      <td>6/6/1990</td>
      <td>sao carlos</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>ABADIA BORGES</td>
      <td>F</td>
      <td>7/7/1990</td>
      <td>ribeirao preto</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>ABADIAS CAMPOS</td>
      <td>M</td>
      <td>NaN</td>
      <td>ilha bela</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>ABADIO CARDOSO</td>
      <td>M</td>
      <td>9/9/1990</td>
      <td>sao jose do rio preto</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>ADETE CARVALHO</td>
      <td>M</td>
      <td>10/10/1990</td>
      <td>osasco</td>
      <td>sp</td>
      <td>brasil</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-0562332b-0caa-4996-b9c0-f812e490b14e')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-0562332b-0caa-4996-b9c0-f812e490b14e button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-0562332b-0caa-4996-b9c0-f812e490b14e');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-cee8da3d-5bd9-4f50-8bb7-08786fe9c0eb">
  <button class="colab-df-quickchart" onclick="quickchart('df-cee8da3d-5bd9-4f50-8bb7-08786fe9c0eb')"
            title="Suggest charts."
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-cee8da3d-5bd9-4f50-8bb7-08786fe9c0eb button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div><div class="output text_html">
  <div id="df-6774e367-d1d2-4db6-be73-25abb6e95608" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNasc</th>
      <th>funcCidade</th>
      <th>funcEstado</th>
      <th>funcPais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>SANTOS</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>5/5/1990</td>
      <td>PIRACICABA</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>ABADI BARROS</td>
      <td>M</td>
      <td>6/6/1990</td>
      <td>SAO CARLOS</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>ABADIA BORGES</td>
      <td>F</td>
      <td>7/7/1990</td>
      <td>RIBEIRAO PRETO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>ABADIO CARDOSO</td>
      <td>M</td>
      <td>9/9/1990</td>
      <td>SAO JOSE DO RIO PRETO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>ADETE CARVALHO</td>
      <td>M</td>
      <td>10/10/1990</td>
      <td>OSASCO</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>ABD CASTRO</td>
      <td>M</td>
      <td>11/11/1990</td>
      <td>ARARAQUARA</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>ABDA COSTA</td>
      <td>F</td>
      <td>12/12/1990</td>
      <td>BARUERI</td>
      <td>SP</td>
      <td>BRASIL</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>ABDIEL DIAS</td>
      <td>M</td>
      <td>13/1/1990</td>
      <td>RIO DE JANEIRO</td>
      <td>RJ</td>
      <td>BRASIL</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-6774e367-d1d2-4db6-be73-25abb6e95608')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-6774e367-d1d2-4db6-be73-25abb6e95608 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-6774e367-d1d2-4db6-be73-25abb6e95608');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-6ef89c9a-accf-473a-b896-09e7f784bb03">
  <button class="colab-df-quickchart" onclick="quickchart('df-6ef89c9a-accf-473a-b896-09e7f784bb03')"
            title="Suggest charts."
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-6ef89c9a-accf-473a-b896-09e7f784bb03 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div></div>
</div>
<h2> Como usar merge?</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K2&quot;</span><span class="p">,</span> <span class="s2">&quot;K3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A0&quot;</span><span class="p">,</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;B0&quot;</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;B3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>


<span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K2&quot;</span><span class="p">,</span> <span class="s2">&quot;K3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;C3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D0&quot;</span><span class="p">,</span> <span class="s2">&quot;D1&quot;</span><span class="p">,</span> <span class="s2">&quot;D2&quot;</span><span class="p">,</span> <span class="s2">&quot;D3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>



<span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="n">result</span>
<span class="c1"># result</span>
<span class="c1"># right</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K2</td>
      <td>A2</td>
      <td>B2</td>
      <td>C2</td>
      <td>D2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K3</td>
      <td>A3</td>
      <td>B3</td>
      <td>C3</td>
      <td>D3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K4&quot;</span><span class="p">,</span> <span class="s2">&quot;K5&quot;</span><span class="p">],</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A0&quot;</span><span class="p">,</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;B0&quot;</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;B3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>


<span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K6&quot;</span><span class="p">,</span> <span class="s2">&quot;K7&quot;</span><span class="p">],</span>
        <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;C3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D0&quot;</span><span class="p">,</span> <span class="s2">&quot;D1&quot;</span><span class="p">,</span> <span class="s2">&quot;D2&quot;</span><span class="p">,</span> <span class="s2">&quot;D3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>


<span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K4&quot;</span><span class="p">,</span> <span class="s2">&quot;K5&quot;</span><span class="p">],</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A0&quot;</span><span class="p">,</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;B0&quot;</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;B3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>


<span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K2&quot;</span><span class="p">,</span> <span class="s2">&quot;K3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;C3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D0&quot;</span><span class="p">,</span> <span class="s2">&quot;D1&quot;</span><span class="p">,</span> <span class="s2">&quot;D2&quot;</span><span class="p">,</span> <span class="s2">&quot;D3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># considerar apenas chaves da esquerda [LEFT OUTER JOIN]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>A_x</th>
      <th>B_x</th>
      <th>A_y</th>
      <th>B_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K4</td>
      <td>A2</td>
      <td>B2</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K5</td>
      <td>A3</td>
      <td>B3</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># considerar apenas chaves da direita [RIGHT OUTER JOIN]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>A_x</th>
      <th>B_x</th>
      <th>A_y</th>
      <th>B_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C2</td>
      <td>D2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C3</td>
      <td>D3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># considerar uniao das chaves [FULL OUTER JOIN]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>A_x</th>
      <th>B_x</th>
      <th>A_y</th>
      <th>B_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K4</td>
      <td>A2</td>
      <td>B2</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K5</td>
      <td>A3</td>
      <td>B3</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C2</td>
      <td>D2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>K3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C3</td>
      <td>D3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># considerar intersecção das chaves [INNER JOIN]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>A_x</th>
      <th>B_x</th>
      <th>A_y</th>
      <th>B_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<center>
<img src="https://files.realpython.com/media/join_diagram.93e6ef63afbe.png" width="70%" height="70%" alt="blueprint" class="center"><br>
Fonte: <a href="https://realpython.com/pandas-merge-join-and-concat/">Real Python</a>
</center><p>Mais informações sobre merge aqui: <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html</a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-05-consultas-olap-span">
<h1><span style="color:blue">Aula 05: Consultas OLAP</span><a class="headerlink" href="#span-style-color-blue-aula-05-consultas-olap-span" title="Permalink to this heading">#</a></h1>
<section id="id14">
<h2><span style="color:blue">Exemplo usando Pandas</span><a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introducao">
<h1>1 Introdução<a class="headerlink" href="#introducao" title="Permalink to this heading">#</a></h1>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma contelação de fatos que une dois esquemas estrela, conforme descrito a seguir.</p>
<section id="esquema-estrela-pagamento">
<h2>1.1 Esquema Estrela Pagamento<a class="headerlink" href="#esquema-estrela-pagamento" title="Permalink to this heading">#</a></h2>
<p>O primeiro esquema estrela, chamado Pagamento, é composto pelas seguintes tabelas de dimensão e tabela de fatos:</p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamento)</p></li>
</ul>
</section>
<section id="esquema-estrela-negociacao">
<h2>1.2 Esquema Estrela Negociacao<a class="headerlink" href="#esquema-estrela-negociacao" title="Permalink to this heading">#</a></h2>
<p>O segundo esquema estrela, chamado Negociacao, é composto pelas seguintes tabelas de dimensão e tabela de fatos:</p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacao)</p></li>
</ul>
</section>
<section id="constelacao-de-fatos">
<h2>1.3 Constelação de Fatos<a class="headerlink" href="#constelacao-de-fatos" title="Permalink to this heading">#</a></h2>
<p>Na constelação de fatos, as tabelas de dimensão data e equipe são tabelas em comum entre os dois esquemas estrela. As tabelas de dimensão e as tabelas de fatos da constelação da BI Solutions são listadas a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamento)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacao)</p></li>
</ul>
</section>
<section id="juncao-estrela">
<h2>1.4 Junção Estrela<a class="headerlink" href="#juncao-estrela" title="Permalink to this heading">#</a></h2>
<p>A operação de junção estrela é necessária devido à forma de organização dos dados do data warehouse segundo os tipos de esquema estrela, floco de neve e estrela-foco.</p>
<p>No processamento de uma consulta OLAP especificada pelo usuário de sistemas de suporte à decisão, deve-se realizar as seguintes atividades:</p>
<ul class="simple">
<li><p>Acessar a tabela de fatos e todas as tabelas de dimensão envolvidas na consulta.</p></li>
<li><p>Realizar as junções necessárias, usando como base a integridade referencial, ou seja, usando como base os pares de chave primária (PK) e chave estrangeira (FK). No caso da junção estrela, isso significa fazer a junção da chave primária de cada tabela de dimensão envolvida na consulta com a chave estrangeira daquela tabela presente na tabela de fatos.</p></li>
<li><p>Exibir os resultados obtidos.</p></li>
</ul>
<p>Em Pandas, a junção estrela é feita usando-se o comando <code class="docutils literal notranslate"><span class="pre">merge</span></code>. Dentro do contexto desta aula, comando <code class="docutils literal notranslate"><span class="pre">merge</span></code> realiza a junção entre dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, considerando a(s) coluna(s) usada como base para a junção, chamada de coluna(s) de junção.  Maiores detalhes sobre o comando merge podem ser obtidos neste <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html">link</a>.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="carregamento-das-tabelas-de-dimensao-e-das-tabelas-de-fatos">
<h1>2 Carregamento das Tabelas de Dimensão e das Tabelas de Fatos<a class="headerlink" href="#carregamento-das-tabelas-de-dimensao-e-das-tabelas-de-fatos" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir instanciam os <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> que são usados nas consultas analíticas. Para facilitar o entendimento dos conceitos, cada <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> possui o mesmo nome da tabela de dimensão ou da tabela de fatos correspondente.</p>
<section id="carregamento-das-tabelas-de-dimensao">
<h2>2.1 Carregamento das Tabelas de Dimensão<a class="headerlink" href="#carregamento-das-tabelas-de-dimensao" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dataPK</th>
      <th>dataCompleta</th>
      <th>dataDia</th>
      <th>dataMes</th>
      <th>dataBimestre</th>
      <th>dataTrimestre</th>
      <th>dataSemestre</th>
      <th>dataAno</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1/1/2016</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2/1/2016</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3/1/2016</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2016</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão funcionario</span>
<span class="n">funcionario</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&#39;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcPK</th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
      <th>funcEstadoSigla</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>M-1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>1</td>
      <td>1</td>
      <td>1990</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>M-2</td>
      <td>ARAO ALVES</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>2</td>
      <td>2</td>
      <td>1990</td>
      <td>CAMPINAS</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>M-3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>3</td>
      <td>3</td>
      <td>1990</td>
      <td>SANTOS</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão equipe</span>
<span class="n">equipe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&#39;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipePK</th>
      <th>equipeNome</th>
      <th>filialNome</th>
      <th>filialCidade</th>
      <th>filialEstadoNome</th>
      <th>filialEstadoSigla</th>
      <th>filialRegiaoNome</th>
      <th>filialRegiaoSigla</th>
      <th>filialPaisNome</th>
      <th>filialPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>RIO DE JANEIRO</td>
      <td>RIO DE JANEIRO</td>
      <td>RJ</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão cargo</span>
<span class="n">cargo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&#39;</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cargoPK</th>
      <th>cargoNome</th>
      <th>cargoRegimeTrabalho</th>
      <th>cargoJornadaTrabalho</th>
      <th>cargoEscolaridadeMinima</th>
      <th>cargoNivel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>PROGRAMADOR DE SISTEMAS DE INFORMACAO</td>
      <td>TEMPORARIO</td>
      <td>20H</td>
      <td>MEDIO</td>
      <td>JUNIOR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>PROGRAMADOR DE SISTEMAS DE INFORMACAO</td>
      <td>TEMPORARIO</td>
      <td>20H</td>
      <td>SUPERIOR</td>
      <td>PLENO</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>PROGRAMADOR DE SISTEMAS DE INFORMACAO</td>
      <td>TEMPORARIO</td>
      <td>20H</td>
      <td>POS</td>
      <td>SENIOR</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão cliente</span>
<span class="n">cliente</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&#39;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>clientePK</th>
      <th>clienteNomeFantasia</th>
      <th>clienteSetor</th>
      <th>clienteCidade</th>
      <th>clienteEstadoNome</th>
      <th>clienteEstadoSigla</th>
      <th>clienteRegiaoNome</th>
      <th>clienteRegiaoSigla</th>
      <th>clientePaisNome</th>
      <th>clientePaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>VIA FOOD</td>
      <td>BEBIDAS E ALIMENTOS</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>VIA PIZZA</td>
      <td>BEBIDAS E ALIMENTOS</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>VIA JAPA</td>
      <td>BEBIDAS E ALIMENTOS</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="carregamento-das-tabelas-de-fatos">
<h2>2.2 Carregamento das Tabelas de Fatos<a class="headerlink" href="#carregamento-das-tabelas-de-fatos" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos pagamento</span>
<span class="n">pagamento</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&#39;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcPK</th>
      <th>equipePK</th>
      <th>dataPK</th>
      <th>cargoPK</th>
      <th>salario</th>
      <th>quantidadeLancamentos</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>147</td>
      <td>2</td>
      <td>5</td>
      <td>64</td>
      <td>1559.94</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>124</td>
      <td>2</td>
      <td>5</td>
      <td>329</td>
      <td>8102.77</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>175</td>
      <td>1</td>
      <td>5</td>
      <td>328</td>
      <td>2532.51</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos negociacao</span>
<span class="n">negociacao</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&#39;</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipePK</th>
      <th>clientePK</th>
      <th>dataPK</th>
      <th>receita</th>
      <th>quantidadeNegociacoes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>9</td>
      <td>22</td>
      <td>11564.75</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>24</td>
      <td>11</td>
      <td>17990.50</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>28</td>
      <td>21</td>
      <td>16335.90</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="execucao-de-consultas-com-foco-nas-operacoes-olap">
<h1>3 Execução de Consultas com Foco nas Operações OLAP<a class="headerlink" href="#execucao-de-consultas-com-foco-nas-operacoes-olap" title="Permalink to this heading">#</a></h1>
<section id="operacao-slice-and-dice">
<h2>3.1 Operação Slice and Dice<a class="headerlink" href="#operacao-slice-and-dice" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Restringe os dados sendo analisados a um subconjunto desses dados.</p>
<ul class="simple">
<li><p>Slice: corte para um valor fixo, diminuindo a dimensionalidade do cubo.</p></li>
<li><p>Dice: seleção de faixas de valores.</p></li>
</ul>
<p><strong>Exemplo de consulta</strong>: Qual a quantidade de pagamentos realizados no mês de setembro de 2020?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataMes == 9 and dataAno == 2020&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoFiltrado</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoFiltrado</span><span class="p">[</span><span class="s1">&#39;quantidadeLancamentos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
</div>
</div>
</section>
<section id="operacoes-drill-down-e-roll-up">
<h2>3.2 Operações Drill-Down e Roll-Up<a class="headerlink" href="#operacoes-drill-down-e-roll-up" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Analisam os dados considerando níveis progressivos de agregação.</p>
<ul class="simple">
<li><p>Drill-down: níveis de agregação progressivamente mais detalhados, ou de menor granularidade.</p></li>
<li><p>Roll-up: níveis de agregação progressivamente menos detalhados, ou de maior granularidade.</p></li>
</ul>
<p>Para ilustrar as operações de drill-down e roll-up, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong> Qual o valor gasto em salários por ano, considerando cada semestre?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span><span class="s1">&#39;dataSemestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno  dataSemestre
2016     1               2221308.54
         2               2221308.54
2017     1               4887639.90
         2               4887639.90
2018     1               7467763.20
         2               7467763.20
2019     1               9283833.18
         2               9283833.18
2020     1               9283833.18
         2               9283833.18
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># modificando a visualização utilizando o .unstack()</span>
<span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span><span class="s1">&#39;dataSemestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>dataSemestre</th>
      <th>1</th>
      <th>2</th>
    </tr>
    <tr>
      <th>dataAno</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016</th>
      <td>2221308.54</td>
      <td>2221308.54</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>4887639.90</td>
      <td>4887639.90</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>7467763.20</td>
      <td>7467763.20</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>9283833.18</td>
      <td>9283833.18</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>9283833.18</td>
      <td>9283833.18</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imprimindo os dados de forma visual</span>
<span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span><span class="s1">&#39;dataSemestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab71879710&gt;
</pre></div>
</div>
<img alt="../_images/09e249cedb84eb1783104a1a56fc83a597a599a8578946a9b7c85bd1e39e04b8.png" src="../_images/09e249cedb84eb1783104a1a56fc83a597a599a8578946a9b7c85bd1e39e04b8.png" />
</div>
</div>
<p><strong>Exemplo de consulta drill-down:</strong> Qual o valor gasto em salários por ano, considerando cada trimestre?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;dataTrimestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno  dataTrimestre
2016     1                1110654.27
         2                1110654.27
         3                1110654.27
         4                1110654.27
2017     1                2443819.95
         2                2443819.95
         3                2443819.95
         4                2443819.95
2018     1                3733881.60
         2                3733881.60
         3                3733881.60
         4                3733881.60
2019     1                4641916.59
         2                4641916.59
         3                4641916.59
         4                4641916.59
2020     1                4641916.59
         2                4641916.59
         3                4641916.59
         4                4641916.59
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;dataTrimestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab6ae37110&gt;
</pre></div>
</div>
<img alt="../_images/ede5ca78f6476de122e1211f73ee1f08a2323645408327c0f94cfd5400b18460.png" src="../_images/ede5ca78f6476de122e1211f73ee1f08a2323645408327c0f94cfd5400b18460.png" />
</div>
</div>
<p><strong>Exemplo de consulta roll-up:</strong> Qual o valor gasto em salários por ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno
2016     4442617.08
2017     9775279.80
2018    14935526.40
2019    18567666.36
2020    18567666.36
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab6a8ea490&gt;
</pre></div>
</div>
<img alt="../_images/e88cc0d04e11b19a45a89901ad8343ce84ba3d70121d161d364b37d60e13700e.png" src="../_images/e88cc0d04e11b19a45a89901ad8343ce84ba3d70121d161d364b37d60e13700e.png" />
</div>
</div>
</section>
<section id="operacao-pivot">
<h2>3.3 Operação Pivot<a class="headerlink" href="#operacao-pivot" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Reorienta a visão multidimensional dos dados, oferecendo diferentes perspectivas dos mesmos dados.</p>
<p>Para ilustrar a operação pivot, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong>  Qual o valor gasto em salários por ano, considerando cada nível de cargo?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataCargo</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;cargoPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;cargoNivel&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Ano&#39;, &#39;Nível do Cargo&#39;])[&#39;Total de Gastos em Salários&#39;].sum()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno  cargoNivel
2016     JUNIOR          489456.84
         PLENO          1454152.44
         SENIOR         2499007.80
2017     JUNIOR         1030642.80
         PLENO          3791593.92
         SENIOR         4953043.08
2018     JUNIOR         1393282.20
         PLENO          5357227.44
         SENIOR         8185016.76
2019     JUNIOR         1755714.36
         PLENO          6132228.24
         SENIOR        10679723.76
2020     JUNIOR         1755714.36
         PLENO          6132228.24
         SENIOR        10679723.76
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;cargoNivel&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Ano&#39;, &#39;Nível do Cargo&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cargoNivel</th>
      <th>JUNIOR</th>
      <th>PLENO</th>
      <th>SENIOR</th>
    </tr>
    <tr>
      <th>dataAno</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016</th>
      <td>489456.84</td>
      <td>1454152.44</td>
      <td>2499007.80</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>1030642.80</td>
      <td>3791593.92</td>
      <td>4953043.08</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>1393282.20</td>
      <td>5357227.44</td>
      <td>8185016.76</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>1755714.36</td>
      <td>6132228.24</td>
      <td>10679723.76</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>1755714.36</td>
      <td>6132228.24</td>
      <td>10679723.76</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;cargoNivel&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Ano&#39;, &#39;Nível do Cargo&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1).plot(kind = &#39;bar&#39;, stacked = True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab6a8598d0&gt;
</pre></div>
</div>
<img alt="../_images/8e8aeec25af4e6c9833a5a3c8860f6c38a92c54127c764f00ba189cab71db26f.png" src="../_images/8e8aeec25af4e6c9833a5a3c8860f6c38a92c54127c764f00ba189cab71db26f.png" />
</div>
</div>
<p><strong>Exemplo de consulta pivot:</strong> Qual o valor gasto em salários por nível de cargo, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Nível do Cargo&#39;, &#39;Ano&#39;])[&#39;Total de Gastos em Salários&#39;].sum()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cargoNivel  dataAno
JUNIOR      2016         489456.84
            2017        1030642.80
            2018        1393282.20
            2019        1755714.36
            2020        1755714.36
PLENO       2016        1454152.44
            2017        3791593.92
            2018        5357227.44
            2019        6132228.24
            2020        6132228.24
SENIOR      2016        2499007.80
            2017        4953043.08
            2018        8185016.76
            2019       10679723.76
            2020       10679723.76
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Nível do Cargo&#39;, &#39;Ano&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>dataAno</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
    </tr>
    <tr>
      <th>cargoNivel</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JUNIOR</th>
      <td>489456.84</td>
      <td>1030642.80</td>
      <td>1393282.20</td>
      <td>1755714.36</td>
      <td>1755714.36</td>
    </tr>
    <tr>
      <th>PLENO</th>
      <td>1454152.44</td>
      <td>3791593.92</td>
      <td>5357227.44</td>
      <td>6132228.24</td>
      <td>6132228.24</td>
    </tr>
    <tr>
      <th>SENIOR</th>
      <td>2499007.80</td>
      <td>4953043.08</td>
      <td>8185016.76</td>
      <td>10679723.76</td>
      <td>10679723.76</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Nível do Cargo&#39;, &#39;Ano&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1).plot(kind = &#39;bar&#39;, stacked = True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab6a79f310&gt;
</pre></div>
</div>
<img alt="../_images/1ee700225db3db19f484a5d99b4cde68901d46ba101e024c8ef396f47d89d8e2.png" src="../_images/1ee700225db3db19f484a5d99b4cde68901d46ba101e024c8ef396f47d89d8e2.png" />
</div>
</div>
</section>
<section id="operacao-drill-across">
<h2>3.4 Operação Drill-Across<a class="headerlink" href="#operacao-drill-across" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Compara medidas numéricas de tabelas de fatos diferentes, utilizando pelo menos uma dimensão em comum.</p>
<p><strong>Exemplo de consulta:</strong> Qual o total gasto com salários e qual o total de receitas recebidas, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#total gasto em salários considerando cada ano</span>
<span class="c1">#dados obtidos utilizando a tabela de fatos pagamento</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span> 
<span class="n">pagamentoAno</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#total de receitas recebidas, considerando cada ano</span>
<span class="c1">#dados obtidos utilizando a tabela de fatos negociacao</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">negociacaoAno</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#relacionado as medidas numéricas presentes nas duas tabelas de fatos</span>
<span class="n">pagamentoAno</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoAno</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salario</th>
      <th>receita</th>
    </tr>
    <tr>
      <th>dataAno</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016</th>
      <td>4442617.08</td>
      <td>4614246.95</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>9775279.80</td>
      <td>7200423.35</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>14935526.40</td>
      <td>11593539.65</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>18567666.36</td>
      <td>35353318.30</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>18567666.36</td>
      <td>30222175.95</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoAno</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoAno</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab6a6c0c90&gt;
</pre></div>
</div>
<img alt="../_images/c834df1c884189f23a760fd3b8dce3ca678b105784b92211133e1288847568a2.png" src="../_images/c834df1c884189f23a760fd3b8dce3ca678b105784b92211133e1288847568a2.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="execucao-de-consultas-com-foco-na-tomada-de-decisao">
<h1>3 Execução de Consultas com Foco na Tomada de Decisão<a class="headerlink" href="#execucao-de-consultas-com-foco-na-tomada-de-decisao" title="Permalink to this heading">#</a></h1>
<p>As consultas OLAP requisitadas por usuários de sistemas de suporte à decisão usualmente requerem que várias operações OLAP sejam realizadas simultaneamente. A seguir são ilustrados exemplos de consultas OLAP que podem ser requisitadas para a tomada de decisão estratégica.</p>
<section id="consulta-1">
<h2>3.1 Consulta 1<a class="headerlink" href="#consulta-1" title="Permalink to this heading">#</a></h2>
<p><strong>Consulta:</strong> Qual é a média dos salários recebidos por nível do cargo e por sexo no ano passado, sendo que o ano passado se refere ao ano de 2019?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">cargo</span></code>, <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.cargoPK</span> <span class="pre">=</span> <span class="pre">cargo.cargoPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.funcPK</span> <span class="pre">=</span> <span class="pre">funcionario.funcPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataAno == 2019&#39;</span><span class="p">)</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataFunc</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">funcionario</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;funcPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataFuncCargo</span> <span class="o">=</span> <span class="n">pagamentoDataFunc</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;cargoPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cargoNivel  funcSexo
JUNIOR      F            2440.233125
            M            2437.859091
PLENO       F            7641.937619
            M            6259.613036
SENIOR      F           12994.190000
            M           14480.502708
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>funcSexo</th>
      <th>F</th>
      <th>M</th>
    </tr>
    <tr>
      <th>cargoNivel</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JUNIOR</th>
      <td>2440.233125</td>
      <td>2437.859091</td>
    </tr>
    <tr>
      <th>PLENO</th>
      <td>7641.937619</td>
      <td>6259.613036</td>
    </tr>
    <tr>
      <th>SENIOR</th>
      <td>12994.190000</td>
      <td>14480.502708</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab6a6ae410&gt;
</pre></div>
</div>
<img alt="../_images/aad1d7baafee232ed2e6b2cc8954b7478b8e6351bb543cd6d61370316c8e622a.png" src="../_images/aad1d7baafee232ed2e6b2cc8954b7478b8e6351bb543cd6d61370316c8e622a.png" />
</div>
</div>
</section>
<section id="consulta-2">
<h2>3.2 Consulta 2<a class="headerlink" href="#consulta-2" title="Permalink to this heading">#</a></h2>
<p><strong>Consulta:</strong> Qual o total de gastos em salários considerando os estados nos quais as equipes estão localizadas no trimestre 3 do ano de 2020?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipePK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataTrimestre == 3 and dataAno == 2020&#39;</span><span class="p">)</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataEquipe</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;filialEstadoNome&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>filialEstadoNome
PERNAMBUCO             438121.26
MATO GROSSO DO SUL    1013857.74
RIO DE JANEIRO        1258479.57
SAO PAULO             1931458.02
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;filialEstadoNome&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fab6a5e54d0&gt;
</pre></div>
</div>
<img alt="../_images/9f0554a17d85539470d3d9c53e98f7e56c3e1a4a2333bddc4214bf8bcbe9285f.png" src="../_images/9f0554a17d85539470d3d9c53e98f7e56c3e1a4a2333bddc4214bf8bcbe9285f.png" />
</div>
</div>
</section>
<section id="consulta-3">
<h2>3.3 Consulta 3<a class="headerlink" href="#consulta-3" title="Permalink to this heading">#</a></h2>
<p><strong>Consulta:</strong> Qual o custo/benefício das equipes quando analisado o semestre 1 do ano de 2020?</p>
<p>A idea da consulta é relacionar os gastos em salários e os ganhos em receitas considerando cada equipe e o período especificado. Portanto, para se realizar essa consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como das tabelas de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code> e <code class="docutils literal notranslate"><span class="pre">negociacao</span></code>.</p>
<p>A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#investigando os gastos em salarios de cada equipe no último semestre ano </span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataSemestre == 1 and dataAno == 2020&#39;</span><span class="p">)</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">dataFiltrada</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span> <span class="p">)</span>
<span class="n">pagamentoDataEquipe</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;equipePK&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span> 
<span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salario</th>
    </tr>
    <tr>
      <th>equipePK</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1160327.40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1060981.14</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1177330.32</td>
    </tr>
    <tr>
      <th>4</th>
      <td>579893.94</td>
    </tr>
    <tr>
      <th>5</th>
      <td>909107.10</td>
    </tr>
    <tr>
      <th>6</th>
      <td>585430.86</td>
    </tr>
    <tr>
      <th>7</th>
      <td>876084.06</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1118608.38</td>
    </tr>
    <tr>
      <th>9</th>
      <td>939827.46</td>
    </tr>
    <tr>
      <th>10</th>
      <td>876242.52</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#investigando os ganhos em receitas de cada equipe no semestre 1 de 2020</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataSemestre == 1 and dataAno == 2020&#39;</span><span class="p">)</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">dataFiltrada</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span> <span class="p">)</span>
<span class="n">negociacaoDataEquipe</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;equipePK&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span> 
<span class="n">negociacaoDataEquipe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>receita</th>
    </tr>
    <tr>
      <th>equipePK</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1259907.25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1338994.40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>340461.30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>340130.65</td>
    </tr>
    <tr>
      <th>5</th>
      <td>614747.70</td>
    </tr>
    <tr>
      <th>6</th>
      <td>736591.35</td>
    </tr>
    <tr>
      <th>7</th>
      <td>722758.45</td>
    </tr>
    <tr>
      <th>8</th>
      <td>538659.30</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4994717.70</td>
    </tr>
    <tr>
      <th>10</th>
      <td>4664745.70</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#juntando os dados obtidos</span>
<span class="n">pagamentoNegociacao</span> <span class="o">=</span> <span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoDataEquipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span> <span class="p">)</span>
<span class="n">pagamentoNegociacao</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salario</th>
      <th>receita</th>
    </tr>
    <tr>
      <th>equipePK</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1160327.40</td>
      <td>1259907.25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1060981.14</td>
      <td>1338994.40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1177330.32</td>
      <td>340461.30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>579893.94</td>
      <td>340130.65</td>
    </tr>
    <tr>
      <th>5</th>
      <td>909107.10</td>
      <td>614747.70</td>
    </tr>
    <tr>
      <th>6</th>
      <td>585430.86</td>
      <td>736591.35</td>
    </tr>
    <tr>
      <th>7</th>
      <td>876084.06</td>
      <td>722758.45</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1118608.38</td>
      <td>538659.30</td>
    </tr>
    <tr>
      <th>9</th>
      <td>939827.46</td>
      <td>4994717.70</td>
    </tr>
    <tr>
      <th>10</th>
      <td>876242.52</td>
      <td>4664745.70</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoNegociacaoEquipeCidade</span> <span class="o">=</span> <span class="n">pagamentoNegociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span> <span class="p">)</span>
<span class="n">pagamentoNegociacaoEquipeCidade</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)[[</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;salario&#39;</span><span class="p">,</span> <span class="s1">&#39;receita&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipeNome</th>
      <th>filialNome</th>
      <th>salario</th>
      <th>receita</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>1160327.40</td>
      <td>1259907.25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>1060981.14</td>
      <td>1338994.40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>1177330.32</td>
      <td>340461.30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>WEB</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>579893.94</td>
      <td>340130.65</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WEB</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>909107.10</td>
      <td>614747.70</td>
    </tr>
    <tr>
      <th>5</th>
      <td>APP - MOBILE</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>585430.86</td>
      <td>736591.35</td>
    </tr>
    <tr>
      <th>6</th>
      <td>APP - MOBILE</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>876084.06</td>
      <td>722758.45</td>
    </tr>
    <tr>
      <th>7</th>
      <td>APP - MOBILE</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>1118608.38</td>
      <td>538659.30</td>
    </tr>
    <tr>
      <th>8</th>
      <td>BI &amp; ANALYTICS</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>939827.46</td>
      <td>4994717.70</td>
    </tr>
    <tr>
      <th>9</th>
      <td>BI &amp; ANALYTICS</td>
      <td>RECIFE - CENTRO</td>
      <td>876242.52</td>
      <td>4664745.70</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;lucro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span>
<span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[[</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;lucro&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;lucro&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipeNome</th>
      <th>filialNome</th>
      <th>lucro</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>BI &amp; ANALYTICS</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>4054890.24</td>
    </tr>
    <tr>
      <th>9</th>
      <td>BI &amp; ANALYTICS</td>
      <td>RECIFE - CENTRO</td>
      <td>3788503.18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>278013.26</td>
    </tr>
    <tr>
      <th>5</th>
      <td>APP - MOBILE</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>151160.49</td>
    </tr>
    <tr>
      <th>0</th>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>99579.85</td>
    </tr>
    <tr>
      <th>6</th>
      <td>APP - MOBILE</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>-153325.61</td>
    </tr>
    <tr>
      <th>3</th>
      <td>WEB</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>-239763.29</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WEB</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>-294359.40</td>
    </tr>
    <tr>
      <th>7</th>
      <td>APP - MOBILE</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>-579949.08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>-836869.02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#investigando o custo/benefício total</span>
<span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;lucro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6267880.620000001
</pre></div>
</div>
</div>
</div>
<p>Como pode ser observado, existem equipes lucrativas e equipes que estão tendo prejuízo. Usuários de sistemas de suporte a decisão devem estabelecer estratégias para definir o que será feito com as equipes que geram prejuízo. Será que elas devem ser dissolvidas? Será que podem ser criadas políticas para que essas equipes sejam mais eficientes? Observa-se que o total de lucro obtido pela BI Solutions é positivo. Portanto, existe uma margem financeira para acomodar possíveis estratégias.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-05-lista-de-exercicios-consultas-olap-span">
<h1><span style="color:blue">Aula 05: Lista de exercícios - Consultas OLAP</span><a class="headerlink" href="#span-style-color-blue-aula-05-lista-de-exercicios-consultas-olap-span" title="Permalink to this heading">#</a></h1>
<section id="id15">
<h2><span style="color:blue">Exemplo usando Pandas</span><a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h2>
<p>Este notebook contém exercícios classificados como essenciais e complementares. A indicação da classificação de cada exercício é feita junto de sua definição. Os exercícios estão espalhados ao longo do texto. Por favor, procurem por EXERCÍCIO para encontrar a especificação dos exercícios e as suas respectivas respostas. Também é possível localizar os exercícios utilizando o menu de navegação. Por completude, o notebook possui todas as descrições apresentadas na parte prática da Aula 05. Recomenda-se fortemente que a lista de exercícios seja respondida antes de se consultar as respostas dos exercícios.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id16">
<h1>1 Introdução<a class="headerlink" href="#id16" title="Permalink to this heading">#</a></h1>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma contelação de fatos que une dois esquemas estrela, conforme descrito a seguir.</p>
<section id="id17">
<h2>1.1 Esquema Estrela Pagamento<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h2>
<p>O primeiro esquema estrela, chamado Pagamento, é composto pelas seguintes tabelas de dimensão e tabela de fatos:</p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamento)</p></li>
</ul>
</section>
<section id="id18">
<h2>1.2 Esquema Estrela Negociacao<a class="headerlink" href="#id18" title="Permalink to this heading">#</a></h2>
<p>O segundo esquema estrela, chamado Negociacao, é composto pelas seguintes tabelas de dimensão e tabela de fatos:</p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacao)</p></li>
</ul>
</section>
<section id="id19">
<h2>1.3 Constelação de Fatos<a class="headerlink" href="#id19" title="Permalink to this heading">#</a></h2>
<p>Na constelação de fatos, as tabelas de dimensão data e equipe são tabelas em comum entre os dois esquemas estrela. As tabelas de dimensão e as tabelas de fatos da constelação da BI Solutions são listadas a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamento)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacao)</p></li>
</ul>
</section>
<section id="id20">
<h2>1.4 Junção Estrela<a class="headerlink" href="#id20" title="Permalink to this heading">#</a></h2>
<p>A operação de junção estrela é necessária devido à forma de organização dos dados do data warehouse segundo os tipos de esquema estrela, floco de neve e estrela-foco.</p>
<p>No processamento de uma consulta OLAP especificada pelo usuário de sistemas de suporte à decisão, deve-se realizar as seguintes atividades:</p>
<ul class="simple">
<li><p>Acessar a tabela de fatos e todas as tabelas de dimensão envolvidas na consulta.</p></li>
<li><p>Realizar as junções necessárias, usando como base a integridade referencial, ou seja, usando como base os pares de chave primária (PK) e chave estrangeira (FK). No caso da junção estrela, isso significa fazer a junção da chave primária de cada tabela de dimensão envolvida na consulta com a chave estrangeira daquela tabela presente na tabela de fatos.</p></li>
<li><p>Exibir os resultados obtidos.</p></li>
</ul>
<p>Em Pandas, a junção estrela é feita usando-se o comando <code class="docutils literal notranslate"><span class="pre">merge</span></code>. Dentro do contexto desta aula, comando <code class="docutils literal notranslate"><span class="pre">merge</span></code> realiza a junção entre dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, considerando a(s) coluna(s) usada como base para a junção, chamada de coluna(s) de junção.  Maiores detalhes sobre o comando merge podem ser obtidos neste <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html">link</a>.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id21">
<h1>2 Carregamento das Tabelas de Dimensão e das Tabelas de Fatos<a class="headerlink" href="#id21" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir instanciam os <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> que são usados nas consultas analíticas. Para facilitar o entendimento dos conceitos, cada <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> possui o mesmo nome da tabela de dimensão ou da tabela de fatos correspondente.</p>
<section id="id22">
<h2>2.1 Carregamento das Tabelas de Dimensão<a class="headerlink" href="#id22" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-4227a019-8035-4384-ac67-3267c0118c2d">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dataPK</th>
      <th>dataCompleta</th>
      <th>dataDia</th>
      <th>dataMes</th>
      <th>dataBimestre</th>
      <th>dataTrimestre</th>
      <th>dataSemestre</th>
      <th>dataAno</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1/1/2016</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2/1/2016</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>3/1/2016</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2016</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-4227a019-8035-4384-ac67-3267c0118c2d')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-4227a019-8035-4384-ac67-3267c0118c2d button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-4227a019-8035-4384-ac67-3267c0118c2d');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão funcionario</span>
<span class="n">funcionario</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&#39;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-cad6bc74-ed04-4a35-bc49-4b9006bf6f19">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcPK</th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
      <th>funcEstadoSigla</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>M-1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>1</td>
      <td>1</td>
      <td>1990</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>M-2</td>
      <td>ARAO ALVES</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>2</td>
      <td>2</td>
      <td>1990</td>
      <td>CAMPINAS</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>M-3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>3</td>
      <td>3</td>
      <td>1990</td>
      <td>SANTOS</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-cad6bc74-ed04-4a35-bc49-4b9006bf6f19')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-cad6bc74-ed04-4a35-bc49-4b9006bf6f19 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-cad6bc74-ed04-4a35-bc49-4b9006bf6f19');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão equipe</span>
<span class="n">equipe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&#39;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-c50449d4-b513-492f-ba53-4bbbe2b17701">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipePK</th>
      <th>equipeNome</th>
      <th>filialNome</th>
      <th>filialCidade</th>
      <th>filialEstadoNome</th>
      <th>filialEstadoSigla</th>
      <th>filialRegiaoNome</th>
      <th>filialRegiaoSigla</th>
      <th>filialPaisNome</th>
      <th>filialPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>RIO DE JANEIRO</td>
      <td>RIO DE JANEIRO</td>
      <td>RJ</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c50449d4-b513-492f-ba53-4bbbe2b17701')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c50449d4-b513-492f-ba53-4bbbe2b17701 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c50449d4-b513-492f-ba53-4bbbe2b17701');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão cargo</span>
<span class="n">cargo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&#39;</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-287346de-d93a-4e7a-87f6-41d4c6c59145">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cargoPK</th>
      <th>cargoNome</th>
      <th>cargoRegimeTrabalho</th>
      <th>cargoJornadaTrabalho</th>
      <th>cargoEscolaridadeMinima</th>
      <th>cargoNivel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>PROGRAMADOR DE SISTEMAS DE INFORMACAO</td>
      <td>TEMPORARIO</td>
      <td>20H</td>
      <td>MEDIO</td>
      <td>JUNIOR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>PROGRAMADOR DE SISTEMAS DE INFORMACAO</td>
      <td>TEMPORARIO</td>
      <td>20H</td>
      <td>SUPERIOR</td>
      <td>PLENO</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>PROGRAMADOR DE SISTEMAS DE INFORMACAO</td>
      <td>TEMPORARIO</td>
      <td>20H</td>
      <td>POS</td>
      <td>SENIOR</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-287346de-d93a-4e7a-87f6-41d4c6c59145')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-287346de-d93a-4e7a-87f6-41d4c6c59145 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-287346de-d93a-4e7a-87f6-41d4c6c59145');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># criando e exibindo o DataFrame para a tabela de dimensão cliente</span>
<span class="n">cliente</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&#39;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-7e59140b-3c71-4916-9ec8-eb4129bfe791">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>clientePK</th>
      <th>clienteNomeFantasia</th>
      <th>clienteSetor</th>
      <th>clienteCidade</th>
      <th>clienteEstadoNome</th>
      <th>clienteEstadoSigla</th>
      <th>clienteRegiaoNome</th>
      <th>clienteRegiaoSigla</th>
      <th>clientePaisNome</th>
      <th>clientePaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>VIA FOOD</td>
      <td>BEBIDAS E ALIMENTOS</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>VIA PIZZA</td>
      <td>BEBIDAS E ALIMENTOS</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>VIA JAPA</td>
      <td>BEBIDAS E ALIMENTOS</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-7e59140b-3c71-4916-9ec8-eb4129bfe791')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-7e59140b-3c71-4916-9ec8-eb4129bfe791 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-7e59140b-3c71-4916-9ec8-eb4129bfe791');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
<section id="id23">
<h2>2.2 Carregamento das Tabelas de Fatos<a class="headerlink" href="#id23" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos pagamento</span>
<span class="n">pagamento</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&#39;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-7795f01b-1bce-4806-b6ab-bd0d11a55c82">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcPK</th>
      <th>equipePK</th>
      <th>dataPK</th>
      <th>cargoPK</th>
      <th>salario</th>
      <th>quantidadeLancamentos</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>147</td>
      <td>2</td>
      <td>5</td>
      <td>64</td>
      <td>1559.94</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>124</td>
      <td>2</td>
      <td>5</td>
      <td>329</td>
      <td>8102.77</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>175</td>
      <td>1</td>
      <td>5</td>
      <td>328</td>
      <td>2532.51</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-7795f01b-1bce-4806-b6ab-bd0d11a55c82')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-7795f01b-1bce-4806-b6ab-bd0d11a55c82 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-7795f01b-1bce-4806-b6ab-bd0d11a55c82');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos negociacao</span>
<span class="n">negociacao</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&#39;</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-ab8bfcb2-8740-4f0c-a40d-40593e746d7a">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipePK</th>
      <th>clientePK</th>
      <th>dataPK</th>
      <th>receita</th>
      <th>quantidadeNegociacoes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>9</td>
      <td>22</td>
      <td>11564.75</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>24</td>
      <td>11</td>
      <td>17990.50</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>28</td>
      <td>21</td>
      <td>16335.90</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-ab8bfcb2-8740-4f0c-a40d-40593e746d7a')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-ab8bfcb2-8740-4f0c-a40d-40593e746d7a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-ab8bfcb2-8740-4f0c-a40d-40593e746d7a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id24">
<h1>3 Execução de Consultas com Foco nas Operações OLAP<a class="headerlink" href="#id24" title="Permalink to this heading">#</a></h1>
<section id="id25">
<h2>3.1 Operação Slice and Dice<a class="headerlink" href="#id25" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Restringe os dados sendo analisados a um subconjunto desses dados.</p>
<ul class="simple">
<li><p>Slice: corte para um valor fixo, diminuindo a dimensionalidade do cubo.</p></li>
<li><p>Dice: seleção de faixas de valores.</p></li>
</ul>
<p><strong>Exemplo de consulta</strong>: Qual a quantidade de pagamentos realizados no mês de setembro de 2020?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataMes == 9 and dataAno == 2020&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoFiltrado</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoFiltrado</span><span class="p">[</span><span class="s1">&#39;quantidadeLancamentos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
</div>
</div>
</section>
<section id="id26">
<h2>3.2 Operações Drill-Down e Roll-Up<a class="headerlink" href="#id26" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Analisam os dados considerando níveis progressivos de agregação.</p>
<ul class="simple">
<li><p>Drill-down: níveis de agregação progressivamente mais detalhados, ou de menor granularidade.</p></li>
<li><p>Roll-up: níveis de agregação progressivamente menos detalhados, ou de maior granularidade.</p></li>
</ul>
<p>Para ilustrar as operações de drill-down e roll-up, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong> Qual o valor gasto em salários por ano, considerando cada semestre?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span><span class="s1">&#39;dataSemestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno  dataSemestre
2016     1               2221308.54
         2               2221308.54
2017     1               4887639.90
         2               4887639.90
2018     1               7467763.20
         2               7467763.20
2019     1               9283833.18
         2               9283833.18
2020     1               9283833.18
         2               9283833.18
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># modificando a visualização utilizando o .unstack()</span>
<span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span><span class="s1">&#39;dataSemestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-d20c07dd-b691-49d1-89a2-4ab1b980c86e">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>dataSemestre</th>
      <th>1</th>
      <th>2</th>
    </tr>
    <tr>
      <th>dataAno</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016</th>
      <td>2221308.54</td>
      <td>2221308.54</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>4887639.90</td>
      <td>4887639.90</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>7467763.20</td>
      <td>7467763.20</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>9283833.18</td>
      <td>9283833.18</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>9283833.18</td>
      <td>9283833.18</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d20c07dd-b691-49d1-89a2-4ab1b980c86e')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d20c07dd-b691-49d1-89a2-4ab1b980c86e button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d20c07dd-b691-49d1-89a2-4ab1b980c86e');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># imprimindo os dados de forma visual</span>
<span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span><span class="s1">&#39;dataSemestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd754060810&gt;
</pre></div>
</div>
<img alt="../_images/09e249cedb84eb1783104a1a56fc83a597a599a8578946a9b7c85bd1e39e04b8.png" src="../_images/09e249cedb84eb1783104a1a56fc83a597a599a8578946a9b7c85bd1e39e04b8.png" />
</div>
</div>
<p><strong>Exemplo de consulta drill-down:</strong> Qual o valor gasto em salários por ano, considerando cada trimestre?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;dataTrimestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno  dataTrimestre
2016     1                1110654.27
         2                1110654.27
         3                1110654.27
         4                1110654.27
2017     1                2443819.95
         2                2443819.95
         3                2443819.95
         4                2443819.95
2018     1                3733881.60
         2                3733881.60
         3                3733881.60
         4                3733881.60
2019     1                4641916.59
         2                4641916.59
         3                4641916.59
         4                4641916.59
2020     1                4641916.59
         2                4641916.59
         3                4641916.59
         4                4641916.59
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;dataTrimestre&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd753aa67d0&gt;
</pre></div>
</div>
<img alt="../_images/ede5ca78f6476de122e1211f73ee1f08a2323645408327c0f94cfd5400b18460.png" src="../_images/ede5ca78f6476de122e1211f73ee1f08a2323645408327c0f94cfd5400b18460.png" />
</div>
</div>
<p><strong>Exemplo de consulta roll-up:</strong> Qual o valor gasto em salários por ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno
2016     4442617.08
2017     9775279.80
2018    14935526.40
2019    18567666.36
2020    18567666.36
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd7539e9a90&gt;
</pre></div>
</div>
<img alt="../_images/e88cc0d04e11b19a45a89901ad8343ce84ba3d70121d161d364b37d60e13700e.png" src="../_images/e88cc0d04e11b19a45a89901ad8343ce84ba3d70121d161d364b37d60e13700e.png" />
</div>
</div>
</section>
<section id="id27">
<h2>3.3 Operação Pivot<a class="headerlink" href="#id27" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Reorienta a visão multidimensional dos dados, oferecendo diferentes perspectivas dos mesmos dados.</p>
<p>Para ilustrar a operação pivot, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong>  Qual o valor gasto em salários por ano, considerando cada nível de cargo?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataCargo</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;cargoPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;cargoNivel&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Ano&#39;, &#39;Nível do Cargo&#39;])[&#39;Total de Gastos em Salários&#39;].sum()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno  cargoNivel
2016     JUNIOR          489456.84
         PLENO          1454152.44
         SENIOR         2499007.80
2017     JUNIOR         1030642.80
         PLENO          3791593.92
         SENIOR         4953043.08
2018     JUNIOR         1393282.20
         PLENO          5357227.44
         SENIOR         8185016.76
2019     JUNIOR         1755714.36
         PLENO          6132228.24
         SENIOR        10679723.76
2020     JUNIOR         1755714.36
         PLENO          6132228.24
         SENIOR        10679723.76
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;cargoNivel&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Ano&#39;, &#39;Nível do Cargo&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-79bd8696-7354-4b0d-a5c7-a7b01a78216b">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cargoNivel</th>
      <th>JUNIOR</th>
      <th>PLENO</th>
      <th>SENIOR</th>
    </tr>
    <tr>
      <th>dataAno</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016</th>
      <td>489456.84</td>
      <td>1454152.44</td>
      <td>2499007.80</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>1030642.80</td>
      <td>3791593.92</td>
      <td>4953043.08</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>1393282.20</td>
      <td>5357227.44</td>
      <td>8185016.76</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>1755714.36</td>
      <td>6132228.24</td>
      <td>10679723.76</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>1755714.36</td>
      <td>6132228.24</td>
      <td>10679723.76</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-79bd8696-7354-4b0d-a5c7-a7b01a78216b')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-79bd8696-7354-4b0d-a5c7-a7b01a78216b button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-79bd8696-7354-4b0d-a5c7-a7b01a78216b');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;cargoNivel&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Ano&#39;, &#39;Nível do Cargo&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1).plot(kind = &#39;bar&#39;, stacked = True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd753962750&gt;
</pre></div>
</div>
<img alt="../_images/8e8aeec25af4e6c9833a5a3c8860f6c38a92c54127c764f00ba189cab71db26f.png" src="../_images/8e8aeec25af4e6c9833a5a3c8860f6c38a92c54127c764f00ba189cab71db26f.png" />
</div>
</div>
<p><strong>Exemplo de consulta pivot:</strong> Qual o valor gasto em salários por nível de cargo, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Nível do Cargo&#39;, &#39;Ano&#39;])[&#39;Total de Gastos em Salários&#39;].sum()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cargoNivel  dataAno
JUNIOR      2016         489456.84
            2017        1030642.80
            2018        1393282.20
            2019        1755714.36
            2020        1755714.36
PLENO       2016        1454152.44
            2017        3791593.92
            2018        5357227.44
            2019        6132228.24
            2020        6132228.24
SENIOR      2016        2499007.80
            2017        4953043.08
            2018        8185016.76
            2019       10679723.76
            2020       10679723.76
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Nível do Cargo&#39;, &#39;Ano&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-6749d6ba-2e23-4155-ac83-b510c15a73c5">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>dataAno</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
    </tr>
    <tr>
      <th>cargoNivel</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JUNIOR</th>
      <td>489456.84</td>
      <td>1030642.80</td>
      <td>1393282.20</td>
      <td>1755714.36</td>
      <td>1755714.36</td>
    </tr>
    <tr>
      <th>PLENO</th>
      <td>1454152.44</td>
      <td>3791593.92</td>
      <td>5357227.44</td>
      <td>6132228.24</td>
      <td>6132228.24</td>
    </tr>
    <tr>
      <th>SENIOR</th>
      <td>2499007.80</td>
      <td>4953043.08</td>
      <td>8185016.76</td>
      <td>10679723.76</td>
      <td>10679723.76</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-6749d6ba-2e23-4155-ac83-b510c15a73c5')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-6749d6ba-2e23-4155-ac83-b510c15a73c5 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-6749d6ba-2e23-4155-ac83-b510c15a73c5');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1">#pagamentoDataCargo.rename(mapper={&quot;dataAno&quot;: &quot;Ano&quot;, &quot;cargoNivel&quot;: &quot;Nível do Cargo&quot;, &quot;salario&quot;: &quot;Total de Gastos em Salários&quot;}, axis=1).groupby([&#39;Nível do Cargo&#39;, &#39;Ano&#39;])[&#39;Total de Gastos em Salários&#39;].sum().unstack(level = 1).plot(kind = &#39;bar&#39;, stacked = True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd7538cac90&gt;
</pre></div>
</div>
<img alt="../_images/1ee700225db3db19f484a5d99b4cde68901d46ba101e024c8ef396f47d89d8e2.png" src="../_images/1ee700225db3db19f484a5d99b4cde68901d46ba101e024c8ef396f47d89d8e2.png" />
</div>
</div>
</section>
<section id="id28">
<h2>3.4 Operação Drill-Across<a class="headerlink" href="#id28" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Compara medidas numéricas de tabelas de fatos diferentes, utilizando pelo menos uma dimensão em comum.</p>
<p><strong>Exemplo de consulta:</strong> Qual o total gasto com salários e qual o total de receitas recebidas, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#total gasto em salários considerando cada ano</span>
<span class="c1">#dados obtidos utilizando a tabela de fatos pagamento</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span> 
<span class="n">pagamentoAno</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#total de receitas recebidas, considerando cada ano</span>
<span class="c1">#dados obtidos utilizando a tabela de fatos negociacao</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">negociacaoAno</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#relacionado as medidas numéricas presentes nas duas tabelas de fatos</span>
<span class="n">pagamentoAno</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoAno</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-b36c6be6-2409-4045-a5fd-d4ee9b386dee">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salario</th>
      <th>receita</th>
    </tr>
    <tr>
      <th>dataAno</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016</th>
      <td>4442617.08</td>
      <td>4614246.95</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>9775279.80</td>
      <td>7200423.35</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>14935526.40</td>
      <td>11593539.65</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>18567666.36</td>
      <td>35353318.30</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>18567666.36</td>
      <td>30222175.95</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b36c6be6-2409-4045-a5fd-d4ee9b386dee')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b36c6be6-2409-4045-a5fd-d4ee9b386dee button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b36c6be6-2409-4045-a5fd-d4ee9b386dee');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoAno</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoAno</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd75380c610&gt;
</pre></div>
</div>
<img alt="../_images/c834df1c884189f23a760fd3b8dce3ca678b105784b92211133e1288847568a2.png" src="../_images/c834df1c884189f23a760fd3b8dce3ca678b105784b92211133e1288847568a2.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id29">
<h1>3 Execução de Consultas com Foco na Tomada de Decisão<a class="headerlink" href="#id29" title="Permalink to this heading">#</a></h1>
<p>As consultas OLAP requisitadas por usuários de sistemas de suporte à decisão usualmente requerem que várias operações OLAP sejam realizadas simultaneamente. A seguir são ilustrados exemplos de consultas OLAP que podem ser requisitadas para a tomada de decisão estratégica.</p>
<section id="id30">
<h2>3.1 Consulta 1<a class="headerlink" href="#id30" title="Permalink to this heading">#</a></h2>
<p><strong>Consulta:</strong> Qual é a média dos salários recebidos por nível do cargo e por sexo no ano passado, sendo que o ano passado se refere ao ano de 2019?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">cargo</span></code>, <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.cargoPK</span> <span class="pre">=</span> <span class="pre">cargo.cargoPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.funcPK</span> <span class="pre">=</span> <span class="pre">funcionario.funcPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataAno == 2019&#39;</span><span class="p">)</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataFunc</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">funcionario</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;funcPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataFuncCargo</span> <span class="o">=</span> <span class="n">pagamentoDataFunc</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;cargoPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cargoNivel  funcSexo
JUNIOR      F            2440.233125
            M            2437.859091
PLENO       F            7641.937619
            M            6259.613036
SENIOR      F           12994.190000
            M           14480.502708
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-11eb86fc-1e75-4b9d-b661-194363c42a05">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>funcSexo</th>
      <th>F</th>
      <th>M</th>
    </tr>
    <tr>
      <th>cargoNivel</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>JUNIOR</th>
      <td>2440.233125</td>
      <td>2437.859091</td>
    </tr>
    <tr>
      <th>PLENO</th>
      <td>7641.937619</td>
      <td>6259.613036</td>
    </tr>
    <tr>
      <th>SENIOR</th>
      <td>12994.190000</td>
      <td>14480.502708</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-11eb86fc-1e75-4b9d-b661-194363c42a05')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-11eb86fc-1e75-4b9d-b661-194363c42a05 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-11eb86fc-1e75-4b9d-b661-194363c42a05');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cargoNivel&#39;</span><span class="p">,</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd753f8e790&gt;
</pre></div>
</div>
<img alt="../_images/aad1d7baafee232ed2e6b2cc8954b7478b8e6351bb543cd6d61370316c8e622a.png" src="../_images/aad1d7baafee232ed2e6b2cc8954b7478b8e6351bb543cd6d61370316c8e622a.png" />
</div>
</div>
</section>
<section id="id31">
<h2>3.2 Consulta 2<a class="headerlink" href="#id31" title="Permalink to this heading">#</a></h2>
<p><strong>Consulta:</strong> Qual o total de gastos em salários considerando os estados nos quais as equipes estão localizadas no trimestre 3 do ano de 2020?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipePK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataTrimestre == 3 and dataAno == 2020&#39;</span><span class="p">)</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataEquipe</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;filialEstadoNome&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>filialEstadoNome
PERNAMBUCO             438121.26
MATO GROSSO DO SUL    1013857.74
RIO DE JANEIRO        1258479.57
SAO PAULO             1931458.02
Name: salario, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;filialEstadoNome&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd753711e10&gt;
</pre></div>
</div>
<img alt="../_images/9f0554a17d85539470d3d9c53e98f7e56c3e1a4a2333bddc4214bf8bcbe9285f.png" src="../_images/9f0554a17d85539470d3d9c53e98f7e56c3e1a4a2333bddc4214bf8bcbe9285f.png" />
</div>
</div>
</section>
<section id="id32">
<h2>3.3 Consulta 3<a class="headerlink" href="#id32" title="Permalink to this heading">#</a></h2>
<p><strong>Consulta:</strong> Qual o custo/benefício das equipes quando analisado o semestre 1 do ano de 2020?</p>
<p>A idea da consulta é relacionar os gastos em salários e os ganhos em receitas considerando cada equipe e o período especificado. Portanto, para se realizar essa consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como das tabelas de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code> e <code class="docutils literal notranslate"><span class="pre">negociacao</span></code>.</p>
<p>A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#investigando os gastos em salarios de cada equipe no último semestre ano </span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataSemestre == 1 and dataAno == 2020&#39;</span><span class="p">)</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">dataFiltrada</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span> <span class="p">)</span>
<span class="n">pagamentoDataEquipe</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;equipePK&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span> 
<span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-3de16ce5-07b7-494f-8f43-1ecf37537aff">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salario</th>
    </tr>
    <tr>
      <th>equipePK</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1160327.40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1060981.14</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1177330.32</td>
    </tr>
    <tr>
      <th>4</th>
      <td>579893.94</td>
    </tr>
    <tr>
      <th>5</th>
      <td>909107.10</td>
    </tr>
    <tr>
      <th>6</th>
      <td>585430.86</td>
    </tr>
    <tr>
      <th>7</th>
      <td>876084.06</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1118608.38</td>
    </tr>
    <tr>
      <th>9</th>
      <td>939827.46</td>
    </tr>
    <tr>
      <th>10</th>
      <td>876242.52</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-3de16ce5-07b7-494f-8f43-1ecf37537aff')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-3de16ce5-07b7-494f-8f43-1ecf37537aff button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-3de16ce5-07b7-494f-8f43-1ecf37537aff');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#investigando os ganhos em receitas de cada equipe no semestre 1 de 2020</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataSemestre == 1 and dataAno == 2020&#39;</span><span class="p">)</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">dataFiltrada</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span> <span class="p">)</span>
<span class="n">negociacaoDataEquipe</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;equipePK&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span> 
<span class="n">negociacaoDataEquipe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-94a22036-70f7-4562-988a-48db9b7ad5a0">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>receita</th>
    </tr>
    <tr>
      <th>equipePK</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1259907.25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1338994.40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>340461.30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>340130.65</td>
    </tr>
    <tr>
      <th>5</th>
      <td>614747.70</td>
    </tr>
    <tr>
      <th>6</th>
      <td>736591.35</td>
    </tr>
    <tr>
      <th>7</th>
      <td>722758.45</td>
    </tr>
    <tr>
      <th>8</th>
      <td>538659.30</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4994717.70</td>
    </tr>
    <tr>
      <th>10</th>
      <td>4664745.70</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-94a22036-70f7-4562-988a-48db9b7ad5a0')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-94a22036-70f7-4562-988a-48db9b7ad5a0 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-94a22036-70f7-4562-988a-48db9b7ad5a0');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#juntando os dados obtidos</span>
<span class="n">pagamentoNegociacao</span> <span class="o">=</span> <span class="n">pagamentoDataEquipe</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoDataEquipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span> <span class="p">)</span>
<span class="n">pagamentoNegociacao</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-3f074a31-afd0-4e26-bd63-13a4cca8a1d3">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salario</th>
      <th>receita</th>
    </tr>
    <tr>
      <th>equipePK</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1160327.40</td>
      <td>1259907.25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1060981.14</td>
      <td>1338994.40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1177330.32</td>
      <td>340461.30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>579893.94</td>
      <td>340130.65</td>
    </tr>
    <tr>
      <th>5</th>
      <td>909107.10</td>
      <td>614747.70</td>
    </tr>
    <tr>
      <th>6</th>
      <td>585430.86</td>
      <td>736591.35</td>
    </tr>
    <tr>
      <th>7</th>
      <td>876084.06</td>
      <td>722758.45</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1118608.38</td>
      <td>538659.30</td>
    </tr>
    <tr>
      <th>9</th>
      <td>939827.46</td>
      <td>4994717.70</td>
    </tr>
    <tr>
      <th>10</th>
      <td>876242.52</td>
      <td>4664745.70</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-3f074a31-afd0-4e26-bd63-13a4cca8a1d3')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-3f074a31-afd0-4e26-bd63-13a4cca8a1d3 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-3f074a31-afd0-4e26-bd63-13a4cca8a1d3');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoNegociacaoEquipeCidade</span> <span class="o">=</span> <span class="n">pagamentoNegociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span> <span class="p">)</span>
<span class="n">pagamentoNegociacaoEquipeCidade</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)[[</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;salario&#39;</span><span class="p">,</span> <span class="s1">&#39;receita&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-f19df6ad-497e-48bf-bd7f-43f9ba60ced7">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipeNome</th>
      <th>filialNome</th>
      <th>salario</th>
      <th>receita</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>1160327.40</td>
      <td>1259907.25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>1060981.14</td>
      <td>1338994.40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>1177330.32</td>
      <td>340461.30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>WEB</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>579893.94</td>
      <td>340130.65</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WEB</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>909107.10</td>
      <td>614747.70</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f19df6ad-497e-48bf-bd7f-43f9ba60ced7')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f19df6ad-497e-48bf-bd7f-43f9ba60ced7 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f19df6ad-497e-48bf-bd7f-43f9ba60ced7');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;lucro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span>
<span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[[</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;lucro&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;lucro&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-b4652667-d4bf-4daf-8032-6124d9add51f">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipeNome</th>
      <th>filialNome</th>
      <th>lucro</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>BI &amp; ANALYTICS</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>4054890.24</td>
    </tr>
    <tr>
      <th>9</th>
      <td>BI &amp; ANALYTICS</td>
      <td>RECIFE - CENTRO</td>
      <td>3788503.18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>278013.26</td>
    </tr>
    <tr>
      <th>5</th>
      <td>APP - MOBILE</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>151160.49</td>
    </tr>
    <tr>
      <th>0</th>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>99579.85</td>
    </tr>
    <tr>
      <th>6</th>
      <td>APP - MOBILE</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>-153325.61</td>
    </tr>
    <tr>
      <th>3</th>
      <td>WEB</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>-239763.29</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WEB</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>-294359.40</td>
    </tr>
    <tr>
      <th>7</th>
      <td>APP - MOBILE</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>-579949.08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>-836869.02</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b4652667-d4bf-4daf-8032-6124d9add51f')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b4652667-d4bf-4daf-8032-6124d9add51f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b4652667-d4bf-4daf-8032-6124d9add51f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamentoNegociacaoEquipeCidade</span><span class="p">[</span><span class="s1">&#39;lucro&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd7540f4cd0&gt;
</pre></div>
</div>
<img alt="../_images/41d14ce405893e3ab46513eca164e167134865f2f9db1f099396304e9ce565fe.png" src="../_images/41d14ce405893e3ab46513eca164e167134865f2f9db1f099396304e9ce565fe.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercicios">
<h1>4 Exercícios<a class="headerlink" href="#exercicios" title="Permalink to this heading">#</a></h1>
<section id="id33">
<h2>Exercício 1<a class="headerlink" href="#id33" title="Permalink to this heading">#</a></h2>
<p>Liste, para cada ano, a quantidade de negociações realizadas pelos clientes residentes no estado de Pernambuco.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span> <span class="p">)</span>
<span class="n">clientesPernambuco</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;clienteEstadoNome == &quot;PERNAMBUCO&quot;&#39;</span><span class="p">)</span>
<span class="n">negociacaoPernambuco</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">clientesPernambuco</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;clientePK&#39;</span><span class="p">)</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">negociacaoPernambuco</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;quantidadeNegociacoes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">resposta</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dataAno
2016    26
2017    48
2018    46
2019    72
2020    63
Name: quantidadeNegociacoes, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="id34">
<h2>Exercício 2<a class="headerlink" href="#id34" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 1 usando um gráfico de barra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>
<span class="n">resposta</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd753fa0a90&gt;
</pre></div>
</div>
<img alt="../_images/24949a2d67adc3300e7e0fcf533b83c54438877974a7d3d6b2adaa051482e4b2.png" src="../_images/24949a2d67adc3300e7e0fcf533b83c54438877974a7d3d6b2adaa051482e4b2.png" />
</div>
</div>
</section>
<section id="id35">
<h2>Exercício 3<a class="headerlink" href="#id35" title="Permalink to this heading">#</a></h2>
<p>Qual o total de despesas em salários nos anos de 2016 a 2020 em cada região na qual a equipe está localizada, considerando o cargo de nível junior? Arredonde a soma dos salários para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “REGIAO”, “TOTALDESPESA”. Ordene as linhas exibidas primeiro pelo total de despesa em ordem descendente, e depois pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Filtra os anos e o cargo</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;2016 &lt;= dataAno and dataAno &lt;= 2020&#39;</span><span class="p">)</span>
<span class="n">cargoFiltrado</span> <span class="o">=</span> <span class="n">cargo</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;cargoNivel == &quot;JUNIOR&quot;&#39;</span><span class="p">)</span>

<span class="c1"># Combina as tabelas necessárias</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataCargo</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cargoFiltrado</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;cargoPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoDataCargoEquipe</span> <span class="o">=</span> <span class="n">pagamentoDataCargo</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span><span class="p">)</span>

<span class="c1"># Agrupa e apresenta o valor</span>
<span class="n">resultado</span> <span class="o">=</span> <span class="n">pagamentoDataCargoEquipe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">,</span> <span class="s1">&#39;filialRegiaoNome&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Transforma o groupby em dataframe</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Orderna as linhas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;salario&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Arredonda valores</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Renomeia colunas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dataAno&quot;</span><span class="p">:</span> <span class="s2">&quot;ANO&quot;</span><span class="p">,</span> <span class="s2">&quot;filialRegiaoNome&quot;</span><span class="p">:</span> <span class="s2">&quot;REGIAO&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">:</span> <span class="s2">&quot;TOTALDESPESA&quot;</span><span class="p">})</span>

<span class="c1"># Lista as primeiras 25 linhas da resposta</span>
<span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-14173607-227f-4db8-9f07-6dfe5637ad8f">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ANO</th>
      <th>REGIAO</th>
      <th>TOTALDESPESA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>2020</td>
      <td>SUDESTE</td>
      <td>1257808.68</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2019</td>
      <td>SUDESTE</td>
      <td>1257808.68</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018</td>
      <td>SUDESTE</td>
      <td>1056208.92</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>SUDESTE</td>
      <td>876154.56</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2016</td>
      <td>SUDESTE</td>
      <td>489456.84</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2020</td>
      <td>CENTRO-OESTE</td>
      <td>337073.28</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2019</td>
      <td>CENTRO-OESTE</td>
      <td>337073.28</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018</td>
      <td>CENTRO-OESTE</td>
      <td>337073.28</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2020</td>
      <td>NORDESTE</td>
      <td>160832.40</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2019</td>
      <td>NORDESTE</td>
      <td>160832.40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017</td>
      <td>CENTRO-OESTE</td>
      <td>154488.24</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-14173607-227f-4db8-9f07-6dfe5637ad8f')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-14173607-227f-4db8-9f07-6dfe5637ad8f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-14173607-227f-4db8-9f07-6dfe5637ad8f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
<section id="id36">
<h2>Exercício 4<a class="headerlink" href="#id36" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 3 usando um diagrama de barras que permite a visualização dos resultados por região.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>
<span class="c1"># Visualiza os dados &quot;divididos&quot; por região</span>
<span class="n">legend</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CENTRO-OESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;NORDESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;SUDESTE&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ANO&#39;</span><span class="p">,</span> <span class="s1">&#39;REGIAO&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">);</span> <span class="c1"># atualiza os labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6ca13f2ddcf2c6eafe362faac22e07d566f7c3103abd0a12757e414e7161f7ae.png" src="../_images/6ca13f2ddcf2c6eafe362faac22e07d566f7c3103abd0a12757e414e7161f7ae.png" />
</div>
</div>
</section>
<section id="id37">
<h2>Exercício 5<a class="headerlink" href="#id37" title="Permalink to this heading">#</a></h2>
<p>Liste o total dos salários e o total de receitas recebidas, considerando os anos de 2017, 2018 e 2019. Arredonde o total dos salários para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “TOTAL GASTO EM SALARIOS”, “TOTAL DE RECEITAS RECEBIDAS”. Ordene as linhas exibidas pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Calcula o total de salários </span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataAno in [2017, 2018, 2019]&#39;</span><span class="p">)</span>
<span class="n">pagamentoData</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagamentoAno</span> <span class="o">=</span> <span class="n">pagamentoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;salario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

<span class="c1"># Calcula o total de receitas recebidas </span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataAno == 2017 or dataAno == 2018 or dataAno == 2019&#39;</span><span class="p">)</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">negociacaoAno</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataAno&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

<span class="c1"># Calcula o resultado final</span>
<span class="n">resultado</span> <span class="o">=</span> <span class="n">pagamentoAno</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoAno</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataAno&#39;</span><span class="p">)</span>

<span class="c1"># Transforma o groupby em dataframe</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Renomeia colunas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dataAno&quot;</span><span class="p">:</span> <span class="s2">&quot;ANO&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">:</span> <span class="s2">&quot;TOTAL GASTO EM SALARIOS&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">:</span> <span class="s2">&quot;TOTAL DE RECEITAS RECEBIDAS&quot;</span><span class="p">})</span>

<span class="c1"># Orderna as linhas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ANO&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Arredonda valores</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Lista as primeiras 25 linhas da resposta</span>
<span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-87ae0fce-5943-4ee5-822d-cbddc3dc9afd">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ANO</th>
      <th>TOTAL GASTO EM SALARIOS</th>
      <th>TOTAL DE RECEITAS RECEBIDAS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>2019</td>
      <td>18567666.36</td>
      <td>35353318.30</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018</td>
      <td>14935526.40</td>
      <td>11593539.65</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2017</td>
      <td>9775279.80</td>
      <td>7200423.35</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-87ae0fce-5943-4ee5-822d-cbddc3dc9afd')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-87ae0fce-5943-4ee5-822d-cbddc3dc9afd button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-87ae0fce-5943-4ee5-822d-cbddc3dc9afd');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
<section id="id38">
<h2>Exercício 6<a class="headerlink" href="#id38" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 5 usando um diagrama de barras.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>
<span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ANO&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd753270a50&gt;
</pre></div>
</div>
<img alt="../_images/c77be4ef8f5f4ec2509e005f8b9d7f03db9dbd92b04e97650534ff8ff416dcd2.png" src="../_images/c77be4ef8f5f4ec2509e005f8b9d7f03db9dbd92b04e97650534ff8ff416dcd2.png" />
</div>
</div>
</section>
<section id="id39">
<h2>Exercício 7<a class="headerlink" href="#id39" title="Permalink to this heading">#</a></h2>
<p>Compare a quantidade de negociações que cada uma das equipes realizou nos anos de 2018 e 2019. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “NOME DA EQUIPE”, “NOME DA FILIAL”, “NEGOCIACOES 2018”, “NEGOCIACOES 2019”. Ordene as linhas exibidas pelo nome da equipe em ordem ascendente e depois pelo nome da filial em ordem ascendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<p>Dica: Considere relacionar as equipes por meio da operação <em>drill-across</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Determina a quantidade de negociações no ano de 2018</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataAno == 2018&#39;</span><span class="p">)</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span> <span class="p">)</span>
<span class="n">negociacaoData</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;equipePK&#39;</span><span class="p">])[</span><span class="s1">&#39;quantidadeNegociacoes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

<span class="c1"># Determina a quantidade de negociações no ano de 2019</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataAno == 2019&#39;</span><span class="p">)</span>
<span class="n">negociacaoData2</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span> <span class="p">)</span>
<span class="n">negociacaoData2</span> <span class="o">=</span> <span class="n">negociacaoData2</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;equipePK&#39;</span><span class="p">])[</span><span class="s1">&#39;quantidadeNegociacoes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

<span class="c1"># Realiza a operação drill-accross</span>
<span class="n">negociacaoPagamentoData</span> <span class="o">=</span> <span class="n">negociacaoData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoData2</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_2018&#39;</span><span class="p">,</span> <span class="s1">&#39;_2019&#39;</span><span class="p">))</span>

<span class="c1"># Adiciona os dados das equipes que devem ser exibidos</span>
<span class="n">negociacaoPagamentoData</span> <span class="o">=</span> <span class="n">equipe</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">negociacaoPagamentoData</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span><span class="p">)</span>
<span class="n">resultado</span> <span class="o">=</span> <span class="n">negociacaoPagamentoData</span><span class="p">[[</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;quantidadeNegociacoes_2018&#39;</span><span class="p">,</span> <span class="s1">&#39;quantidadeNegociacoes_2019&#39;</span><span class="p">]]</span>
<span class="n">resultado</span>

<span class="c1"># Renomeia colunas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;equipeNome&quot;</span><span class="p">:</span> <span class="s2">&quot;NOME DA EQUIPE&quot;</span><span class="p">,</span> <span class="s2">&quot;filialNome&quot;</span><span class="p">:</span> <span class="s2">&quot;NOME DA FILIAL&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeNegociacoes_2018&quot;</span><span class="p">:</span> <span class="s2">&quot;NEGOCIACOES 2018&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeNegociacoes_2019&quot;</span><span class="p">:</span> <span class="s2">&quot;NEGOCIACOES 2019&quot;</span>
<span class="p">})</span>

<span class="c1"># Orderna as linhas</span>
<span class="n">resultadoTransformado</span><span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NOME DA EQUIPE&quot;</span><span class="p">,</span> <span class="s2">&quot;NOME DA FILIAL&quot;</span><span class="p">])</span>

<span class="c1"># Lista as primeiras 25 linhas</span>
<span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-5dfa97ab-9284-4f91-8c1f-609b0c2a19ce">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NOME DA EQUIPE</th>
      <th>NOME DA FILIAL</th>
      <th>NEGOCIACOES 2018</th>
      <th>NEGOCIACOES 2019</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>149</td>
      <td>135</td>
    </tr>
    <tr>
      <th>0</th>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>132</td>
      <td>135</td>
    </tr>
    <tr>
      <th>7</th>
      <td>APP - MOBILE</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>98</td>
      <td>88</td>
    </tr>
    <tr>
      <th>6</th>
      <td>APP - MOBILE</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>99</td>
      <td>112</td>
    </tr>
    <tr>
      <th>5</th>
      <td>APP - MOBILE</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>104</td>
      <td>108</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WEB</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>100</td>
      <td>95</td>
    </tr>
    <tr>
      <th>3</th>
      <td>WEB</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>91</td>
      <td>106</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>76</td>
      <td>87</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-5dfa97ab-9284-4f91-8c1f-609b0c2a19ce')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-5dfa97ab-9284-4f91-8c1f-609b0c2a19ce button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-5dfa97ab-9284-4f91-8c1f-609b0c2a19ce');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
<section id="id40">
<h2>Exercício 8<a class="headerlink" href="#id40" title="Permalink to this heading">#</a></h2>
<p>Liste os setores dos clientes e a soma de suas respectivas receitas para o segundo semestre do ano de 2020. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “SETOR DO CLIENTE”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo total de receitas em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Filtra os dados do segundo semestre do ano de 2020</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataSemestre == 2 and dataAno == 2020&#39;</span><span class="p">)</span>

<span class="c1"># Realiza as junções necessárias</span>
<span class="n">receitaData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">receitaDataCliente</span> <span class="o">=</span> <span class="n">receitaData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cliente</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;clientePK&#39;</span><span class="p">)</span>

<span class="c1"># Determina o total de receitas</span>
<span class="n">resultado</span> <span class="o">=</span> <span class="n">receitaDataCliente</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;clienteSetor&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

<span class="c1"># Transforma o groupby em dataframe</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Renomeia colunas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">:</span> <span class="s2">&quot;SETOR DO CLIENTE&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">:</span> <span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">})</span>

<span class="c1"># Orderna as linhas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Lista as primeiras 25 linhas</span>
<span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-b44c217e-0250-4e21-93c6-ee0bb78498e4">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SETOR DO CLIENTE</th>
      <th>TOTAL DE RECEITAS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>BEBIDAS E ALIMENTOS</td>
      <td>5749704.70</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SAUDE</td>
      <td>3119775.30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TECNOLOGIA</td>
      <td>2465926.05</td>
    </tr>
    <tr>
      <th>1</th>
      <td>VESTUARIO</td>
      <td>2336266.50</td>
    </tr>
    <tr>
      <th>0</th>
      <td>CREDITO</td>
      <td>998789.60</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b44c217e-0250-4e21-93c6-ee0bb78498e4')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b44c217e-0250-4e21-93c6-ee0bb78498e4 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b44c217e-0250-4e21-93c6-ee0bb78498e4');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
<section id="id41">
<h2>Exercício 9<a class="headerlink" href="#id41" title="Permalink to this heading">#</a></h2>
<p>Analise a resposta do Exercício 8 para identificar qual o setor do cliente que obteve o maior total de receitas. Mostre o total de receitas por mês para esse setor do cliente, considerando o segundo semestre do ano de 2020. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “MES”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo total de receitas em ordem descendente e depois pelo mês em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Filtra os dados do segundo semestre do ano de 2020 </span>
<span class="c1"># considerando o setor do cliente com maior total de receitas</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataSemestre == 2 and dataAno == 2020&#39;</span><span class="p">)</span>
<span class="n">clienteFiltrado</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;clienteSetor == &quot;BEBIDAS E ALIMENTOS&quot;&#39;</span><span class="p">)</span>

<span class="c1"># Realiza as junções necessárias</span>
<span class="n">receitaData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">receitaDataCliente</span> <span class="o">=</span> <span class="n">receitaData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">clienteFiltrado</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;clientePK&#39;</span><span class="p">)</span>

<span class="c1"># Determina o total de receitas</span>
<span class="n">resultado</span> <span class="o">=</span> <span class="n">receitaDataCliente</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dataMes&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Transforma o groupby em dataframe</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Renomeia colunas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dataMes&quot;</span><span class="p">:</span> <span class="s2">&quot;MES&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">:</span> <span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">})</span>

<span class="c1"># Orderna as linhas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">,</span> <span class="s2">&quot;MES&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Lista as primeiras 25 linhas</span>
<span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-9b56d76b-1245-4f81-9463-fb4c607464fc">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MES</th>
      <th>TOTAL DE RECEITAS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>11</td>
      <td>1156403.30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10</td>
      <td>1091389.50</td>
    </tr>
    <tr>
      <th>5</th>
      <td>12</td>
      <td>899122.70</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9</td>
      <td>877223.55</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8</td>
      <td>875934.30</td>
    </tr>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>849631.35</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-9b56d76b-1245-4f81-9463-fb4c607464fc')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-9b56d76b-1245-4f81-9463-fb4c607464fc button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-9b56d76b-1245-4f81-9463-fb4c607464fc');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
<section id="id42">
<h2>Exercício 10<a class="headerlink" href="#id42" title="Permalink to this heading">#</a></h2>
<p>Analise a resposta do Exercício 9 para identificar qual mês gerou o maior total de receitas para o setor de cliente identificado no Exercício 8. Mostre o total de receitas das equipes, considerando o segundo semestre do ano de 2020, o setor de cliente identificado no Exercício 8 e o mês identificado no Exercício 9. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “NOME DA EQUIPE”, “NOME DA FILIAL”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo pelo nome da equipe em ordem ascendente, e depois pelo nome da filial em ordem ascendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Filtra os dados do segundo semestre do ano de 2020 </span>
<span class="c1"># considerando o setor do cliente com maior total de receitas</span>
<span class="c1"># e o mês com o maior total de receitas</span>
<span class="n">dataFiltrada</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;dataAno == 2020 and dataMes == 11&#39;</span><span class="p">)</span>
<span class="n">clienteFiltrado</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;clienteSetor == &quot;BEBIDAS E ALIMENTOS&quot;&#39;</span><span class="p">)</span>

<span class="c1"># Realiza as junções necessárias</span>
<span class="n">receitaData</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataFiltrada</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">receitaDataCliente</span> <span class="o">=</span> <span class="n">receitaData</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">clienteFiltrado</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;clientePK&#39;</span><span class="p">)</span>
<span class="n">receitaDataClienteEquipe</span> <span class="o">=</span> <span class="n">receitaDataCliente</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;equipePK&#39;</span><span class="p">)</span>

<span class="c1"># Determina o total de receitas</span>
<span class="n">resultado</span> <span class="o">=</span> <span class="n">receitaDataClienteEquipe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">])[</span><span class="s1">&#39;receita&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

<span class="c1"># Transforma o groupby em dataframe</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Orderna as linhas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Renomeia colunas</span>
<span class="n">resultadoTransformado</span> <span class="o">=</span> <span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;equipeNome&quot;</span><span class="p">:</span> <span class="s2">&quot;NOME DA EQUIPE&quot;</span><span class="p">,</span> <span class="s2">&quot;filialNome&quot;</span><span class="p">:</span> <span class="s2">&quot;NOME DA FILIAL&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">:</span><span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">})</span>

<span class="c1"># Lista as primeiras 25 linhas</span>
<span class="n">resultadoTransformado</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-bba7988a-52ea-4a35-93ac-efd3bae95397">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NOME DA EQUIPE</th>
      <th>NOME DA FILIAL</th>
      <th>TOTAL DE RECEITAS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>APP - DESKTOP</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>35645.65</td>
    </tr>
    <tr>
      <th>7</th>
      <td>APP - DESKTOP</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>129409.40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>APP - MOBILE</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>48714.45</td>
    </tr>
    <tr>
      <th>4</th>
      <td>APP - MOBILE</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>62138.70</td>
    </tr>
    <tr>
      <th>1</th>
      <td>APP - MOBILE</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>26571.85</td>
    </tr>
    <tr>
      <th>9</th>
      <td>BI &amp; ANALYTICS</td>
      <td>RECIFE - CENTRO</td>
      <td>527169.75</td>
    </tr>
    <tr>
      <th>8</th>
      <td>BI &amp; ANALYTICS</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>149490.15</td>
    </tr>
    <tr>
      <th>0</th>
      <td>WEB</td>
      <td>CAMPO GRANDE - CENTRO</td>
      <td>20042.75</td>
    </tr>
    <tr>
      <th>5</th>
      <td>WEB</td>
      <td>RIO DE JANEIRO - BARRA DA TIJUCA</td>
      <td>68596.10</td>
    </tr>
    <tr>
      <th>6</th>
      <td>WEB</td>
      <td>SAO PAULO - AV. PAULISTA</td>
      <td>88624.50</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-bba7988a-52ea-4a35-93ac-efd3bae95397')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-bba7988a-52ea-4a35-93ac-efd3bae95397 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-bba7988a-52ea-4a35-93ac-efd3bae95397');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  </div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analise-de-dados-com-base-em-processamento-massivo-em-paralelo">
<h1>Análise de Dados com Base em Processamento Massivo em Paralelo<a class="headerlink" href="#analise-de-dados-com-base-em-processamento-massivo-em-paralelo" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="aula-05-plantao-leonardo-pipeline-utilizando-luigi">
<h1>Aula 05 - Plantão Leonardo - Pipeline utilizando Luigi<a class="headerlink" href="#aula-05-plantao-leonardo-pipeline-utilizando-luigi" title="Permalink to this heading">#</a></h1>
<p>Material Produzido por <strong>Leonardo Mauro Pereira Moraes</strong><br />
CEMEAI - ICMC/USP São Carlos</p>
<section id="luigi">
<h2>Luigi<a class="headerlink" href="#luigi" title="Permalink to this heading">#</a></h2>
<p>“Luigi é um módulo Python que ajuda a construir pipelines complexos de trabalhos em lote. Ele lida com resolução de dependências, gerenciamento de fluxo de trabalho, visualização, etc” <a class="reference external" href="https://github.com/spotify/luigi">spotify/luigi</a>. Ele também vem com suporte a Hadoop, AWS S3, entre outros.</p>
<p>Vamos instalar o pacote.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
!pip install luigi==3.0.3
</pre></div>
</div>
</div>
</div>
</section>
<section id="pros-e-contras">
<h2>Prós e Contras<a class="headerlink" href="#pros-e-contras" title="Permalink to this heading">#</a></h2>
<p>“A biblioteca de pipeline do Luigi foi projetada e ainda é usada pelo Spotify. Com o passar dos anos, foi adotado por outras empresas. Mas, exatamente, por ter sido feito sob medida para o Spotify, pode não ser adequado para atender às suas necessidades e eu o aconselho a considerar cuidadosamente se este sistema pode funcionar para você” <a class="reference external" href="https://towardsdatascience.com/a-tutorial-on-luigi-spotifys-pipeline-5c694fb4113e">Mattia Cinelli</a>.</p>
<section id="pros">
<h3>Prós<a class="headerlink" href="#pros" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>É Python! Logo, você já sabe codificar nele, além de poder combinar o processo que deseja automatizar (seu código original) com a infraestrutura do pipeline (portanto, Luigi)</p></li>
<li><p>Sua estrutura é “backward”, isto é permite que se recupere de tarefas com falha sem executar novamente todo o pipeline novamente.</p></li>
<li><p>Um wrapper de lote AWS para trabalhar diretamente com o Amazon ECS.</p></li>
<li><p>Uma GUI que mostra o status das tarefas e uma representação gráfica de seu pipeline.</p></li>
</ul>
</section>
<section id="contras">
<h3>Contras<a class="headerlink" href="#contras" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>É difícil testar.</p></li>
<li><p>Apresenta um paradgima de programação diferente.</p></li>
<li><p>Ele precisa ser mantido simples, ou melhor, linear (tente mantê-lo &lt;1k tarefas). Muitos ramos e garfos podem diminuir o tempo de execução de forma incrível.</p></li>
<li><p>Não há gatilho (trigger). Assim, o pipeline não iniciará quando os arquivos necessários estiverem no lugar, mas você precisa configurar um cronjob para verificá-los e fazer o pipeline iniciar.</p></li>
</ul>
</section>
</section>
<section id="estrutura-do-luigi">
<h2>Estrutura do Luigi<a class="headerlink" href="#estrutura-do-luigi" title="Permalink to this heading">#</a></h2>
<section id="do-pipeline">
<h3>do Pipeline<a class="headerlink" href="#do-pipeline" title="Permalink to this heading">#</a></h3>
<p>Normalmente, um pipeline segue um fluxo linear, em que o primeiro nó é considerado o nó inicial, este é o primeiro a ser executado, seguido por um segundo e depois um terceiro até que o nó final conclua o fluxo de trabalho.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Inicio</span> <span class="pre">-&gt;</span> <span class="pre">Nó</span> <span class="pre">A</span> <span class="pre">-&gt;</span> <span class="pre">Nó</span> <span class="pre">B</span> <span class="pre">-&gt;</span> <span class="pre">Nó</span> <span class="pre">C</span> <span class="pre">-&gt;</span> <span class="pre">Fim</span></code></p>
</div></blockquote>
<p>Em vez disso, no Luigi, esse processo é invertido!</p>
</section>
<section id="do-codigo">
<h3>do Código<a class="headerlink" href="#do-codigo" title="Permalink to this heading">#</a></h3>
<p>O Luigi funciona como um gráfo, seus nós são chamados de <code class="docutils literal notranslate"><span class="pre">Task</span></code> e suas conexões são chamadas de <code class="docutils literal notranslate"><span class="pre">Target</span></code>. Dentro de cada nó há um conjunto de funções:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">output()</span></code> - Define o <code class="docutils literal notranslate"><span class="pre">Target</span></code> de saída.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requires()</span></code> - Define qual <code class="docutils literal notranslate"><span class="pre">Task</span></code> é necessária para este nó.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run()</span></code> - Define a execução do código.</p></li>
</ul>
</section>
</section>
<section id="exemplo-1">
<h2>Exemplo 1<a class="headerlink" href="#exemplo-1" title="Permalink to this heading">#</a></h2>
<p>Contagem de letras.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">luigi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GenerateWords</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s1">&#39;output/1.words.txt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># write a dummy list of words to output file</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span><span class="s1">&#39;grapefruit&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{word}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CountLetters</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GenerateWords</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="s1">&#39;output/2.letter_counts.txt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># read in file as list</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="c1"># write each word to output file with its corresponding letter count</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{word}</span><span class="s1"> | </span><span class="si">{letter_count}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">,</span><span class="n">letter_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Rodar o código,</p>
<ul class="simple">
<li><p>pelo Terminal<br />
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">luigi</span> <span class="pre">--module</span> <span class="pre">arquivo</span> <span class="pre">CountLetters</span> <span class="pre">--local-schedule</span></code></p></li>
<li><p>pelo Python<br />
<code class="docutils literal notranslate"><span class="pre">luigi.build([CountLetters()],</span> <span class="pre">local_scheduler=True)</span></code> porém, não funciona no Google Colab</p></li>
</ul>
</section>
<section id="exemplo-2">
<h2>Exemplo 2<a class="headerlink" href="#exemplo-2" title="Permalink to this heading">#</a></h2>
<p>Utilizando <a class="reference external" href="https://luigi.readthedocs.io/en/stable/api/luigi.parameter.html">parâmetros</a>.</p>
<ul class="simple">
<li><p>Parâmetros padrão</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.Parameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">str</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.IntParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">int</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.FloatParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">float</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.BoolParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">bool</span></code></p></li>
</ul>
</li>
<li><p>Parâmetros temporais - objeto do tipo <code class="docutils literal notranslate"><span class="pre">datetime</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.YearParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">datetime.date</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.MonthParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">datetime.date</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.DateParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">datetime.date</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.DateHourParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.DateMinuteParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.DateSecondParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code></p></li>
</ul>
</li>
<li><p>Parâmetros de conjunto</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.ListParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">list</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.TupleParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">tuple</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">luigi.DictParameter</span></code> - tipo <code class="docutils literal notranslate"><span class="pre">dict</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">CreateFile</span><span class="p">(</span><span class="n">luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">luigi</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;hello world!&#39;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">luigi</span><span class="o">.</span><span class="n">DateParameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;luigi/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/file.txt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Rodar o código,</p>
<ul class="simple">
<li><p>pelo Terminal<br />
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">luigi</span> <span class="pre">--module</span> <span class="pre">arquivo</span> <span class="pre">CreateFile</span> <span class="pre">--local-schedule</span> <span class="pre">--text</span> <span class="pre">&quot;Novo</span> <span class="pre">texto&quot;</span> <span class="pre">--date</span> <span class="pre">2023-11-02</span></code></p></li>
<li><p>pelo Python<br />
<code class="docutils literal notranslate"><span class="pre">luigi.build([CreateFile('Novo</span> <span class="pre">texto',</span> <span class="pre">'2023-11-04')],</span> <span class="pre">local_scheduler=True)</span></code> porém, não funciona no Google Colab</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-06-processamento-paralelo-e-distribuido-span">
<h1><span style="color:blue">Aula 06: Processamento Paralelo e Distribuído</span><a class="headerlink" href="#span-style-color-blue-aula-06-processamento-paralelo-e-distribuido-span" title="Permalink to this heading">#</a></h1>
<section id="span-style-color-blue-apache-spark-rdd-span">
<h2><span style="color:blue">Apache Spark RDD</span><a class="headerlink" href="#span-style-color-blue-apache-spark-rdd-span" title="Permalink to this heading">#</a></h2>
</section>
<section id="id43">
<h2><strong>1 Introdução</strong><a class="headerlink" href="#id43" title="Permalink to this heading">#</a></h2>
<p>O objetivo deste notebook é apresentar conceitos relacionados ao Apache Spark RDD. Antes de apresentar esses conceitos, a seguir são definidas as principais características do <em>framework</em> Apache Spark.</p>
<p>O <em>framework</em> Apache Spark:</p>
<ul class="simple">
<li><p>Executa sobre o sistema de arquivos distribuídos <strong>HDFS</strong> (<em>Hadoop Distributed File System</em>).</p></li>
<li><p>Incorpora e estende os conceitos relacionados ao modelo de programação funcional <strong>MapReduce</strong>. Em especial, o <em>framework</em> Apache Spark introduz diversas operações que podem ser executadas sobre os RDDs, além da possibilidade de criação de dois tipos de variáveis compartilhadas.</p></li>
<li><p>É baseado no uso de <strong>conjuntos de dados distribuídos e resilientes, RDDs</strong> (<em>Resilient and Distributed Datasets</em>). RDDs são abstrações que representam blocos de dados que podem ser reconstruídos em caso de falhas. Eles possibilitam o armazenamento dos resultados intermediários em memória primária sempre que possível. Como resultado, o uso de RDDs diminui o número de acessos a disco.</p></li>
<li><p>Possibilita o <strong>agendamento de tarefas na forma de grafos acíclicos e direcionados, DAGs</strong>. O processamento das tarefas consiste de vários estágios, os quais podem ser executados em paralelo caso não haja dependências entre os estágios. Como resultado, o uso de DAGs melhora o desempenho computacional das aplicações.</p></li>
</ul>
</section>
<section id="apache-spark-cluster">
<h2><strong>2 Apache Spark Cluster</strong><a class="headerlink" href="#apache-spark-cluster" title="Permalink to this heading">#</a></h2>
<section id="arquitetura">
<h3>2.1 Arquitetura<a class="headerlink" href="#arquitetura" title="Permalink to this heading">#</a></h3>
<p>Um <em>cluster</em> Spark é uma arquitetura de sistema distribuído para processamento paralelo composto por três elementos:</p>
<blockquote>
<div><p><strong>Nó mestre</strong>: O nó mestre (<em>master node</em>) é o componente responsável por coordenar a execução das tarefas. Um programa Spark possui apenas um nó mestre. Neste nó, roda-se o <em>driver</em>, um <em>software</em> que distribui as tarefas (<em>tasks</em>) entre os nós do <em>cluster</em> e obtém os resultados dessas tarefas. Para criar o <em>driver</em>, é necessário criar um objeto chamado <em>SparkContext</em>, no qual são definidos os recursos computacionais desejados.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Nó de trabalho</strong>: O nó de trabalho (<em>worker node</em>) é o componente responsável por realizar as tarefas. Um programa Spark possui um ou mais nós de trabalho. Nesses nós, roda-se um ou mais <em>executors</em>. Um <em>executor</em> é um <em>software</em> que recebe as tarefas (<em>tasks</em>) do <em>software</em> <em>driver</em>, armazena os resultados intermediários e retorna os dados gerados quando requisitado.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Gerenciador do cluster</strong>: O gerenciador do <em>cluster</em> (<em>cluster manager</em>) é o componente responsável por disponibilizar os recursos computacionais (por exemplo: memória e núcleos de processamento) por meio dos <em>executors</em> para o <em>driver</em>. O Spark é agnóstico quanto ao gerenciador e oferece suporte para os seguintes gerenciadores em sua versão atual (versão 3.0.1): Spark Standalone (gerenciador próprio do Spark), Apache YARN (mais utilizado), Apache Mesos e Kubernetes (muito utilizado em ambientes de computação em nuvem).</p>
</div></blockquote>
<p>Detalhes adicionais sobre o Apache Spark Cluster podem ser obtidos na documentação oficial do Spark neste <a class="reference external" href="https://spark.apache.org/docs/latest/cluster-overview.html#cluster-manager-types">link</a>.</p>
</section>
<section id="criacao-de-uma-aplicacao-spark">
<h3>2.2 Criação de uma Aplicação Spark<a class="headerlink" href="#criacao-de-uma-aplicacao-spark" title="Permalink to this heading">#</a></h3>
<p>A criação de uma aplicação Spark é feita da forma descrita a seguir, utilizando como base a Figura 1.</p>
<ol class="arabic simple">
<li><p>Deve ser criado um objeto <em>SparkContext</em> definindo os recursos computacionais desejados. A criação desse objeto instancia o <em>driver</em> no <strong>nó mestre</strong>.</p></li>
<li><p>O <em>driver</em> solicita ao <strong>gerenciador do cluster</strong> um conjunto de <em>executors</em> de acordo com os recursos computacionais selecionados.</p></li>
<li><p>O <strong>gerenciador do cluster</strong> cria os <em>executors</em> nos <strong>nós de trabalho</strong> e retorna a informação relacionada a essa criação ao <em>driver</em>;</p></li>
<li><p>O <em>driver</em> submete as tarefas (<em>tasks</em>) para os <em>executors</em> e obtém os resultados retornados por esses <em>executors</em>.</p></li>
</ol>
<br>
<p align="center"><img src="https://raw.githubusercontent.com/cdaciferri/Figures/main/CreateSparkApp.png" width="600" height="300"></p>
<p align="center">Figura 1. Exemplo ilustrativo da criação de uma aplicação Spark.</p>
<br>
<p><strong>Exemplo:</strong> O exemplo a seguir cria uma aplicação Spark utilizando as seguintes configurações: (i) <em>cluster</em> gerenciado pelo Apache YARN; (ii) 1 <em>driver</em> de 1 núcleo de computação e 4 gigabytes de memória; e (iii) 4 <em>executors</em> de 2 núcleos de computação e 16 gigabytes de memória cada. O objeto criado é um objeto <em>SparkContext</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkConf</span><span class="p">,</span> <span class="n">SparkContext</span>

<span class="n">conf</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span> \
       <span class="n">setMaster</span><span class="p">(</span><span class="s2">&quot;yarn&quot;</span><span class="p">)</span><span class="o">.</span> \
       <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;spark.driver.cores&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span><span class="o">.</span> \
       <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;spark.driver.memory&quot;</span><span class="p">,</span> <span class="s2">&quot;4g&quot;</span><span class="p">)</span><span class="o">.</span> \
       <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;spark.executor.cores&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span><span class="o">.</span> \
       <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;spark.executor.memory&quot;</span><span class="p">,</span> <span class="s2">&quot;16g&quot;</span><span class="p">)</span><span class="o">.</span> \
       <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;spark.executor.instances&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">)</span><span class="o">.</span> \

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
<p>Uma lista completa de configurações pode ser obtida na documentação oficial do Spark neste <a class="reference external" href="https://spark.apache.org/docs/latest/configuration.html">link</a>.</p>
</section>
<section id="instalacao">
<h3>2.3 Instalação<a class="headerlink" href="#instalacao" title="Permalink to this heading">#</a></h3>
<p>Neste <em>notebook</em> é criado um <em>cluster</em> Spark composto apenas por um <strong>nó mestre</strong>. Ou seja, o <em>cluster</em> não possui um ou mais <strong>nós de trabalho</strong> e o <strong>gerenciador de cluster</strong>. Nessa configuração, as tarefas (<em>tasks</em>) são realizadas no próprio <em>driver</em> localizado no <strong>nó mestre</strong>.</p>
<p>Para que o cluster possa ser criado, primeiramente é instalado o Java Runtime Environment (JRE) versão 8.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando Java Runtime Environment (JRE) versão 8
%%capture
!apt-get remove openjdk*
!apt-get update --fix-missing
!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<p>Na sequência, é feito o <em>download</em> do Apache Spark versão 3.0.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#baixando Apache Spark versão 3.0.0
%%capture
!wget -q https://archive.apache.org/dist/spark/spark-3.0.0/spark-3.0.0-bin-hadoop2.7.tgz
!tar xf spark-3.0.0-bin-hadoop2.7.tgz &amp;&amp; rm spark-3.0.0-bin-hadoop2.7.tgz
</pre></div>
</div>
</div>
</div>
<p>Na sequência, são configuradas as variáveis de ambiente JAVA_HOME e SPARK_HOME. Isto permite que tanto o Java quanto o Spark possam ser encontrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#configurando a variável de ambiente JAVA_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="c1">#configurando a variável de ambiente SPARK_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.0.0-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, são instalados dois pacotes da linguagem de programação Python, cujas funcionalidades são descritas a seguir.</p>
<blockquote>
<div><p><strong>Pacote findspark:</strong> Usado para ler a variável de ambiente SPARK_HOME e armazenar seu valor na variável dinâmica de ambiente PYTHONPATH. Como resultado, Python pode encontrar a instalação do Spark.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Pacote pyspark:</strong> PySpark é a API do Python para Spark. Ela possibilita o uso de Python, considerando que o <em>framework</em> Apache Spark encontra-se desenvolvido na linguagem de programação Scala.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
#instalando o pacote findspark
!pip install -q findspark==1.4.2
#instalando o pacote pyspark
!pip install -q pyspark==3.0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="conexao">
<h3>2.4 Conexão<a class="headerlink" href="#conexao" title="Permalink to this heading">#</a></h3>
<p>PySpark não é adicionado ao <em>sys.path</em> por padrão. Isso significa que não é possível importá-lo, pois o interpretador da linguagem Python não sabe onde encontrá-lo.</p>
<p>Para resolver esse aspecto, é necessário instalar o módulo <code class="docutils literal notranslate"><span class="pre">findspark</span></code>. Esse módulo mostra onde PySpark está localizado. Os comandos a seguir têm essa finalidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#importando o módulo findspark</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="c1">#carregando a variávels SPARK_HOME na variável dinâmica PYTHONPATH</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Depois de configurados os pacotes e módulos e inicializadas as variáveis de ambiente, é possível criar o objeto <em>SparkContext</em>. No comando de criação a seguir, é definido que é utilizado o próprio sistema operacional deste <em>notebook</em> como <strong>nó mestre</strong> por meio do parâmetro <strong>local</strong> do método <strong>setMaster</strong>. O complemento do parametro <strong>[*]</strong> indica que são alocados todos os núcleos de processamento disponíveis para o objeto <em>driver</em> criado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkConf</span><span class="p">,</span> <span class="n">SparkContext</span>

<span class="n">conf</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span><span class="n">setMaster</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="api-apache-spark-rdd">
<h2><strong>3 API Apache Spark RDD</strong><a class="headerlink" href="#api-apache-spark-rdd" title="Permalink to this heading">#</a></h2>
<p>Nesta seção, é detalhada a classe <code class="docutils literal notranslate"><span class="pre">pyspark.RDD</span></code>, que está relacionada ao uso de RDDs. Primeiramente, são descritos dois conjuntos de dados usados como base para os exemplos. Depois, os principais conceitos envolvidos na classe pyspark.RDD são introduzidos.</p>
<p>O detalhamento da classe <code class="docutils literal notranslate"><span class="pre">pyspark.RDD</span></code> pode ser encontrada na documentação oficial do Spark neste <a class="reference external" href="https://spark.apache.org/docs/latest/api/python/pyspark.html#pyspark.RDD">link</a>. Neste notebook são explicados os métodos mais utilizados e também os métodos que são necessários para o desenvolvimento da lista de exercícios.</p>
<section id="conjuntos-de-dados">
<h3>3.1 Conjuntos de Dados<a class="headerlink" href="#conjuntos-de-dados" title="Permalink to this heading">#</a></h3>
<p>Para descrever a API Apache Spark RDD, são utilizadas dois conjuntos de dados, conforme descrito a seguir:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fib</span></code>: Uma lista Python contendo os 30 primeiros números da Sequência de Fibonacci. Na matemática, a Sucessão de Fibonacci (ou Sequência de Fibonacci), é uma sequência de números inteiros, começando normalmente por 0 e 1, na qual cada termo subsequente corresponde à soma dos dois anteriores.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logs.txt</span></code>: Um arquivo texto com 56.481 linhas de <em>log</em> de um servidor web. O arquivo fonte pode ser obtido neste (<a class="reference external" href="https://github.com/logpai/loghub/tree/master/Apache">link</a>).</p></li>
</ul>
<p>O comando a seguir cria a lista <code class="docutils literal notranslate"><span class="pre">fib</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando a lista fib com os 30 primeiros números da Sequência de Fibonacci</span>
<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fib</span> <span class="o">=</span> <span class="p">[</span><span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo a lista criada</span>
<span class="n">fib</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0,
 1,
 1,
 2,
 3,
 5,
 8,
 13,
 21,
 34,
 55,
 89,
 144,
 233,
 377,
 610,
 987,
 1597,
 2584,
 4181,
 6765,
 10946,
 17711,
 28657,
 46368,
 75025,
 121393,
 196418,
 317811,
 514229]
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir obtém os dados do arquivo texto <code class="docutils literal notranslate"><span class="pre">logs.txt</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#obtendo os dados do arquivo texto logs.txt
%%capture
!wget -q https://zenodo.org/record/3227177/files/Apache.tar.gz?download=1 -O logs.tar.gz
!tar xf logs.tar.gz &amp;&amp; rm -rf logs.tar.gz
!mv Apache.log logs.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#abrindo o arquivo logs.txt no modo leitura (mode=&quot;r&quot;) </span>
<span class="c1">#exibindo os primeiros 10 registros do arquivo</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;logs.txt&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span> 
  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Thu Jun 09 06:07:04 2005] [notice] LDAP: Built with OpenLDAP LDAP SDK

[Thu Jun 09 06:07:04 2005] [notice] LDAP: SSL support unavailable

[Thu Jun 09 06:07:04 2005] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)

[Thu Jun 09 06:07:05 2005] [notice] Digest: generating secret for digest authentication ...

[Thu Jun 09 06:07:05 2005] [notice] Digest: done

[Thu Jun 09 06:07:05 2005] [notice] LDAP: Built with OpenLDAP LDAP SDK

[Thu Jun 09 06:07:05 2005] [notice] LDAP: SSL support unavailable

[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating channel.jni:jni ( channel.jni, jni)

[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create channel.jni:jni

[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating vm: ( vm, )
</pre></div>
</div>
</div>
</div>
</section>
<section id="criacao-de-rdds">
<h3>3.2 Criação de RDDs<a class="headerlink" href="#criacao-de-rdds" title="Permalink to this heading">#</a></h3>
<p>Existem duas formas de se criar RDDs, conforme descrito a seguir:</p>
<ul class="simple">
<li><p>Paralelizando uma coleção de dados já existente no <em>driver</em>.</p></li>
<li><p>Referenciando um conjunto de dados armazenado em um sistema de armazenamento externo, como um sistema de arquivo compartilhado, HDFS, HBase, Cassandra, ou qualquer outra fonte de dados que ofereça suporte para o formato de entrada do Hadoop.</p></li>
</ul>
<section id="metodo-parallelize">
<h4>Método parallelize()<a class="headerlink" href="#metodo-parallelize" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">parallelize(nameCollection,</span> <span class="pre">nPartitions=None)</span></code></p>
<p>Distribui uma coleção de dados em Python para formar um RDD. O parâmetro <code class="docutils literal notranslate"><span class="pre">nameCollection</span></code> indica o nome da coleção, enquanto que o parâmetro <code class="docutils literal notranslate"><span class="pre">nPartitions</span></code> indica o número de partições nas quais os dados da coleção são particionados. Usualmente, Spark seta o número de partições automaticamente, com base no <em>cluster</em> sendo utilizado.</p>
<p>O comando a seguir utiliza o método <code class="docutils literal notranslate"><span class="pre">parellelize()</span></code> para armazenar no RDD chamado fib_rdd o conjunto de dados referente à Sequência de Fibonacci. Uma vez criado, fib_rdd pode ser manipulado em paralelo utilizando comandos que são apresentados ao longo do <em>notebook</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fib_rdd</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-textfile">
<h4>Método textFile()<a class="headerlink" href="#metodo-textfile" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">textFile(nameFile,</span> <span class="pre">nPartitions=None,</span> <span class="pre">use_unicode=True)</span></code></p>
<p>Lê um arquivo do tipo texto chamado <code class="docutils literal notranslate"><span class="pre">nameFile</span></code>, o qual encontra-se armazenado em um sistema de armazenamento externo, e o retorna como um RDD de <em>strings</em>. O segundo parâmetro, <code class="docutils literal notranslate"><span class="pre">nPartitions</span></code>, indica o número de partições nas quais os registros do arquivo são particionados. O último parâmetro se refere ao formato do arquivo texto, cujo padrão é o formato UTF-8.</p>
<p>O comando a seguir utiliza o método <code class="docutils literal notranslate"><span class="pre">textFile()</span></code> para armazenar no RDD chamado lines_rdd os registros do arquivo de texto <code class="docutils literal notranslate"><span class="pre">&quot;logs.txt&quot;</span></code>. Uma vez criado, lines_rdd pode ser manipulado em paralelo utilizando comandos que são apresentados ao longo do notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lines_rdd</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s2">&quot;logs.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="transformacoes">
<h3>3.2 Transformações<a class="headerlink" href="#transformacoes" title="Permalink to this heading">#</a></h3>
<p>Transformações são operações que transformam um RDD em outro RDD.</p>
<p>No Spark, as <strong>transformações</strong> não são executadas imediatamente sobre os dados do RDD. Elas são anexadas ao grafo acíclico direcionado de transformações, o qual é executado apenas quando uma <strong>ação</strong> sobre o RDD em questão for solicitada. Essa característica é conhecida como <em>lazy-evaluation</em>. Mais informações sobre essa característica podem ser encontradas neste <a class="reference external" href="https://databricks.com/blog/2015/06/22/understanding-your-spark-application-through-visualization.html">link</a>.</p>
<section id="metodo-map">
<h4>Método map()<a class="headerlink" href="#metodo-map" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">map(func)</span></code></p>
<p>Aplica a função <code class="docutils literal notranslate"><span class="pre">func</span></code> sobre todos os elementos do RDD.</p>
<p>Os comandos a seguir definem uma função que multiplica todos os elementos da Sequência de Fibonacci contidos em <code class="docutils literal notranslate"><span class="pre">fib_rdd</span></code> por 10.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#definindo a função separadamente e chamando a função</span>
<span class="k">def</span> <span class="nf">multiply_by_ten</span><span class="p">(</span><span class="n">element</span><span class="p">):</span> <span class="k">return</span> <span class="n">element</span> <span class="o">*</span> <span class="mi">10</span> 

<span class="n">fib_rdd</span><span class="o">.</span> \
  <span class="nb">map</span><span class="p">(</span><span class="n">multiply_by_ten</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0,
 10,
 10,
 20,
 30,
 50,
 80,
 130,
 210,
 340,
 550,
 890,
 1440,
 2330,
 3770,
 6100,
 9870,
 15970,
 25840,
 41810,
 67650,
 109460,
 177110,
 286570,
 463680,
 750250,
 1213930,
 1964180,
 3178110,
 5142290]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#definindo a função lambda</span>
<span class="n">fib_rdd</span><span class="o">.</span> \
  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 10, 10, 20, 30]
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-flatmap">
<h4>Método flatMap()<a class="headerlink" href="#metodo-flatmap" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">flatMap(func,</span> <span class="pre">preservesPartitioning=False)</span></code></p>
<p>Aplica a função <code class="docutils literal notranslate"><span class="pre">func</span></code> sobre todos os elementos do RDD e nivela os resultados gerados.</p>
<p>No comando a seguir, aplica-se o método nativo do Python <code class="docutils literal notranslate"><span class="pre">split</span></code>, por meio da transformação do método <code class="docutils literal notranslate"><span class="pre">map</span></code>, sobre os elementos em <code class="docutils literal notranslate"><span class="pre">line_rdd</span></code> para separar as linhas do arquivo <code class="docutils literal notranslate"><span class="pre">logs.txt</span></code> em palavras. Contudo, o método <code class="docutils literal notranslate"><span class="pre">split</span></code> retorna uma lista Python. Portanto, os elementos do novo RDD não são palavras individuais, mas sim listas de palavras.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aplicando a transformaçao map para transformar linhas em palavras</span>
<span class="c1"># o resultado não são palavras individuais, mas sim listas Python de palavras</span>
<span class="n">lines_rdd</span><span class="o">.</span> \
  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="o">.</span> \
  <span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[&#39;[Thu&#39;,
  &#39;Jun&#39;,
  &#39;09&#39;,
  &#39;06:07:04&#39;,
  &#39;2005]&#39;,
  &#39;[notice]&#39;,
  &#39;LDAP:&#39;,
  &#39;Built&#39;,
  &#39;with&#39;,
  &#39;OpenLDAP&#39;,
  &#39;LDAP&#39;,
  &#39;SDK&#39;],
 [&#39;[Thu&#39;,
  &#39;Jun&#39;,
  &#39;09&#39;,
  &#39;06:07:04&#39;,
  &#39;2005]&#39;,
  &#39;[notice]&#39;,
  &#39;LDAP:&#39;,
  &#39;SSL&#39;,
  &#39;support&#39;,
  &#39;unavailable&#39;]]
</pre></div>
</div>
</div>
</div>
<p>Para unir as coleções Python resultantes da transformação provida pelo método <code class="docutils literal notranslate"><span class="pre">map</span></code>, ou seja, para nivelar os elementos do novo RDD, utiliza-se a transformação <code class="docutils literal notranslate"><span class="pre">flatMap</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aplicando a transformaçao flatMap para transformar linhas em palavras</span>
<span class="c1"># as listas Python de palavras resultantes são niveladas, gerando um RDD em que cada elemente é uma palavra individual</span>
<span class="n">lines_rdd</span><span class="o">.</span> \
  <span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="o">.</span> \
  <span class="n">take</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[Thu&#39;,
 &#39;Jun&#39;,
 &#39;09&#39;,
 &#39;06:07:04&#39;,
 &#39;2005]&#39;,
 &#39;[notice]&#39;,
 &#39;LDAP:&#39;,
 &#39;Built&#39;,
 &#39;with&#39;,
 &#39;OpenLDAP&#39;,
 &#39;LDAP&#39;,
 &#39;SDK&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-mapvalues">
<h4>Método mapValues()<a class="headerlink" href="#metodo-mapvalues" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">mapValues(func)</span></code></p>
<p>Considerando um RDD composto por pares chave-valor (C,V), aplica a função <code class="docutils literal notranslate"><span class="pre">func</span></code> apenas sobre os valores V do RDD.</p>
<p>Nos comandos a seguir, primeiro aplica-se a transformação <code class="docutils literal notranslate"><span class="pre">map</span></code> para criar um RDD composto por pares chave-valor, de forma que chave = valor para cada elemento do RDD. Na sequência, aplica-se a transformação <code class="docutils literal notranslate"><span class="pre">mapValues</span></code> usando uma função <code class="docutils literal notranslate"><span class="pre">lambda</span></code> que mapeia os valores da sequência de Fibonacci em par (<em>even</em>) ou ímpar (<em>odd</em>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#produzindo pares na forma chave-valor </span>
<span class="n">fib_rdd</span><span class="o">.</span> \
  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">element</span><span class="p">))</span><span class="o">.</span> \
  <span class="n">mapValues</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="s2">&quot;even&quot;</span> <span class="k">if</span> <span class="n">element</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;odd&quot;</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0, &#39;even&#39;),
 (1, &#39;odd&#39;),
 (1, &#39;odd&#39;),
 (2, &#39;even&#39;),
 (3, &#39;odd&#39;),
 (5, &#39;odd&#39;),
 (8, &#39;even&#39;),
 (13, &#39;odd&#39;),
 (21, &#39;odd&#39;),
 (34, &#39;even&#39;),
 (55, &#39;odd&#39;),
 (89, &#39;odd&#39;),
 (144, &#39;even&#39;),
 (233, &#39;odd&#39;),
 (377, &#39;odd&#39;),
 (610, &#39;even&#39;),
 (987, &#39;odd&#39;),
 (1597, &#39;odd&#39;),
 (2584, &#39;even&#39;),
 (4181, &#39;odd&#39;),
 (6765, &#39;odd&#39;),
 (10946, &#39;even&#39;),
 (17711, &#39;odd&#39;),
 (28657, &#39;odd&#39;),
 (46368, &#39;even&#39;),
 (75025, &#39;odd&#39;),
 (121393, &#39;odd&#39;),
 (196418, &#39;even&#39;),
 (317811, &#39;odd&#39;),
 (514229, &#39;odd&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-filter">
<h4>Método filter()<a class="headerlink" href="#metodo-filter" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">filter(func)</span></code></p>
<p>Aplica a função booleana <code class="docutils literal notranslate"><span class="pre">func</span></code> sobre todos os elementos do RDD e retorna apenas os elementos que são verdadeiros.</p>
<p>Os comandos a seguir definem uma função booleana que retorna verdadeiro caso a string <code class="docutils literal notranslate"><span class="pre">[error]</span></code> esteja presente na linha de <code class="docutils literal notranslate"><span class="pre">lines_rdd</span></code>.  Essa função é utilizada pela transformação <code class="docutils literal notranslate"><span class="pre">filter</span></code> para exibir as linhas de <code class="docutils literal notranslate"><span class="pre">lines_rdd</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#aplicando o método filter para recuperar as linhas de interesse</span>
<span class="k">def</span> <span class="nf">is_error_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="s2">&quot;[error]&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">else</span> <span class="kc">False</span>

<span class="n">lines_rdd</span><span class="o">.</span> \
  <span class="nb">filter</span><span class="p">(</span><span class="n">is_error_line</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">take</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating channel.jni:jni ( channel.jni, jni)&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create channel.jni:jni&quot;,
 &#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating vm: ( vm, )&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create vm:&quot;,
 &#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating worker.jni:onStartup ( worker.jni, onStartup)&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create worker.jni:onStartup&quot;,
 &#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating worker.jni:onShutdown ( worker.jni, onShutdown)&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create worker.jni:onShutdown&quot;,
 &#39;[Thu Jun 09 06:07:20 2005] [error] mod_jk child init 1 0&#39;,
 &#39;[Thu Jun 09 07:11:21 2005] [error] [client 204.100.200.22] Directory index forbidden by rule: /var/www/html/&#39;,
 &#39;[Thu Jun 09 12:08:57 2005] [error] [client 207.203.80.15] Directory index forbidden by rule: /var/www/html/&#39;,
 &#39;[Thu Jun 09 12:17:49 2005] [error] [client 216.68.171.39] Directory index forbidden by rule: /var/www/html/&#39;,
 &#39;[Thu Jun 09 12:48:10 2005] [error] [client 24.158.204.7] Directory index forbidden by rule: /var/www/html/&#39;,
 &#39;[Thu Jun 09 13:59:36 2005] [error] [client 216.85.154.124] Directory index forbidden by rule: /var/www/html/&#39;,
 &#39;[Thu Jun 09 14:22:15 2005] [error] [client 219.136.165.149] Directory index forbidden by rule: /var/www/html/&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-join">
<h4>Método join()<a class="headerlink" href="#metodo-join" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">join(RDD²)</span></code></p>
<p>Quando aplicado a um RDD¹ composto por elementos na forma pares chave-valor (C¹,V¹) e, considerando o parâmetro RDD² na forma de pares chave-valor (C²,V²), junta os valores V¹,V² que possuem o mesmo valor de chave (C¹ = C²), gerando  (C¹, (V¹,V²)). O método <code class="docutils literal notranslate"><span class="pre">join()</span></code> combina os valores dos elementos dos RDDs que compartilham a mesma chave dois a dois. Esse método requer uma operação de <code class="docutils literal notranslate"><span class="pre">suffle</span></code>.</p>
<p>Os comandos a seguir dividem o RDD <code class="docutils literal notranslate"><span class="pre">fib_rdd</span></code> em dois novos RDDs usando o método <code class="docutils literal notranslate"><span class="pre">filter</span></code> e o método <code class="docutils literal notranslate"><span class="pre">map</span></code>. O método <code class="docutils literal notranslate"><span class="pre">filter</span></code> é usado para filtrar os dados do RDD de acordo com os seus valores. No primeiro RDD são considerados valores menores ou iguais a 100, enquanto que no segundo RDD são considerados valores maiores do que 100. O método <code class="docutils literal notranslate"><span class="pre">map</span></code> é usado para mapear o RDD em um RDD do tipo chave-valor, com chave igual a par (even) ou ímpar (odd) de acordo com o valor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">up_to_100_rdd</span> <span class="o">=</span> <span class="n">fib_rdd</span><span class="o">.</span> \
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span> \
                <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;even&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">if</span> <span class="n">element</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;odd&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">))</span>
<span class="n">up_to_100_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;even&#39;, 0), (&#39;odd&#39;, 1), (&#39;odd&#39;, 1)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">greater_than_100_rdd</span> <span class="o">=</span> <span class="n">fib_rdd</span><span class="o">.</span> \
                       <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span> \
                       <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;even&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">if</span> <span class="n">element</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;odd&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">))</span>
<span class="n">greater_than_100_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;even&#39;, 144), (&#39;odd&#39;, 233), (&#39;odd&#39;, 377), (&#39;even&#39;, 610)]
</pre></div>
</div>
</div>
</div>
<p>O comando a seguir aplica o método <code class="docutils literal notranslate"><span class="pre">join</span></code> para juntar os valores que possuem a mesma chave. O resultado produzido é referente a um <code class="docutils literal notranslate"><span class="pre">inner</span> <span class="pre">join</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">up_to_100_rdd</span><span class="o">.</span> \
  <span class="n">join</span><span class="p">(</span><span class="n">greater_than_100_rdd</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;even&#39;, (0, 144)), (&#39;even&#39;, (0, 610)), (&#39;even&#39;, (0, 2584))]
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-reducebykey">
<h4>Método reduceByKey()<a class="headerlink" href="#metodo-reducebykey" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">reduceByKey(func,nPartitions=None)</span></code></p>
<p>Quando aplicado a um RDD composto por pares chave-valor (C,V), agrega os valores V, de forma que esses valores são computados dois a dois usando a função <code class="docutils literal notranslate"><span class="pre">func</span></code> e agrupados de acordo com a chave C. O segundo parâmetro, <code class="docutils literal notranslate"><span class="pre">nPartitions</span></code>, possibilita que o número de tarefas <em>reduce</em> seja configurado. Esse método requer uma operação de <code class="docutils literal notranslate"><span class="pre">suffle</span></code>.</p>
<p>Os comandos a seguir analisam os elementos de <code class="docutils literal notranslate"><span class="pre">fib_rdd</span></code>, retornando a quantidade de elementos que possuem valores menores do que 10 e a quantidade de elementos que possuem valores maiores ou iguais a 10.</p>
<p>Note que a entrada para o método <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code> é um RDD composto por pares chave-valor. Portanto, primeiramente é aplicado o método <code class="docutils literal notranslate"><span class="pre">map()</span></code>, para depois ser aplicado o método <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code>. A saída é formada por pares chave-valor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fib_rdd</span><span class="o">.</span> \
  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span> <span class="k">if</span> <span class="n">element</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span> \
  <span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(False, 7), (True, 23)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-sortbykey">
<h4>Método sortByKey()<a class="headerlink" href="#metodo-sortbykey" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">sortByKey(order=ascending,</span> <span class="pre">nPartitions=None)</span></code></p>
<p>Quando aplicado a um RDD composto por pares chave-valor (C,V), ordena os elementos de acordo com os valores de C em ordem ascendente ou descentende. O primeiro parâmetro, <code class="docutils literal notranslate"><span class="pre">order</span></code>, indica ascendente ou descendente. O segundo parâmetro, <code class="docutils literal notranslate"><span class="pre">nPartitions</span></code>, permite configurar o número de partições. Este método requer uma operação de <code class="docutils literal notranslate"><span class="pre">shuffle</span></code>.</p>
<p>Os comandos a seguir verificam se cada elemento de <code class="docutils literal notranslate"><span class="pre">fib_rdd</span></code> é par ou ímpar, retornando True para elementos pares e False para elementos ímpares. O resultado é ordenado em ordem ascentende, exibindo primeiro os elementos referentes às chaves False e depois os elementos referentes às chaves True.</p>
<p>Note que a entrada para o método <code class="docutils literal notranslate"><span class="pre">sortByKey()</span></code> é um RDD composto por pares chave-valor. Portanto, primeiramente é aplicado o método <code class="docutils literal notranslate"><span class="pre">map()</span></code>, para depois ser aplicado o método <code class="docutils literal notranslate"><span class="pre">sortByKey()</span></code>. A saída é formada por pares chave-valor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fib_rdd</span><span class="o">.</span> \
  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span> <span class="k">if</span> <span class="n">element</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">element</span><span class="p">))</span><span class="o">.</span> \
  <span class="n">sortByKey</span><span class="p">()</span><span class="o">.</span> \
  <span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(False, 1),
 (False, 1),
 (False, 3),
 (False, 5),
 (False, 13),
 (False, 21),
 (False, 55),
 (False, 89),
 (False, 233),
 (False, 377),
 (False, 987),
 (False, 1597),
 (False, 4181),
 (False, 6765),
 (False, 17711),
 (False, 28657),
 (False, 75025),
 (False, 121393),
 (False, 317811),
 (False, 514229),
 (True, 0),
 (True, 2),
 (True, 8),
 (True, 34),
 (True, 144),
 (True, 610),
 (True, 2584),
 (True, 10946),
 (True, 46368),
 (True, 196418)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-sortby">
<h4>Método sortBy()<a class="headerlink" href="#metodo-sortby" title="Permalink to this heading">#</a></h4>
<p>sortBy(keyfunc, ascending=True, nPartitions=None)</p>
<p>Ordena os elementos do RDD usando como base o parâmetro <code class="docutils literal notranslate"><span class="pre">keyfunc</span></code>. O segundo parâmetro, <code class="docutils literal notranslate"><span class="pre">ascending=True</span></code>, indica a ordem ascendente é a ordem padrão. O terceiro parâmetro, <code class="docutils literal notranslate"><span class="pre">nPartitions</span></code>, permite configurar o número de partições.</p>
<p>Os comandos a seguir são análogos aos comandos da transformação do método <code class="docutils literal notranslate"><span class="pre">sortByKey</span></code>. No método <code class="docutils literal notranslate"><span class="pre">sortBy</span></code>, a ordenação dos elementos do RDD é definida pela função <code class="docutils literal notranslate"><span class="pre">keyfunc</span></code> que aponta para o primeiro item do elemento, ou seja, a chave.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fib_rdd</span><span class="o">.</span> \
  <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span> <span class="k">if</span> <span class="n">element</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">element</span><span class="p">))</span><span class="o">.</span> \
  <span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span> \
  <span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(False, 1),
 (False, 1),
 (False, 3),
 (False, 5),
 (False, 13),
 (False, 21),
 (False, 55),
 (False, 89),
 (False, 233),
 (False, 377),
 (False, 987),
 (False, 1597),
 (False, 4181),
 (False, 6765),
 (False, 17711),
 (False, 28657),
 (False, 75025),
 (False, 121393),
 (False, 317811),
 (False, 514229),
 (True, 0),
 (True, 2),
 (True, 8),
 (True, 34),
 (True, 144),
 (True, 610),
 (True, 2584),
 (True, 10946),
 (True, 46368),
 (True, 196418)]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="acoes">
<h3>3.3 Ações<a class="headerlink" href="#acoes" title="Permalink to this heading">#</a></h3>
<p>Ações são operações que retornam valores calculados sobre um RDD.</p>
<p>No Spark, as ações disparam a execução das <strong>transformações</strong> que foram anexadas ao grafo acíclico direcionado dessas transformações.</p>
<section id="metodos-collect-take-e-first">
<h4>Métodos collect(), take() e first()<a class="headerlink" href="#metodos-collect-take-e-first" title="Permalink to this heading">#</a></h4>
<p>Os métodos collect(), take() e first() têm como objetivo retornar os elementos de um RDD, conforme descrito a seguir.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">collect()</span></code>: Retorna uma lista com todos os elementos do RDD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">take(num)</span></code>: Retorna uma lista com os primeiros <code class="docutils literal notranslate"><span class="pre">num</span></code> elementos do RDD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">first()</span></code>:  Retorna o primeiro elemento do RDD.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando todos os elementos da Sequência de Fibonacci armazenados em fib_rdd</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0,
 1,
 1,
 2,
 3,
 5,
 8,
 13,
 21,
 34,
 55,
 89,
 144,
 233,
 377,
 610,
 987,
 1597,
 2584,
 4181,
 6765,
 10946,
 17711,
 28657,
 46368,
 75025,
 121393,
 196418,
 317811,
 514229]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando os 10 primeiros elementos da Sequência de Fibonacci armazenados em fib_rdd</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 1, 2, 3, 5, 8, 13, 21, 34]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando o primeiro elemento da Sequência de Fibonacci armazenados em fib_rdd</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodos-max-min-mean-count">
<h4>Métodos  max(), min(), mean(), count()<a class="headerlink" href="#metodos-max-min-mean-count" title="Permalink to this heading">#</a></h4>
<p>Os métodos max(), min(), mean() e count() desempenham funcionalidades semelhantes às funções de agregação, conforme descrito a seguir.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max(key=None)</span></code>: Retorna o maior elemento do RDD. O parâmetro opcional <code class="docutils literal notranslate"><span class="pre">key</span></code> pode ser usado para gerar uma <code class="docutils literal notranslate"><span class="pre">key</span></code> para comparação.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min(key=None)</span></code>: Retorna o menor elemento do RDD. O parâmetro opcional <code class="docutils literal notranslate"><span class="pre">key</span></code> pode ser usado para gerar uma <code class="docutils literal notranslate"><span class="pre">key</span></code> para comparação.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean()</span></code>: Calcula a média dos valores dos elementos do RDD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">count()</span></code>: Retorna o número de elementos do RDD.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando o maior elemento armazenado em fib_rdd</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>514229
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando o menor elemento armazenado em fib_rdd</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculando a média dos valores dos elementos armazeandos em fib_rdd</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>44875.6
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando a quantidade de elementos armazenados em fib_rdd</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-reduce">
<h4>Método reduce()<a class="headerlink" href="#metodo-reduce" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">reduce(func)</span></code></p>
<p>Aplica a função <code class="docutils literal notranslate"><span class="pre">func</span></code> a todos os elementos do RDD, processando os elementos dois a dois até a geração de um resultado final agregado.</p>
<p>Os comandos a seguir calculam a soma dos elementos armazenados em fib_rdd.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculando a soma dos elementos armazenados em fib_rdd</span>
<span class="c1">#definindo a função separadamente e chamando a função</span>
<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">fib_rdd</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1346268
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#calculando a soma dos elementos armazenados em fib_rdd</span>
<span class="c1">#definindo a função lambda</span>
<span class="n">fib_rdd</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1346268
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="contador-de-palavras">
<h2><strong>4 Contador de Palavras</strong><a class="headerlink" href="#contador-de-palavras" title="Permalink to this heading">#</a></h2>
<p>O contador de palavras é um exemplo clássico de explicação da funcionalidade do modelo de programação funcional MapReduce.</p>
<p>Neste notebook é apresentado um exemplo que tem como objetivo contar as palavras presentes no texto do arquivo <code class="docutils literal notranslate"><span class="pre">logs.txt</span></code>. Primeiramente, o exemplo é implementado passo a passo, visando fins didáticos. Depois, são mostrados todos os passos realizados de uma única vez.</p>
<p>(1) Criação do RDD <code class="docutils literal notranslate"><span class="pre">lines_rdd</span></code> com as linhas do texto do arquivo. A criação deste RDD pode ser encontrada junto à descrição do método <code class="docutils literal notranslate"><span class="pre">textFile()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lines_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[Thu Jun 09 06:07:04 2005] [notice] LDAP: Built with OpenLDAP LDAP SDK&#39;,
 &#39;[Thu Jun 09 06:07:04 2005] [notice] LDAP: SSL support unavailable&#39;,
 &#39;[Thu Jun 09 06:07:04 2005] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)&#39;,
 &#39;[Thu Jun 09 06:07:05 2005] [notice] Digest: generating secret for digest authentication ...&#39;,
 &#39;[Thu Jun 09 06:07:05 2005] [notice] Digest: done&#39;,
 &#39;[Thu Jun 09 06:07:05 2005] [notice] LDAP: Built with OpenLDAP LDAP SDK&#39;,
 &#39;[Thu Jun 09 06:07:05 2005] [notice] LDAP: SSL support unavailable&#39;,
 &#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating channel.jni:jni ( channel.jni, jni)&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create channel.jni:jni&quot;,
 &#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating vm: ( vm, )&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create vm:&quot;,
 &#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating worker.jni:onStartup ( worker.jni, onStartup)&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create worker.jni:onStartup&quot;,
 &#39;[Thu Jun 09 06:07:05 2005] [error] env.createBean2(): Factory error creating worker.jni:onShutdown ( worker.jni, onShutdown)&#39;,
 &quot;[Thu Jun 09 06:07:05 2005] [error] config.update(): Can&#39;t create worker.jni:onShutdown&quot;]
</pre></div>
</div>
</div>
</div>
<p>(2) Separação das linhas do arquivo de dados em palavras usando o método <code class="docutils literal notranslate"><span class="pre">flatMap</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_rdd</span> <span class="o">=</span> <span class="n">lines_rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
<span class="n">words_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[Thu&#39;, &#39;Jun&#39;, &#39;09&#39;, &#39;06:07:04&#39;, &#39;2005]&#39;, &#39;[notice]&#39;, &#39;LDAP:&#39;]
</pre></div>
</div>
</div>
</div>
<p>(3) Mapeamento de cada palavra presente no RDD words_rdd em um par chave-valor usando o método <code class="docutils literal notranslate"><span class="pre">map</span></code>. Cada chave corresponde a uma palavra e cada valor corresponde ao valor 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_tuple_rdd</span> <span class="o">=</span> <span class="n">words_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">words_tuple_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;[Thu&#39;, 1),
 (&#39;Jun&#39;, 1),
 (&#39;09&#39;, 1),
 (&#39;06:07:04&#39;, 1),
 (&#39;2005]&#39;, 1),
 (&#39;[notice]&#39;, 1),
 (&#39;LDAP:&#39;, 1)]
</pre></div>
</div>
</div>
</div>
<p>(4) Agrupamento das palavras iguais usando o método <code class="docutils literal notranslate"><span class="pre">reduceByKey</span></code>. A função usada como parâmetro é soma. Ou seja, soma-se o número de vezes que cada palavra aparece.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_counts_rdd</span> <span class="o">=</span> <span class="n">words_tuple_rdd</span><span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="n">words_counts_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;09&#39;, 1793),
 (&#39;06:07:04&#39;, 7),
 (&#39;LDAP:&#39;, 106),
 (&#39;SDK&#39;, 53),
 (&#39;SSL&#39;, 53),
 (&#39;support&#39;, 53),
 (&#39;unavailable&#39;, 53)]
</pre></div>
</div>
</div>
</div>
<p>Pode ser interessante ordenar o resultado final usando o método <code class="docutils literal notranslate"><span class="pre">sortBy</span></code>, de forma que as palavras com maior ocorrência apareçam primeiro.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_counts_rdd_sorted</span> <span class="o">=</span> <span class="n">words_counts_rdd</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word_count</span><span class="p">:</span> <span class="n">word_count</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">words_counts_rdd_sorted</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;[error]&#39;, 38081),
 (&#39;2005]&#39;, 32309),
 (&#39;[client&#39;, 31115),
 (&#39;not&#39;, 28808),
 (&#39;File&#39;, 20861),
 (&#39;does&#39;, 20861),
 (&#39;exist:&#39;, 20861)]
</pre></div>
</div>
</div>
</div>
<p>Todos os passos anteriores podem ser agrupados, conforme descrito a seguir.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_counts</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s2">&quot;logs.txt&quot;</span><span class="p">)</span><span class="o">.</span> \
               <span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="o">.</span> \
               <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span> \
               <span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span> \
               <span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word_count</span><span class="p">:</span> <span class="n">word_count</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span> \
               <span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_counts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;[error]&#39;, 38081),
 (&#39;2005]&#39;, 32309),
 (&#39;[client&#39;, 31115),
 (&#39;not&#39;, 28808),
 (&#39;File&#39;, 20861),
 (&#39;does&#39;, 20861),
 (&#39;exist:&#39;, 20861)]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="persistencia-dos-rdds">
<h1>5 Persistência dos RDDs<a class="headerlink" href="#persistencia-dos-rdds" title="Permalink to this heading">#</a></h1>
<p>RDDs são de primordial importância no Spark, desde que possibilitam o armazenamento dos resultados intermediários em memória primária sempre que possível. Conforme discutido anteriormente, o uso de RDDs diminui o número de acessos a disco e, consequentemente, melhora o desempenho da aplicação.</p>
<p>Existem dois métodos para a persistência dos RDDs, conforme descrito a seguir.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cache()</span></code>: Persiste um RDD utilizando o nível de armazenamento padrão, que é MEMORY_ONLY.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">persist(storageLevel=StorageLevel(False,</span> <span class="pre">True,</span> <span class="pre">False,</span> <span class="pre">False,</span> <span class="pre">1))</span></code>: Seta o nível de armazenamento que persiste um RDD na primeira vez que o RDD é calculado. Este comando somente pode ser utilizado para associar um novo nível de armazenamento caso o RDD não possua nenhum nível já associado.</p></li>
</ul>
<p>Os níveis de armazenamento são:</p>
<ul class="simple">
<li><p>MEMORY_ONLY (StorageLevel(False, True, False, False, 1)): Armazena o RDD em memória primária, ou seja, todas as partições do RDD são armazenadas em memória primária quando possível. Se o RDD não couber totalmente em memória primária, as partições que não couberem são calculadas em tempo de execução todas as vezes que for necessário usá-las. Este é o nível de armazenamento default.</p></li>
<li><p>MEMORY_AND_DISK (StorageLevel(True, True, False, False, 1)): Armazena o RDD em memória primária e em disco. As partições do RDD não que couberem em memória primária são armazenadas nessa memória, e as partições que não couberem são armazenadas em disco. As partições armazenadas em disco são lidas do disco todas as vezes que for necessário usá-las.</p></li>
<li><p>DISK_ONLY (StorageLevel(True, False, False, False, 1)): Armazena o RDD em disco, ou seja, todas as partições do RDD são armazenadas em disco. Essas partições devem ser lidas do disco todas as vezes que for necessário usá-las.</p></li>
<li><p>MEMORY_ONLY_2 (StorageLevel(False, True, False, False, 2)): Possui funcionalidade similar ao nível de armazenamento MEMORY_ONLY, porém replica cada partição em dois nós do <em>cluster</em>.</p></li>
<li><p>MEMORY_AND_DISK_2 (StorageLevel(True, True, False, False, 2)): Possui funcionalidade similar ao nível de armazenamento MEMORY_AND_DISK, porém replica cada partição em dois nós do <em>cluster</em>.</p></li>
<li><p>DISK_ONLY_2 (StorageLevel(True, False, False, False, 2)): Possui funcionalidade similar ao nível de armazenamento DISK_ONLY, porém replica cada partição em dois nós do <em>cluster</em>.</p></li>
<li><p>OFF_HEAP (StorageLevel(True, True, True, False, 1)): Armazena o RDD em memória off-heap.</p></li>
</ul>
<p>Em Python, os objetos armazenados são serializáveis por meio da biblioteca Pickle, ou seja, não existe necessidade de se escolher o nível serializável. Em linguagens de programação com suporte diferente, pode-se usar os níveis de armazenamento MEMORY_ONLY_SER e MEMORY_AND_DISK_SER.</p>
<p>Spark automaticamente persiste alguns dados intermediários em operações <em>suffle</em> (por exemplo, <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code>), mesmo quando isso não é definido de forma explícita. Isto é feito para se evitar a necessidade de recomputação de entrada inteira caso ocorra uma falha durante o <em>suffle</em>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="aula-06-lista-de-exercicios-processamento-paralelo-e-distribuido">
<h1>Aula 06 - Lista de Exercícios - Processamento Paralelo e Distribuído<a class="headerlink" href="#aula-06-lista-de-exercicios-processamento-paralelo-e-distribuido" title="Permalink to this heading">#</a></h1>
<hr class="docutils" />
<p>Esta lista possui 11 exercícios, sendo possível navegar pelos mesmos utilizando o sumário na esquerda. Os primeiros exercícios contam com dicas para auxiliar na sua resolução. Leiam-os com atenção e desenvolvam as respostas nos blocos indicados com</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>
</pre></div>
</div>
<p>Por completude, o <em>notebook</em> possui todas as descrições apresentadas na parte prática da Aula 06. <strong>Recomenda-se fortemente</strong> que esta lista seja respondida antes de se consultar o material com as respostas.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id44">
<h1>1 Introdução<a class="headerlink" href="#id44" title="Permalink to this heading">#</a></h1>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma contelação de fatos que une dois esquemas estrela, conforme descrito a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (<code class="docutils literal notranslate"><span class="pre">dataPK,</span> <span class="pre">dataCompleta,</span> <span class="pre">dataDia,</span> <span class="pre">dataMes,</span> <span class="pre">dataBimestre,</span> <span class="pre">dataTrimestre,</span> <span class="pre">dataSemestre,</span> <span class="pre">dataAno</span></code>)</p></li>
<li><p>funcionario (<code class="docutils literal notranslate"><span class="pre">funcPK,</span> <span class="pre">funcMatricula,</span> <span class="pre">funcNome,</span> <span class="pre">funcSexo,</span> <span class="pre">funcDataNascimento,</span> <span class="pre">funcDiaNascimento,</span> <span class="pre">funcMesNascimento,</span> <span class="pre">funcAnoNascimento,</span> <span class="pre">funcCidade,</span> <span class="pre">funcEstadoNome,</span> <span class="pre">funcEstadoSigla,</span> <span class="pre">funcRegiaoNome,</span> <span class="pre">funcRegiaoSigla,</span> <span class="pre">funcPaisNome,</span> <span class="pre">funcPaisSigla</span></code>)</p></li>
<li><p>equipe (<code class="docutils literal notranslate"><span class="pre">equipePK,</span> <span class="pre">equipeNome,</span> <span class="pre">filialNome,</span> <span class="pre">filialCidade,</span> <span class="pre">filialEstadoNome,</span> <span class="pre">filialEstadoSigla,</span> <span class="pre">filialRegiaoNome,</span> <span class="pre">filialRegiaoSigla,</span> <span class="pre">filialPaisNome,</span> <span class="pre">filialPaisSigla</span></code>)</p></li>
<li><p>cargo (<code class="docutils literal notranslate"><span class="pre">cargoPK,</span> <span class="pre">cargoNome,</span> <span class="pre">cargoRegimeTrabalho,</span> <span class="pre">cargoEscolaridadeMinima,</span> <span class="pre">cargoNivel</span></code>)</p></li>
<li><p>cliente (<code class="docutils literal notranslate"><span class="pre">clientePK,</span> <span class="pre">clienteNomeFantasia,</span> <span class="pre">clienteSetor,</span> <span class="pre">clienteCidade,</span> <span class="pre">clienteEstadoNome,</span> <span class="pre">clienteEstadoSigla,</span> <span class="pre">clienteRegiaoNome,</span> <span class="pre">clienteRegiaoSigla,</span> <span class="pre">clientePaisNome,</span> <span class="pre">clientePaisSigla</span></code>)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (<code class="docutils literal notranslate"><span class="pre">dataPK,</span> <span class="pre">funcPK,</span> <span class="pre">equipePK,</span> <span class="pre">cargoPK,</span> <span class="pre">salario,</span> <span class="pre">quantidadeLancamento</span></code>)</p></li>
<li><p>negociacao (<code class="docutils literal notranslate"><span class="pre">dataPK,</span> <span class="pre">equipePK,</span> <span class="pre">clientePK,</span> <span class="pre">receita,</span> <span class="pre">quantidadeNegociacao</span></code>)</p></li>
</ul>
<p>Primeiramente, são definidos <code class="docutils literal notranslate"><span class="pre">paths</span></code>, sendo que cada <code class="docutils literal notranslate"><span class="pre">path</span></code> se refere a uma tabela de fatos ou uma tabela de dimensão.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tabelas de dimensão</span>
<span class="n">pathData</span> <span class="o">=</span> <span class="s1">&#39;dados/data.csv&#39;</span>
<span class="n">pathFuncionario</span> <span class="o">=</span> <span class="s1">&#39;dados/funcionario.csv&#39;</span>
<span class="n">pathEquipe</span> <span class="o">=</span> <span class="s1">&#39;dados/equipe.csv&#39;</span>
<span class="n">pathCargo</span> <span class="o">=</span> <span class="s1">&#39;dados/cargo.csv&#39;</span>
<span class="n">pathCliente</span> <span class="o">=</span> <span class="s1">&#39;dados/cliente.csv&#39;</span>

<span class="c1"># Tabelas de fato</span>
<span class="n">pathPagamento</span> <span class="o">=</span> <span class="s1">&#39;dados/pagamento.csv&#39;</span>
<span class="n">pathNegociacao</span> <span class="o">=</span> <span class="s1">&#39;dados/negociacao.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Na sequência,  todos os arquivos referentes às tabelas de fatos e às tabelas de dimensão são baixados, sendo armazenados na pasta <code class="docutils literal notranslate"><span class="pre">dados</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
!git clone https://github.com/GuiMuzziUSP/Data_Mart_BI_Solutions.git dados
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="apache-spark-cluster-instalacao-e-configuracao">
<h1>2 Apache Spark Cluster: instalação e configuração<a class="headerlink" href="#apache-spark-cluster-instalacao-e-configuracao" title="Permalink to this heading">#</a></h1>
<p><strong>2.1 Instalação</strong></p>
<p>Neste <em>notebook</em> é criado um <em>cluster</em> Spark composto apenas por um <strong>nó mestre</strong>. Ou seja, o <em>cluster</em> não possui um ou mais <strong>nós de trabalho</strong> e o <strong>gerenciador de cluster</strong>. Nessa configuração, as tarefas (<em>tasks</em>) são realizadas no próprio <em>driver</em> localizado no <strong>nó mestre</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando Java Runtime Environment (JRE) versão 8
%%capture
!apt-get remove openjdk*
!apt-get update --fix-missing
!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<p>Na sequência, é feito o <em>download</em> do Apache Spark versão 3.0.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#baixando Apache Spark versão 3.0.0
%%capture
!wget -q https://archive.apache.org/dist/spark/spark-3.0.0/spark-3.0.0-bin-hadoop2.7.tgz
!tar xf spark-3.0.0-bin-hadoop2.7.tgz &amp;&amp; rm spark-3.0.0-bin-hadoop2.7.tgz
</pre></div>
</div>
</div>
</div>
<p>Na sequência, são configuradas as variáveis de ambiente JAVA_HOME e SPARK_HOME. Isto permite que tanto o Java quanto o Spark possam ser encontrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#configurando a variável de ambiente JAVA_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="c1">#configurando a variável de ambiente SPARK_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.0.0-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, são instalados dois pacotes da linguagem de programação Python, cujas funcionalidades são descritas a seguir.</p>
<p>Pacote findspark: Usado para ler a variável de ambiente SPARK_HOME e armazenar seu valor na variável dinâmica de ambiente PYTHONPATH. Como resultado, Python pode encontrar a instalação do Spark.</p>
<p>Pacote pyspark: PySpark é a API do Python para Spark. Ela possibilita o uso de Python, considerando que o framework Apache Spark encontra-se desenvolvido na linguagem de programação Scala.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
#instalando o pacote findspark
!pip install -q findspark==1.4.2
#instalando o pacote pyspark
!pip install -q pyspark==3.0.0
</pre></div>
</div>
</div>
</div>
<p><strong>2.2 Conexão</strong></p>
<p>PySpark não é adicionado ao <em>sys.path</em> por padrão. Isso significa que não é possível importá-lo, pois o interpretador da linguagem Python não sabe onde encontrá-lo.</p>
<p>Para resolver esse aspecto, é necessário instalar o módulo <code class="docutils literal notranslate"><span class="pre">findspark</span></code>. Esse módulo mostra onde PySpark está localizado. Os comandos a seguir têm essa finalidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#importando o módulo findspark</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="c1">#carregando a variávels SPARK_HOME na variável dinâmica PYTHONPATH</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Depois de configurados os pacotes e módulos e inicializadas as variáveis de ambiente, é possível criar o objeto SparkContext. No comando de criação a seguir, é definido que é utilizado o próprio sistema operacional deste notebook como nó mestre por meio do parâmetro local do método setMaster. O complemento do parametro [*] indica que são alocados todos os núcleos de processamento disponíveis para o objeto driver criado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkConf</span><span class="p">,</span> <span class="n">SparkContext</span>

<span class="n">conf</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span><span class="n">setMaster</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="carregamento-dos-dados-da-aplicacao-da-bi-solutions">
<h1>3 Carregamento dos Dados da Aplicação da BI Solutions<a class="headerlink" href="#carregamento-dos-dados-da-aplicacao-da-bi-solutions" title="Permalink to this heading">#</a></h1>
<p><strong>3.1 Carregamento da tabela de dimensão</strong> <em>data</em></p>
<p>O comando a seguir utiliza o método <code class="docutils literal notranslate"><span class="pre">textFile()</span></code> para armazenar no RDD chamado <code class="docutils literal notranslate"><span class="pre">data</span></code> os registros do arquivo de texto <code class="docutils literal notranslate"><span class="pre">&quot;data.csv&quot;</span></code>, os quais possuem os dados da tabela de dimensão <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_rdd</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">pathData</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Os comandos a seguir realizam alterações no RDD <code class="docutils literal notranslate"><span class="pre">data</span></code> de forma que seus elementos representem linhas (ou tuplas) da tabela.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#imprimindo as 3 primeiras linhas de &quot;data&quot; e verificando que a primeira linha contém metadados (ou seja, o esquema referente aos dados)</span>
<span class="n">data_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;dataPK,dataCompleta,dataDia,dataMes,dataBimestre,dataTrimestre,dataSemestre,dataAno&#39;,
 &#39;1,1/1/2016,1,1,1,1,1,2016&#39;,
 &#39;2,2/1/2016,2,1,1,1,1,2016&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#removendo a primeira linha de &quot;data&quot;, desde que ela se refere a metadados</span>
<span class="c1">#capturando o cabeçalho</span>
<span class="n">firstRow</span> <span class="o">=</span> <span class="n">data_rdd</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="c1">#removendo o cabeçalho</span>
<span class="n">data_rdd</span> <span class="o">=</span> <span class="n">data_rdd</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span> <span class="o">!=</span> <span class="n">firstRow</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#imprimindo as 3 primeiras linhas de &quot;data&quot; e verificando que elas contêm apenas dados</span>
<span class="n">data_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1,1/1/2016,1,1,1,1,1,2016&#39;,
 &#39;2,2/1/2016,2,1,1,1,1,2016&#39;,
 &#39;3,3/1/2016,3,1,1,1,1,2016&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#imprimindo o cabeçalho de &quot;data&quot; e verificando os metadados</span>
<span class="n">data_header</span> <span class="o">=</span> <span class="n">firstRow</span><span class="p">[:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">data_header</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;dataPK&#39;,
 &#39;dataCompleta&#39;,
 &#39;dataDia&#39;,
 &#39;dataMes&#39;,
 &#39;dataBimestre&#39;,
 &#39;dataTrimestre&#39;,
 &#39;dataSemestre&#39;,
 &#39;dataAno&#39;]
</pre></div>
</div>
</div>
</div>
<p>Desde que o arquivo lido encontra-se no formato <code class="docutils literal notranslate"><span class="pre">.csv</span></code>, utiliza-se o método <code class="docutils literal notranslate"><span class="pre">()</span></code> para transformar os elementos do RDD <code class="docutils literal notranslate"><span class="pre">data</span></code> em uma lista de valores divididos por <code class="docutils literal notranslate"><span class="pre">&quot;,&quot;</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#mapeando os valores do RDD &quot;data&quot; utilizando o separador vírgula</span>
<span class="n">data_rdd</span> <span class="o">=</span> <span class="n">data_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
<span class="c1">#imprimindo as 3 primeiras linhas de &quot;data&quot;</span>
<span class="n">data_rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;1&#39;, &#39;1/1/2016&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;2016&#39;),
 (&#39;2&#39;, &#39;2/1/2016&#39;, &#39;2&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;2016&#39;),
 (&#39;3&#39;, &#39;3/1/2016&#39;, &#39;3&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;2016&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id45">
<h1><strong>Exercícios</strong><a class="headerlink" href="#id45" title="Permalink to this heading">#</a></h1>
<section id="id46">
<h2><strong>Exercício 1</strong><a class="headerlink" href="#id46" title="Permalink to this heading">#</a></h2>
<p>Dê continuidade ao exemplo anterior e realize o carregamento dos demais arquivos referentes à constelação de fatos da BI solution, a saber: (i) tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">funcionario</span></code>, <code class="docutils literal notranslate"><span class="pre">equipe</span></code>, <code class="docutils literal notranslate"><span class="pre">cargo</span></code> e <code class="docutils literal notranslate"><span class="pre">cliente</span></code>; e (ii) tabelas de fato <code class="docutils literal notranslate"><span class="pre">pagamento</span></code> e <code class="docutils literal notranslate"><span class="pre">negociação</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="k">def</span> <span class="nf">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
  <span class="n">rddCsv</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="c1">#capturando o cabeçalho</span>
  <span class="n">firstRow</span> <span class="o">=</span> <span class="n">rddCsv</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
  <span class="n">rddCsv</span> <span class="o">=</span> <span class="n">rddCsv</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span> <span class="o">!=</span> <span class="n">firstRow</span><span class="p">)</span>
  <span class="n">header</span> <span class="o">=</span> <span class="n">firstRow</span><span class="p">[:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

  <span class="c1">#processando o rddCsv</span>
  <span class="n">rddCsv</span> <span class="o">=</span> <span class="n">rddCsv</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>

  <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">rddCsv</span>


<span class="c1">#realizando o carregamento das tabelas de dimensão</span>
<span class="n">funcionario_header</span><span class="p">,</span> <span class="n">funcionario_rdd</span> <span class="o">=</span> <span class="n">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">pathFuncionario</span><span class="p">)</span>
<span class="n">equipe_header</span><span class="p">,</span> <span class="n">equipe_rdd</span> <span class="o">=</span> <span class="n">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">pathEquipe</span><span class="p">)</span>
<span class="n">cargo_header</span><span class="p">,</span> <span class="n">cargo_rdd</span> <span class="o">=</span> <span class="n">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">pathCargo</span><span class="p">)</span>
<span class="n">cliente_header</span><span class="p">,</span> <span class="n">cliente_rdd</span> <span class="o">=</span> <span class="n">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">pathCliente</span><span class="p">)</span>

<span class="c1">#realizando o carregamento das tabelas de fatos</span>
<span class="n">pagamento_header</span><span class="p">,</span> <span class="n">pagamento_rdd</span> <span class="o">=</span> <span class="n">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">pathPagamento</span><span class="p">)</span>
<span class="n">negociacao_header</span><span class="p">,</span> <span class="n">negociacao_rdd</span> <span class="o">=</span> <span class="n">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">pathNegociacao</span><span class="p">)</span>

<span class="c1">#Checando o resultado</span>
<span class="n">display</span><span class="p">(</span><span class="n">equipe_header</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;equipePK&#39;,
 &#39;equipeNome&#39;,
 &#39;filialNome&#39;,
 &#39;filialCidade&#39;,
 &#39;filialEstadoNome&#39;,
 &#39;filialEstadoSigla&#39;,
 &#39;filialRegiaoNome&#39;,
 &#39;filialRegiaoSigla&#39;,
 &#39;filialPaisNome&#39;,
 &#39;filialPaisSigla&#39;]
</pre></div>
</div>
</div>
</div>
<p><strong>Dica 1 para o exercício</strong>: Crie uma função para executar este procedimento repetidas vezes. Utilize o esqueleto a seguir como base.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">processaRdd</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
  <span class="o">...</span>
  <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">rddCsv</span>
</pre></div>
</div>
<p><strong>Dica 2</strong>: Se tiver dificuldades em criar a função, replique os comandos descritos para o carregamento da tabela de dimensão data para todas as tabelas restantes.</p>
</section>
<section id="id47">
<h2><strong>Exercício 2</strong><a class="headerlink" href="#id47" title="Permalink to this heading">#</a></h2>
<p>Selecione as seguintes colunas do RDD <code class="docutils literal notranslate"><span class="pre">cliente</span></code>: primeira, segunda, terceira e sexta. Exiba as 5 primeiras linhas resultantes. Consulte <code class="docutils literal notranslate"><span class="pre">cliente_header</span></code> caso necessário.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Verificando quais colunas estão presentes no RDD cliente</span>
<span class="n">display</span><span class="p">(</span><span class="n">cliente_header</span><span class="p">)</span>

<span class="c1"># Selecionando as colunas solicitadas</span>
<span class="n">cliente_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;clientePK&#39;,
 &#39;clienteNomeFantasia&#39;,
 &#39;clienteSetor&#39;,
 &#39;clienteCidade&#39;,
 &#39;clienteEstadoNome&#39;,
 &#39;clienteEstadoSigla&#39;,
 &#39;clienteRegiaoNome&#39;,
 &#39;clienteRegiaoSigla&#39;,
 &#39;clientePaisNome&#39;,
 &#39;clientePaisSigla&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;1&#39;, &#39;VIA FOOD&#39;, &#39;BEBIDAS E ALIMENTOS&#39;, &#39;SP&#39;),
 (&#39;2&#39;, &#39;VIA PIZZA&#39;, &#39;BEBIDAS E ALIMENTOS&#39;, &#39;SP&#39;),
 (&#39;3&#39;, &#39;VIA JAPA&#39;, &#39;BEBIDAS E ALIMENTOS&#39;, &#39;SP&#39;),
 (&#39;4&#39;, &#39;VIA VEG&#39;, &#39;BEBIDAS E ALIMENTOS&#39;, &#39;SP&#39;),
 (&#39;5&#39;, &#39;VIA DRINK&#39;, &#39;BEBIDAS E ALIMENTOS&#39;, &#39;SP&#39;)]
</pre></div>
</div>
</div>
</div>
<p><strong>Dica para o exercício:</strong> método <em><strong>map()</strong></em></p>
<p>O método <code class="docutils literal notranslate"><span class="pre">map()</span></code> pode ser utilizado para selecionar colunas. Veja o exemplo abaixo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#selecionando as seguintes colunas do RDD &quot;funcionario&quot;:  segunda, terceira, décima</span>
<span class="n">funcionario_rdd</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span> \
  <span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;M-1&#39;, &#39;ALINE ALMEIDA&#39;, &#39;SAO PAULO&#39;),
 (&#39;M-2&#39;, &#39;ARAO ALVES&#39;, &#39;SAO PAULO&#39;),
 (&#39;M-3&#39;, &#39;ARON ANDRADE&#39;, &#39;SAO PAULO&#39;),
 (&#39;M-4&#39;, &#39;ADA BARBOSA&#39;, &#39;SAO PAULO&#39;),
 (&#39;M-5&#39;, &#39;ABADE BATISTA&#39;, &#39;SAO PAULO&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id48">
<h2><strong>Exercício 3</strong><a class="headerlink" href="#id48" title="Permalink to this heading">#</a></h2>
<p>Recupere os clientes que moram no estado de Minas Gerais.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Verificando quais colunas estão presentes no RDD cliente</span>
<span class="n">display</span><span class="p">(</span><span class="n">cliente_header</span><span class="p">)</span>

<span class="c1"># Mostrando os 5 primeiros elementos do RDD que contém os clientes que moram no estado de Minas Gerais</span>
<span class="n">cliente_rdd</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;clientePK&#39;,
 &#39;clienteNomeFantasia&#39;,
 &#39;clienteSetor&#39;,
 &#39;clienteCidade&#39;,
 &#39;clienteEstadoNome&#39;,
 &#39;clienteEstadoSigla&#39;,
 &#39;clienteRegiaoNome&#39;,
 &#39;clienteRegiaoSigla&#39;,
 &#39;clientePaisNome&#39;,
 &#39;clientePaisSigla&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;10&#39;,
  &#39;VIA LIFE&#39;,
  &#39;SAUDE&#39;,
  &#39;BELO HORIZONTE&#39;,
  &#39;MINAS GERAIS&#39;,
  &#39;MG&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;11&#39;,
  &#39;VIA MED&#39;,
  &#39;SAUDE&#39;,
  &#39;UBERLANDIA&#39;,
  &#39;MINAS GERAIS&#39;,
  &#39;MG&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;30&#39;,
  &#39;SR. HAPPY HOUR&#39;,
  &#39;BEBIDAS E ALIMENTOS&#39;,
  &#39;BELO HORIZONTE&#39;,
  &#39;MINAS GERAIS&#39;,
  &#39;MG&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;31&#39;,
  &#39;SR. LIFE&#39;,
  &#39;SAUDE&#39;,
  &#39;UBERLANDIA&#39;,
  &#39;MINAS GERAIS&#39;,
  &#39;MG&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;50&#39;,
  &#39;SR. FRIENDS&#39;,
  &#39;BEBIDAS E ALIMENTOS&#39;,
  &#39;BELO HORIZONTE&#39;,
  &#39;MINAS GERAIS&#39;,
  &#39;MG&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;)]
</pre></div>
</div>
</div>
</div>
<p><strong>Dica para o exercício</strong>: Método <em><strong>filter()</strong></em></p>
<p>O método <code class="docutils literal notranslate"><span class="pre">filter()</span></code> pode ser utilizado para filtrar valores de acordo com  critérios de seleção. No exemplo a seguir, o método <code class="docutils literal notranslate"><span class="pre">filter()</span></code> é utilizado para filtrar os funcionários que <strong>não</strong> são do estado de <code class="docutils literal notranslate"><span class="pre">'SAO</span> <span class="pre">PAULO'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cliente_rdd</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;SP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;7&#39;,
  &#39;VIA PASTA&#39;,
  &#39;BEBIDAS E ALIMENTOS&#39;,
  &#39;RIO DE JANEIRO&#39;,
  &#39;RIO DE JANEIRO&#39;,
  &#39;RJ&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;8&#39;,
  &#39;VIA FRIENDS&#39;,
  &#39;BEBIDAS E ALIMENTOS&#39;,
  &#39;RIO DE JANEIRO&#39;,
  &#39;RIO DE JANEIRO&#39;,
  &#39;RJ&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;9&#39;,
  &#39;VIA HAPPY HOUR&#39;,
  &#39;BEBIDAS E ALIMENTOS&#39;,
  &#39;RIO DE JANEIRO&#39;,
  &#39;RIO DE JANEIRO&#39;,
  &#39;RJ&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;10&#39;,
  &#39;VIA LIFE&#39;,
  &#39;SAUDE&#39;,
  &#39;BELO HORIZONTE&#39;,
  &#39;MINAS GERAIS&#39;,
  &#39;MG&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;11&#39;,
  &#39;VIA MED&#39;,
  &#39;SAUDE&#39;,
  &#39;UBERLANDIA&#39;,
  &#39;MINAS GERAIS&#39;,
  &#39;MG&#39;,
  &#39;SUDESTE&#39;,
  &#39;SE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;12&#39;,
  &#39;VIA PREVENT&#39;,
  &#39;SAUDE&#39;,
  &#39;SALVADOR&#39;,
  &#39;CEARA&#39;,
  &#39;CE&#39;,
  &#39;NORDESTE&#39;,
  &#39;NE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;),
 (&#39;13&#39;,
  &#39;VIA SENIOR&#39;,
  &#39;SAUDE&#39;,
  &#39;RECIFE&#39;,
  &#39;PERNAMBUCO&#39;,
  &#39;PE&#39;,
  &#39;NORDESTE&#39;,
  &#39;NE&#39;,
  &#39;BRASIL&#39;,
  &#39;BR&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id49">
<h2><strong>Exercício 4</strong><a class="headerlink" href="#id49" title="Permalink to this heading">#</a></h2>
<p>Realize a junção da tabela cliente com a tabela negociacao, considerando a integridade referencial definida em termos de clientePK (ou seja, <code class="docutils literal notranslate"><span class="pre">cliente.clientePK</span> <span class="pre">=</span> <span class="pre">negociacao.clientePK</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Verificando quais colunas estão presentes no RDD cliente</span>
<span class="n">display</span><span class="p">(</span><span class="n">cliente_header</span><span class="p">)</span>

<span class="c1"># Verificando quais colunas estão presentes no RDD negociacao</span>
<span class="n">display</span><span class="p">(</span><span class="n">negociacao_header</span><span class="p">)</span>

<span class="c1"># Realizando a junção dos RDDs cliente e negociacao</span>
<span class="n">cliente_rdd</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao_rdd</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;clientePK&#39;,
 &#39;clienteNomeFantasia&#39;,
 &#39;clienteSetor&#39;,
 &#39;clienteCidade&#39;,
 &#39;clienteEstadoNome&#39;,
 &#39;clienteEstadoSigla&#39;,
 &#39;clienteRegiaoNome&#39;,
 &#39;clienteRegiaoSigla&#39;,
 &#39;clientePaisNome&#39;,
 &#39;clientePaisSigla&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;equipePK&#39;, &#39;clientePK&#39;, &#39;dataPK&#39;, &#39;receita&#39;, &#39;quantidadeNegociacoes&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;4&#39;, (&#39;VIA VEG&#39;, &#39;4&#39;)),
 (&#39;4&#39;, (&#39;VIA VEG&#39;, &#39;18&#39;)),
 (&#39;4&#39;, (&#39;VIA VEG&#39;, &#39;36&#39;)),
 (&#39;4&#39;, (&#39;VIA VEG&#39;, &#39;135&#39;)),
 (&#39;4&#39;, (&#39;VIA VEG&#39;, &#39;142&#39;))]
</pre></div>
</div>
</div>
</div>
<p><strong>Dica para exercício:</strong> Método <em><strong>join()</strong></em></p>
<p>O método <code class="docutils literal notranslate"><span class="pre">join()</span></code> pode ser utilizado para juntar duas tabelas de acordo com a integridade referencial, ou seja, de acordo com a chave primária presente em uma primeira tabela e a chave secundária presente em uma segunda tabela.</p>
<p>No exemplo a seguir, o método <code class="docutils literal notranslate"><span class="pre">join()</span></code> é utilizado para juntar dados da tabela de dimensão funcionario com dados da tabela de dimensão pagamento, utilizando a junção estrela definida em termos de <code class="docutils literal notranslate"><span class="pre">funcionario.funcPK</span> <span class="pre">=</span> <span class="pre">pagamento.funcPK</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando os metadados de funcionário</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario_header</span><span class="p">)</span>

<span class="c1">#criando um RDD temporário para funcionário, contendo apenas algumas colunas</span>
<span class="n">funcionario_temp</span> <span class="o">=</span> <span class="n">funcionario_rdd</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>

<span class="c1">#listando os 5 primeiros elementos de &quot;funcionario_temp&quot;</span>
<span class="n">funcionario_temp</span> \
  <span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcPK&#39;,
 &#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcDiaNascimento&#39;,
 &#39;funcMesNascimento&#39;,
 &#39;funcAnoNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoNome&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcRegiaoNome&#39;,
 &#39;funcRegiaoSigla&#39;,
 &#39;funcPaisNome&#39;,
 &#39;funcPaisSigla&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;1&#39;, &#39;ALINE ALMEIDA&#39;, &#39;SAO PAULO&#39;),
 (&#39;2&#39;, &#39;ARAO ALVES&#39;, &#39;SAO PAULO&#39;),
 (&#39;3&#39;, &#39;ARON ANDRADE&#39;, &#39;SAO PAULO&#39;),
 (&#39;4&#39;, &#39;ADA BARBOSA&#39;, &#39;SAO PAULO&#39;),
 (&#39;5&#39;, &#39;ABADE BATISTA&#39;, &#39;SAO PAULO&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#listando os metadados de pagamento</span>
<span class="n">display</span><span class="p">(</span><span class="n">pagamento_header</span><span class="p">)</span>

<span class="c1">#criando um RDD temporário para pagamento, contendo apenas as colunas referentes à funcPK e às medidas numéricas</span>
<span class="n">pagamento_temp</span> <span class="o">=</span> <span class="n">pagamento_rdd</span>\
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1">#listando os 5 primeiros elementos de &quot;pagamento_temp&quot; para o funcionário com funcPK = 5</span>
<span class="k">def</span> <span class="nf">filterPagamentoFuncionario</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
  <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span> <span class="k">else</span> <span class="kc">False</span>
<span class="n">pagamento_temp</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filterPagamentoFuncionario</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcPK&#39;, &#39;equipePK&#39;, &#39;dataPK&#39;, &#39;cargoPK&#39;, &#39;salario&#39;, &#39;quantidadeLancamentos&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;4&#39;, &#39;10498.14&#39;, &#39;5&#39;),
 (&#39;4&#39;, &#39;10498.14&#39;, &#39;5&#39;),
 (&#39;4&#39;, &#39;10498.14&#39;, &#39;5&#39;),
 (&#39;4&#39;, &#39;10498.14&#39;, &#39;5&#39;),
 (&#39;4&#39;, &#39;10498.14&#39;, &#39;5&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#realizando a junção de funcionario_temp com pagamento_temp, para o funcionário com funcPK igual a 5</span>
<span class="c1">#note que a juncao é feita considerando a igualdade na primeira coluna</span>
<span class="c1">#note também que somente os valores da segunda coluna de funcionario e de pagamento são retornados</span>
<span class="n">funcionario_temp</span> \
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento_temp</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;4&#39;, (&#39;ADA BARBOSA&#39;, &#39;10498.14&#39;)),
 (&#39;4&#39;, (&#39;ADA BARBOSA&#39;, &#39;10498.14&#39;)),
 (&#39;4&#39;, (&#39;ADA BARBOSA&#39;, &#39;10498.14&#39;)),
 (&#39;4&#39;, (&#39;ADA BARBOSA&#39;, &#39;10498.14&#39;)),
 (&#39;4&#39;, (&#39;ADA BARBOSA&#39;, &#39;10498.14&#39;))]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id50">
<h2><strong>Exercício 5</strong><a class="headerlink" href="#id50" title="Permalink to this heading">#</a></h2>
<p>Liste a quantidade de clientes por região. Ordene o resultado pelo nome da região em ordem crescente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Verificando quais colunas estão presentes no RDD cliente</span>
<span class="n">display</span><span class="p">(</span><span class="n">cliente_header</span><span class="p">)</span>

<span class="c1"># Calculando a quantidade de clientes por região e ordenando o resultado</span>
<span class="n">cliente_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> \
  <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> \
  <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;clientePK&#39;,
 &#39;clienteNomeFantasia&#39;,
 &#39;clienteSetor&#39;,
 &#39;clienteCidade&#39;,
 &#39;clienteEstadoNome&#39;,
 &#39;clienteEstadoSigla&#39;,
 &#39;clienteRegiaoNome&#39;,
 &#39;clienteRegiaoSigla&#39;,
 &#39;clientePaisNome&#39;,
 &#39;clientePaisSigla&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;CENTRO-OESTE&#39;, 10),
 (&#39;NORDESTE&#39;, 30),
 (&#39;NORTE&#39;, 10),
 (&#39;SUDESTE&#39;, 130),
 (&#39;SUL&#39;, 30)]
</pre></div>
</div>
</div>
</div>
<p><strong>Dica para o exercício</strong>: Método <em><strong>reduceByKey()</strong></em></p>
<p>O método <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code> pode ser utilizado para calcular valores agregados para cada valor de chave presente em uma coluna.</p>
<p>No exemplo a seguir, é listada a quantidade de funcionários por estado.</p>
<p>Para responder a essa consulta, é necessário utilizar os dados de <code class="docutils literal notranslate"><span class="pre">funcionario_rdd</span></code>, usando a coluna <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code> e contando quantas vezes o mesmo nome de estado aparece. São executados os seguintes passos:</p>
<ul class="simple">
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para selecionar a coluna desejada <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code>, que é a décima coluna de <code class="docutils literal notranslate"><span class="pre">funcionario_rdd</span></code>, e para criar pares chave-valor da seguinte forma: a chave corresponde à coluna <code class="docutils literal notranslate"><span class="pre">funcEstadoNome</span></code> e o valor corresponde a 1.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code> para calcular, para cada chave a quantidade de vezes que ela aparece.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">collect()</span></code> para exibir os pares chave-valor obtidos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verificando quais colunas estão presentes no RDD funcionario</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario_header</span><span class="p">)</span>

<span class="c1"># Executando os passos necessários para responder à consulta</span>
<span class="n">funcionario_rdd</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> \
  <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> \
  <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcPK&#39;,
 &#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcDiaNascimento&#39;,
 &#39;funcMesNascimento&#39;,
 &#39;funcAnoNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoNome&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcRegiaoNome&#39;,
 &#39;funcRegiaoSigla&#39;,
 &#39;funcPaisNome&#39;,
 &#39;funcPaisSigla&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;MINAS GERAIS&#39;, 28),
 (&#39;PARANA&#39;, 28),
 (&#39;PERNAMBUCO&#39;, 21),
 (&#39;SAO PAULO&#39;, 95),
 (&#39;RIO DE JANEIRO&#39;, 28)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id51">
<h2><strong>Exercício 6</strong><a class="headerlink" href="#id51" title="Permalink to this heading">#</a></h2>
<p>Qual foi o maior e o menor salário pago em 2019?</p>
<p><strong>Dica para o exercício</strong>: Para responder a essa consulta, é necessário utilizar os dados de pagamento_rdd, usando a coluna salario e aplicando o método min() e max(), considerando a seguinte sequência de passos.</p>
<ul class="simple">
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para transformar o tipo de dados da coluna salario em um número de ponto flutuante (ou seja, float)</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">min()</span></code> para descobrir o menor salário.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">max()</span></code> para descobrir o maior salário.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Verificando quais colunas estão presentes no RDD pagamento</span>
<span class="n">display</span><span class="p">(</span><span class="n">pagamento_header</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcPK&#39;, &#39;equipePK&#39;, &#39;dataPK&#39;, &#39;cargoPK&#39;, &#39;salario&#39;, &#39;quantidadeLancamentos&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtendo o menor salário</span>
<span class="n">pagamento_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1501.57
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtendo o maior salário</span>
<span class="n">pagamento_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>47140.17
</pre></div>
</div>
</div>
</div>
</section>
<section id="id52">
<h2><strong>Exercício 7</strong><a class="headerlink" href="#id52" title="Permalink to this heading">#</a></h2>
<p>Qual a idade média dos funcionários? Para fazer este exercício, não precisa considerar a idade exata, ou seja, não é necessário considerar o dia no qual o funcionário nasceu. Considere apenas o ano de nascimento do funcionário.</p>
<p><strong>Exercício 7a</strong> Resolva o exercício utilizando o método <em>mean()</em>.</p>
<p>A seguinte sequência de passos deve ser realizada:</p>
<ul class="simple">
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para obter os anos de nascimento dos funcionários.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para calcular a idade do funcionário, considerando o ano atual de 2020 e o ano no qual o funcionário nasceu.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">mean()</span></code> para gerar o resultado final.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Criando uma função que calcula a idade a partir do ano</span>
<span class="k">def</span> <span class="nf">idadeApartirDeAno</span><span class="p">(</span><span class="n">ano</span><span class="p">):</span>
  <span class="n">anoAtual</span> <span class="o">=</span> <span class="mi">2020</span>
  <span class="k">return</span> <span class="n">anoAtual</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">ano</span><span class="p">)</span>

<span class="c1"># Calculando a idade média dos funcionários usando o método mean()</span>
<span class="n">funcionario_rdd</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">idadeApartirDeAno</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> \
  <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>37.595
</pre></div>
</div>
</div>
</div>
<p><strong>Exercício 7b</strong> Resolva o exercício <strong>sem</strong> usar o método <em>mean().</em></p>
<p>A seguinte sequência de passos deve ser realizada:</p>
<ul class="simple">
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para obter os anos de nascimento dos funcionários.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para calcular a idade do funcionário, considerando o ano atual de 2020 e o ano no qual o funcionário nasceu.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para gerar pares chave-valor, de forma que a chave seja a idade do funcionário e o valor seja 1.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code> reduzindo pelas chaves e somando as idades e as quantidades de linhas.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">mapValues()</span></code> para mapear os valores e para dividir as somas das idades pelas quantidades de linhas.</p></li>
<li><p>Utilização do método <code class="docutils literal notranslate"><span class="pre">map()</span></code> para mapear a idade média dos funcionários.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Criando uma função que calcula idade a partir de ano</span>
<span class="k">def</span> <span class="nf">idadeApartirDeAno</span><span class="p">(</span><span class="n">ano</span><span class="p">):</span>
  <span class="n">anoAtual</span> <span class="o">=</span> <span class="mi">2020</span>
  <span class="k">return</span> <span class="n">anoAtual</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">ano</span><span class="p">)</span>

<span class="c1"># Calculando a idade média dos funcionários usando o método mean()</span>
<span class="n">funcionario_rdd</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">idadeApartirDeAno</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span> \
  <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> \
  <span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
  <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
  <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[37.595]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id53">
<h2><strong>Exercício 8</strong><a class="headerlink" href="#id53" title="Permalink to this heading">#</a></h2>
<p>Liste a quantidade de vezes que cada palavra individual aparece nos nomes de cidades que os funcionários moram. Por exemplo, na cidade de SAO JOSE DO RIO PRETO, existem 5 palavras individuais. Ordene o resultado de forma que as palavras individuais que mais se repetem sejam mostradas primeiro.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Verificando quais colunas estão presentes no RDD pagamento</span>
<span class="n">display</span><span class="p">(</span><span class="n">funcionario_header</span><span class="p">)</span>

<span class="c1"># Calculando a quantidade de vezes que cada palavra individual aparece</span>
<span class="n">funcionario_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span><span class="o">.</span> \
    <span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="o">.</span> \
    <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span> \
    <span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span> \
    <span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word_count</span><span class="p">:</span> <span class="n">word_count</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span> \
    <span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;funcPK&#39;,
 &#39;funcMatricula&#39;,
 &#39;funcNome&#39;,
 &#39;funcSexo&#39;,
 &#39;funcDataNascimento&#39;,
 &#39;funcDiaNascimento&#39;,
 &#39;funcMesNascimento&#39;,
 &#39;funcAnoNascimento&#39;,
 &#39;funcCidade&#39;,
 &#39;funcEstadoNome&#39;,
 &#39;funcEstadoSigla&#39;,
 &#39;funcRegiaoNome&#39;,
 &#39;funcRegiaoSigla&#39;,
 &#39;funcPaisNome&#39;,
 &#39;funcPaisSigla&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;SAO&#39;, 24),
 (&#39;PRETO&#39;, 23),
 (&#39;RECIFE&#39;, 21),
 (&#39;RIO&#39;, 15),
 (&#39;CAMPINAS&#39;, 8),
 (&#39;RIBEIRAO&#39;, 8),
 (&#39;ILHA&#39;, 8),
 (&#39;JOSE&#39;, 8),
 (&#39;PAULO&#39;, 8),
 (&#39;SANTOS&#39;, 8),
 (&#39;SANTO&#39;, 8),
 (&#39;ANDRE&#39;, 8),
 (&#39;PIRACICABA&#39;, 8),
 (&#39;CARLOS&#39;, 8),
 (&#39;BELA&#39;, 8),
 (&#39;DO&#39;, 8),
 (&#39;OSASCO&#39;, 8),
 (&#39;ARARAQUARA&#39;, 8),
 (&#39;BARUERI&#39;, 7),
 (&#39;DE&#39;, 7),
 (&#39;REDONDA&#39;, 7),
 (&#39;ANGRA&#39;, 7),
 (&#39;DOS&#39;, 7),
 (&#39;PRAIA&#39;, 7),
 (&#39;SECA&#39;, 7),
 (&#39;HORIZONTE&#39;, 7),
 (&#39;ARAGUARI&#39;, 7),
 (&#39;MONTE&#39;, 7),
 (&#39;CURITIBA&#39;, 7),
 (&#39;GUARATUBA&#39;, 7),
 (&#39;MORRETES&#39;, 7),
 (&#39;JANEIRO&#39;, 7),
 (&#39;VOLTA&#39;, 7),
 (&#39;REIS&#39;, 7),
 (&#39;BELO&#39;, 7),
 (&#39;OURO&#39;, 7),
 (&#39;VERDE&#39;, 7),
 (&#39;LONDRINA&#39;, 7)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id54">
<h2><strong>Exercício 9</strong><a class="headerlink" href="#id54" title="Permalink to this heading">#</a></h2>
<p>Considere o código Python a seguir, o qual tem como objetivo contar quantas
vezes uma determinada palavra aparece em um arquivo texto com 4 linhas de log.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">error_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;&quot;(2021-11-01 06:58:43) ERROR - Event with job id 1abc Failed,</span>
<span class="s2">                  (2021-11-01 06:58:47) ERROR - Event with job id 2abc Failed,</span>
<span class="s2">                  (2021-11-01 06:58:50) ERROR - Event with job id 3abc Failed,</span>
<span class="s2">                  (2021-11-01 06:59:43) INFO - Number of table lines is 102345.&quot;&quot;&quot;</span><span class="p">]</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span>\
<span class="n">parallelize</span><span class="p">(</span><span class="n">error_lines</span><span class="p">)</span><span class="o">.</span>\
<span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="o">.</span>\
<span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span>\
<span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
<p>Explique qual é a função dos métodos *flatMap(), filter() e count(). Explique também qual o resultado da variável <code class="docutils literal notranslate"><span class="pre">output</span></code>.</p>
<p><strong>Resposta do Exercício:</strong></p>
<p><strong>Método <code class="docutils literal notranslate"><span class="pre">flatMap()</span></code></strong>: Aplica a função lambda para todos os elementos presentes no RDD gerado pelo método <code class="docutils literal notranslate"><span class="pre">parallelize()</span></code> e nivela os resultados. Da forma como está especificada,a função lambda realiza a separação das palavras por espaço em branco usando o método <code class="docutils literal notranslate"><span class="pre">split()</span></code> nativo do Python.</p>
<p><strong>Método <code class="docutils literal notranslate"><span class="pre">filter()</span></code>:</strong> Aplica a função booleana lambda sobre todos os elementos do RDD e retorna apenas os elementos que são verdadeiros baseados em uma condição. Da forma como está especificada, a função lambda retorna todas as palavras que são iguais à string “<code class="docutils literal notranslate"><span class="pre">ERROR</span></code>”.</p>
<p><strong>Método <code class="docutils literal notranslate"><span class="pre">count()</span></code>:</strong> Retorna o número de elementos do RDD.</p>
<p><strong>Resultado da variável <code class="docutils literal notranslate"><span class="pre">output</span></code>:</strong> Da forma como está especificado, o método <code class="docutils literal notranslate"><span class="pre">count()</span></code> retorna quantas vezes a palavra “ERROR” aparece. O valor da variável <code class="docutils literal notranslate"><span class="pre">output</span></code> é 3, pois considerando o arquivo de log representado por <code class="docutils literal notranslate"><span class="pre">error_lines</span></code> e a forma como está especificado o código Python, a palavra “<code class="docutils literal notranslate"><span class="pre">ERROR</span></code>” aparece 3 vezes.</p>
</section>
<section id="id55">
<h2><strong>Exercício 10</strong><a class="headerlink" href="#id55" title="Permalink to this heading">#</a></h2>
<p>Considere a figura a seguir, a qual representa um cluster de computadores que segue
a arquitetura do sistema de arquivos distribuídos HDFS (<em>Hadoop Distributed File System</em>).
Ao lado de cada quadrado, existe uma numeração que representa o componente dentro
daquele quadrado. Responda às questões a seguir, utilizando como base essa numeração.</p>
<p>(a) Qual componente representa o NameNode primário?</p>
<p>(b) Quais componentes representam os DataNodes?</p>
<p>(c) Qual componente representa o NameNode secundário?</p>
<p>(d) Quais são os componentes que são considerados nós escravos?</p>
<p>(e) Quais são os componentes responsáveis pela manutenção dos metadados sobre os
dados armazenados?</p>
<p>(f) Quais são os componentes responsáveis por fornecer os dados solicitados nas operações de leitura e escrita?</p>
<br>
<p align="center"><img src="https://raw.githubusercontent.com/kenjitakatuzi/MBA-ICMC-2022/main/images/CLUSTER.png" width="500" height="300"></p>
<!-- <p align="center">Figura 1 - Representação de um cluster de computadores que segue a arquitetura do HDFS. </p> -->
<br><p><strong>Resposta do Exercício:</strong></p>
<p>(1) Componente 1</p>
<p>(2) Componentes 2, 3 e 4</p>
<p>(3) Componente 5</p>
<p>(4) Componentes 2, 3 e 4</p>
<p>(5) Componentes 1 e 5</p>
<p>(6) Componentes 2, 3 e 4</p>
</section>
<section id="exercicio-11">
<h2><strong>Exercício 11</strong><a class="headerlink" href="#exercicio-11" title="Permalink to this heading">#</a></h2>
<p>Transformações são operações que transformam um RDD (Resilient and Distributed Datasets) em outro RDD. No Spark, as transformações não são executadas imediatamente sobre os dados do RDD. Elas são anexadas ao grafo acíclico direcionado de transformações, o qual é executado apenas quando uma ação sobre o RDD em questão for solicitada. Essa característica é conhecida como lazy-evaluation.</p>
<p>Como resultado, operações podem ser executadas em conjunto, possibilitando otimizações. Por exemplo, os métodos <code class="docutils literal notranslate"><span class="pre">map()</span></code> e <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code> são transformações, e eles somente são executados quando ocorrer uma ação, como quando o método collect() for chamado. Portanto, <code class="docutils literal notranslate"><span class="pre">map()</span></code>, <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code> e <code class="docutils literal notranslate"><span class="pre">collect()</span></code> podem ser executados em conjunto.</p>
<p>No exemplo do contador de palavras, comumente utiliza-se o que é conhecido como side-map reducer, indicando que internamente o Spark usa uma estrutura de HashMap e faz o método de <code class="docutils literal notranslate"><span class="pre">reduceByKey()</span></code> localmente antes de enviar o resultado para a etapa de reducing propriamente dita. Isso é ilustrado por meio da seta azul na figura a seguir.</p>
<p>Por outro lado, o framework Hadoop não provê operações com a característica de <em>lazy-evaluation</em>. Portanto, operações não são executadas em conjunto. Refaça a figura a seguir de forma que o exemplo do contador de palavras não considere essa característica, ou seja, que o contador de palavras não considere a característica de <em>lazy-evaluation</em>.</p>
<p><strong>Dica para o exercício:</strong> Ao invés de refazer a figura, é possível discutir as alterações que precisam ser feitas.</p>
<br>
<p align="center"><img src="https://raw.githubusercontent.com/kenjitakatuzi/MBA-ICMC-2022/main/images/FIGURA1.jpeg" width="600" height="300"></p>
<!-- <p align="center">Figura 2 - Exemplo de contador de palavras.</p> -->
<br><p><strong>Resposta do exercício:</strong></p>
<br>
<p align="center"><img src="https://raw.githubusercontent.com/kenjitakatuzi/MBA-ICMC-2022/main/images/FIGURA2.jpeg" width="600" height="300"></p>
<!-- <p align="center">Figura 1. Exemplo de contador de palavras. </p> -->
<br></section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-07-consultas-olap-usando-spark-sql-span">
<h1><span style="color:blue">Aula 07: Consultas OLAP usando Spark SQL</span><a class="headerlink" href="#span-style-color-blue-aula-07-consultas-olap-usando-spark-sql-span" title="Permalink to this heading">#</a></h1>
<section id="span-style-color-blue-apache-spark-sql-span">
<h2><span style="color:blue">Apache Spark SQL</span><a class="headerlink" href="#span-style-color-blue-apache-spark-sql-span" title="Permalink to this heading">#</a></h2>
<p><strong>IMPORTANTE: O uso do <em>framework</em> Spark requer diversas configurações no ambiente de desenvolvimento para executar o <em>notebook</em>. Dado que tal complexidade foge do escopo de nossa disciplina, recomenda-se que o <em>notebook</em> seja executado na plataforma de desenvolvimento COLAB. O uso do COLAB  proporciona um ambiente de desenvolvimento pré-configurado e remove a complexidade de instalação e configuração de pacotes e <em>frameworks</em> que são utilizados na disciplina.</strong></p>
<p>#1 Otimizador de Consultas Catalyst</p>
<p>O componente mais importante do Spark SQL é o seu otimizador de consultas, chamado Catalyst. Catalyst é baseado em construtores de programação funcional e é implementado na linguagem de programação Scala. Sua implementação tem dois propósitos principais. O primeiro é permitir que novas técnicas de otimização e novas características possam ser facilmente adicionadas ao Spark SQL. O segundo propósito consiste em possibilitar que desenvolvedores externos estendam o otimizador de consultas, por exemplo, adicionando novas regras de otimização e provendo suporte para novos tipos de dados, dentre outros.</p>
</section>
<section id="plano-de-consulta">
<h2>1.1 Plano de Consulta<a class="headerlink" href="#plano-de-consulta" title="Permalink to this heading">#</a></h2>
<p>Dada uma consulta em alto nível, existem diferentes estratégias de execução (ou seja, planos de consulta) alternativas para se processar essa consulta, principalmente se ela for complexa. A otimização de consultas consiste no processo de gerar e selecionar o plano de consulta mais eficiente dentre as diversas possibilidades disponíveis, ou seja, consiste no processo de selecionar o plano de consulta de menor custo.</p>
<p>De fato, a quantidade de possíveis planos de consulta que podem ser gerados para processar uma consulta pode ser muito grande. Assim, no processamento de uma consulta, nem todos os planos possíveis são gerados e analisados, uma vez que o tempo gasto nesta atividade seria provavelmente excessivo, talvez superando o tempo de responder à consulta por meio de uma busca sequencial. Heurísticas são usualmente empregadas para diminuir o espaço de busca.</p>
<p>Portanto, o otimizador de consultas em geral não produz uma solução que é a ótima ou de menor custo frente a todas as possibilidades existentes, mas produz uma solução que é a melhor frente a algumas dessas possibilidades.</p>
<p>##1.2 Técnicas de Otimização</p>
<p>Duas técnicas amplamente utilizadas pelo otimizador de consultas são descritas a seguir.</p>
<ul class="simple">
<li><p>Otimização baseada em regras. O otimizador de consultas baseado em regras tem por objetivo gerar apenas um subconjunto de planos a serem analisados, usado como base heurísticas. Cada plano gerado pelo otimizador de consultas baseado em regras consiste de uma expressão algébrica que determina a ordem na qual as operações deve ser executadas, de forma que todos os planos para uma determinada consulta sejam equivalentes.</p></li>
<li><p>Otimização baseada em custo. O otimizador de consultas baseado em custo identifica, para cada plano gerado, o custo para processar a consulta, e seleciona o plano de menor custo. Isso depende de diversos fatores, tais como quais as operações algébricas que encontram-se efetivamente implementadas por meio de algoritmos disponilizados e os índices disponíveis para processar a consulta.</p></li>
</ul>
<p>Catalyst realiza otimização de consultas baseada em regras e otimização de consultas baseada em custo para transformar uma consulta escrita em SQL em códigos que executam sobre RDDs e utilizam os princípios do modelo MapReduce e do sistema de arquivos distribuídos HDFS.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="constelacao-de-fatos-da-bi-solutions">
<h1>2 Constelação de Fatos da BI Solutions<a class="headerlink" href="#constelacao-de-fatos-da-bi-solutions" title="Permalink to this heading">#</a></h1>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma constelação de fatos, conforme descrita a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamentos)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacoes)</p></li>
</ul>
<section id="baixando-o-modulo-wget">
<h2>2.1 Baixando o Módulo wget<a class="headerlink" href="#baixando-o-modulo-wget" title="Permalink to this heading">#</a></h2>
<p>Para baixar os dados referentes ao esquema relacional da constelação de fatos da BI Solutions, é utilizado o módulo  <strong>wget</strong>. O comando a seguir realiza a instalação desse módulo. <br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando o módulo wget
%%capture
!pip install -q wget
#criando pasta para salvar as bases de dados
!mkdir data
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtencao-dos-dados-das-tabelas-de-dimensao">
<h2>2.2 Obtenção dos Dados das Tabelas de Dimensão<a class="headerlink" href="#obtencao-dos-dados-das-tabelas-de-dimensao" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de dimensão.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de dimensão</span>
<span class="kn">import</span> <span class="nn">wget</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/data.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/cliente.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtencao-dos-dados-tabelas-de-fatos">
<h2>2.3 Obtenção dos Dados Tabelas de Fatos<a class="headerlink" href="#obtencao-dos-dados-tabelas-de-fatos" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de fatos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de fatos</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/negociacao.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id56">
<h1>3 Apache Spark Cluster<a class="headerlink" href="#id56" title="Permalink to this heading">#</a></h1>
<section id="id57">
<h2>3.1 Instalação<a class="headerlink" href="#id57" title="Permalink to this heading">#</a></h2>
<p>Neste <em>notebook</em> é criado um <em>cluster</em> Spark composto apenas por um <strong>nó mestre</strong>. Ou seja, o <em>cluster</em> não possui um ou mais <strong>nós de trabalho</strong> e o <strong>gerenciador de cluster</strong>. Nessa configuração, as tarefas (<em>tasks</em>) são realizadas no próprio <em>driver</em> localizado no <strong>nó mestre</strong>.</p>
<p>Para que o cluster possa ser criado, primeiramente é instalado o Java Runtime Environment (JRE) versão 8.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando Java Runtime Environment (JRE) versão 8
%%capture
!apt-get remove openjdk*
!apt-get update --fix-missing
!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<p>Na sequência, é feito o <em>download</em> do Apache Spark versão 3.0.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#baixando Apache Spark versão 3.0.0
%%capture
!wget -q https://archive.apache.org/dist/spark/spark-3.0.0/spark-3.0.0-bin-hadoop2.7.tgz
!tar xf spark-3.0.0-bin-hadoop2.7.tgz &amp;&amp; rm spark-3.0.0-bin-hadoop2.7.tgz
</pre></div>
</div>
</div>
</div>
<p>Na sequência, são configuradas as variáveis de ambiente JAVA_HOME e SPARK_HOME. Isto permite que tanto o Java quanto o Spark possam ser encontrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#configurando a variável de ambiente JAVA_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="c1">#configurando a variável de ambiente SPARK_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.0.0-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, são instalados dois pacotes da linguagem de programação Python, cujas funcionalidades são descritas a seguir.</p>
<blockquote>
<div><p><strong>Pacote findspark:</strong> Usado para ler a variável de ambiente SPARK_HOME e armazenar seu valor na variável dinâmica de ambiente PYTHONPATH. Como resultado, Python pode encontrar a instalação do Spark.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Pacote pyspark:</strong> PySpark é a API do Python para Spark. Ela possibilita o uso de Python, considerando que o <em>framework</em> Apache Spark encontra-se desenvolvido na linguagem de programação Scala.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
#instalando o pacote findspark
!pip install -q findspark==1.4.2
#instalando o pacote pyspark
!pip install -q pyspark==3.0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="id58">
<h2>3.2 Conexão<a class="headerlink" href="#id58" title="Permalink to this heading">#</a></h2>
<p>PySpark não é adicionado ao <em>sys.path</em> por padrão. Isso significa que não é possível importá-lo, pois o interpretador da linguagem Python não sabe onde encontrá-lo.</p>
<p>Para resolver esse aspecto, é necessário instalar o módulo <code class="docutils literal notranslate"><span class="pre">findspark</span></code>. Esse módulo mostra onde PySpark está localizado. Os comandos a seguir têm essa finalidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#importando o módulo findspark</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="c1">#carregando a variávels SPARK_HOME na variável dinâmica PYTHONPATH</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Depois de configurados os pacotes e módulos e inicializadas as variáveis de ambiente, é possível iniciar o uso do Spark na aplicação de <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">warehousing</span></code>. Para tanto, é necessário importar o comando <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code> do módulo <code class="docutils literal notranslate"><span class="pre">pyspark.sql</span></code>. São utilizados os seguintes conceitos: <br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SparkSession</span></code>: permite a criação de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, as tabelas relacionais podem ser manipuladas por meio de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> e é possível realizar consultas OLAP por meio de comandos SQL. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">builder</span></code>: cria uma instância de SparkSession. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">appName</span></code>: define um nome para a aplicação, o qual pode ser visto na interface de usuário web do Spark. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master</span></code>: define onde está o nó mestre do <em>cluster</em>. Como a aplicação é executada localmente e não em um <em>cluster</em>, indica-se isso pela <em>string</em> <code class="docutils literal notranslate"><span class="pre">local</span></code> seguida do parâmetro <code class="docutils literal notranslate"><span class="pre">[*]</span></code>. Ou seja, define-se que apenas núcleos locais são utilizados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getOrCreate</span></code>: cria uma SparkSession. Caso ela já exista, retorna a instância existente.</p></li>
</ul>
<p><strong>Observação</strong>: A lista completa de todos os parâmetros que podem ser utilizados na inicialização do <em>cluster</em> pode ser encontrada neste <a class="reference external" href="https://spark.apache.org/docs/latest/spark-standalone.html#cluster-launch-scripts">link</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;pyspark-notebook&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="preparacao-dos-dados">
<h1>4 Preparação dos Dados<a class="headerlink" href="#preparacao-dos-dados" title="Permalink to this heading">#</a></h1>
<section id="geracao-dos-dataframes">
<h2>4.1 Geração dos DataFrames<a class="headerlink" href="#geracao-dos-dataframes" title="Permalink to this heading">#</a></h2>
<p>Para a leitura dos dados dos arquivos .csv, é utilizado o método <code class="docutils literal notranslate"><span class="pre">spark.read.csv</span></code>. Seus parâmetros são:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: endereço do arquivo que é lido.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code>: indica se o arquivo possui um cabeçalho.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code>: especifica o caractere que separa os campos do arquivo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cargo</span>
<span class="n">cargo</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|cargoPK|           cargoNome|cargoRegimeTrabalho|cargoJornadaTrabalho|cargoEscolaridadeMinima|cargoNivel|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|      1|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                  MEDIO|    JUNIOR|
|      2|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|               SUPERIOR|     PLENO|
|      3|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                    POS|    SENIOR|
|      4|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|                  MEDIO|    JUNIOR|
|      5|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|               SUPERIOR|     PLENO|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cliente</span>
<span class="n">cliente</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|clientePK|clienteNomeFantasia|       clienteSetor|clienteCidade|clienteEstadoNome|clienteEstadoSigla|clienteRegiaoNome|clienteRegiaoSigla|clientePaisNome|clientePaisSigla|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|        1|           VIA FOOD|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        2|          VIA PIZZA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        3|           VIA JAPA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        4|            VIA VEG|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        5|          VIA DRINK|BEBIDAS E ALIMENTOS|   SAO CARLOS|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/data.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> 
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+------------+-------+-------+------------+-------------+------------+-------+
|dataPK|dataCompleta|dataDia|dataMes|dataBimestre|dataTrimestre|dataSemestre|dataAno|
+------+------------+-------+-------+------------+-------------+------------+-------+
|     1|    1/1/2016|      1|      1|           1|            1|           1|   2016|
|     2|    2/1/2016|      2|      1|           1|            1|           1|   2016|
|     3|    3/1/2016|      3|      1|           1|            1|           1|   2016|
|     4|    4/1/2016|      4|      1|           1|            1|           1|   2016|
|     5|    5/1/2016|      5|      1|           1|            1|           1|   2016|
+------+------------+-------+-------+------------+-------------+------------+-------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão equipe</span>
<span class="n">equipe</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|equipePK|   equipeNome|          filialNome|  filialCidade|  filialEstadoNome|filialEstadoSigla|filialRegiaoNome|filialRegiaoSigla|filialPaisNome|filialPaisSigla|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|       1|APP - DESKTOP|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       2|APP - DESKTOP|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       3|          WEB|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       4|          WEB|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       5|          WEB|CAMPO GRANDE - CE...|  CAMPO GRANDE|MATO GROSSO DO SUL|               MS|    CENTRO-OESTE|               CO|        BRASIL|             BR|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos funcionario</span>
<span class="n">funcionario</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos negociacao</span>
<span class="n">negociacao</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+---------+------+--------+---------------------+
|equipePK|clientePK|dataPK| receita|quantidadeNegociacoes|
+--------+---------+------+--------+---------------------+
|       2|        9|    22|11564.75|                    1|
|       2|       24|    11| 17990.5|                    1|
|       2|       28|    21| 16335.9|                    1|
|       1|       30|    23| 8495.55|                    1|
|       2|       43|    30|24748.75|                    1|
+--------+---------+------+--------+---------------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos pagamento</span>
<span class="n">pagamento</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+--------+---------------------+
|funcPK|equipePK|dataPK|cargoPK| salario|quantidadeLancamentos|
+------+--------+------+-------+--------+---------------------+
|   147|       2|     5|     64| 1559.94|                    1|
|   124|       2|     5|    329| 8102.77|                    1|
|   175|       1|     5|    328| 2532.51|                    1|
|   171|       1|     5|    245|  7882.7|                    1|
|   148|       2|     5|     65| 4404.59|                    1|
|     5|       2|     5|    112| 2226.66|                    1|
|   128|       1|     5|    341| 6157.04|                    1|
|    82|       2|     5|     43| 1585.51|                    1|
|    28|       1|     5|    253| 1594.02|                    1|
|    46|       1|     5|    390| 9880.16|                    1|
|    91|       2|     5|    233|10931.47|                    1|
|   176|       2|     5|    241| 2005.49|                    1|
|   172|       1|     5|    351|14218.28|                    1|
|   155|       1|     5|    121| 2002.57|                    1|
|    19|       2|     5|    223| 1778.26|                    1|
|    94|       1|     5|    394|  2505.1|                    1|
|    26|       2|     5|    350| 9162.46|                    1|
|    55|       2|     5|    313| 3215.53|                    1|
|    29|       1|     5|     62| 4128.44|                    1|
|   181|       1|     5|    249|11082.75|                    1|
+------+--------+------+-------+--------+---------------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="criacao-de-visoes-temporarias">
<h2>4.2 Criação de Visões Temporárias<a class="headerlink" href="#criacao-de-visoes-temporarias" title="Permalink to this heading">#</a></h2>
<p>Para que seja possível executar consultas SQL usando Spark SQL, é necessário criar visões temporárias. Uma visão temporária é uma forma na qual um DataFrame pode ser consultado como se fosse uma tabela.</p>
<p>Para tanto, deve ser utilizado o método  <code class="docutils literal notranslate"><span class="pre">createOrReplaceTempView</span></code> e deve ser passado como parâmetro uma <em>string</em> que é o nome da tabela que é criada a partir do DataFrame.  Os comandos a seguir criam uma visão temporária para cada DataFrame da aplicação de <em>data warehousing</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando as visões temporárias para as tabelas de dimensão</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;cargo&quot;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;equipe&quot;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;funcionario&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando a visão temporária para as tabelas de fatos</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;negociacao&quot;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;pagamento&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id59">
<h1>5 Execução de Consultas com Foco nas Operações OLAP<a class="headerlink" href="#id59" title="Permalink to this heading">#</a></h1>
<section id="id60">
<h2>5.1 Operação Slice and Dice<a class="headerlink" href="#id60" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Restringe os dados sendo analisados a um subconjunto desses dados.</p>
<ul class="simple">
<li><p>Slice: corte para um valor fixo, diminuindo a dimensionalidade do cubo.</p></li>
<li><p>Dice: seleção de faixas de valores.</p></li>
</ul>
<p><strong>Exemplo de consulta</strong>: Qual a quantidade de pagamentos realizados no mês de setembro de 2020?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT CAST(SUM(quantidadeLancamentos) AS INTEGER) AS `Quantidade de Lançamentos`</span>
<span class="s2">FROM data JOIN pagamento ON (data.dataPK = pagamento.dataPK) </span>
<span class="s2">WHERE dataAno = 2020 </span>
<span class="s2">      AND dataMes = 9</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------------+
|Quantidade de Lançamentos|
+-------------------------+
|                      200|
+-------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id61">
<h2>5.2 Operações Drill-Down e Roll-Up<a class="headerlink" href="#id61" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Analisam os dados considerando níveis progressivos de agregação.</p>
<ul class="simple">
<li><p>Drill-down: níveis de agregação progressivamente mais detalhados, ou de menor granularidade.</p></li>
<li><p>Roll-up: níveis de agregação progressivamente menos detalhados, ou de maior granularidade.</p></li>
</ul>
<p>Para ilustrar as operações de drill-down e roll-up, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>semestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, dataSemestre, ROUND(SUM(salario),2) AS `Valor gasto em salários por semestre`</span>
<span class="s2">FROM data JOIN pagamento ON data.dataPK = pagamento.dataPK </span>
<span class="s2">GROUP BY dataAno, dataSemestre</span>
<span class="s2">ORDER BY dataAno, dataSemestre</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------+------------------------------------+
|dataAno|dataSemestre|Valor gasto em salários por semestre|
+-------+------------+------------------------------------+
|   2016|           1|                          2221308.54|
|   2016|           2|                          2221308.54|
|   2017|           1|                           4887639.9|
|   2017|           2|                           4887639.9|
|   2018|           1|                           7467763.2|
|   2018|           2|                           7467763.2|
|   2019|           1|                          9283833.18|
|   2019|           2|                          9283833.18|
|   2020|           1|                          9283833.18|
|   2020|           2|                          9283833.18|
+-------+------------+------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta drill-down:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>trimestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, dataTrimestre, ROUND(SUM(salario),2) AS `Valor gasto em salários por trimestre`</span>
<span class="s2">FROM data JOIN pagamento ON (data.dataPK = pagamento.dataPK) </span>
<span class="s2">GROUP BY dataAno, dataTrimestre</span>
<span class="s2">ORDER BY dataAno, dataTrimestre</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------+-------------------------------------+
|dataAno|dataTrimestre|Valor gasto em salários por trimestre|
+-------+-------------+-------------------------------------+
|   2016|            1|                           1110654.27|
|   2016|            2|                           1110654.27|
|   2016|            3|                           1110654.27|
|   2016|            4|                           1110654.27|
|   2017|            1|                           2443819.95|
|   2017|            2|                           2443819.95|
|   2017|            3|                           2443819.95|
|   2017|            4|                           2443819.95|
|   2018|            1|                            3733881.6|
|   2018|            2|                            3733881.6|
|   2018|            3|                            3733881.6|
|   2018|            4|                            3733881.6|
|   2019|            1|                           4641916.59|
|   2019|            2|                           4641916.59|
|   2019|            3|                           4641916.59|
|   2019|            4|                           4641916.59|
|   2020|            1|                           4641916.59|
|   2020|            2|                           4641916.59|
|   2020|            3|                           4641916.59|
|   2020|            4|                           4641916.59|
+-------+-------------+-------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta roll-up:</strong> Qual o valor gasto em salários por <strong>ano</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, ROUND(SUM(salario),2) AS `Valor gasto em salários por ano`</span>
<span class="s2">FROM data JOIN pagamento ON (data.dataPK = pagamento.dataPK) </span>
<span class="s2">GROUP BY dataAno</span>
<span class="s2">ORDER BY dataAno</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------------------------+
|dataAno|Valor gasto em salários por ano|
+-------+-------------------------------+
|   2016|                     4442617.08|
|   2017|                      9775279.8|
|   2018|                   1.49355264E7|
|   2019|                  1.856766636E7|
|   2020|                  1.856766636E7|
+-------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id62">
<h2>5.3 Operação Pivot<a class="headerlink" href="#id62" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Reorienta a visão multidimensional dos dados, oferecendo diferentes perspectivas dos mesmos dados.</p>
<p>Para ilustrar a operação pivot, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong>  Qual o valor gasto em salários por ano, considerando cada nível de cargo?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, cargoNivel, ROUND(SUM(salario),2) AS `Gastos em Salários`</span>
<span class="s2">FROM pagamento JOIN data ON pagamento.dataPK = data.dataPK </span>
<span class="s2">               JOIN cargo ON pagamento.cargoPK = cargo.cargoPK </span>
<span class="s2">GROUP BY dataAno, cargoNivel</span>
<span class="s2">ORDER BY dataAno, cargoNivel</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+----------+------------------+
|dataAno|cargoNivel|Gastos em Salários|
+-------+----------+------------------+
|   2016|    JUNIOR|         489456.84|
|   2016|     PLENO|        1454152.44|
|   2016|    SENIOR|         2499007.8|
|   2017|    JUNIOR|         1030642.8|
|   2017|     PLENO|        3791593.92|
|   2017|    SENIOR|        4953043.08|
|   2018|    JUNIOR|         1393282.2|
|   2018|     PLENO|        5357227.44|
|   2018|    SENIOR|        8185016.76|
|   2019|    JUNIOR|        1755714.36|
|   2019|     PLENO|        6132228.24|
|   2019|    SENIOR|     1.067972376E7|
|   2020|    JUNIOR|        1755714.36|
|   2020|     PLENO|        6132228.24|
|   2020|    SENIOR|     1.067972376E7|
+-------+----------+------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta pivot:</strong> Qual o valor gasto em salários por nível de cargo, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT cargoNivel, dataAno, ROUND(SUM(salario),2) AS `Gastos em Salários`</span>
<span class="s2">FROM pagamento JOIN data ON pagamento.dataPK = data.dataPK </span>
<span class="s2">               JOIN cargo ON pagamento.cargoPK = cargo.cargoPK </span>
<span class="s2">GROUP BY cargoNivel, dataAno</span>
<span class="s2">ORDER BY cargoNivel, dataAno</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+-------+------------------+
|cargoNivel|dataAno|Gastos em Salários|
+----------+-------+------------------+
|    JUNIOR|   2016|         489456.84|
|    JUNIOR|   2017|         1030642.8|
|    JUNIOR|   2018|         1393282.2|
|    JUNIOR|   2019|        1755714.36|
|    JUNIOR|   2020|        1755714.36|
|     PLENO|   2016|        1454152.44|
|     PLENO|   2017|        3791593.92|
|     PLENO|   2018|        5357227.44|
|     PLENO|   2019|        6132228.24|
|     PLENO|   2020|        6132228.24|
|    SENIOR|   2016|         2499007.8|
|    SENIOR|   2017|        4953043.08|
|    SENIOR|   2018|        8185016.76|
|    SENIOR|   2019|     1.067972376E7|
|    SENIOR|   2020|     1.067972376E7|
+----------+-------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id63">
<h2>5.4 Operação Drill-Across<a class="headerlink" href="#id63" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Compara medidas numéricas de tabelas de fatos diferentes, utilizando pelo menos uma dimensão em comum.</p>
<p><strong>Exemplo de consulta:</strong> Qual o total gasto com salários e qual o total de receitas recebidas, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula JOIN ... ON ...</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT anoPag AS `Ano`, ROUND(salario,2) AS `Total Gasto com Salários`, ROUND(receita,2) AS `Total de Receitas Recebidas`</span>
<span class="s2">FROM ( SELECT dataAno, SUM(salario)  </span>
<span class="s2">       FROM pagamento JOIN data on data.dataPK = pagamento.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS pag(anoPag, salario)</span>
<span class="s2">     JOIN </span>
<span class="s2">     ( SELECT dataAno, SUM(receita)</span>
<span class="s2">       FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS neg(anoNeg, receita) </span>
<span class="s2">     ON anoPag = anoNeg </span>
<span class="s2">ORDER BY anoPag</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+------------------------+---------------------------+
| Ano|Total Gasto com Salários|Total de Receitas Recebidas|
+----+------------------------+---------------------------+
|2016|              4442617.08|                 4614246.95|
|2017|               9775279.8|                 7200423.35|
|2018|            1.49355264E7|              1.159353965E7|
|2019|           1.856766636E7|               3.53533183E7|
|2020|           1.856766636E7|              3.022217595E7|
+----+------------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula WHERE</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT anoPag AS `Ano`, ROUND(salario,2) AS `Total Gasto com Salários`, ROUND(receita,2) AS `Total de Receitas Recebidas`</span>
<span class="s2">FROM ( SELECT dataAno, SUM(salario) </span>
<span class="s2">       FROM pagamento JOIN data on data.dataPK = pagamento.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS pag(anoPag, salario), </span>
<span class="s2">     ( SELECT dataAno, SUM(receita)</span>
<span class="s2">       FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS neg(anoNeg, receita) </span>
<span class="s2">WHERE anoPag = anoNeg </span>
<span class="s2">ORDER BY anoPag</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+------------------------+---------------------------+
| Ano|Total Gasto com Salários|Total de Receitas Recebidas|
+----+------------------------+---------------------------+
|2016|              4442617.08|                 4614246.95|
|2017|               9775279.8|                 7200423.35|
|2018|            1.49355264E7|              1.159353965E7|
|2019|           1.856766636E7|               3.53533183E7|
|2020|           1.856766636E7|              3.022217595E7|
+----+------------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="extensoes-rollup-cube-e-grouping-sets">
<h2>5.5 Extensões ROLLUP, CUBE e GROUPING SETS<a class="headerlink" href="#extensoes-rollup-cube-e-grouping-sets" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Constrém vários níveis de agregação.</p>
<ul class="simple">
<li><p>ROLLUP: criação de subtotais para as combinações dos atributos da lista de agrupamento de acordo com a ordem desses atributos. São criados n+1 níveis de agregação, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
<li><p>CUBE: criação de subtotais para todas as combinações dos atributos da lista de agrupamento. São criados 2ˆn (2 elevado a n) níveis, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
<li><p>GROUPING SETS: criação de subtotais para quaisquer combinações de atributos de agrupamentos. É criada a quantidade de subtotais especificados na lista de níveis de agregação desejados.</p></li>
</ul>
<p><strong>Exemplo de consulta com ROLLUP:</strong> Liste as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY ROLLUP (clienteSetor, clienteCidade)</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com GROUPING SETS com semântica de ROLLUP:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY GROUPING SETS ((clienteSetor, clienteCidade), (clienteSetor), ())</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com CUBE:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY CUBE (clienteSetor, clienteCidade)</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|               null|BELO HORIZONTE|       4379523.85|
|               null|  CAMPO GRANDE|       3422117.05|
|               null|      CURITIBA|       3697625.35|
|               null|     FORTALEZA|       3391233.25|
|               null|        MANAUS|       5234539.25|
|               null|       MARILIA|        7289146.1|
|               null|  PORTO ALEGRE|        4319625.7|
|               null|        RECIFE|       4717719.45|
|               null|RIO DE JANEIRO|    1.525596265E7|
|               null|    SAO CARLOS|       4192741.95|
|               null|     SAO PAULO|    2.464599965E7|
|               null|    UBERLANDIA|        4357595.2|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com GROUPING SETS com semântica de CUBE:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY GROUPING SETS ((clienteSetor, clienteCidade), (clienteSetor), (clienteCidade), ())</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|               null|BELO HORIZONTE|       4379523.85|
|               null|  CAMPO GRANDE|       3422117.05|
|               null|      CURITIBA|       3697625.35|
|               null|     FORTALEZA|       3391233.25|
|               null|        MANAUS|       5234539.25|
|               null|       MARILIA|        7289146.1|
|               null|  PORTO ALEGRE|        4319625.7|
|               null|        RECIFE|       4717719.45|
|               null|RIO DE JANEIRO|    1.525596265E7|
|               null|    SAO CARLOS|       4192741.95|
|               null|     SAO PAULO|    2.464599965E7|
|               null|    UBERLANDIA|        4357595.2|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id64">
<h1>6 Execução de Consultas com Foco na Tomada de Decisão<a class="headerlink" href="#id64" title="Permalink to this heading">#</a></h1>
<p>As consultas OLAP requisitadas por usuários de sistemas de suporte à decisão usualmente requerem que várias operações OLAP sejam realizadas simultaneamente. A seguir são ilustrados exemplos de consultas OLAP que podem ser requisitadas para a tomada de decisão estratégica.</p>
<section id="id65">
<h2>6.1 Consulta 1<a class="headerlink" href="#id65" title="Permalink to this heading">#</a></h2>
<p>Qual é a média dos salários recebidos por nível do cargo e por sexo no ano de 2019?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">cargo</span></code>, <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.cargoPK</span> <span class="pre">=</span> <span class="pre">cargo.cargoPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.funcPK</span> <span class="pre">=</span> <span class="pre">funcionario.funcPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula JOIN ... ON ...</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT cargoNivel, funcSexo, ROUND(AVG(salario),2) AS `Média dos Salários`</span>
<span class="s2">FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK</span>
<span class="s2">               JOIN cargo ON cargo.cargoPK = pagamento.cargoPK</span>
<span class="s2">               JOIN funcionario ON funcionario.funcPK = pagamento.funcPK </span>
<span class="s2">WHERE dataAno = 2019</span>
<span class="s2">GROUP BY cargoNivel, funcSexo</span>
<span class="s2">ORDER BY cargoNivel, funcSexo</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula WHERE</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT cargoNivel, funcSexo, ROUND(AVG(salario),2) AS `Média dos Salários`</span>
<span class="s2">FROM pagamento, cargo, funcionario, data</span>
<span class="s2">WHERE data.dataPK = pagamento.dataPK</span>
<span class="s2">      AND cargo.cargoPK = pagamento.cargoPK</span>
<span class="s2">      AND funcionario.funcPK = pagamento.funcPK</span>
<span class="s2">      AND dataAno = 2019</span>
<span class="s2">GROUP BY cargoNivel, funcSexo</span>
<span class="s2">ORDER BY cargoNivel, funcSexo</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id66">
<h2>6.2 Consulta 2<a class="headerlink" href="#id66" title="Permalink to this heading">#</a></h2>
<p>Qual o total de gastos em salários considerando os estados nos quais as equipes estão localizadas no trimestre 3 do ano de 2020?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipePK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT filialEstadoNome, ROUND(SUM(salario),2) AS Total</span>
<span class="s2">FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK </span>
<span class="s2">               JOIN equipe ON equipe.equipePK = pagamento.equipePK</span>
<span class="s2">WHERE dataAno = 2019</span>
<span class="s2">      AND dataTrimestre = 3</span>
<span class="s2">GROUP BY filialEstadoNome</span>
<span class="s2">ORDER BY Total </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+----------+
|  filialEstadoNome|     Total|
+------------------+----------+
|        PERNAMBUCO| 438121.26|
|MATO GROSSO DO SUL|1013857.74|
|    RIO DE JANEIRO|1258479.57|
|         SAO PAULO|1931458.02|
+------------------+----------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id67">
<h2>6.3 Consulta 3<a class="headerlink" href="#id67" title="Permalink to this heading">#</a></h2>
<p>Qual o custo/benefício das equipes quando analisado o semestre 1 do ano de 2020?</p>
<p>A idea da consulta é relacionar os gastos em salários e os ganhos em receitas considerando cada equipe e o período especificado. Portanto, para se realizar essa consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como das tabelas de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code> e <code class="docutils literal notranslate"><span class="pre">negociacao</span></code>.</p>
<p>A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
</ul>
<p>Uma observação muito importante refere-se ao fato que, para evitar dubiedade nas respostas, elas devem ser feitas sempre considerando a chave primária, desde que a chave primária identifica univocamente cada tupla. Depois de ser resolvida a consulta em termos da chave primária, então deve ser obtido os demais atributos a serem exibidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- obtendo os dados a serem exibidos na resposta</span>
<span class="s2">SELECT equipeNome, filialNome, ROUND(Lucro,2)</span>
<span class="s2">FROM equipe,</span>
<span class="s2">(</span>
<span class="s2">   SELECT pag.equipePK AS retornaEquipePK, (TotalReceita - TotalSalario) AS Lucro</span>
<span class="s2">   FROM ( </span>
<span class="s2">        -- investigando os gastos em salarios de cada equipe no último semestre deste ano </span>
<span class="s2">        SELECT equipePK, SUM(salario) AS TotalSalario</span>
<span class="s2">        FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK</span>
<span class="s2">        WHERE dataSemestre = 1 </span>
<span class="s2">              AND dataAno = 2020</span>
<span class="s2">        GROUP BY equipePK </span>
<span class="s2">        ORDER BY equipePK </span>
<span class="s2">        ) AS pag,  </span>
<span class="s2">        (</span>
<span class="s2">        -- investigando os ganhos em receitas de cada equipe no último semestre deste ano   </span>
<span class="s2">        SELECT equipePK, SUM(receita) AS TotalReceita</span>
<span class="s2">        FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">        WHERE dataSemestre = 1 </span>
<span class="s2">              AND dataAno = 2020</span>
<span class="s2">        GROUP BY equipePK </span>
<span class="s2">        ORDER BY equipePK</span>
<span class="s2">        ) AS neg</span>
<span class="s2">   WHERE pag.equipePK = neg.equipePK</span>
<span class="s2">   ) AS parte</span>
<span class="s2">WHERE equipe.equipePK = parte.retornaEquipePK</span>
<span class="s2">ORDER BY Lucro DESC</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+---------------+
|    equipeNome|          filialNome|round(Lucro, 2)|
+--------------+--------------------+---------------+
|BI &amp; ANALYTICS|SAO PAULO - AV. P...|     4054890.24|
|BI &amp; ANALYTICS|     RECIFE - CENTRO|     3788503.18|
| APP - DESKTOP|RIO DE JANEIRO - ...|      278013.26|
|  APP - MOBILE|SAO PAULO - AV. P...|      151160.49|
| APP - DESKTOP|SAO PAULO - AV. P...|       99579.85|
+--------------+--------------------+---------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id68">
<h1><span style="color:blue">Aula 07: Consultas OLAP usando Spark SQL</span><a class="headerlink" href="#id68" title="Permalink to this heading">#</a></h1>
<section id="id69">
<h2><span style="color:blue">Apache Spark SQL</span><a class="headerlink" href="#id69" title="Permalink to this heading">#</a></h2>
<p>Esta lista contém os exercícios referentes à Aula 07. Por favor, procurem por “Exerício” para encontrar a especificação dos exercícios. Também é possível localizar os exercícios utilizando o menu de navegação. Por completude, o <em>notebook</em> possui todas as descrições apresentadas na parte prática da Aula 07. Recomenda-se fortemente que a lista de exercícios seja respondida antes de se consultar as respostas dos exercícios.</p>
<p><strong>IMPORTANTE: O uso do <em>framework</em> Spark requer diversas configurações no ambiente de desenvolvimento para executar o <em>notebook</em>. Dado que tal complexidade foge do escopo de nossa disciplina, recomenda-se que o <em>notebook</em> seja executado na plataforma de desenvolvimento COLAB. O uso do COLAB  proporciona um ambiente de desenvolvimento pré-configurado e remove a complexidade de instalação e configuração de pacotes e <em>frameworks</em> que são utilizados na disciplina.</strong></p>
<p>#1 Otimizador de Consultas Catalyst</p>
<p>O componente mais importante do Spark SQL é o seu otimizador de consultas, chamado Catalyst. Catalyst é baseado em construtores de programação funcional e é implementado na linguagem de programação Scala. Sua implementação tem dois propósitos principais. O primeiro é permitir que novas técnicas de otimização e novas características possam ser facilmente adicionadas ao Spark SQL. O segundo propósito consiste em possibilitar que desenvolvedores externos estendam o otimizador de consultas, por exemplo, adicionando novas regras de otimização e provendo suporte para novos tipos de dados, dentre outros.</p>
</section>
<section id="id70">
<h2>1.1 Plano de Consulta<a class="headerlink" href="#id70" title="Permalink to this heading">#</a></h2>
<p>Dada uma consulta em alto nível, existem diferentes estratégias de execução (ou seja, planos de consulta) alternativas para se processar essa consulta, principalmente se ela for complexa. A otimização de consultas consiste no processo de gerar e selecionar o plano de consulta mais eficiente dentre as diversas possibilidades disponíveis, ou seja, consiste no processo de selecionar o plano de consulta de menor custo.</p>
<p>De fato, a quantidade de possíveis planos de consulta que podem ser gerados para processar uma consulta pode ser muito grande. Assim, no processamento de uma consulta, nem todos os planos possíveis são gerados e analisados, uma vez que o tempo gasto nesta atividade seria provavelmente excessivo, talvez superando o tempo de responder à consulta por meio de uma busca sequencial. Heurísticas são usualmente empregadas para diminuir o espaço de busca.</p>
<p>Portanto, o otimizador de consultas em geral não produz uma solução que é a ótima ou de menor custo frente a todas as possibilidades existentes, mas produz uma solução que é a melhor frente a algumas dessas possibilidades.</p>
<p>##1.2 Técnicas de Otimização</p>
<p>Duas técnicas amplamente utilizadas pelo otimizador de consultas são descritas a seguir.</p>
<ul class="simple">
<li><p>Otimização baseada em regras. O otimizador de consultas baseado em regras tem por objetivo gerar apenas um subconjunto de planos a serem analisados, usado como base heurísticas. Cada plano gerado pelo otimizador de consultas baseado em regras consiste de uma expressão algébrica que determina a ordem na qual as operações deve ser executadas, de forma que todos os planos para uma determinada consulta sejam equivalentes.</p></li>
<li><p>Otimização baseada em custo. O otimizador de consultas baseado em custo identifica, para cada plano gerado, o custo para processar a consulta, e seleciona o plano de menor custo. Isso depende de diversos fatores, tais como quais as operações algébricas que encontram-se efetivamente implementadas por meio de algoritmos disponilizados e os índices disponíveis para processar a consulta.</p></li>
</ul>
<p>Catalyst realiza otimização de consultas baseada em regras e otimização de consultas baseada em custo para transformar uma consulta escrita em SQL em códigos que executam sobre RDDs e utilizam os princípios do modelo MapReduce e do sistema de arquivos distribuídos HDFS.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id71">
<h1>2 Constelação de Fatos da BI Solutions<a class="headerlink" href="#id71" title="Permalink to this heading">#</a></h1>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma constelação de fatos, conforme descrita a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamentos)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacoes)</p></li>
</ul>
<section id="id72">
<h2>2.1 Baixando o Módulo wget<a class="headerlink" href="#id72" title="Permalink to this heading">#</a></h2>
<p>Para baixar os dados referentes ao esquema relacional da constelação de fatos da BI Solutions, é utilizado o módulo  <strong>wget</strong>. O comando a seguir realiza a instalação desse módulo. <br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando o módulo wget
%%capture
!pip install -q wget
#criando pasta para salvar as bases de dados
!mkdir data
</pre></div>
</div>
</div>
</div>
</section>
<section id="id73">
<h2>2.2 Obtenção dos Dados das Tabelas de Dimensão<a class="headerlink" href="#id73" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de dimensão.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de dimensão</span>
<span class="kn">import</span> <span class="nn">wget</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/data.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/cliente (1).csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="id74">
<h2>2.3 Obtenção dos Dados Tabelas de Fatos<a class="headerlink" href="#id74" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de fatos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de fatos</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/negociacao (1).csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id75">
<h1>3 Apache Spark Cluster<a class="headerlink" href="#id75" title="Permalink to this heading">#</a></h1>
<section id="id76">
<h2>3.1 Instalação<a class="headerlink" href="#id76" title="Permalink to this heading">#</a></h2>
<p>Neste <em>notebook</em> é criado um <em>cluster</em> Spark composto apenas por um <strong>nó mestre</strong>. Ou seja, o <em>cluster</em> não possui um ou mais <strong>nós de trabalho</strong> e o <strong>gerenciador de cluster</strong>. Nessa configuração, as tarefas (<em>tasks</em>) são realizadas no próprio <em>driver</em> localizado no <strong>nó mestre</strong>.</p>
<p>Para que o cluster possa ser criado, primeiramente é instalado o Java Runtime Environment (JRE) versão 8.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando Java Runtime Environment (JRE) versão 8
%%capture
!apt-get remove openjdk*
!apt-get update --fix-missing
!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<p>Na sequência, é feito o <em>download</em> do Apache Spark versão 3.0.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#baixando Apache Spark versão 3.0.0
%%capture
!wget -q https://archive.apache.org/dist/spark/spark-3.0.0/spark-3.0.0-bin-hadoop2.7.tgz
!tar xf spark-3.0.0-bin-hadoop2.7.tgz &amp;&amp; rm spark-3.0.0-bin-hadoop2.7.tgz
</pre></div>
</div>
</div>
</div>
<p>Na sequência, são configuradas as variáveis de ambiente JAVA_HOME e SPARK_HOME. Isto permite que tanto o Java quanto o Spark possam ser encontrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#configurando a variável de ambiente JAVA_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="c1">#configurando a variável de ambiente SPARK_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.0.0-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, são instalados dois pacotes da linguagem de programação Python, cujas funcionalidades são descritas a seguir.</p>
<blockquote>
<div><p><strong>Pacote findspark:</strong> Usado para ler a variável de ambiente SPARK_HOME e armazenar seu valor na variável dinâmica de ambiente PYTHONPATH. Como resultado, Python pode encontrar a instalação do Spark.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Pacote pyspark:</strong> PySpark é a API do Python para Spark. Ela possibilita o uso de Python, considerando que o <em>framework</em> Apache Spark encontra-se desenvolvido na linguagem de programação Scala.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
#instalando o pacote findspark
!pip install -q findspark==1.4.2
#instalando o pacote pyspark
!pip install -q pyspark==3.0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="id77">
<h2>3.2 Conexão<a class="headerlink" href="#id77" title="Permalink to this heading">#</a></h2>
<p>PySpark não é adicionado ao <em>sys.path</em> por padrão. Isso significa que não é possível importá-lo, pois o interpretador da linguagem Python não sabe onde encontrá-lo.</p>
<p>Para resolver esse aspecto, é necessário instalar o módulo <code class="docutils literal notranslate"><span class="pre">findspark</span></code>. Esse módulo mostra onde PySpark está localizado. Os comandos a seguir têm essa finalidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#importando o módulo findspark</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="c1">#carregando a variávels SPARK_HOME na variável dinâmica PYTHONPATH</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Depois de configurados os pacotes e módulos e inicializadas as variáveis de ambiente, é possível iniciar o uso do Spark na aplicação de <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">warehousing</span></code>. Para tanto, é necessário importar o comando <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code> do módulo <code class="docutils literal notranslate"><span class="pre">pyspark.sql</span></code>. São utilizados os seguintes conceitos: <br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SparkSession</span></code>: permite a criação de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, as tabelas relacionais podem ser manipuladas por meio de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> e é possível realizar consultas OLAP por meio de comandos SQL. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">builder</span></code>: cria uma instância de SparkSession. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">appName</span></code>: define um nome para a aplicação, o qual pode ser visto na interface de usuário web do Spark. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master</span></code>: define onde está o nó mestre do <em>cluster</em>. Como a aplicação é executada localmente e não em um <em>cluster</em>, indica-se isso pela <em>string</em> <code class="docutils literal notranslate"><span class="pre">local</span></code> seguida do parâmetro <code class="docutils literal notranslate"><span class="pre">[*]</span></code>. Ou seja, define-se que apenas núcleos locais são utilizados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getOrCreate</span></code>: cria uma SparkSession. Caso ela já exista, retorna a instância existente.</p></li>
</ul>
<p><strong>Observação</strong>: A lista completa de todos os parâmetros que podem ser utilizados na inicialização do <em>cluster</em> pode ser encontrada neste <a class="reference external" href="https://spark.apache.org/docs/latest/spark-standalone.html#cluster-launch-scripts">link</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;pyspark-notebook&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id78">
<h1>4 Preparação dos Dados<a class="headerlink" href="#id78" title="Permalink to this heading">#</a></h1>
<section id="id79">
<h2>4.1 Geração dos DataFrames<a class="headerlink" href="#id79" title="Permalink to this heading">#</a></h2>
<p>Para a leitura dos dados dos arquivos .csv, é utilizado o método <code class="docutils literal notranslate"><span class="pre">spark.read.csv</span></code>. Seus parâmetros são:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: endereço do arquivo que é lido.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code>: indica se o arquivo possui um cabeçalho.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code>: especifica o caractere que separa os campos do arquivo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cargo</span>
<span class="n">cargo</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|cargoPK|           cargoNome|cargoRegimeTrabalho|cargoJornadaTrabalho|cargoEscolaridadeMinima|cargoNivel|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|      1|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                  MEDIO|    JUNIOR|
|      2|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|               SUPERIOR|     PLENO|
|      3|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                    POS|    SENIOR|
|      4|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|                  MEDIO|    JUNIOR|
|      5|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|               SUPERIOR|     PLENO|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cliente</span>
<span class="n">cliente</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|clientePK|clienteNomeFantasia|       clienteSetor|clienteCidade|clienteEstadoNome|clienteEstadoSigla|clienteRegiaoNome|clienteRegiaoSigla|clientePaisNome|clientePaisSigla|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|        1|           VIA FOOD|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        2|          VIA PIZZA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        3|           VIA JAPA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        4|            VIA VEG|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        5|          VIA DRINK|BEBIDAS E ALIMENTOS|   SAO CARLOS|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/data.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> 
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+------------+-------+-------+------------+-------------+------------+-------+
|dataPK|dataCompleta|dataDia|dataMes|dataBimestre|dataTrimestre|dataSemestre|dataAno|
+------+------------+-------+-------+------------+-------------+------------+-------+
|     1|    1/1/2016|      1|      1|           1|            1|           1|   2016|
|     2|    2/1/2016|      2|      1|           1|            1|           1|   2016|
|     3|    3/1/2016|      3|      1|           1|            1|           1|   2016|
|     4|    4/1/2016|      4|      1|           1|            1|           1|   2016|
|     5|    5/1/2016|      5|      1|           1|            1|           1|   2016|
+------+------------+-------+-------+------------+-------------+------------+-------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão equipe</span>
<span class="n">equipe</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|equipePK|   equipeNome|          filialNome|  filialCidade|  filialEstadoNome|filialEstadoSigla|filialRegiaoNome|filialRegiaoSigla|filialPaisNome|filialPaisSigla|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|       1|APP - DESKTOP|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       2|APP - DESKTOP|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       3|          WEB|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       4|          WEB|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       5|          WEB|CAMPO GRANDE - CE...|  CAMPO GRANDE|MATO GROSSO DO SUL|               MS|    CENTRO-OESTE|               CO|        BRASIL|             BR|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos funcionario</span>
<span class="n">funcionario</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos negociacao</span>
<span class="n">negociacao</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+---------+------+--------+---------------------+
|equipePK|clientePK|dataPK| receita|quantidadeNegociacoes|
+--------+---------+------+--------+---------------------+
|       2|        9|    22|11564.75|                    1|
|       2|       24|    11| 17990.5|                    1|
|       2|       28|    21| 16335.9|                    1|
|       1|       30|    23| 8495.55|                    1|
|       2|       43|    30|24748.75|                    1|
+--------+---------+------+--------+---------------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos pagamento</span>
<span class="n">pagamento</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+--------+---------------------+
|funcPK|equipePK|dataPK|cargoPK| salario|quantidadeLancamentos|
+------+--------+------+-------+--------+---------------------+
|   147|       2|     5|     64| 1559.94|                    1|
|   124|       2|     5|    329| 8102.77|                    1|
|   175|       1|     5|    328| 2532.51|                    1|
|   171|       1|     5|    245|  7882.7|                    1|
|   148|       2|     5|     65| 4404.59|                    1|
|     5|       2|     5|    112| 2226.66|                    1|
|   128|       1|     5|    341| 6157.04|                    1|
|    82|       2|     5|     43| 1585.51|                    1|
|    28|       1|     5|    253| 1594.02|                    1|
|    46|       1|     5|    390| 9880.16|                    1|
|    91|       2|     5|    233|10931.47|                    1|
|   176|       2|     5|    241| 2005.49|                    1|
|   172|       1|     5|    351|14218.28|                    1|
|   155|       1|     5|    121| 2002.57|                    1|
|    19|       2|     5|    223| 1778.26|                    1|
|    94|       1|     5|    394|  2505.1|                    1|
|    26|       2|     5|    350| 9162.46|                    1|
|    55|       2|     5|    313| 3215.53|                    1|
|    29|       1|     5|     62| 4128.44|                    1|
|   181|       1|     5|    249|11082.75|                    1|
+------+--------+------+-------+--------+---------------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id80">
<h2>4.2 Criação de Visões Temporárias<a class="headerlink" href="#id80" title="Permalink to this heading">#</a></h2>
<p>Para que seja possível executar consultas SQL usando Spark SQL, é necessário criar visões temporárias. Uma visão temporária é uma forma na qual um DataFrame pode ser consultado como se fosse uma tabela.</p>
<p>Para tanto, deve ser utilizado o método  <code class="docutils literal notranslate"><span class="pre">createOrReplaceTempView</span></code> e deve ser passado como parâmetro uma <em>string</em> que é o nome da tabela que é criada a partir do DataFrame.  Os comandos a seguir criam uma visão temporária para cada DataFrame da aplicação de <em>data warehousing</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando as visões temporárias para as tabelas de dimensão</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;cargo&quot;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;equipe&quot;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;funcionario&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando a visão temporária para as tabelas de fatos</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;negociacao&quot;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;pagamento&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id81">
<h1>5 Execução de Consultas com Foco nas Operações OLAP<a class="headerlink" href="#id81" title="Permalink to this heading">#</a></h1>
<section id="id82">
<h2>5.1 Operação Slice and Dice<a class="headerlink" href="#id82" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Restringe os dados sendo analisados a um subconjunto desses dados.</p>
<ul class="simple">
<li><p>Slice: corte para um valor fixo, diminuindo a dimensionalidade do cubo.</p></li>
<li><p>Dice: seleção de faixas de valores.</p></li>
</ul>
<p><strong>Exemplo de consulta</strong>: Qual a quantidade de pagamentos realizados no mês de setembro de 2020?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT CAST(SUM(quantidadeLancamentos) AS INTEGER) AS `Quantidade de Lançamentos`</span>
<span class="s2">FROM data JOIN pagamento ON (data.dataPK = pagamento.dataPK) </span>
<span class="s2">WHERE dataAno = 2020 </span>
<span class="s2">      AND dataMes = 9</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------------+
|Quantidade de Lançamentos|
+-------------------------+
|                      200|
+-------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id83">
<h2>5.2 Operações Drill-Down e Roll-Up<a class="headerlink" href="#id83" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Analisam os dados considerando níveis progressivos de agregação.</p>
<ul class="simple">
<li><p>Drill-down: níveis de agregação progressivamente mais detalhados, ou de menor granularidade.</p></li>
<li><p>Roll-up: níveis de agregação progressivamente menos detalhados, ou de maior granularidade.</p></li>
</ul>
<p>Para ilustrar as operações de drill-down e roll-up, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>semestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, dataSemestre, ROUND(SUM(salario),2) AS `Valor gasto em salários por semestre`</span>
<span class="s2">FROM data JOIN pagamento ON data.dataPK = pagamento.dataPK </span>
<span class="s2">GROUP BY dataAno, dataSemestre</span>
<span class="s2">ORDER BY dataAno, dataSemestre</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------+------------------------------------+
|dataAno|dataSemestre|Valor gasto em salários por semestre|
+-------+------------+------------------------------------+
|   2016|           1|                          2221308.54|
|   2016|           2|                          2221308.54|
|   2017|           1|                           4887639.9|
|   2017|           2|                           4887639.9|
|   2018|           1|                           7467763.2|
|   2018|           2|                           7467763.2|
|   2019|           1|                          9283833.18|
|   2019|           2|                          9283833.18|
|   2020|           1|                          9283833.18|
|   2020|           2|                          9283833.18|
+-------+------------+------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta drill-down:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>trimestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, dataTrimestre, ROUND(SUM(salario),2) AS `Valor gasto em salários por trimestre`</span>
<span class="s2">FROM data JOIN pagamento ON (data.dataPK = pagamento.dataPK) </span>
<span class="s2">GROUP BY dataAno, dataTrimestre</span>
<span class="s2">ORDER BY dataAno, dataTrimestre</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------+-------------------------------------+
|dataAno|dataTrimestre|Valor gasto em salários por trimestre|
+-------+-------------+-------------------------------------+
|   2016|            1|                           1110654.27|
|   2016|            2|                           1110654.27|
|   2016|            3|                           1110654.27|
|   2016|            4|                           1110654.27|
|   2017|            1|                           2443819.95|
|   2017|            2|                           2443819.95|
|   2017|            3|                           2443819.95|
|   2017|            4|                           2443819.95|
|   2018|            1|                            3733881.6|
|   2018|            2|                            3733881.6|
|   2018|            3|                            3733881.6|
|   2018|            4|                            3733881.6|
|   2019|            1|                           4641916.59|
|   2019|            2|                           4641916.59|
|   2019|            3|                           4641916.59|
|   2019|            4|                           4641916.59|
|   2020|            1|                           4641916.59|
|   2020|            2|                           4641916.59|
|   2020|            3|                           4641916.59|
|   2020|            4|                           4641916.59|
+-------+-------------+-------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta roll-up:</strong> Qual o valor gasto em salários por <strong>ano</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, ROUND(SUM(salario),2) AS `Valor gasto em salários por ano`</span>
<span class="s2">FROM data JOIN pagamento ON (data.dataPK = pagamento.dataPK) </span>
<span class="s2">GROUP BY dataAno</span>
<span class="s2">ORDER BY dataAno</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------------------------+
|dataAno|Valor gasto em salários por ano|
+-------+-------------------------------+
|   2016|                     4442617.08|
|   2017|                      9775279.8|
|   2018|                   1.49355264E7|
|   2019|                  1.856766636E7|
|   2020|                  1.856766636E7|
+-------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id84">
<h2>5.3 Operação Pivot<a class="headerlink" href="#id84" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Reorienta a visão multidimensional dos dados, oferecendo diferentes perspectivas dos mesmos dados.</p>
<p>Para ilustrar a operação pivot, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong>  Qual o valor gasto em salários por ano, considerando cada nível de cargo?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno, cargoNivel, ROUND(SUM(salario),2) AS `Gastos em Salários`</span>
<span class="s2">FROM pagamento JOIN data ON pagamento.dataPK = data.dataPK </span>
<span class="s2">               JOIN cargo ON pagamento.cargoPK = cargo.cargoPK </span>
<span class="s2">GROUP BY dataAno, cargoNivel</span>
<span class="s2">ORDER BY dataAno, cargoNivel</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+----------+------------------+
|dataAno|cargoNivel|Gastos em Salários|
+-------+----------+------------------+
|   2016|    JUNIOR|         489456.84|
|   2016|     PLENO|        1454152.44|
|   2016|    SENIOR|         2499007.8|
|   2017|    JUNIOR|         1030642.8|
|   2017|     PLENO|        3791593.92|
|   2017|    SENIOR|        4953043.08|
|   2018|    JUNIOR|         1393282.2|
|   2018|     PLENO|        5357227.44|
|   2018|    SENIOR|        8185016.76|
|   2019|    JUNIOR|        1755714.36|
|   2019|     PLENO|        6132228.24|
|   2019|    SENIOR|     1.067972376E7|
|   2020|    JUNIOR|        1755714.36|
|   2020|     PLENO|        6132228.24|
|   2020|    SENIOR|     1.067972376E7|
+-------+----------+------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta pivot:</strong> Qual o valor gasto em salários por nível de cargo, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT cargoNivel, dataAno, ROUND(SUM(salario),2) AS `Gastos em Salários`</span>
<span class="s2">FROM pagamento JOIN data ON pagamento.dataPK = data.dataPK </span>
<span class="s2">               JOIN cargo ON pagamento.cargoPK = cargo.cargoPK </span>
<span class="s2">GROUP BY cargoNivel, dataAno</span>
<span class="s2">ORDER BY cargoNivel, dataAno</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+-------+------------------+
|cargoNivel|dataAno|Gastos em Salários|
+----------+-------+------------------+
|    JUNIOR|   2016|         489456.84|
|    JUNIOR|   2017|         1030642.8|
|    JUNIOR|   2018|         1393282.2|
|    JUNIOR|   2019|        1755714.36|
|    JUNIOR|   2020|        1755714.36|
|     PLENO|   2016|        1454152.44|
|     PLENO|   2017|        3791593.92|
|     PLENO|   2018|        5357227.44|
|     PLENO|   2019|        6132228.24|
|     PLENO|   2020|        6132228.24|
|    SENIOR|   2016|         2499007.8|
|    SENIOR|   2017|        4953043.08|
|    SENIOR|   2018|        8185016.76|
|    SENIOR|   2019|     1.067972376E7|
|    SENIOR|   2020|     1.067972376E7|
+----------+-------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id85">
<h2>5.4 Operação Drill-Across<a class="headerlink" href="#id85" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Compara medidas numéricas de tabelas de fatos diferentes, utilizando pelo menos uma dimensão em comum.</p>
<p><strong>Exemplo de consulta:</strong> Qual o total gasto com salários e qual o total de receitas recebidas, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula JOIN ... ON ...</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT anoPag AS `Ano`, ROUND(salario,2) AS `Total Gasto com Salários`, ROUND(receita,2) AS `Total de Receitas Recebidas`</span>
<span class="s2">FROM ( SELECT dataAno, SUM(salario)  </span>
<span class="s2">       FROM pagamento JOIN data on data.dataPK = pagamento.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS pag(anoPag, salario)</span>
<span class="s2">     JOIN </span>
<span class="s2">     ( SELECT dataAno, SUM(receita)</span>
<span class="s2">       FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS neg(anoNeg, receita) </span>
<span class="s2">     ON anoPag = anoNeg </span>
<span class="s2">ORDER BY anoPag</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+------------------------+---------------------------+
| Ano|Total Gasto com Salários|Total de Receitas Recebidas|
+----+------------------------+---------------------------+
|2016|              4442617.08|                 4614246.95|
|2017|               9775279.8|                 7200423.35|
|2018|            1.49355264E7|              1.159353965E7|
|2019|           1.856766636E7|               3.53533183E7|
|2020|           1.856766636E7|              3.022217595E7|
+----+------------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula WHERE</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT anoPag AS `Ano`, ROUND(salario,2) AS `Total Gasto com Salários`, ROUND(receita,2) AS `Total de Receitas Recebidas`</span>
<span class="s2">FROM ( SELECT dataAno, SUM(salario) </span>
<span class="s2">       FROM pagamento JOIN data on data.dataPK = pagamento.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS pag(anoPag, salario), </span>
<span class="s2">     ( SELECT dataAno, SUM(receita)</span>
<span class="s2">       FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">       GROUP BY dataAno</span>
<span class="s2">      ) AS neg(anoNeg, receita) </span>
<span class="s2">WHERE anoPag = anoNeg </span>
<span class="s2">ORDER BY anoPag</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+------------------------+---------------------------+
| Ano|Total Gasto com Salários|Total de Receitas Recebidas|
+----+------------------------+---------------------------+
|2016|              4442617.08|                 4614246.95|
|2017|               9775279.8|                 7200423.35|
|2018|            1.49355264E7|              1.159353965E7|
|2019|           1.856766636E7|               3.53533183E7|
|2020|           1.856766636E7|              3.022217595E7|
+----+------------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id86">
<h2>5.5 Extensões ROLLUP, CUBE e GROUPING SETS<a class="headerlink" href="#id86" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Constrém vários níveis de agregação.</p>
<ul class="simple">
<li><p>ROLLUP: criação de subtotais para as combinações dos atributos da lista de agrupamento de acordo com a ordem desses atributos. São criados n+1 níveis de agregação, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
<li><p>CUBE: criação de subtotais para todas as combinações dos atributos da lista de agrupamento. São criados 2ˆn (2 elevado a n) níveis, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
<li><p>GROUPING SETS: criação de subtotais para quaisquer combinações de atributos de agrupamentos. É criada a quantidade de subtotais especificados na lista de níveis de agregação desejados.</p></li>
</ul>
<p><strong>Exemplo de consulta com ROLLUP:</strong> Liste as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY ROLLUP (clienteSetor, clienteCidade)</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com GROUPING SETS com semântica de ROLLUP:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY GROUPING SETS ((clienteSetor, clienteCidade), (clienteSetor), ())</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com CUBE:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY CUBE (clienteSetor, clienteCidade)</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|               null|BELO HORIZONTE|       4379523.85|
|               null|  CAMPO GRANDE|       3422117.05|
|               null|      CURITIBA|       3697625.35|
|               null|     FORTALEZA|       3391233.25|
|               null|        MANAUS|       5234539.25|
|               null|       MARILIA|        7289146.1|
|               null|  PORTO ALEGRE|        4319625.7|
|               null|        RECIFE|       4717719.45|
|               null|RIO DE JANEIRO|    1.525596265E7|
|               null|    SAO CARLOS|       4192741.95|
|               null|     SAO PAULO|    2.464599965E7|
|               null|    UBERLANDIA|        4357595.2|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com GROUPING SETS com semântica de CUBE:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor, clientecidade, ROUND(SUM(receita),2) AS `Total de Receitas`</span>
<span class="s2">FROM cliente JOIN negociacao ON cliente.clientePk = negociacao.clientePK</span>
<span class="s2">GROUP BY GROUPING SETS ((clienteSetor, clienteCidade), (clienteSetor), (clienteCidade), ())</span>
<span class="s2">HAVING SUM(receita) &gt; 3000000</span>
<span class="s2">ORDER BY clienteSetor, clienteCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|     8.89837042E7|
|               null|BELO HORIZONTE|       4379523.85|
|               null|  CAMPO GRANDE|       3422117.05|
|               null|      CURITIBA|       3697625.35|
|               null|     FORTALEZA|       3391233.25|
|               null|        MANAUS|       5234539.25|
|               null|       MARILIA|        7289146.1|
|               null|  PORTO ALEGRE|        4319625.7|
|               null|        RECIFE|       4717719.45|
|               null|RIO DE JANEIRO|    1.525596265E7|
|               null|    SAO CARLOS|       4192741.95|
|               null|     SAO PAULO|    2.464599965E7|
|               null|    UBERLANDIA|        4357595.2|
|BEBIDAS E ALIMENTOS|          null|     3.54087859E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|        3899358.3|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.95|
|BEBIDAS E ALIMENTOS|     SAO PAULO|        6177945.5|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.55|
|            CREDITO|          null|        6621387.7|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.25|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|      1.6568033E7|
|         TECNOLOGIA|     SAO PAULO|        9200352.8|
|          VESTUARIO|          null|    1.207288515E7|
|          VESTUARIO|RIO DE JANEIRO|        5948448.1|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id87">
<h1>6 Execução de Consultas com Foco na Tomada de Decisão<a class="headerlink" href="#id87" title="Permalink to this heading">#</a></h1>
<p>As consultas OLAP requisitadas por usuários de sistemas de suporte à decisão usualmente requerem que várias operações OLAP sejam realizadas simultaneamente. A seguir são ilustrados exemplos de consultas OLAP que podem ser requisitadas para a tomada de decisão estratégica.</p>
<section id="id88">
<h2>6.1 Consulta 1<a class="headerlink" href="#id88" title="Permalink to this heading">#</a></h2>
<p>Qual é a média dos salários recebidos por nível do cargo e por sexo no ano de 2019?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">cargo</span></code>, <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.cargoPK</span> <span class="pre">=</span> <span class="pre">cargo.cargoPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.funcPK</span> <span class="pre">=</span> <span class="pre">funcionario.funcPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula JOIN ... ON ...</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT cargoNivel, funcSexo, ROUND(AVG(salario),2) AS `Média dos Salários`</span>
<span class="s2">FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK</span>
<span class="s2">               JOIN cargo ON cargo.cargoPK = pagamento.cargoPK</span>
<span class="s2">               JOIN funcionario ON funcionario.funcPK = pagamento.funcPK </span>
<span class="s2">WHERE dataAno = 2019</span>
<span class="s2">GROUP BY cargoNivel, funcSexo</span>
<span class="s2">ORDER BY cargoNivel, funcSexo</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utilizando a cláusula WHERE</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT cargoNivel, funcSexo, ROUND(AVG(salario),2) AS `Média dos Salários`</span>
<span class="s2">FROM pagamento, cargo, funcionario, data</span>
<span class="s2">WHERE data.dataPK = pagamento.dataPK</span>
<span class="s2">      AND cargo.cargoPK = pagamento.cargoPK</span>
<span class="s2">      AND funcionario.funcPK = pagamento.funcPK</span>
<span class="s2">      AND dataAno = 2019</span>
<span class="s2">GROUP BY cargoNivel, funcSexo</span>
<span class="s2">ORDER BY cargoNivel, funcSexo</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id89">
<h2>6.2 Consulta 2<a class="headerlink" href="#id89" title="Permalink to this heading">#</a></h2>
<p>Qual o total de gastos em salários considerando os estados nos quais as equipes estão localizadas no trimestre 3 do ano de 2020?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipePK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT filialEstadoNome, ROUND(SUM(salario),2) AS Total</span>
<span class="s2">FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK </span>
<span class="s2">               JOIN equipe ON equipe.equipePK = pagamento.equipePK</span>
<span class="s2">WHERE dataAno = 2019</span>
<span class="s2">      AND dataTrimestre = 3</span>
<span class="s2">GROUP BY filialEstadoNome</span>
<span class="s2">ORDER BY Total </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+----------+
|  filialEstadoNome|     Total|
+------------------+----------+
|        PERNAMBUCO| 438121.26|
|MATO GROSSO DO SUL|1013857.74|
|    RIO DE JANEIRO|1258479.57|
|         SAO PAULO|1931458.02|
+------------------+----------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id90">
<h2>6.3 Consulta 3<a class="headerlink" href="#id90" title="Permalink to this heading">#</a></h2>
<p>Qual o custo/benefício das equipes quando analisado o semestre 1 do ano de 2020?</p>
<p>A idea da consulta é relacionar os gastos em salários e os ganhos em receitas considerando cada equipe e o período especificado. Portanto, para se realizar essa consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como das tabelas de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code> e <code class="docutils literal notranslate"><span class="pre">negociacao</span></code>.</p>
<p>A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
</ul>
<p>Uma observação muito importante refere-se ao fato que, para evitar dubiedade nas respostas, elas devem ser feitas sempre considerando a chave primária, desde que a chave primária identifica univocamente cada tupla. Depois de ser resolvida a consulta em termos da chave primária, então deve ser obtido os demais atributos a serem exibidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- obtendo os dados a serem exibidos na resposta</span>
<span class="s2">SELECT equipeNome, filialNome, ROUND(Lucro,2)</span>
<span class="s2">FROM equipe,</span>
<span class="s2">(</span>
<span class="s2">   SELECT pag.equipePK AS retornaEquipePK, (TotalReceita - TotalSalario) AS Lucro</span>
<span class="s2">   FROM ( </span>
<span class="s2">        -- investigando os gastos em salarios de cada equipe no último semestre deste ano </span>
<span class="s2">        SELECT equipePK, SUM(salario) AS TotalSalario</span>
<span class="s2">        FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK</span>
<span class="s2">        WHERE dataSemestre = 1 </span>
<span class="s2">              AND dataAno = 2020</span>
<span class="s2">        GROUP BY equipePK </span>
<span class="s2">        ORDER BY equipePK </span>
<span class="s2">        ) AS pag,  </span>
<span class="s2">        (</span>
<span class="s2">        -- investigando os ganhos em receitas de cada equipe no último semestre deste ano   </span>
<span class="s2">        SELECT equipePK, SUM(receita) AS TotalReceita</span>
<span class="s2">        FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">        WHERE dataSemestre = 1 </span>
<span class="s2">              AND dataAno = 2020</span>
<span class="s2">        GROUP BY equipePK </span>
<span class="s2">        ORDER BY equipePK</span>
<span class="s2">        ) AS neg</span>
<span class="s2">   WHERE pag.equipePK = neg.equipePK</span>
<span class="s2">   ) AS parte</span>
<span class="s2">WHERE equipe.equipePK = parte.retornaEquipePK</span>
<span class="s2">ORDER BY Lucro DESC</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+---------------+
|    equipeNome|          filialNome|round(Lucro, 2)|
+--------------+--------------------+---------------+
|BI &amp; ANALYTICS|SAO PAULO - AV. P...|     4054890.24|
|BI &amp; ANALYTICS|     RECIFE - CENTRO|     3788503.18|
| APP - DESKTOP|RIO DE JANEIRO - ...|      278013.26|
|  APP - MOBILE|SAO PAULO - AV. P...|      151160.49|
| APP - DESKTOP|SAO PAULO - AV. P...|       99579.85|
+--------------+--------------------+---------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id91">
<h1>7 Exercícios<a class="headerlink" href="#id91" title="Permalink to this heading">#</a></h1>
<section id="id92">
<h2>Exercício 1<a class="headerlink" href="#id92" title="Permalink to this heading">#</a></h2>
<p>Liste, para cada ano, a quantidade de negociações realizadas pelos clientes residentes no estado de Pernambuco.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno as `Ano`, CAST(SUM(quantidadeNegociacoes) AS INTEGER) AS `Soma Quantidade Negociacoes`</span>
<span class="s2">FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK </span>
<span class="s2">                JOIN cliente ON cliente.clientePK = negociacao.clientePK</span>
<span class="s2">WHERE clienteEstadoNome = &#39;PERNAMBUCO&#39; </span>
<span class="s2">GROUP BY dataAno</span>
<span class="s2">ORDER BY dataAno</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+---------------------------+
| Ano|Soma Quantidade Negociacoes|
+----+---------------------------+
|2016|                         26|
|2017|                         48|
|2018|                         46|
|2019|                         72|
|2020|                         63|
+----+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id93">
<h2>Exercício 2<a class="headerlink" href="#id93" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 1 usando um gráfico de barra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 

<span class="n">resposta</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">resposta</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Ano&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Soma Quantidade Negociacoes&#39;</span><span class="p">,</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/43f830e33790167dbe4936fc80266f97f28016a308415620156d2d45f97219f2.png" src="../_images/43f830e33790167dbe4936fc80266f97f28016a308415620156d2d45f97219f2.png" />
</div>
</div>
</section>
<section id="id94">
<h2>Exercício 3<a class="headerlink" href="#id94" title="Permalink to this heading">#</a></h2>
<p>Qual o total de despesas em salários nos anos de 2016 a 2020 em cada região na qual a equipe está localizada, considerando o cargo de nível junior? Arredonde a soma dos salários para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “REGIAO”, “TOTALDESPESA”. Ordene as linhas exibidas primeiro pelo total de despesa em ordem descendente, e depois pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno AS `ANO`, filialRegiaoNome AS `REGIAO`, ROUND(SUM(salario), 2) AS `TOTALDESPESA`</span>
<span class="s2">FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK </span>
<span class="s2">               JOIN cargo ON cargo.cargoPK = pagamento.cargoPK</span>
<span class="s2">               JOIN equipe ON equipe.equipePK = pagamento.equipePK</span>
<span class="s2">WHERE cargoNivel = &#39;JUNIOR&#39;</span>
<span class="s2">  AND dataAno &gt;= 2016</span>
<span class="s2">  AND dataAno &lt;= 2020 </span>
<span class="s2">GROUP BY dataAno, filialRegiaoNome</span>
<span class="s2">ORDER BY TOTALDESPESA DESC, dataAno DESC</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+------------+------------+
| ANO|      REGIAO|TOTALDESPESA|
+----+------------+------------+
|2020|     SUDESTE|  1257808.68|
|2019|     SUDESTE|  1257808.68|
|2018|     SUDESTE|  1056208.92|
|2017|     SUDESTE|   876154.56|
|2016|     SUDESTE|   489456.84|
|2020|CENTRO-OESTE|   337073.28|
|2019|CENTRO-OESTE|   337073.28|
|2018|CENTRO-OESTE|   337073.28|
|2020|    NORDESTE|    160832.4|
|2019|    NORDESTE|    160832.4|
|2017|CENTRO-OESTE|   154488.24|
+----+------------+------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id95">
<h2>Exercício 4<a class="headerlink" href="#id95" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 3 usando um diagrama de barras que permite a visualização dos resultados por região.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">resposta</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>

<span class="n">legend</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CENTRO-OESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;NORDESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;SUDESTE&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ANO&#39;</span><span class="p">,</span> <span class="s1">&#39;REGIAO&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6ca13f2ddcf2c6eafe362faac22e07d566f7c3103abd0a12757e414e7161f7ae.png" src="../_images/6ca13f2ddcf2c6eafe362faac22e07d566f7c3103abd0a12757e414e7161f7ae.png" />
</div>
</div>
</section>
<section id="id96">
<h2>Exercício 5<a class="headerlink" href="#id96" title="Permalink to this heading">#</a></h2>
<p>Liste o total dos salários e o total de receitas recebidas, considerando os anos de 2017, 2018 e 2019. Arredonde o total dos salários para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “TOTAL GASTO EM SALARIOS”, “TOTAL DE RECEITAS RECEBIDAS”. Ordene as linhas exibidas pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT tabSalario.ANO,</span>
<span class="s2">      `TOTAL GASTO EM SALARIOS`,</span>
<span class="s2">      `TOTAL DE RECEITAS RECEBIDAS`</span>
<span class="s2">FROM (</span>
<span class="s2">  SELECT dataAno AS `ANO`, ROUND(SUM(salario), 2) AS `TOTAL GASTO EM SALARIOS`</span>
<span class="s2">  FROM data JOIN pagamento ON data.dataPK = pagamento.dataPK</span>
<span class="s2">  WHERE dataAno BETWEEN 2017 AND 2019</span>
<span class="s2">  GROUP BY dataAno</span>
<span class="s2">) AS tabSalario</span>
<span class="s2">JOIN (</span>
<span class="s2">  SELECT dataAno AS `ANO`, ROUND(SUM(receita), 2) AS `TOTAL DE RECEITAS RECEBIDAS`</span>
<span class="s2">  FROM data JOIN negociacao ON data.dataPK = negociacao.dataPK</span>
<span class="s2">  WHERE dataAno BETWEEN 2017 AND 2019</span>
<span class="s2">  GROUP BY dataAno  </span>
<span class="s2">) AS tabReceita</span>
<span class="s2">ON tabSalario.ANO = tabReceita.ANO</span>
<span class="s2">ORDER BY tabSalario.ANO DESC</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+-----------------------+---------------------------+
| ANO|TOTAL GASTO EM SALARIOS|TOTAL DE RECEITAS RECEBIDAS|
+----+-----------------------+---------------------------+
|2019|          1.856766636E7|               3.53533183E7|
|2018|           1.49355264E7|              1.159353965E7|
|2017|              9775279.8|                 7200423.35|
+----+-----------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id97">
<h2>Exercício 6<a class="headerlink" href="#id97" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 5 usando um diagrama de barras.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">resposta</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">resposta</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ANO&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c77be4ef8f5f4ec2509e005f8b9d7f03db9dbd92b04e97650534ff8ff416dcd2.png" src="../_images/c77be4ef8f5f4ec2509e005f8b9d7f03db9dbd92b04e97650534ff8ff416dcd2.png" />
</div>
</div>
</section>
<section id="id98">
<h2>Exercício 7<a class="headerlink" href="#id98" title="Permalink to this heading">#</a></h2>
<p>Compare a quantidade de negociações que cada uma das equipes realizou nos anos de 2018 e 2019. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “NOME DA EQUIPE”, “NOME DA FILIAL”, “NEGOCIACOES 2018”, “NEGOCIACOES 2019”. Ordene as linhas exibidas pelo nome da equipe em ordem ascendente e depois pelo nome da filial em ordem ascendente. Liste as primeiras 25 linhas da resposta, sem truncamento das strings.</p>
<p>Dica: Considere relacionar as equipes por meio da operação drill-across.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT negociacoes2018.equipeNome AS `NOME DA EQUIPE`,</span>
<span class="s2">       negociacoes2018.filialNome AS `NOME DA FILIAL`,</span>
<span class="s2">       total2018 AS `NEGOCIACOES2018`,</span>
<span class="s2">       total2019 AS `NEGOCIACOES2019`</span>
<span class="s2">FROM ( SELECT negociacao.equipePK, equipeNome, filialNome, SUM(CAST(quantidadeNegociacoes AS INTEGER)) AS total2018</span>
<span class="s2">       FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">                       JOIN equipe ON equipe.equipePK = negociacao.equipePK</span>
<span class="s2">       WHERE dataAno = 2018</span>
<span class="s2">       GROUP BY negociacao.equipePK, equipeNome, filialNome</span>
<span class="s2">     ) AS negociacoes2018</span>
<span class="s2">     JOIN </span>
<span class="s2">     ( SELECT negociacao.equipePK, equipeNome, filialNome, SUM(CAST(quantidadeNegociacoes AS INTEGER)) AS total2019</span>
<span class="s2">       FROM negociacao JOIN data ON data.dataPK = negociacao.dataPK</span>
<span class="s2">                       JOIN equipe ON equipe.equipePK = negociacao.equipePK</span>
<span class="s2">       WHERE dataAno = 2019</span>
<span class="s2">       GROUP BY negociacao.equipePK, equipeNome, filialNome  </span>
<span class="s2">     ) AS negociacoes2019</span>
<span class="s2">     ON negociacoes2018.equipePK = negociacoes2019.equipePK</span>
<span class="s2">ORDER BY negociacoes2018.equipeNome, negociacoes2018.filialNome</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+---------------+---------------+
|NOME DA EQUIPE|      NOME DA FILIAL|NEGOCIACOES2018|NEGOCIACOES2019|
+--------------+--------------------+---------------+---------------+
| APP - DESKTOP|RIO DE JANEIRO - ...|            149|            135|
| APP - DESKTOP|SAO PAULO - AV. P...|            132|            135|
|  APP - MOBILE|CAMPO GRANDE - CE...|             98|             88|
|  APP - MOBILE|RIO DE JANEIRO - ...|             99|            112|
|  APP - MOBILE|SAO PAULO - AV. P...|            104|            108|
|           WEB|CAMPO GRANDE - CE...|            100|             95|
|           WEB|RIO DE JANEIRO - ...|             91|            106|
|           WEB|SAO PAULO - AV. P...|             76|             87|
+--------------+--------------------+---------------+---------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id99">
<h2>Exercício 8<a class="headerlink" href="#id99" title="Permalink to this heading">#</a></h2>
<p>Liste os setores dos clientes e a soma de suas respectivas receitas para o segundo semestre do ano de 2020. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “SETOR DO CLIENTE”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo total de receitas em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT clienteSetor AS `SETOR DO CLIENTE`,</span>
<span class="s2">       ROUND(SUM(receita),2) AS `TOTAL DE RECEITAS`</span>
<span class="s2">FROM negociacao JOIN data ON negociacao.dataPK = data.dataPK </span>
<span class="s2">                JOIN cliente ON negociacao.clientePK = cliente.clientePK</span>
<span class="s2">WHERE dataAno = 2020 </span>
<span class="s2">  AND dataSemestre = 2</span>
<span class="s2">GROUP BY clienteSetor</span>
<span class="s2">ORDER BY `TOTAL DE RECEITAS` DESC</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+-----------------+
|   SETOR DO CLIENTE|TOTAL DE RECEITAS|
+-------------------+-----------------+
|BEBIDAS E ALIMENTOS|        5749704.7|
|              SAUDE|        3119775.3|
|         TECNOLOGIA|       2465926.05|
|          VESTUARIO|        2336266.5|
|            CREDITO|         998789.6|
+-------------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id100">
<h2>Exercício 9<a class="headerlink" href="#id100" title="Permalink to this heading">#</a></h2>
<p>Analise a resposta do Exercício 8 para identificar qual o setor do cliente que obteve o maior total de receitas. Mostre o total de receitas por mês para esse setor do cliente, considerando o segundo semestre do ano de 2020. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “MES”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo total de receitas em ordem descendente e depois pelo mês em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataMes AS `MES` ,</span>
<span class="s2">       ROUND(SUM(receita),2) as `TOTAL DE RECEITAS`</span>
<span class="s2">FROM negociacao JOIN data ON negociacao.dataPK = data.dataPK</span>
<span class="s2">                JOIN cliente ON negociacao.clientePK = cliente.clientePK</span>
<span class="s2">WHERE dataAno = 2020 </span>
<span class="s2">  AND dataSemestre = 2 </span>
<span class="s2">  AND clienteSetor = &#39;BEBIDAS E ALIMENTOS&#39;</span>
<span class="s2">GROUP BY dataMes</span>
<span class="s2">ORDER BY `TOTAL DE RECEITAS` DESC, `MES` DESC</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---+-----------------+
|MES|TOTAL DE RECEITAS|
+---+-----------------+
| 11|        1156403.3|
| 10|        1091389.5|
| 12|         899122.7|
|  9|        877223.55|
|  8|         875934.3|
|  7|        849631.35|
+---+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id101">
<h2>Exercício 10<a class="headerlink" href="#id101" title="Permalink to this heading">#</a></h2>
<p>Analise a resposta do Exercício 9 para identificar qual mês gerou o maior total de receitas para o setor de cliente identificado no Exercício 8. Mostre o total de receitas das equipes, considerando o segundo semestre do ano de 2020, o setor de cliente identificado no Exercício 8 e o mês identificado no Exercício 9. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “NOME DA EQUIPE”, “NOME DA FILIAL”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo nome da equipe em ordem ascendente, e depois pelo nome da filial em ordem ascendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT equipeNome as `NOME DA EQUIPE`,</span>
<span class="s2">       filialNome as `NOME DA FILIAL`,</span>
<span class="s2">       ROUND(SUM(receita),2) as `TOTAL DE RECEITAS`</span>
<span class="s2">FROM negociacao JOIN data ON negociacao.dataPK = data.dataPK</span>
<span class="s2">                JOIN cliente ON negociacao.clientePK = cliente.clientePK</span>
<span class="s2">                JOIN equipe ON negociacao.equipePK = equipe.equipePK</span>
<span class="s2">WHERE dataAno = 2020 </span>
<span class="s2">  AND dataSemestre = 2 </span>
<span class="s2">  AND clienteSetor = &#39;BEBIDAS E ALIMENTOS&#39;</span>
<span class="s2">  AND dataMes = 11</span>
<span class="s2">GROUP BY equipeNome, filialNome</span>
<span class="s2">ORDER BY equipeNome, filialNome</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+-----------------+
|NOME DA EQUIPE|      NOME DA FILIAL|TOTAL DE RECEITAS|
+--------------+--------------------+-----------------+
| APP - DESKTOP|RIO DE JANEIRO - ...|         35645.65|
| APP - DESKTOP|SAO PAULO - AV. P...|         129409.4|
|  APP - MOBILE|CAMPO GRANDE - CE...|         48714.45|
|  APP - MOBILE|RIO DE JANEIRO - ...|          62138.7|
|  APP - MOBILE|SAO PAULO - AV. P...|         26571.85|
|BI &amp; ANALYTICS|     RECIFE - CENTRO|        527169.75|
|BI &amp; ANALYTICS|SAO PAULO - AV. P...|        149490.15|
|           WEB|CAMPO GRANDE - CE...|         20042.75|
|           WEB|RIO DE JANEIRO - ...|          68596.1|
|           WEB|SAO PAULO - AV. P...|          88624.5|
+--------------+--------------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id102">
<h2>Exercício 11<a class="headerlink" href="#id102" title="Permalink to this heading">#</a></h2>
<p>Liste todas as agregações que podem ser geradas a partir da média dos salários por ano por nome do estado da filial, considerando as equipes localizadas na região de nome SUDESTE. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “ESTADO DA FILIAL”, “MEDIA DE SALARIOS”. Ordene as linhas exibidas pelo estado da filial em ordem descendente, e depois pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dataAno AS ANO,</span>
<span class="s2">       filialEstadoNome AS `ESTADO DA FILIAL`,</span>
<span class="s2">       ROUND(AVG(salario), 2) AS `MEDIA DE SALARIOS`</span>
<span class="s2">FROM pagamento JOIN data ON data.dataPK = pagamento.dataPK</span>
<span class="s2">               JOIN equipe ON equipe.equipePK = pagamento.equipePK</span>
<span class="s2">               JOIN cargo ON cargo.cargoPK = pagamento.cargoPK</span>
<span class="s2">WHERE filialRegiaoNome = &quot;SUDESTE&quot;</span>
<span class="s2">GROUP BY CUBE (dataAno, filialEstadoNome)</span>
<span class="s2">ORDER BY `ESTADO DA FILIAL` DESC, ANO DESC </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+----------------+-----------------+
| ANO|ESTADO DA FILIAL|MEDIA DE SALARIOS|
+----+----------------+-----------------+
|2020|       SAO PAULO|          7948.39|
|2019|       SAO PAULO|          7948.39|
|2018|       SAO PAULO|          7986.58|
|2017|       SAO PAULO|           7639.4|
|2016|       SAO PAULO|          7735.52|
|null|       SAO PAULO|          7885.68|
|2020|  RIO DE JANEIRO|          7914.97|
|2019|  RIO DE JANEIRO|          7914.97|
|2018|  RIO DE JANEIRO|          7914.97|
|2017|  RIO DE JANEIRO|          7596.64|
|2016|  RIO DE JANEIRO|          7073.21|
|null|  RIO DE JANEIRO|          7767.22|
|2020|            null|          7935.17|
|2019|            null|          7935.17|
|2018|            null|          7953.29|
|2017|            null|          7621.71|
|2016|            null|          7404.36|
|null|            null|          7835.47|
+----+----------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="criando-uma-base-de-dados">
<h2>Criando uma Base de Dados<a class="headerlink" href="#criando-uma-base-de-dados" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1"># conectando base de dados</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conectando a base de dados&quot;</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conectando cursor&quot;</span><span class="p">)</span>
<span class="c1"># cursor de comandos</span>
<span class="n">crsr</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fechando Conexao&quot;</span><span class="p">)</span>
<span class="c1"># fechar conexao</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Conectando a base de dados
Conectando cursor
Fechando Conexao
</pre></div>
</div>
</div>
</div>
</section>
<section id="criando-tabela">
<h2>Criando tabela<a class="headerlink" href="#criando-tabela" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># conectando combase de dados</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="c1"># cursor de comandos</span>
<span class="n">crsr</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Comando SQL para criar tabela</span>
<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE funcionario (</span>
<span class="s2">  id INTEGER PRIMARY KEY,</span>
<span class="s2">  nome VARCHAR(120),</span>
<span class="s2">  genero CHAR(1),</span>
<span class="s2">  data_nascimento DATE,</span>
<span class="s2">  salario REAL</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Executar comando</span>
<span class="n">crsr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>

<span class="c1"># Fechar conexao</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inserindo-dados">
<h2>Inserindo Dados<a class="headerlink" href="#inserindo-dados" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># conectando combase de dados</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="c1"># cursor de comandos</span>
<span class="n">crsr</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Comando SQL para inserir dados</span>
<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">INSERT INTO funcionario VALUES (1111, &quot;Maria Eduarda&quot;, &quot;F&quot;, &quot;1991-03-02&quot;, 5000.00);</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">crsr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>

<span class="c1"># Adicionar dados na base</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Fechar conexao</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="consultando-tabela">
<h2>Consultando Tabela<a class="headerlink" href="#consultando-tabela" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="c1"># conectando combase de dados</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="c1"># cursor de comandos</span>
<span class="n">crsr</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT * from funcionario</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Executar comando</span>
<span class="n">crsr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>

<span class="c1"># salva retorno do comando</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">crsr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c1"># Fechar conexao</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1111, &#39;Maria Eduarda&#39;, &#39;F&#39;, &#39;1991-03-02&#39;, 5000.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># using pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Create your connection.</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT * from funcionario</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">sql_command</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-6135ca93-377d-46e0-a5a5-9ff39014b3d2" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>nome</th>
      <th>genero</th>
      <th>data_nascimento</th>
      <th>salario</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1111</td>
      <td>Maria Eduarda</td>
      <td>F</td>
      <td>1991-03-02</td>
      <td>5000.0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-6135ca93-377d-46e0-a5a5-9ff39014b3d2')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-6135ca93-377d-46e0-a5a5-9ff39014b3d2 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-6135ca93-377d-46e0-a5a5-9ff39014b3d2');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&quot;</span>
<span class="n">df_funcionario</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">df_funcionario</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-0ea54b14-3cc9-4eb0-bad8-4e3d2a97e832" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>funcPK</th>
      <th>funcMatricula</th>
      <th>funcNome</th>
      <th>funcSexo</th>
      <th>funcDataNascimento</th>
      <th>funcDiaNascimento</th>
      <th>funcMesNascimento</th>
      <th>funcAnoNascimento</th>
      <th>funcCidade</th>
      <th>funcEstadoNome</th>
      <th>funcEstadoSigla</th>
      <th>funcRegiaoNome</th>
      <th>funcRegiaoSigla</th>
      <th>funcPaisNome</th>
      <th>funcPaisSigla</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>M-1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1/1/1990</td>
      <td>1</td>
      <td>1</td>
      <td>1990</td>
      <td>SAO PAULO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>M-2</td>
      <td>ARAO ALVES</td>
      <td>M</td>
      <td>2/2/1990</td>
      <td>2</td>
      <td>2</td>
      <td>1990</td>
      <td>CAMPINAS</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>M-3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>3/3/1990</td>
      <td>3</td>
      <td>3</td>
      <td>1990</td>
      <td>SANTOS</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>M-4</td>
      <td>ADA BARBOSA</td>
      <td>F</td>
      <td>4/4/1990</td>
      <td>4</td>
      <td>4</td>
      <td>1990</td>
      <td>SANTO ANDRE</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>M-5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>5/5/1990</td>
      <td>5</td>
      <td>5</td>
      <td>1990</td>
      <td>PIRACICABA</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>195</th>
      <td>196</td>
      <td>M-196</td>
      <td>ABNOAN FERNANDES</td>
      <td>F</td>
      <td>15/4/1974</td>
      <td>15</td>
      <td>4</td>
      <td>1974</td>
      <td>RIBEIRAO PRETO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>196</th>
      <td>197</td>
      <td>M-197</td>
      <td>ADNAEL FERREIRA</td>
      <td>M</td>
      <td>16/5/1975</td>
      <td>16</td>
      <td>5</td>
      <td>1975</td>
      <td>ILHA BELA</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>197</th>
      <td>198</td>
      <td>M-198</td>
      <td>ADRA GARCIA</td>
      <td>M</td>
      <td>17/6/1976</td>
      <td>17</td>
      <td>6</td>
      <td>1976</td>
      <td>SAO JOSE DO RIO PRETO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>198</th>
      <td>199</td>
      <td>M-199</td>
      <td>ABRAHAM GOMES</td>
      <td>M</td>
      <td>18/7/1977</td>
      <td>18</td>
      <td>7</td>
      <td>1977</td>
      <td>OSASCO</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
    <tr>
      <th>199</th>
      <td>200</td>
      <td>M-200</td>
      <td>ABRAAO LIMA</td>
      <td>M</td>
      <td>19/8/1978</td>
      <td>19</td>
      <td>8</td>
      <td>1978</td>
      <td>ARARAQUARA</td>
      <td>SAO PAULO</td>
      <td>SP</td>
      <td>SUDESTE</td>
      <td>SE</td>
      <td>BRASIL</td>
      <td>BR</td>
    </tr>
  </tbody>
</table>
<p>200 rows × 15 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-0ea54b14-3cc9-4eb0-bad8-4e3d2a97e832')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-0ea54b14-3cc9-4eb0-bad8-4e3d2a97e832 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-0ea54b14-3cc9-4eb0-bad8-4e3d2a97e832');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-dd546f2a-6b28-450c-8156-c3d807d6d2cf">
  <button class="colab-df-quickchart" onclick="quickchart('df-dd546f2a-6b28-450c-8156-c3d807d6d2cf')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-dd546f2a-6b28-450c-8156-c3d807d6d2cf button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># conectando combase de dados</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="c1"># cursor de comandos</span>
<span class="n">crsr</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Comando SQL para inserir dados</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_funcionario</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
  <span class="n">funcPK</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">]</span>
  <span class="n">funcNome</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;funcNome&quot;</span><span class="p">]</span>
  <span class="n">funcSexo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;funcSexo&quot;</span><span class="p">]</span>
  <span class="n">funcDataNascimento</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;funcAnoNascimento&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;funcMesNascimento&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;funcDiaNascimento&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">salario</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">)</span>

  <span class="n">sql_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  INSERT INTO funcionario VALUES (</span><span class="si">{</span><span class="n">funcPK</span><span class="si">}</span><span class="s2">, &quot;</span><span class="si">{</span><span class="n">funcNome</span><span class="si">}</span><span class="s2">&quot;, &quot;</span><span class="si">{</span><span class="n">funcSexo</span><span class="si">}</span><span class="s2">&quot;, &quot;</span><span class="si">{</span><span class="n">funcDataNascimento</span><span class="si">}</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">salario</span><span class="si">}</span><span class="s2">);</span>
<span class="s2">  &quot;&quot;&quot;</span>
  <span class="n">crsr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>

<span class="c1"># Adicionar dados na base</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Fechar conexao</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create your connection.</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT * from funcionario</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">sql_command</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-a1d56701-67af-4974-85af-d8914fad5ad8" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>nome</th>
      <th>genero</th>
      <th>data_nascimento</th>
      <th>salario</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>ALINE ALMEIDA</td>
      <td>F</td>
      <td>1990/1/1</td>
      <td>10552.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ARAO ALVES</td>
      <td>M</td>
      <td>1990/2/2</td>
      <td>5796.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>1990/3/3</td>
      <td>3685.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ADA BARBOSA</td>
      <td>F</td>
      <td>1990/4/4</td>
      <td>11984.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>1990/5/5</td>
      <td>15565.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>196</th>
      <td>197</td>
      <td>ADNAEL FERREIRA</td>
      <td>M</td>
      <td>1975/5/16</td>
      <td>13554.0</td>
    </tr>
    <tr>
      <th>197</th>
      <td>198</td>
      <td>ADRA GARCIA</td>
      <td>M</td>
      <td>1976/6/17</td>
      <td>4166.0</td>
    </tr>
    <tr>
      <th>198</th>
      <td>199</td>
      <td>ABRAHAM GOMES</td>
      <td>M</td>
      <td>1977/7/18</td>
      <td>10636.0</td>
    </tr>
    <tr>
      <th>199</th>
      <td>200</td>
      <td>ABRAAO LIMA</td>
      <td>M</td>
      <td>1978/8/19</td>
      <td>19911.0</td>
    </tr>
    <tr>
      <th>200</th>
      <td>1111</td>
      <td>Maria Eduarda</td>
      <td>F</td>
      <td>1991-03-02</td>
      <td>5000.0</td>
    </tr>
  </tbody>
</table>
<p>201 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-a1d56701-67af-4974-85af-d8914fad5ad8')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-a1d56701-67af-4974-85af-d8914fad5ad8 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-a1d56701-67af-4974-85af-d8914fad5ad8');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-72963f18-ab84-41e8-bd2c-26df29e445b3">
  <button class="colab-df-quickchart" onclick="quickchart('df-72963f18-ab84-41e8-bd2c-26df29e445b3')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-72963f18-ab84-41e8-bd2c-26df29e445b3 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div></div>
</div>
</section>
<section id="update-tabela">
<h2>Update Tabela<a class="headerlink" href="#update-tabela" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>


<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT * from funcionario</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># Updating</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">UPDATE funcionario SET nome = &quot;Marco Antonio&quot; WHERE id=1;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create your connection.</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT * from funcionario</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">sql_command</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-ca8b76fd-6edd-40ee-98c6-eab0106d77d9" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>nome</th>
      <th>genero</th>
      <th>data_nascimento</th>
      <th>salario</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Marco Antonio</td>
      <td>F</td>
      <td>1990/1/1</td>
      <td>10552.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ARAO ALVES</td>
      <td>M</td>
      <td>1990/2/2</td>
      <td>5796.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>1990/3/3</td>
      <td>3685.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>ADA BARBOSA</td>
      <td>F</td>
      <td>1990/4/4</td>
      <td>11984.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>1990/5/5</td>
      <td>15565.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>196</th>
      <td>197</td>
      <td>ADNAEL FERREIRA</td>
      <td>M</td>
      <td>1975/5/16</td>
      <td>13554.0</td>
    </tr>
    <tr>
      <th>197</th>
      <td>198</td>
      <td>ADRA GARCIA</td>
      <td>M</td>
      <td>1976/6/17</td>
      <td>4166.0</td>
    </tr>
    <tr>
      <th>198</th>
      <td>199</td>
      <td>ABRAHAM GOMES</td>
      <td>M</td>
      <td>1977/7/18</td>
      <td>10636.0</td>
    </tr>
    <tr>
      <th>199</th>
      <td>200</td>
      <td>ABRAAO LIMA</td>
      <td>M</td>
      <td>1978/8/19</td>
      <td>19911.0</td>
    </tr>
    <tr>
      <th>200</th>
      <td>1111</td>
      <td>Maria Eduarda</td>
      <td>F</td>
      <td>1991-03-02</td>
      <td>5000.0</td>
    </tr>
  </tbody>
</table>
<p>201 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-ca8b76fd-6edd-40ee-98c6-eab0106d77d9')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-ca8b76fd-6edd-40ee-98c6-eab0106d77d9 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-ca8b76fd-6edd-40ee-98c6-eab0106d77d9');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-ef94acef-3319-4e72-bf44-02e24d8057ab">
  <button class="colab-df-quickchart" onclick="quickchart('df-ef94acef-3319-4e72-bf44-02e24d8057ab')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-ef94acef-3319-4e72-bf44-02e24d8057ab button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div></div>
</div>
</section>
<section id="delete-linha">
<h2>Delete linha<a class="headerlink" href="#delete-linha" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;gfg.db&#39;</span><span class="p">)</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Updating</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DELETE FROM funcionario WHERE nome=&quot;Marco Antonio&quot;;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create your connection.</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT * from funcionario</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">sql_command</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>

<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">df_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-8d4c3ffe-2c3e-43e2-9fb7-836e0d08f2d4" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>nome</th>
      <th>genero</th>
      <th>data_nascimento</th>
      <th>salario</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>ARAO ALVES</td>
      <td>M</td>
      <td>1990/2/2</td>
      <td>5796.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>ARON ANDRADE</td>
      <td>M</td>
      <td>1990/3/3</td>
      <td>3685.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>ADA BARBOSA</td>
      <td>F</td>
      <td>1990/4/4</td>
      <td>11984.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>ABADE BATISTA</td>
      <td>M</td>
      <td>1990/5/5</td>
      <td>15565.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6</td>
      <td>ABADI BARROS</td>
      <td>M</td>
      <td>1990/6/6</td>
      <td>12124.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>195</th>
      <td>197</td>
      <td>ADNAEL FERREIRA</td>
      <td>M</td>
      <td>1975/5/16</td>
      <td>13554.0</td>
    </tr>
    <tr>
      <th>196</th>
      <td>198</td>
      <td>ADRA GARCIA</td>
      <td>M</td>
      <td>1976/6/17</td>
      <td>4166.0</td>
    </tr>
    <tr>
      <th>197</th>
      <td>199</td>
      <td>ABRAHAM GOMES</td>
      <td>M</td>
      <td>1977/7/18</td>
      <td>10636.0</td>
    </tr>
    <tr>
      <th>198</th>
      <td>200</td>
      <td>ABRAAO LIMA</td>
      <td>M</td>
      <td>1978/8/19</td>
      <td>19911.0</td>
    </tr>
    <tr>
      <th>199</th>
      <td>1111</td>
      <td>Maria Eduarda</td>
      <td>F</td>
      <td>1991-03-02</td>
      <td>5000.0</td>
    </tr>
  </tbody>
</table>
<p>200 rows × 5 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-8d4c3ffe-2c3e-43e2-9fb7-836e0d08f2d4')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-8d4c3ffe-2c3e-43e2-9fb7-836e0d08f2d4 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-8d4c3ffe-2c3e-43e2-9fb7-836e0d08f2d4');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-621efffc-70ef-4138-a4b5-d5cf80585896">
  <button class="colab-df-quickchart" onclick="quickchart('df-621efffc-70ef-4138-a4b5-d5cf80585896')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-621efffc-70ef-4138-a4b5-d5cf80585896 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div></div>
</div>
</section>
<section id="deletar-tabela">
<h2>Deletar Tabela<a class="headerlink" href="#deletar-tabela" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># conectando combase de dados</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;gfg.db&quot;</span><span class="p">)</span>

<span class="c1"># cursor de comandos</span>
<span class="n">crsr</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Comando SQL para criar tabela</span>
<span class="n">sql_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">DROP TABLE IF EXISTS funcionario</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Executar comando</span>
<span class="n">crsr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_command</span><span class="p">)</span>

<span class="c1"># Fechar conexao</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-08-explorando-o-modulo-pyspark-sql-span">
<h1><span style="color:blue">Aula 08: Explorando o Módulo pyspark.sql</span><a class="headerlink" href="#span-style-color-blue-aula-08-explorando-o-modulo-pyspark-sql-span" title="Permalink to this heading">#</a></h1>
<section id="span-style-color-blue-metodos-de-interesse-e-consultas-olap-span">
<h2><span style="color:blue">Métodos de Interesse e Consultas OLAP</span><a class="headerlink" href="#span-style-color-blue-metodos-de-interesse-e-consultas-olap-span" title="Permalink to this heading">#</a></h2>
<p><strong>IMPORTANTE: O uso do <em>framework</em> Spark requer diversas configurações no ambiente de desenvolvimento para executar o <em>notebook</em>. Dado que tal complexidade foge do escopo de nossa disciplina, recomenda-se que o <em>notebook</em> seja executado na plataforma de desenvolvimento COLAB. O uso do COLAB  proporciona um ambiente de desenvolvimento pré-configurado e remove a complexidade de instalação e configuração de pacotes e <em>frameworks</em> que são utilizados na disciplina.</strong></p>
<p>#1 Constelação de Fatos da BI Solutions</p>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma contelação de fatos, conforme descrita a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamentos)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacoes)</p></li>
</ul>
<p>#2 Obtenção dos Dados da BI Solutions</p>
</section>
<section id="id103">
<h2>2.1 Baixando o Módulo wget<a class="headerlink" href="#id103" title="Permalink to this heading">#</a></h2>
<p>Para baixar os dados referentes ao esquema relacional da constelação de fatos da BI Solutions, é utilizado o módulo  <strong>wget</strong>. O comando a seguir realiza a instalação desse módulo. <br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando o módulo wget
%%capture
!pip install -q wget
!mkdir data
</pre></div>
</div>
</div>
</div>
</section>
<section id="id104">
<h2>2.2 Obtenção dos Dados das Tabelas de Dimensão<a class="headerlink" href="#id104" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de dimensão.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de dimensão</span>
<span class="kn">import</span> <span class="nn">wget</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/data.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/cliente.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="id105">
<h2>2.3 Obtenção dos Dados Tabelas de Fatos<a class="headerlink" href="#id105" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de fatos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de fatos</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/negociacao.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id106">
<h1>3 Apache Spark Cluster<a class="headerlink" href="#id106" title="Permalink to this heading">#</a></h1>
<section id="id107">
<h2>3.1 Instalação<a class="headerlink" href="#id107" title="Permalink to this heading">#</a></h2>
<p>Neste <em>notebook</em> é criado um <em>cluster</em> Spark composto apenas por um <strong>nó mestre</strong>. Ou seja, o <em>cluster</em> não possui um ou mais <strong>nós de trabalho</strong> e o <strong>gerenciador de cluster</strong>. Nessa configuração, as tarefas (<em>tasks</em>) são realizadas no próprio <em>driver</em> localizado no <strong>nó mestre</strong>.</p>
<p>Para que o cluster possa ser criado, primeiramente é instalado o Java Runtime Environment (JRE) versão 8.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando Java Runtime Environment (JRE) versão 8
%%capture
!apt-get remove openjdk*
!apt-get update --fix-missing
!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<p>Na sequência, é feito o <em>download</em> do Apache Spark versão 3.0.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#baixando Apache Spark versão 3.0.0
%%capture
!wget -q https://archive.apache.org/dist/spark/spark-3.0.0/spark-3.0.0-bin-hadoop2.7.tgz
!tar xf spark-3.0.0-bin-hadoop2.7.tgz &amp;&amp; rm spark-3.0.0-bin-hadoop2.7.tgz
</pre></div>
</div>
</div>
</div>
<p>Na sequência, são configuradas as variáveis de ambiente JAVA_HOME e SPARK_HOME. Isto permite que tanto o Java quanto o Spark possam ser encontrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#configurando a variável de ambiente JAVA_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="c1">#configurando a variável de ambiente SPARK_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.0.0-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, são instalados dois pacotes da linguagem de programação Python, cujas funcionalidades são descritas a seguir.</p>
<blockquote>
<div><p><strong>Pacote findspark:</strong> Usado para ler a variável de ambiente SPARK_HOME e armazenar seu valor na variável dinâmica de ambiente PYTHONPATH. Como resultado, Python pode encontrar a instalação do Spark.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Pacote pyspark:</strong> PySpark é a API do Python para Spark. Ela possibilita o uso de Python, considerando que o <em>framework</em> Apache Spark encontra-se desenvolvido na linguagem de programação Scala.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
#instalando o pacote findspark
!pip install -q findspark==1.4.2
#instalando o pacote pyspark
!pip install -q pyspark==3.0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="id108">
<h2>3.2 Conexão<a class="headerlink" href="#id108" title="Permalink to this heading">#</a></h2>
<p>PySpark não é adicionado ao <em>sys.path</em> por padrão. Isso significa que não é possível importá-lo, pois o interpretador da linguagem Python não sabe onde encontrá-lo.</p>
<p>Para resolver esse aspecto, é necessário instalar o módulo <code class="docutils literal notranslate"><span class="pre">findspark</span></code>. Esse módulo mostra onde PySpark está localizado. Os comandos a seguir têm essa finalidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#importando o módulo findspark</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="c1">#carregando a variávels SPARK_HOME na variável dinâmica PYTHONPATH</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Depois de configurados os pacotes e módulos e inicializadas as variáveis de ambiente, é possível iniciar o uso do Spark na aplicação de <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">warehousing</span></code>. Para tanto, é necessário importar o comando <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code> do módulo <code class="docutils literal notranslate"><span class="pre">pyspark.sql</span></code>. São utilizados os seguintes conceitos: <br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SparkSession</span></code>: permite a criação de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, as tabelas relacionais podem ser manipuladas por meio de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> e é possível realizar consultas OLAP por meio de comandos SQL. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">builder</span></code>: cria uma instância de SparkSession. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">appName</span></code>: define um nome para a aplicação, o qual pode ser visto na interface de usuário web do Spark. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master</span></code>: define onde está o nó mestre do <em>cluster</em>. Como a aplicação é executada localmente e não em um <em>cluster</em>, indica-se isso pela <em>string</em> <code class="docutils literal notranslate"><span class="pre">local</span></code> seguida do parâmetro <code class="docutils literal notranslate"><span class="pre">[*]</span></code>. Ou seja, define-se que apenas núcleos locais são utilizados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getOrCreate</span></code>: cria uma SparkSession. Caso ela já exista, retorna a instância existente.</p></li>
</ul>
<p><strong>Observação</strong>: A lista completa de todos os parâmetros que podem ser utilizados na inicialização do <em>cluster</em> pode ser encontrada neste <a class="reference external" href="https://spark.apache.org/docs/latest/spark-standalone.html#cluster-launch-scripts">link</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;pyspark-notebook&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="geracao-dos-dataframes-da-bi-solutions">
<h1>4 Geração dos DataFrames da BI Solutions<a class="headerlink" href="#geracao-dos-dataframes-da-bi-solutions" title="Permalink to this heading">#</a></h1>
<p>Um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> em Spark é equivalente a uma tabela relacional. Portanto, um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> possui um esquema, uma ou mais linhas (ou tuplas) e uma ou mais colunas (ou atributos).</p>
<section id="metodos-para-leitura-e-escrita">
<h2>4.1 Métodos para Leitura e Escrita<a class="headerlink" href="#metodos-para-leitura-e-escrita" title="Permalink to this heading">#</a></h2>
<section id="metodo-spark-read-csv">
<h3>Método spark.read.csv()<a class="headerlink" href="#metodo-spark-read-csv" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">spark.read.csv()</span></code></p>
<p>Realiza a leitura dos dados de um arquivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code> e armazena esses dados em um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Alguns parâmetros do método são:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: indica o endereço do arquivo que é lido.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code>: indica se o arquivo possui um cabeçalho.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code>: especifica o caractere que separa os campos do arquivo.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inferSchema</span></code>: infere o tipo de dados de cada atributo automaticamente a partir dos dados do arquivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code>. Para que isto seja possível, existe a necessidade de se ler os dados mais uma vez. Se esse parâmetro não for especificado, seu valor padrão é <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
</ul>
<p>Entretanto, vários parâmetros podem ser especificados. Uma lista completa desses parâmetros pode ser encontrada neste <a class="reference external" href="https://docs.databricks.com/data/data-sources/read-csv.html">link</a>.</p>
</section>
<section id="metodo-show">
<h3>Método show()<a class="headerlink" href="#metodo-show" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">show(number=20,</span> <span class="pre">truncate=True,</span> <span class="pre">vertical=False)</span></code></p>
<p>Mostra o conteúdo do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Caso o parâmetro <code class="docutils literal notranslate"><span class="pre">number</span></code> seja especificado, é mostrado o número de linhas especificado. Caso contrário, são exibidas as 20 primeiras linhas.  O parâmetro <code class="docutils literal notranslate"><span class="pre">truncate</span></code> indica que  <em>strings</em> com tamanho maior do que 20 caracteres são truncadas. O último parâmetro, <code class="docutils literal notranslate"><span class="pre">vertical</span></code>, indica que a saída é composta por um conjunto de linhas divididas em colunas (forma de uma tabela). Caso seja especificado <code class="docutils literal notranslate"><span class="pre">vertical=True</span></code>, cada coluna de cada linha é exibida em uma linha diferente.</p>
</section>
<section id="metodo-printschema">
<h3>Método printSchema()<a class="headerlink" href="#metodo-printschema" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">printSchema()</span></code></p>
<p>Mostra o esquema do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> no formato de uma árvore. São exibidos os nomes das colunas e os tipos de dados dessas colunas. <code class="docutils literal notranslate"><span class="pre">nullable</span> <span class="pre">=</span> <span class="pre">true</span></code> indica que o valor nulo é usado para indicar valores que não são conhecidos ou que são foram preenchidos quando o arquivo foi lido em um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
</section>
<section id="metodo-write-csv">
<h3>Método write.csv()<a class="headerlink" href="#metodo-write-csv" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">write.csv()</span></code></p>
<p>Realiza a escrita dos dados de um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> em um arquivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code>. Podem ser definidos vários parâmetros, como <code class="docutils literal notranslate"><span class="pre">path</span></code> para indicar o endereço do arquivo que é escrito, <code class="docutils literal notranslate"><span class="pre">header</span></code> para armazenar os nomes das colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> como um cabeçalho do arquivo e <code class="docutils literal notranslate"><span class="pre">sep</span></code> para especificar o caractere que separa os campos do arquivo. Uma lista completa desses parâmetros pode ser encontrada neste <a class="reference external" href="https://docs.databricks.com/data/data-sources/read-csv.html">link</a>.</p>
</section>
</section>
<section id="criacao-dos-dataframes">
<h2>4.2 Criação dos DataFrames<a class="headerlink" href="#criacao-dos-dataframes" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cargo</span>
<span class="n">cargo</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|cargoPK|           cargoNome|cargoRegimeTrabalho|cargoJornadaTrabalho|cargoEscolaridadeMinima|cargoNivel|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|      1|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                  MEDIO|    JUNIOR|
|      2|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|               SUPERIOR|     PLENO|
|      3|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                    POS|    SENIOR|
|      4|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|                  MEDIO|    JUNIOR|
|      5|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|               SUPERIOR|     PLENO|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
only showing top 5 rows

root
 |-- cargoPK: string (nullable = true)
 |-- cargoNome: string (nullable = true)
 |-- cargoRegimeTrabalho: string (nullable = true)
 |-- cargoJornadaTrabalho: string (nullable = true)
 |-- cargoEscolaridadeMinima: string (nullable = true)
 |-- cargoNivel: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cliente</span>
<span class="n">cliente</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|clientePK|clienteNomeFantasia|       clienteSetor|clienteCidade|clienteEstadoNome|clienteEstadoSigla|clienteRegiaoNome|clienteRegiaoSigla|clientePaisNome|clientePaisSigla|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|        1|           VIA FOOD|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        2|          VIA PIZZA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        3|           VIA JAPA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        4|            VIA VEG|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        5|          VIA DRINK|BEBIDAS E ALIMENTOS|   SAO CARLOS|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
only showing top 5 rows

root
 |-- clientePK: string (nullable = true)
 |-- clienteNomeFantasia: string (nullable = true)
 |-- clienteSetor: string (nullable = true)
 |-- clienteCidade: string (nullable = true)
 |-- clienteEstadoNome: string (nullable = true)
 |-- clienteEstadoSigla: string (nullable = true)
 |-- clienteRegiaoNome: string (nullable = true)
 |-- clienteRegiaoSigla: string (nullable = true)
 |-- clientePaisNome: string (nullable = true)
 |-- clientePaisSigla: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/data.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> 
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+------------+-------+-------+------------+-------------+------------+-------+
|dataPK|dataCompleta|dataDia|dataMes|dataBimestre|dataTrimestre|dataSemestre|dataAno|
+------+------------+-------+-------+------------+-------------+------------+-------+
|     1|    1/1/2016|      1|      1|           1|            1|           1|   2016|
|     2|    2/1/2016|      2|      1|           1|            1|           1|   2016|
|     3|    3/1/2016|      3|      1|           1|            1|           1|   2016|
|     4|    4/1/2016|      4|      1|           1|            1|           1|   2016|
|     5|    5/1/2016|      5|      1|           1|            1|           1|   2016|
+------+------------+-------+-------+------------+-------------+------------+-------+
only showing top 5 rows

root
 |-- dataPK: string (nullable = true)
 |-- dataCompleta: string (nullable = true)
 |-- dataDia: string (nullable = true)
 |-- dataMes: string (nullable = true)
 |-- dataBimestre: string (nullable = true)
 |-- dataTrimestre: string (nullable = true)
 |-- dataSemestre: string (nullable = true)
 |-- dataAno: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão equipe</span>
<span class="n">equipe</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|equipePK|   equipeNome|          filialNome|  filialCidade|  filialEstadoNome|filialEstadoSigla|filialRegiaoNome|filialRegiaoSigla|filialPaisNome|filialPaisSigla|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|       1|APP - DESKTOP|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       2|APP - DESKTOP|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       3|          WEB|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       4|          WEB|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       5|          WEB|CAMPO GRANDE - CE...|  CAMPO GRANDE|MATO GROSSO DO SUL|               MS|    CENTRO-OESTE|               CO|        BRASIL|             BR|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
only showing top 5 rows

root
 |-- equipePK: string (nullable = true)
 |-- equipeNome: string (nullable = true)
 |-- filialNome: string (nullable = true)
 |-- filialCidade: string (nullable = true)
 |-- filialEstadoNome: string (nullable = true)
 |-- filialEstadoSigla: string (nullable = true)
 |-- filialRegiaoNome: string (nullable = true)
 |-- filialRegiaoSigla: string (nullable = true)
 |-- filialPaisNome: string (nullable = true)
 |-- filialPaisSigla: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos funcionario</span>
<span class="n">funcionario</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 5 rows

root
 |-- funcPK: string (nullable = true)
 |-- funcMatricula: string (nullable = true)
 |-- funcNome: string (nullable = true)
 |-- funcSexo: string (nullable = true)
 |-- funcDataNascimento: string (nullable = true)
 |-- funcDiaNascimento: string (nullable = true)
 |-- funcMesNascimento: string (nullable = true)
 |-- funcAnoNascimento: string (nullable = true)
 |-- funcCidade: string (nullable = true)
 |-- funcEstadoNome: string (nullable = true)
 |-- funcEstadoSigla: string (nullable = true)
 |-- funcRegiaoNome: string (nullable = true)
 |-- funcRegiaoSigla: string (nullable = true)
 |-- funcPaisNome: string (nullable = true)
 |-- funcPaisSigla: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos negociacao</span>
<span class="n">negociacao</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+---------+------+--------+---------------------+
|equipePK|clientePK|dataPK| receita|quantidadeNegociacoes|
+--------+---------+------+--------+---------------------+
|       2|        9|    22|11564.75|                    1|
|       2|       24|    11| 17990.5|                    1|
|       2|       28|    21| 16335.9|                    1|
|       1|       30|    23| 8495.55|                    1|
|       2|       43|    30|24748.75|                    1|
+--------+---------+------+--------+---------------------+
only showing top 5 rows

root
 |-- equipePK: string (nullable = true)
 |-- clientePK: string (nullable = true)
 |-- dataPK: string (nullable = true)
 |-- receita: string (nullable = true)
 |-- quantidadeNegociacoes: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos pagamento</span>
<span class="n">pagamento</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+--------+---------------------+
|funcPK|equipePK|dataPK|cargoPK| salario|quantidadeLancamentos|
+------+--------+------+-------+--------+---------------------+
|   147|       2|     5|     64| 1559.94|                    1|
|   124|       2|     5|    329| 8102.77|                    1|
|   175|       1|     5|    328| 2532.51|                    1|
|   171|       1|     5|    245|  7882.7|                    1|
|   148|       2|     5|     65| 4404.59|                    1|
|     5|       2|     5|    112| 2226.66|                    1|
|   128|       1|     5|    341| 6157.04|                    1|
|    82|       2|     5|     43| 1585.51|                    1|
|    28|       1|     5|    253| 1594.02|                    1|
|    46|       1|     5|    390| 9880.16|                    1|
|    91|       2|     5|    233|10931.47|                    1|
|   176|       2|     5|    241| 2005.49|                    1|
|   172|       1|     5|    351|14218.28|                    1|
|   155|       1|     5|    121| 2002.57|                    1|
|    19|       2|     5|    223| 1778.26|                    1|
|    94|       1|     5|    394|  2505.1|                    1|
|    26|       2|     5|    350| 9162.46|                    1|
|    55|       2|     5|    313| 3215.53|                    1|
|    29|       1|     5|     62| 4128.44|                    1|
|   181|       1|     5|    249|11082.75|                    1|
+------+--------+------+-------+--------+---------------------+
only showing top 20 rows

root
 |-- funcPK: string (nullable = true)
 |-- equipePK: string (nullable = true)
 |-- dataPK: string (nullable = true)
 |-- cargoPK: string (nullable = true)
 |-- salario: string (nullable = true)
 |-- quantidadeLancamentos: string (nullable = true)
</pre></div>
</div>
</div>
</div>
</section>
<section id="manipulacao-da-tipagem-dos-dados">
<h2>4.3 Manipulação da Tipagem dos Dados<a class="headerlink" href="#manipulacao-da-tipagem-dos-dados" title="Permalink to this heading">#</a></h2>
<p>Como pode ser observado nos comandos relativos ao método <code class="docutils literal notranslate"><span class="pre">printSchema()</span></code> aplicado a cada um dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> gerados, todos os tipos de dados importados são <em>string</em>. Entretanto, alguns valores devem ser do tipo de dado <em>numérico</em>. Portanto, primeiramente é usado o método <code class="docutils literal notranslate"><span class="pre">cast()</span></code> para a conversão entre os tipos de dados e depois o método <code class="docutils literal notranslate"><span class="pre">withColumn()</span></code> para substituir a colunas existentes por novas colunas contendo os valores convertidos.</p>
<p>É importante salientar que, mesmo que o parâmetro <code class="docutils literal notranslate"><span class="pre">inferSchema</span></code> fosse especificado como <code class="docutils literal notranslate"><span class="pre">true</span></code> no método <code class="docutils literal notranslate"><span class="pre">spark.read.csv()</span></code>, ainda existiria a necessidade de se verificar os tipos de dados e realizar a conversão caso necessário.</p>
<section id="metodo-cast">
<h3>Método cast()<a class="headerlink" href="#metodo-cast" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cast(tipoDeDado)</span></code></p>
<p>Converte o atributo para o <code class="docutils literal notranslate"><span class="pre">tipoDeDado</span></code> passado como parâmetro. Podem ser definidos os seguintes valores para <code class="docutils literal notranslate"><span class="pre">tipoDeDado</span></code>: DataType, NullType, StringType, BinaryType, BooleanType, DateType, TimestampType, DecimalType, DoubleType, FloatType, ByteType, IntegerType, LongType, ShortType, ArrayType, MapType, StructField, StructType.</p>
</section>
<section id="metodo-withcolumn">
<h3>Método withColumn()<a class="headerlink" href="#metodo-withcolumn" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">withColumn(nomeColuna,</span> <span class="pre">exprColuna)</span></code></p>
<p>Retorna um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> adicionando uma coluna de <code class="docutils literal notranslate"><span class="pre">nomeColuna</span></code> ou substituindo uma coluna existente que possui o mesmo nome <code class="docutils literal notranslate"><span class="pre">nomeColuna</span></code>, usando o parâmetro <code class="docutils literal notranslate"><span class="pre">exprColuna</span></code> para o preenchimento dos valores daquela coluna.</p>
<p>Este comando considera o <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> sobre o qual ele foi aplicado, não permitindo adicionar a esse <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> colunas de um segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
</section>
</section>
<section id="atualizacao-dos-tipos-de-dados">
<h2>4.4 Atualização dos Tipos de Dados<a class="headerlink" href="#atualizacao-dos-tipos-de-dados" title="Permalink to this heading">#</a></h2>
<p>Nos comandos a seguir, primeiro são identificados quais colunas de quais <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser do tipo de dado inteiro. Na sequência, ocorre a conversão. Por fim, são exibidos os esquemas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, possibilitando visualizar a mudança de tipo de dados das colunas especificadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># identificando quais colunas de quais DataFrames devem ser do tipo de dado inteiro</span>
<span class="n">colunas_cargo</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">]</span>
<span class="n">colunas_cliente</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;clientePK&quot;</span><span class="p">]</span>
<span class="n">colunas_data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dataPk&quot;</span><span class="p">,</span> <span class="s2">&quot;dataDia&quot;</span><span class="p">,</span> <span class="s2">&quot;dataMes&quot;</span><span class="p">,</span> <span class="s2">&quot;dataBimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">]</span>
<span class="n">colunas_equipe</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;equipePK&quot;</span><span class="p">]</span>
<span class="n">colunas_funcionario</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;funcDiaNascimento&quot;</span><span class="p">,</span> <span class="s2">&quot;funcMesNascimento&quot;</span><span class="p">,</span> <span class="s2">&quot;funcAnoNascimento&quot;</span><span class="p">]</span>
<span class="n">colunas_negociacao</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;clientePK&quot;</span><span class="p">,</span> <span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeNegociacoes&quot;</span><span class="p">]</span>
<span class="n">colunas_pagamento</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importando o tipo de dado desejado</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span>


<span class="c1"># atualizando o tipo de dado das colunas especificadas </span>
<span class="c1"># substituindo as colunas já existentes </span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_cargo</span><span class="p">:</span>
  <span class="n">cargo</span> <span class="o">=</span> <span class="n">cargo</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">cargo</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_cliente</span><span class="p">:</span>
  <span class="n">cliente</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">cliente</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_data</span><span class="p">:</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_equipe</span><span class="p">:</span>
  <span class="n">equipe</span> <span class="o">=</span> <span class="n">equipe</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">equipe</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_funcionario</span><span class="p">:</span>
  <span class="n">funcionario</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">funcionario</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_negociacao</span><span class="p">:</span>
  <span class="n">negociacao</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">negociacao</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_pagamento</span><span class="p">:</span>
  <span class="n">pagamento</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo o esquema dos DataFrames após as alterações realizadas</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>root
 |-- cargoPK: integer (nullable = true)
 |-- cargoNome: string (nullable = true)
 |-- cargoRegimeTrabalho: string (nullable = true)
 |-- cargoJornadaTrabalho: string (nullable = true)
 |-- cargoEscolaridadeMinima: string (nullable = true)
 |-- cargoNivel: string (nullable = true)

root
 |-- clientePK: integer (nullable = true)
 |-- clienteNomeFantasia: string (nullable = true)
 |-- clienteSetor: string (nullable = true)
 |-- clienteCidade: string (nullable = true)
 |-- clienteEstadoNome: string (nullable = true)
 |-- clienteEstadoSigla: string (nullable = true)
 |-- clienteRegiaoNome: string (nullable = true)
 |-- clienteRegiaoSigla: string (nullable = true)
 |-- clientePaisNome: string (nullable = true)
 |-- clientePaisSigla: string (nullable = true)

root
 |-- dataPk: integer (nullable = true)
 |-- dataCompleta: string (nullable = true)
 |-- dataDia: integer (nullable = true)
 |-- dataMes: integer (nullable = true)
 |-- dataBimestre: integer (nullable = true)
 |-- dataTrimestre: integer (nullable = true)
 |-- dataSemestre: integer (nullable = true)
 |-- dataAno: integer (nullable = true)

root
 |-- equipePK: integer (nullable = true)
 |-- equipeNome: string (nullable = true)
 |-- filialNome: string (nullable = true)
 |-- filialCidade: string (nullable = true)
 |-- filialEstadoNome: string (nullable = true)
 |-- filialEstadoSigla: string (nullable = true)
 |-- filialRegiaoNome: string (nullable = true)
 |-- filialRegiaoSigla: string (nullable = true)
 |-- filialPaisNome: string (nullable = true)
 |-- filialPaisSigla: string (nullable = true)

root
 |-- funcPK: integer (nullable = true)
 |-- funcMatricula: string (nullable = true)
 |-- funcNome: string (nullable = true)
 |-- funcSexo: string (nullable = true)
 |-- funcDataNascimento: string (nullable = true)
 |-- funcDiaNascimento: integer (nullable = true)
 |-- funcMesNascimento: integer (nullable = true)
 |-- funcAnoNascimento: integer (nullable = true)
 |-- funcCidade: string (nullable = true)
 |-- funcEstadoNome: string (nullable = true)
 |-- funcEstadoSigla: string (nullable = true)
 |-- funcRegiaoNome: string (nullable = true)
 |-- funcRegiaoSigla: string (nullable = true)
 |-- funcPaisNome: string (nullable = true)
 |-- funcPaisSigla: string (nullable = true)

root
 |-- funcPK: integer (nullable = true)
 |-- equipePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- cargoPK: integer (nullable = true)
 |-- salario: string (nullable = true)
 |-- quantidadeLancamentos: integer (nullable = true)

root
 |-- equipePK: integer (nullable = true)
 |-- clientePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- receita: string (nullable = true)
 |-- quantidadeNegociacoes: integer (nullable = true)
</pre></div>
</div>
</div>
</div>
<p>Nos comandos a seguir, primeiro são identificados quais colunas de quais <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser do tipo de dado número de ponto flutuante. Na sequência, ocorre a conversão. Por fim, são exibidos os esquemas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, possibilitando visualizar a mudança de tipo de dados das colunas especificadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># identificando quais colunas de quais DataFrames devem ser do tipo de dado número de ponto flutuante</span>
<span class="n">colunas_negociacao</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;receita&quot;</span><span class="p">]</span>
<span class="n">colunas_pagamento</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;salario&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importando o tipo de dado desejado</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">FloatType</span>


<span class="c1"># atualizando o tipo de dado das colunas especificadas </span>
<span class="c1"># substituindo as colunas já existentes </span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_negociacao</span><span class="p">:</span>
  <span class="n">negociacao</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">negociacao</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">FloatType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_pagamento</span><span class="p">:</span>
  <span class="n">pagamento</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">FloatType</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo o esquema dos DataFrames após as alterações realizadas</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>root
 |-- funcPK: integer (nullable = true)
 |-- equipePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- cargoPK: integer (nullable = true)
 |-- salario: float (nullable = true)
 |-- quantidadeLancamentos: integer (nullable = true)

root
 |-- equipePK: integer (nullable = true)
 |-- clientePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- receita: float (nullable = true)
 |-- quantidadeNegociacoes: integer (nullable = true)
</pre></div>
</div>
</div>
</div>
<p>Note que outras conversões de formato também poderiam ser realizadas, como mudar as colunas referentes às datas para o tipo de dado <code class="docutils literal notranslate"><span class="pre">DateType</span></code>.</p>
<p>#5 Métodos Similares às Cláusulas SQL</p>
<p>O módulo <code class="docutils literal notranslate"><span class="pre">pyspark.sql</span></code> oferece diversos métodos com funcionalidades similares às cláusulas da linguagem SQL. Esses métodos são descritos considerando as similaridades com a estrutura básica do comando SELECT, com as funções de agregação e agrupamento e com as operações sobre conjuntos.</p>
</section>
<section id="estrutura-basica-do-comando-select">
<h2>5.1 Estrutura Básica do Comando SELECT<a class="headerlink" href="#estrutura-basica-do-comando-select" title="Permalink to this heading">#</a></h2>
<section id="metodo-select">
<h3>Método select()<a class="headerlink" href="#metodo-select" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">(coluna_1,</span> <span class="pre">...,</span> <span class="pre">coluna_n)</span></code></p>
<p>Lista as colunas definidas, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. É possível utilizar o caractere <code class="docutils literal notranslate"><span class="pre">*</span></code> para indicar que todas as colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> devem ser exibidas.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> da linguagem SQL.</p>
<p>Os comandos a seguir selecionam as duas primeiras colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span> <span class="pre">funcionario</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exemplo que mostra o esquema selecionado</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataFrame[funcPK: int, funcMatricula: string]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo os dados usando o método .take</span>
<span class="c1">#exibindo linha a linha</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Row(funcPK=1, funcMatricula=&#39;M-1&#39;),
 Row(funcPK=2, funcMatricula=&#39;M-2&#39;),
 Row(funcPK=3, funcMatricula=&#39;M-3&#39;),
 Row(funcPK=4, funcMatricula=&#39;M-4&#39;),
 Row(funcPK=5, funcMatricula=&#39;M-5&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo as linhas na forma de tabela</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+
|funcPK|funcMatricula|
+------+-------------+
|     1|          M-1|
|     2|          M-2|
|     3|          M-3|
|     4|          M-4|
|     5|          M-5|
+------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo as linhas na forma de tabela</span>
<span class="c1">#forma de representação alternativa</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">funcionario</span><span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">],</span> <span class="n">funcionario</span><span class="p">[</span><span class="s2">&quot;funcMatricula&quot;</span><span class="p">])</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+
|funcPK|funcMatricula|
+------+-------------+
|     1|          M-1|
|     2|          M-2|
|     3|          M-3|
|     4|          M-4|
|     5|          M-5|
+------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-selectexpr">
<h3>Método selectExpr()<a class="headerlink" href="#metodo-selectexpr" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">selectExpr</span> <span class="pre">(expressao_1,</span> <span class="pre">...,</span> <span class="pre">expressao_n)</span></code></p>
<p>Lista as expressões definidas, as quais podem ser nomes de colunas, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Este método é uma variação do método <code class="docutils literal notranslate"><span class="pre">select()</span></code> que permite a especificação de expressões SQL.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona as duas primeiras colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span> <span class="pre">funcionario</span></code>, multiplicando a primeira coluna por 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;funcPK * 2&quot;</span><span class="p">,</span> <span class="s2">&quot;funcMatricula&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------+-------------+
|(funcPK * 2)|funcMatricula|
+------------+-------------+
|           2|          M-1|
|           4|          M-2|
|           6|          M-3|
|           8|          M-4|
|          10|          M-5|
+------------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-distinct">
<h3>Método distinct()<a class="headerlink" href="#metodo-distinct" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">distinct()</span></code></p>
<p>Retorna um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> contendo apenas linhas cujos valores são diferentes entre si.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, primeiro é listada somente a coluna <code class="docutils literal notranslate"><span class="pre">funcSexo</span></code> de funcionário, mostrando valores repetidos para os sexos. Na sequência, é listada a coluna <code class="docutils literal notranslate"><span class="pre">funcSexo</span></code> de funcionário, porém sem listar valores repetidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+
|funcSexo|
+--------+
|       F|
|       M|
|       M|
|       F|
|       M|
|       M|
|       F|
|       M|
|       M|
|       M|
+--------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+
|funcSexo|
+--------+
|       F|
|       M|
+--------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id109">
<h3>Método filter()<a class="headerlink" href="#id109" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">filter</span> <span class="pre">(condição)</span></code></p>
<p>Filtra as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de acordo com a <code class="docutils literal notranslate"><span class="pre">condição</span></code> especificada, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">where()</span></code>.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona os funcionários do sexo feminino cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> é maior do que 160.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK &gt; 160 AND funcSexo = &#39;F&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|    funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|   161|        M-161|  ABINOA ALMEIDA|       F|          9/5/1990|                9|                5|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   162|        M-162|   ABINOAN ALVES|       F|         10/6/1990|               10|                6|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   166|        M-166|ABIQUEILA BARROS|       F|        14/10/1990|               14|               10|             1990|   SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   169|        M-169|ABISAGUE CARDOSO|       F|         17/1/1990|               17|                1|             1990|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   179|        M-179|   ABKEILA GOMES|       F|        27/11/1957|               27|               11|             1957|BELO HORIZONTE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   180|        M-180|     ADELAR LIMA|       F|        28/12/1958|               28|               12|             1958|      ARAGUARI|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|    OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|     GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|    SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-where">
<h3>Método where()<a class="headerlink" href="#metodo-where" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">where</span> <span class="pre">(condição)</span></code></p>
<p>Filtra as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de acordo com a condição especificada, criando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">filter()</span></code>.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona os funcionários do sexo feminino cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> é maior do que 160.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;funcPK &gt; 160 AND funcSexo = &#39;F&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|    funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|   161|        M-161|  ABINOA ALMEIDA|       F|          9/5/1990|                9|                5|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   162|        M-162|   ABINOAN ALVES|       F|         10/6/1990|               10|                6|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   166|        M-166|ABIQUEILA BARROS|       F|        14/10/1990|               14|               10|             1990|   SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   169|        M-169|ABISAGUE CARDOSO|       F|         17/1/1990|               17|                1|             1990|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   179|        M-179|   ABKEILA GOMES|       F|        27/11/1957|               27|               11|             1957|BELO HORIZONTE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   180|        M-180|     ADELAR LIMA|       F|        28/12/1958|               28|               12|             1958|      ARAGUARI|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|    OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|     GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|    SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-between">
<h3>Método between()<a class="headerlink" href="#metodo-between" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">between</span> <span class="pre">(valorInferior,</span> <span class="pre">valorSuperior)</span></code></p>
<p>Retorna as linhas cujos valores são maiores ou iguais ao <code class="docutils literal notranslate"><span class="pre">valorInferior</span></code> e menores ou iguais ao <code class="docutils literal notranslate"><span class="pre">valorSuperior</span></code>.</p>
<p>Este método é equivalente ao operador de comparação <code class="docutils literal notranslate"><span class="pre">BETWEEN</span> <span class="pre">...</span> <span class="pre">AND</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona os funcionários cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> é maior ou igual a 10 e menor ou igual a 15.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK BETWEEN 10 AND 15&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+---------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|       funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|    funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+---------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|    10|         M-10| ADETE CARVALHO|       M|        10/10/1990|               10|               10|             1990|        OSASCO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    11|         M-11|     ABD CASTRO|       M|        11/11/1990|               11|               11|             1990|    ARARAQUARA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    12|         M-12|     ABDA COSTA|       F|        12/12/1990|               12|               12|             1990|       BARUERI|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    13|         M-13|    ABDIEL DIAS|       M|         13/1/1990|               13|                1|             1990|RIO DE JANEIRO|RIO DE JANEIRO|             RJ|       SUDESTE|             SE|      BRASIL|           BR|
|    14|         M-14|  ABDALA DUARTE|       M|         14/2/1990|               14|                2|             1990| VOLTA REDONDA|RIO DE JANEIRO|             RJ|       SUDESTE|             SE|      BRASIL|           BR|
|    15|         M-15|ABDALLA FREITAS|       M|         15/3/1990|               15|                3|             1990|ANGRA DOS REIS|RIO DE JANEIRO|             RJ|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+---------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodos-isnull-e-isnotnull">
<h3>Métodos isNull() e isNotNull()<a class="headerlink" href="#metodos-isnull-e-isnotnull" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">isNull()</span></code> e <code class="docutils literal notranslate"><span class="pre">isNotNull()</span></code> estão relacionados com a verificação de valores nulos, da seguinte forma:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">isNull()</span></code>: Retorna verdadeiro se o valor do atributo for nulo.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isNotNull()</span></code>: Retorna verdadeiro se o valor do atributo não for nulo.</p></li>
</ul>
<p>Estes métodos são equivalentes aos operadores de comparação <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NULL</span></code> e <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, primeiramente solicita-se a listagem de todas as linhas cujo valor do atributo <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> seja nulo. Nenhuma linha é retornada. Na sequência, são retornadas todas as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">funcionario</span></code>, desde que todos os valores do atributo <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> não são nulos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>

<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcPK</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+--------+--------+------------------+-----------------+-----------------+-----------------+----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+--------+--------+------------------+-----------------+-----------------+-----------------+----------+--------------+---------------+--------------+---------------+------------+-------------+
+------+-------------+--------+--------+------------------+-----------------+-----------------+-----------------+----------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcPK</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-isin">
<h3>Método isin()<a class="headerlink" href="#metodo-isin" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">isin(listaDeValores)</span></code></p>
<p>Retorna verdadeiro se o valor do atributo estiver contido na <code class="docutils literal notranslate"><span class="pre">listaDeValores</span></code> passada como parâmetro.</p>
<p>Este método é equivalente ao operador de comparação <code class="docutils literal notranslate"><span class="pre">IN</span></code> da linguagem SQL.</p>
<p>No comando a seguir, são listados os dados dos funcionários cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> está contido na lista identificada pelos valores <code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcPK</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])]</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-like">
<h3>Método like()<a class="headerlink" href="#metodo-like" title="Permalink to this heading">#</a></h3>
<p>like(expressão)</p>
<p>Quando aplicado a uma coluna de um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, retorna as linhas que são similares à <code class="docutils literal notranslate"><span class="pre">expressão</span></code> definida como parâmetro.</p>
<p>A comparação é sensível ao caso. Pode ser utilizado % para substituir qualquer <em>string</em>.</p>
<p>Este método é equivalente ao operador de comparação <code class="docutils literal notranslate"><span class="pre">LIKE</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcNome</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">&#39;ADA%&#39;</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+--------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|      funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+--------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     4|          M-4|   ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    52|         M-52|ADAILTON COSTA|       M|         21/4/1951|               21|                4|             1951|     RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   113|        M-113|    ADAIR DIAS|       F|         21/5/1990|               21|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+--------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-withcolumnrenamed">
<h3>Método withColumnRenamed()<a class="headerlink" href="#metodo-withcolumnrenamed" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">withColumnRenamed(nomeColunaAtual,</span> <span class="pre">novoNomeColuna)</span></code></p>
<p>Renomeia o nome de uma coluna já existente, identificado pelo parâmetro <code class="docutils literal notranslate"><span class="pre">nomeColunaAtual</span></code>, para o novo nome identificado pelo parâmetro <code class="docutils literal notranslate"><span class="pre">novoNomeColuna</span></code>.</p>
<p>Este método é equivalente à cláusula AS da linguagem SQL quando utilizada para renomear atributos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+-------+---------------------+
|funcPK|equipePK|dataPK|cargoPK|salario|quantidadeLancamentos|
+------+--------+------+-------+-------+---------------------+
|   147|       2|     5|     64|1559.94|                    1|
|   124|       2|     5|    329|8102.77|                    1|
+------+--------+------+-------+-------+---------------------+
only showing top 2 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">,</span> <span class="s2">&quot;Salário do funcionário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+----------------------+---------------------+
|funcPK|equipePK|dataPK|cargoPK|Salário do funcionário|quantidadeLancamentos|
+------+--------+------+-------+----------------------+---------------------+
|   147|       2|     5|     64|               1559.94|                    1|
|   124|       2|     5|    329|               8102.77|                    1|
+------+--------+------+-------+----------------------+---------------------+
only showing top 2 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-crossjoin">
<h3>Método crossJoin()<a class="headerlink" href="#metodo-crossjoin" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">crossJoin(segundoDataFrame)</span></code></p>
<p>Retorna o produto cartesiano de dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, criando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. É passado como parâmetro o segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>No produto cartesiano, quaisquer duas linhas são combinadas, independentemente da integridade referencial existente entre elas. Portanto, como resultado, são produzidas todas as combinações de linhas possíveis entre os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> participantes.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">FROM</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, é feito o produto cartesiano dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> relacionados a <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>, mostrando que <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> pode ser diferente de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcSelecionado</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
<span class="n">pagSelecionado</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">select</span> <span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;salario&#39;</span><span class="p">)</span>
<span class="n">funcSelecionado</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">pagSelecionado</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+------+-------+
|funcPK|funcMatricula|funcPK|salario|
+------+-------------+------+-------+
|     1|          M-1|   147|1559.94|
|     2|          M-2|   147|1559.94|
|     3|          M-3|   147|1559.94|
|     4|          M-4|   147|1559.94|
|     5|          M-5|   147|1559.94|
|     6|          M-6|   147|1559.94|
|     7|          M-7|   147|1559.94|
|     8|          M-8|   147|1559.94|
|     9|          M-9|   147|1559.94|
|    10|         M-10|   147|1559.94|
+------+-------------+------+-------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id110">
<h3>Método join()<a class="headerlink" href="#id110" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">join(segundoDataFrame,</span> <span class="pre">on=None,</span> <span class="pre">how=None)</span></code></p>
<p>Retorna a junção de dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, criando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. O primeiro parâmetro indica qual o segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> a ser considerado na junção. O parâmetro <code class="docutils literal notranslate"><span class="pre">on</span></code> indica a condição de junção. O terceiro parâmetro, <code class="docutils literal notranslate"><span class="pre">how</span></code>, especifica como a junção deve ser feita. O valor padrão é <code class="docutils literal notranslate"><span class="pre">inner</span></code>. Também pode ser: <code class="docutils literal notranslate"><span class="pre">cross</span></code>, <code class="docutils literal notranslate"><span class="pre">outer</span></code>, <code class="docutils literal notranslate"><span class="pre">full</span></code>, <code class="docutils literal notranslate"><span class="pre">fullouter</span></code>, <code class="docutils literal notranslate"><span class="pre">full_outer</span></code>, <code class="docutils literal notranslate"><span class="pre">left</span></code>, <code class="docutils literal notranslate"><span class="pre">leftouter</span></code>, <code class="docutils literal notranslate"><span class="pre">left_outer</span></code>, <code class="docutils literal notranslate"><span class="pre">right</span></code>, <code class="docutils literal notranslate"><span class="pre">rightouter</span></code>, <code class="docutils literal notranslate"><span class="pre">right_outer</span></code>.</p>
<p>Na junção,  as linhas são combinadas de acordo com a integridade referencial existente entre elas, a qual deve ser definida no parâmetro <code class="docutils literal notranslate"><span class="pre">on</span></code>.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, é feita a junção interna (<code class="docutils literal notranslate"><span class="pre">inner</span> <span class="pre">join</span></code>) dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> relacionados a <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>, mostrando que <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de funcionario é igual à <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a junção passo a passo</span>
<span class="n">funcSelecionado</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
<span class="n">pagSelecionado</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;salario&#39;</span><span class="p">)</span>
<span class="n">funcSelecionado</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagSelecionado</span><span class="p">,</span> <span class="n">funcSelecionado</span><span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pagSelecionado</span><span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">],</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+------+-------+
|funcPK|funcMatricula|funcPK|salario|
+------+-------------+------+-------+
|   147|        M-147|   147|1559.94|
|   124|        M-124|   124|8102.77|
|   175|        M-175|   175|2532.51|
|   171|        M-171|   171| 7882.7|
|   148|        M-148|   148|4404.59|
|     5|          M-5|     5|2226.66|
|   128|        M-128|   128|6157.04|
|    82|         M-82|    82|1585.51|
|    28|         M-28|    28|1594.02|
|    46|         M-46|    46|9880.16|
+------+-------------+------+-------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># eliminando a coluna funcPK repetida</span>
<span class="n">funcSelecionado</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagSelecionado</span><span class="p">,</span> <span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------+
|funcPK|funcMatricula|salario|
+------+-------------+-------+
|   147|        M-147|1559.94|
|   124|        M-124|8102.77|
|   175|        M-175|2532.51|
|   171|        M-171| 7882.7|
|   148|        M-148|4404.59|
|     5|          M-5|2226.66|
|   128|        M-128|6157.04|
|    82|         M-82|1585.51|
|    28|         M-28|1594.02|
|    46|         M-46|9880.16|
+------+-------------+-------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-orderby">
<h3>Método orderBy()<a class="headerlink" href="#metodo-orderby" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">orderBy</span> <span class="pre">(colunas,</span> <span class="pre">ordena)</span></code></p>
<p>Ordena as linhas resultantes, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Deve ser especificada uma lista de colunas ou os nomes de colunas a serem considerados na ordenação. Pode ser especificada também a ordenação ascendente ou descendente.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">funcionario</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|          funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|   200|        M-200|     ABRAAO LIMA|       M|         19/8/1978|               19|                8|             1978|          ARARAQUARA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   199|        M-199|   ABRAHAM GOMES|       M|         18/7/1977|               18|                7|             1977|              OSASCO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   198|        M-198|     ADRA GARCIA|       M|         17/6/1976|               17|                6|             1976|SAO JOSE DO RIO P...|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   197|        M-197| ADNAEL FERREIRA|       M|         16/5/1975|               16|                5|             1975|           ILHA BELA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|      RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|          SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   194|        M-194|    ABNER DUARTE|       M|         13/2/1972|               13|                2|             1972|          PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   193|        M-193|    ADNALDO DIAS|       M|         12/1/1971|               12|                1|             1971|         SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   192|        M-192|     ADNEI COSTA|       M|        11/12/1970|               11|               12|             1970|              SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   191|        M-191|    ABNER CASTRO|       M|        10/11/1969|               10|               11|             1969|            CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   190|        M-190| ADNAEL CARVALHO|       M|         9/10/1968|                9|               10|             1968|           SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   189|        M-189|   ABNER CARDOSO|       M|          8/9/1967|                8|                9|             1967|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   188|        M-188|   ADNAEL CAMPOS|       M|          7/8/1966|                7|                8|             1966|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   187|        M-187| ABNADABE BORGES|       M|          6/7/1965|                6|                7|             1965|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   186|        M-186|  ABNADAB BARROS|       M|          5/6/1964|                5|                6|             1964|            MORRETES|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|           GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   184|        M-184| ADMARIO BARBOSA|       M|          3/4/1962|                3|                4|             1962|            LONDRINA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   183|        M-183|   ADMAR ANDRADE|       M|          2/3/1961|                2|                3|             1961|            CURITIBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   182|        M-182|    ABMAEL ALVES|       M|          1/2/1960|                1|                2|             1960|         MONTE VERDE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|          OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">orderBy</span><span class="p">([</span><span class="s2">&quot;funcPK&quot;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|          funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|   200|        M-200|     ABRAAO LIMA|       M|         19/8/1978|               19|                8|             1978|          ARARAQUARA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   199|        M-199|   ABRAHAM GOMES|       M|         18/7/1977|               18|                7|             1977|              OSASCO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   198|        M-198|     ADRA GARCIA|       M|         17/6/1976|               17|                6|             1976|SAO JOSE DO RIO P...|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   197|        M-197| ADNAEL FERREIRA|       M|         16/5/1975|               16|                5|             1975|           ILHA BELA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|      RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|          SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   194|        M-194|    ABNER DUARTE|       M|         13/2/1972|               13|                2|             1972|          PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   193|        M-193|    ADNALDO DIAS|       M|         12/1/1971|               12|                1|             1971|         SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   192|        M-192|     ADNEI COSTA|       M|        11/12/1970|               11|               12|             1970|              SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   191|        M-191|    ABNER CASTRO|       M|        10/11/1969|               10|               11|             1969|            CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   190|        M-190| ADNAEL CARVALHO|       M|         9/10/1968|                9|               10|             1968|           SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   189|        M-189|   ABNER CARDOSO|       M|          8/9/1967|                8|                9|             1967|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   188|        M-188|   ADNAEL CAMPOS|       M|          7/8/1966|                7|                8|             1966|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   187|        M-187| ABNADABE BORGES|       M|          6/7/1965|                6|                7|             1965|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   186|        M-186|  ABNADAB BARROS|       M|          5/6/1964|                5|                6|             1964|            MORRETES|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|           GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   184|        M-184| ADMARIO BARBOSA|       M|          3/4/1962|                3|                4|             1962|            LONDRINA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   183|        M-183|   ADMAR ANDRADE|       M|          2/3/1961|                2|                3|             1961|            CURITIBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   182|        M-182|    ABMAEL ALVES|       M|          1/2/1960|                1|                2|             1960|         MONTE VERDE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|          OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="agregacao-e-agrupamento">
<h2>5.2 Agregação e Agrupamento<a class="headerlink" href="#agregacao-e-agrupamento" title="Permalink to this heading">#</a></h2>
<p>As funções de agregação e agrupamento somente podem ser aplicadas a tipos de dados numéricos.</p>
<section id="metodo-sum">
<h3>Método sum()<a class="headerlink" href="#metodo-sum" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">sum(listaDeColunas)</span></code></p>
<p>Calcula a soma dos valores para cada coluna especificada no parâmetro  <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada agrupamento.</p>
<p>Este método é equivalente à função <code class="docutils literal notranslate"><span class="pre">SUM()</span></code> do SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando a soma dos salários e a soma da quantidade de lancamentos</span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">,</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">,</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Soma dos salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+-------------------------------+
|  Soma dos salários|Quantidade Total de Lançamentos|
+-------------------+-------------------------------+
|6.628875631347656E7|                           8640|
+-------------------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-min">
<h3>Método min()<a class="headerlink" href="#metodo-min" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">min(listaDeColunas)</span></code></p>
<p>Calcula o menor valor para cada coluna especificada no parâmetro  <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada agrupamento.</p>
<p>Este método é equivalente à função <code class="docutils literal notranslate"><span class="pre">MIN()</span></code> do SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando o menor salário </span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;min(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Menor Salário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------+
|Menor Salário|
+-------------+
|      1501.57|
+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-max">
<h3>Método max()<a class="headerlink" href="#metodo-max" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">max(listaDeColunas)</span></code></p>
<p>Calcula o maior valor para cada coluna especificada no parâmetro  <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada agrupamento.</p>
<p>Este método é equivalente à função <code class="docutils literal notranslate"><span class="pre">MAX()</span></code> do SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando o maior salário </span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;max(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Maior Salário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------+
|Maior Salário|
+-------------+
|     47140.17|
+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-avg">
<h3>Método avg()<a class="headerlink" href="#metodo-avg" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">avg(listaDeColunas)</span></code></p>
<p>Calcula o valor médio para cada coluna especificada no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada grupo.  Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">mean()</span></code>.</p>
<p>Este método é equivalente à função de agregação <code class="docutils literal notranslate"><span class="pre">AVG()</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+
|Média dos Salários|
+------------------+
|           7672.31|
+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-mean">
<h3>Método mean()<a class="headerlink" href="#metodo-mean" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">mean(listaDeColunas)</span></code></p>
<p>Calcula o valor médio para cada coluna especificada no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada grupo.  Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">avg()</span></code>.</p>
<p>Este método é equivalente à função de agregação <code class="docutils literal notranslate"><span class="pre">AVG()</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando a média dos salários </span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+
|Média dos Salários|
+------------------+
|           7672.31|
+------------------+
</pre></div>
</div>
</div>
</div>
<p>Método count()</p>
<p><code class="docutils literal notranslate"><span class="pre">count()</span></code></p>
<p>Retorna o número de linhas de um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Este método é equivalente à função de agregação <code class="docutils literal notranslate"><span class="pre">COUNT()</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retornando a quantidade de linhas de pagamento</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8640
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-agg">
<h3>Método agg()<a class="headerlink" href="#metodo-agg" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">agg(listaDeExpressões)</span></code></p>
<p>Aplica um método de agregação a todas as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, sem considerar agrupamentos. O parâmetro listaDeExpressões indica, para cada atributo sendo considerado, qual o método de agregação que deve ser aplicado. O método <code class="docutils literal notranslate"><span class="pre">agg()</span></code> representa uma sintaxe resumida para <code class="docutils literal notranslate"><span class="pre">groupBy.agg()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando o maior salário e a soma das quantidades de lançamentos</span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;salario&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;max(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Maior Salário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------+-------------------------------+
|Maior Salário|Quantidade Total de Lançamentos|
+-------------+-------------------------------+
|     47140.17|                           8640|
+-------------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodo-groupby">
<h3>Método groupBy()<a class="headerlink" href="#metodo-groupby" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">groupBy(listaDeColunas)</span></code></p>
<p>Aplica um método de agregação a um grupo de conjunto de linhas, retornando para cada grupo do conjunto de linhas um único valor.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> da linguagem SQL.</p>
<p>O comando a seguir lista, para cada funcPK, a soma dos salários recebidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Soma dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-----------------+
|funcPK|Soma dos Salários|
+------+-----------------+
|     1|   864589.2890625|
|     2|    80109.1171875|
|     3|   284531.2734375|
|     4|    503910.703125|
|     5|133599.5947265625|
|     6|   248232.9609375|
|     7|     347159.53125|
|     8| 43802.3994140625|
|     9|    628010.859375|
|    10|  332712.01171875|
|    11|   331538.8828125|
|    12|  72875.759765625|
|    13|      289336.3125|
|    14| 150465.603515625|
|    15|    218086.078125|
|    16|  41527.201171875|
|    17| 309711.005859375|
|    18| 45548.3994140625|
|    19|106695.6005859375|
|    20|  95876.162109375|
+------+-----------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="metodos-sobre-conjuntos">
<h2>5.3 Métodos sobre Conjuntos<a class="headerlink" href="#metodos-sobre-conjuntos" title="Permalink to this heading">#</a></h2>
<section id="metodos-union-unionall-e-unionbyname">
<h3>Métodos union(), unionAll() e unionByName()<a class="headerlink" href="#metodos-union-unionall-e-unionbyname" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">union()</span></code>, <code class="docutils literal notranslate"><span class="pre">unionAll()</span></code> e <code class="docutils literal notranslate"><span class="pre">unionByName()</span></code> têm como objetivo realizar a operação de <code class="docutils literal notranslate"><span class="pre">união</span></code> entre conjuntos considerando dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, tem-se um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que contém todas as linhas pertencentes ao primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, ao segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> ou a ambos os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>.</p>
<p>Os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser compatíveis entre si. Ou seja, eles precisam ter o mesmo número de colunas.</p>
<p>A sintaxe de cada um dos métodos é:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">union(segundoDataFrame)</span></code>: Realiza a união considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. As linhas repetidas não são eliminadas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unionAll(segundoDataFrame)</span></code>: Realiza a união considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. As linhas repetidas não são eliminadas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unionByName(segundoDataFrame)</span></code>: Realiza a união considerando o nome das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente do posicionamento dessas colunas. As linhas repetidas não são eliminadas do resultado final.</p></li>
</ul>
<p>Estes métodos são equipalentes à operação <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code> da linguagem SQL.</p>
<p>Caso haja a necessidade de se eliminar as linhas repetidas do resultado final, é necessário utilizar primeiro um dos métodos de união e, na sequência, aplicar o método <code class="docutils literal notranslate"><span class="pre">distinct()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método union(), sem eliminar linhas repetidas do resultado </span>
<span class="n">pagFiltro</span> <span class="o">=</span> <span class="n">pagamento</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK = 30 AND dataPK BETWEEN 50 AND 100&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">negFiltro</span> <span class="o">=</span> <span class="n">negociacao</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;equipePK = 2 AND dataPK BETWEEN 90 AND 110&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagFiltro</span>\
   <span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">negFiltro</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
|    90|
|    96|
|    96|
|    99|
|    99|
|   109|
+------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método union(), eliminando as linhas repetidas do resultado </span>
<span class="n">pagFiltro</span>\
   <span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">negFiltro</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
|    90|
|    96|
|    99|
|   109|
+------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodos-intersect-e-intersectall">
<h3>Métodos intersect() e intersectAll()<a class="headerlink" href="#metodos-intersect-e-intersectall" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">intersect()</span></code> e <code class="docutils literal notranslate"><span class="pre">intersectAll()</span></code> têm como objetivo realizar a operação de <code class="docutils literal notranslate"><span class="pre">intersecção</span></code> entre conjuntos considerando dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, tem-se um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que contém todas as linhas presentes simultaneamente no primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> e no segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Os dois DataFrames devem ser compatíveis entre si. Ou seja, eles precisam ter o mesmo número de colunas.</p>
<p>A sintaxe de cada um dos métodos é:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intersect(segundoDataFrame)</span></code>: Realiza a intersecção considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método elimina as linhas repetidas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intersectAll(segundoDataFrame)</span></code>: Realiza a intersecção considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método não elimina as linhas repetidas do resultado final.</p></li>
</ul>
<p>O método <code class="docutils literal notranslate"><span class="pre">intersect()</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">INTERSECT</span></code> da linguagem SQL, enquanto o método <code class="docutils literal notranslate"><span class="pre">intersectAll()</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">INTERSECT</span> <span class="pre">ALL</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método intersect()</span>
<span class="n">pagIntersect</span> <span class="o">=</span> <span class="n">pagamento</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK = 30 AND dataPK BETWEEN 50 AND 100&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagIntersect</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
|    96|
+------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">negIntersect</span> <span class="o">=</span> <span class="n">negociacao</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;equipePK = 2 AND dataPK BETWEEN 90 AND 110&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">negIntersect</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    90|
|    99|
|    96|
|   109|
|    99|
+------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagIntersect</span>\
   <span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">negIntersect</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    96|
+------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodos-subtract-e-exceptall">
<h3>Métodos subtract() e exceptAll()<a class="headerlink" href="#metodos-subtract-e-exceptall" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">subtract()</span></code> e <code class="docutils literal notranslate"><span class="pre">exceptAll()</span></code> têm como objetivo realizar a operação de <code class="docutils literal notranslate"><span class="pre">diferença</span></code> de conjuntos considerando dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, tem-se um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que contém todas as linhas presentes no primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, mas que não estão no segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser compatíveis entre si. Ou seja, eles precisam ter o mesmo número de colunas.</p>
<p>A sintaxe de cada um dos métodos é:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">subtract(segundoDataFrame)</span></code>: Realiza a diferença entre conjuntos considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método elimina as linhas repetidas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exceptAll(segundoDataFrame)</span></code>: Realiza a diferença entre conjuntos considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método não elimina as linhas repetidas do resultado final.</p></li>
</ul>
<p>O método <code class="docutils literal notranslate"><span class="pre">subtract(segundoDataFrame)</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">MINUS</span></code> da linguagem SQL, enquanto que o método <code class="docutils literal notranslate"><span class="pre">exceptAll(segundoDataFrame)</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">MINUS</span> <span class="pre">ALL</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método exceptAll()</span>
<span class="n">pagIntersect</span>\
   <span class="o">.</span><span class="n">exceptAll</span><span class="p">(</span><span class="n">negIntersect</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
+------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id111">
<h1>6 Execução de Consultas com Foco nas Operações OLAP<a class="headerlink" href="#id111" title="Permalink to this heading">#</a></h1>
<section id="id112">
<h2>6.1 Operação Slice and Dice<a class="headerlink" href="#id112" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Restringe os dados sendo analisados a um subconjunto desses dados.</p>
<ul class="simple">
<li><p>Slice: corte para um valor fixo, diminuindo a dimensionalidade do cubo.</p></li>
<li><p>Dice: seleção de faixas de valores.</p></li>
</ul>
<p><strong>Exemplo de consulta</strong>: Qual a quantidade de pagamentos realizados no mês de setembro de 2020?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de slice and dice utilizando o método filter() ou where()</span>
<span class="c1"># selecionando apenas as colunas necessárias ao processamento da consulta </span>
<span class="n">dataSelecionada</span> <span class="o">=</span> \
   <span class="n">data</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;dataAno = 2020 AND dataMes=9&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>
<span class="n">dataSelecionada</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|  1706|
|  1707|
|  1708|
|  1709|
|  1710|
+------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias ao processamento da consulta</span>
<span class="n">pagamentoSelecionado</span> <span class="o">=</span> \
   <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>
<span class="n">pagamentoSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+---------------------+
|dataPK|quantidadeLancamentos|
+------+---------------------+
|     5|                    1|
|     5|                    1|
|     5|                    1|
|     5|                    1|
|     5|                    1|
+------+---------------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a junção entre os resultados obtidos</span>
<span class="n">dataPagamento</span> <span class="o">=</span>\
   <span class="n">dataSelecionada</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamentoSelecionado</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>
<span class="n">dataPagamento</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+---------------------+
|dataPK|quantidadeLancamentos|
+------+---------------------+
|  1710|                    1|
|  1710|                    1|
|  1710|                    1|
|  1710|                    1|
|  1710|                    1|
+------+---------------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo o resultado desejado</span>
<span class="n">dataPagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------------------+
|Quantidade Total de Lançamentos|
+-------------------------------+
|                            200|
+-------------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo uma forma alternativa, e considerando apenas um único comando </span>
<span class="n">data</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2020 AND dataMes=9&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------------------+
|Quantidade Total de Lançamentos|
+-------------------------------+
|                            200|
+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id113">
<h2>6.2 Operações Drill-Down e Roll-Up<a class="headerlink" href="#id113" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Analisam os dados considerando níveis progressivos de agregação.</p>
<ul class="simple">
<li><p>Drill-down: níveis de agregação progressivamente mais detalhados, ou de menor granularidade.</p></li>
<li><p>Roll-up: níveis de agregação progressivamente menos detalhados, ou de maior granularidade.</p></li>
</ul>
<p>Para ilustrar as operações de drill-down e roll-up, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>semestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo a resposta considerando cada semestre</span>

<span class="n">data</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Valor gasto em salários por semestre&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------+------------------------------------+
|dataAno|dataSemestre|Valor gasto em salários por semestre|
+-------+------------+------------------------------------+
|   2016|           1|                          2221308.55|
|   2016|           2|                          2221308.55|
|   2017|           1|                          4887639.92|
|   2017|           2|                          4887639.92|
|   2018|           1|                          7467763.23|
|   2018|           2|                          7467763.23|
|   2019|           1|                          9283833.23|
|   2019|           2|                          9283833.23|
|   2020|           1|                          9283833.23|
|   2020|           2|                          9283833.23|
+-------+------------+------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta drill-down:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>trimestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exibindo a resposta considerando cada trimestre (mais detalhes)</span>

<span class="n">data</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Valor gasto em salários por trimestre&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------+-------------------------------------+
|dataAno|dataTrimestre|Valor gasto em salários por trimestre|
+-------+-------------+-------------------------------------+
|   2016|            1|                           1110654.28|
|   2016|            2|                           1110654.28|
|   2016|            3|                           1110654.28|
|   2016|            4|                           1110654.28|
|   2017|            1|                           2443819.96|
|   2017|            2|                           2443819.96|
|   2017|            3|                           2443819.96|
|   2017|            4|                           2443819.96|
|   2018|            1|                           3733881.62|
|   2018|            2|                           3733881.62|
|   2018|            3|                           3733881.62|
|   2018|            4|                           3733881.62|
|   2019|            1|                           4641916.61|
|   2019|            2|                           4641916.61|
|   2019|            3|                           4641916.61|
|   2019|            4|                           4641916.61|
|   2020|            1|                           4641916.61|
|   2020|            2|                           4641916.61|
|   2020|            3|                           4641916.61|
|   2020|            4|                           4641916.61|
+-------+-------------+-------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta roll-up:</strong> Qual o valor gasto em salários por <strong>ano</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exibindo a resposta considerando cada ano (menos detalhes)</span>

<span class="n">data</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Valor gasto em salários por ano&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------------------------+
|dataAno|Valor gasto em salários por ano|
+-------+-------------------------------+
|   2016|                      4442617.1|
|   2017|                     9775279.84|
|   2018|                  1.493552647E7|
|   2019|                  1.856766645E7|
|   2020|                  1.856766645E7|
+-------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id114">
<h2>6.3 Operação Pivot<a class="headerlink" href="#id114" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Reorienta a visão multidimensional dos dados, oferecendo diferentes perspectivas dos mesmos dados.</p>
<p>Para ilustrar a operação pivot, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong>  Qual o valor gasto em salários por ano, considerando cada nível de cargo?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span>  <span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Gastos em Salários&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+----------+------------------+
|dataAno|cargoNivel|Gastos em Salários|
+-------+----------+------------------+
|   2016|    JUNIOR|         489456.84|
|   2016|     PLENO|        1454152.44|
|   2016|    SENIOR|        2499007.82|
|   2017|    JUNIOR|         1030642.8|
|   2017|     PLENO|        3791593.94|
|   2017|    SENIOR|         4953043.1|
|   2018|    JUNIOR|         1393282.2|
|   2018|     PLENO|        5357227.46|
|   2018|    SENIOR|        8185016.81|
|   2019|    JUNIOR|        1755714.36|
|   2019|     PLENO|        6132228.26|
|   2019|    SENIOR|     1.067972384E7|
|   2020|    JUNIOR|        1755714.36|
|   2020|     PLENO|        6132228.26|
|   2020|    SENIOR|     1.067972384E7|
+-------+----------+------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta pivot:</strong> Qual o valor gasto em salários por nível de cargo, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Gastos em Salários&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+-------+------------------+
|cargoNivel|dataAno|Gastos em Salários|
+----------+-------+------------------+
|    JUNIOR|   2016|         489456.84|
|    JUNIOR|   2017|         1030642.8|
|    JUNIOR|   2018|         1393282.2|
|    JUNIOR|   2019|        1755714.36|
|    JUNIOR|   2020|        1755714.36|
|     PLENO|   2016|        1454152.44|
|     PLENO|   2017|        3791593.94|
|     PLENO|   2018|        5357227.46|
|     PLENO|   2019|        6132228.26|
|     PLENO|   2020|        6132228.26|
|    SENIOR|   2016|        2499007.82|
|    SENIOR|   2017|         4953043.1|
|    SENIOR|   2018|        8185016.81|
|    SENIOR|   2019|     1.067972384E7|
|    SENIOR|   2020|     1.067972384E7|
+----------+-------+------------------+
</pre></div>
</div>
</div>
</div>
<section id="metodo-pivot">
<h3>Método pivot()<a class="headerlink" href="#metodo-pivot" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pivot(coluna,</span> <span class="pre">valores=None)</span></code></p>
<p>Rotaciona uma <code class="docutils literal notranslate"><span class="pre">coluna</span></code> do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, e exibe os valores de acordo com o parâmetro <code class="docutils literal notranslate"><span class="pre">valores</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#metodo pivot()</span>

<span class="n">pagamento</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span>  <span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;sum(salario)&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Gastos em Salários&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------------+------------------+------------------+------------------+
|dataAno|Gastos em Salários|            JUNIOR|             PLENO|            SENIOR|
+-------+------------------+------------------+------------------+------------------+
|   2017|         4953043.1|              null|              null|   4953043.1015625|
|   2018|         1393282.2|1393282.1967773438|              null|              null|
|   2020|     1.067972384E7|              null|              null|1.06797238359375E7|
|   2018|        5357227.46|              null|5357227.4560546875|              null|
|   2016|        1454152.44|              null|  1454152.44140625|              null|
|   2019|        6132228.26|              null|6132228.2607421875|              null|
|   2016|         489456.84|489456.84228515625|              null|              null|
|   2017|        3791593.94|              null|3791593.9423828125|              null|
|   2019|     1.067972384E7|              null|              null|1.06797238359375E7|
|   2018|        8185016.81|              null|              null|      8185016.8125|
|   2020|        1755714.36| 1755714.357421875|              null|              null|
|   2020|        6132228.26|              null|6132228.2607421875|              null|
|   2016|        2499007.82|              null|              null|  2499007.81640625|
|   2017|         1030642.8|1030642.7958984375|              null|              null|
|   2019|        1755714.36| 1755714.357421875|              null|              null|
+-------+------------------+------------------+------------------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id115">
<h2>6.4 Operação Drill-Across<a class="headerlink" href="#id115" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Compara medidas numéricas de tabelas de fatos diferentes, utilizando pelo menos uma dimensão em comum.</p>
<p><strong>Exemplo de consulta:</strong> Qual o total gasto com salários e qual o total de receitas recebidas, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o primeiro bloco da consulta</span>
<span class="c1"># qual o total de gastos em salários, considerando cada ano? </span>
<span class="n">pag</span> <span class="o">=</span> <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>
<span class="n">pag</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+
|dataAno|        sum(salario)|
+-------+--------------------+
|   2018|1.4935526465332031E7|
|   2019|1.8567666454101562E7|
|   2020|1.8567666454101562E7|
|   2016|   4442617.100097656|
|   2017|    9775279.83984375|
+-------+--------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o segundo bloco da consulta</span>
<span class="n">neg</span> <span class="o">=</span> <span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>
<span class="n">neg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+
|dataAno|        sum(receita)|
+-------+--------------------+
|   2018|1.1593539659606934E7|
|   2019| 3.535331833154297E7|
|   2020| 3.022217587109375E7|
|   2016|   4614246.968261719|
|   2017|  7200423.3539123535|
+-------+--------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de drill-across</span>
<span class="c1"># exibindo o resultado final</span>
<span class="n">pag</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">neg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;sum(receita)&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Gasto com Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total de Receitas Recebidas&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------------------+---------------------------+
|dataAno|Total Gasto com Salários|Total de Receitas Recebidas|
+-------+------------------------+---------------------------+
|   2016|               4442617.1|                 4614246.97|
|   2017|              9775279.84|                 7200423.35|
|   2018|           1.493552647E7|              1.159353966E7|
|   2019|           1.856766645E7|              3.535331833E7|
|   2020|           1.856766645E7|              3.022217587E7|
+-------+------------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="extensoes-rollup-e-cube">
<h2>5.5 Extensões ROLLUP e CUBE<a class="headerlink" href="#extensoes-rollup-e-cube" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Constrém vários níveis de agregação.</p>
<ul class="simple">
<li><p>ROLLUP: criação de subtotais para as combinações dos atributos da lista de agrupamento de acordo com a ordem desses atributos. São criados n+1 níveis de agregação, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
<li><p>CUBE: criação de subtotais para todas as combinações dos atributos da lista de agrupamento. São criados 2ˆn (2 elevado a n) níveis, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
</ul>
<section id="metodo-rollup">
<h3>Método rollup()<a class="headerlink" href="#metodo-rollup" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">rollup(listaDeColunas)</span></code></p>
<p>Cria vários níveis de agregação de acordo com a extensão ROLLUP usando as colunas especificadas no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code> e possibilita a definição de um método de agregação sobre essas colunas.</p>
</section>
<section id="metodo-cube">
<h3>Método cube()<a class="headerlink" href="#metodo-cube" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cube(listaDeColunas)</span></code></p>
<p>Cria vários níveis de agregação de acordo com a extensão CUBE usando as colunas especificadas no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code> e possibilita a definição de um método de agregação sobre essas colunas.</p>
<p><strong>Exemplo de consulta com ROLLUP:</strong> Liste as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cliente</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span>  <span class="s2">&quot;clienteCidade&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">rollup</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;sum(receita) &gt; 3000000&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total de Receitas&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|    8.898370418E7|
|BEBIDAS E ALIMENTOS|          null|    3.540878588E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|       3899358.31|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.96|
|BEBIDAS E ALIMENTOS|     SAO PAULO|       6177945.47|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.57|
|            CREDITO|          null|       6621387.69|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.24|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|    1.656803299E7|
|         TECNOLOGIA|     SAO PAULO|       9200352.79|
|          VESTUARIO|          null|    1.207288518E7|
|          VESTUARIO|RIO DE JANEIRO|       5948448.13|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com CUBE:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cliente</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">cube</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;sum(receita) &gt; 3000000&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total de Receitas&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|    8.898370418E7|
|               null|BELO HORIZONTE|       4379523.84|
|               null|  CAMPO GRANDE|       3422117.04|
|               null|      CURITIBA|       3697625.37|
|               null|     FORTALEZA|       3391233.25|
|               null|        MANAUS|       5234539.23|
|               null|       MARILIA|       7289146.09|
|               null|  PORTO ALEGRE|       4319625.71|
|               null|        RECIFE|       4717719.46|
|               null|RIO DE JANEIRO|    1.525596269E7|
|               null|    SAO CARLOS|       4192741.95|
|               null|     SAO PAULO|    2.464599961E7|
|               null|    UBERLANDIA|        4357595.2|
|BEBIDAS E ALIMENTOS|          null|    3.540878588E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|       3899358.31|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.96|
|BEBIDAS E ALIMENTOS|     SAO PAULO|       6177945.47|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.57|
+-------------------+--------------+-----------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id116">
<h1>7 Execução de Consultas com Foco na Tomada de Decisão<a class="headerlink" href="#id116" title="Permalink to this heading">#</a></h1>
<p>As consultas OLAP requisitadas por usuários de sistemas de suporte à decisão usualmente requerem que várias operações OLAP sejam realizadas simultaneamente. A seguir são ilustrados exemplos de consultas OLAP que podem ser requisitadas para a tomada de decisão estratégica.</p>
<section id="id117">
<h2>7.1 Consulta 1<a class="headerlink" href="#id117" title="Permalink to this heading">#</a></h2>
<p>Qual é a média dos salários recebidos por nível do cargo e por sexo no ano de 2019?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">cargo</span></code>, <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.cargoPK</span> <span class="pre">=</span> <span class="pre">cargo.cargoPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.funcPK</span> <span class="pre">=</span> <span class="pre">funcionario.funcPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de slice and dice utilizando o método filter()</span>
<span class="c1"># selecionando apenas as colunas necessárias ao processamento da consulta </span>
<span class="n">dataSelecionada</span> <span class="o">=</span>\
   <span class="n">data</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;dataAno = 2019&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>
<span class="n">dataSelecionada</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|  1097|
|  1098|
|  1099|
|  1100|
|  1101|
+------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias de funcionario </span>
<span class="n">funcionarioSelecionado</span> <span class="o">=</span>\
   <span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>
<span class="n">funcionarioSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+
|funcPK|funcSexo|
+------+--------+
|     1|       F|
|     2|       M|
|     3|       M|
|     4|       F|
|     5|       M|
+------+--------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias de cargo</span>
<span class="n">cargoSelecionado</span> <span class="o">=</span> \
   <span class="n">cargo</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>
<span class="n">cargoSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+----------+
|cargoPK|cargoNivel|
+-------+----------+
|      1|    JUNIOR|
|      2|     PLENO|
|      3|    SENIOR|
|      4|    JUNIOR|
|      5|     PLENO|
|      6|    SENIOR|
|      7|    JUNIOR|
|      8|     PLENO|
|      9|    SENIOR|
|     10|    JUNIOR|
|     11|     PLENO|
|     12|    SENIOR|
|     13|    JUNIOR|
|     14|     PLENO|
|     15|    SENIOR|
|     16|    JUNIOR|
|     17|     PLENO|
|     18|    SENIOR|
|     19|    JUNIOR|
|     20|     PLENO|
+-------+----------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias de pagamento</span>
<span class="n">pagamentoSelecionado</span> <span class="o">=</span> \
   <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoPK&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>
<span class="n">pagamentoSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+------+-------+--------+
|dataPK|funcPK|cargoPK| salario|
+------+------+-------+--------+
|     5|   147|     64| 1559.94|
|     5|   124|    329| 8102.77|
|     5|   175|    328| 2532.51|
|     5|   171|    245|  7882.7|
|     5|   148|     65| 4404.59|
|     5|     5|    112| 2226.66|
|     5|   128|    341| 6157.04|
|     5|    82|     43| 1585.51|
|     5|    28|    253| 1594.02|
|     5|    46|    390| 9880.16|
|     5|    91|    233|10931.47|
|     5|   176|    241| 2005.49|
|     5|   172|    351|14218.28|
|     5|   155|    121| 2002.57|
|     5|    19|    223| 1778.26|
|     5|    94|    394|  2505.1|
|     5|    26|    350| 9162.46|
|     5|    55|    313| 3215.53|
|     5|    29|     62| 4128.44|
|     5|   181|    249|11082.75|
+------+------+-------+--------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#realizando as junções par a par</span>
<span class="n">pagamentoData</span> <span class="o">=</span> \
   <span class="n">pagamentoSelecionado</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataSelecionada</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>

<span class="n">pagamentoDataFunc</span> <span class="o">=</span> \
   <span class="n">pagamentoData</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">funcionarioSelecionado</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>

<span class="n">pagamentoDataFuncCargo</span> <span class="o">=</span> \
   <span class="n">pagamentoDataFunc</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargoSelecionado</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>
   
<span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------+------+-------+--------+----------+
|cargoPK|funcPK|dataPK|salario|funcSexo|cargoNivel|
+-------+------+------+-------+--------+----------+
|     64|   147|  1101|1559.94|       F|    JUNIOR|
|    329|   124|  1101|8102.77|       M|     PLENO|
|    328|   175|  1101|2532.51|       M|    JUNIOR|
|    245|   171|  1101| 7882.7|       M|     PLENO|
|     65|   148|  1101|4404.59|       M|     PLENO|
+-------+------+------+-------+--------+----------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo e calculando o resultado final</span>
<span class="n">pagamentoDataFuncCargo</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span><span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a consulta em um único comando</span>

<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">funcionario</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2019&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span><span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id118">
<h2>7.2 Consulta 2<a class="headerlink" href="#id118" title="Permalink to this heading">#</a></h2>
<p>Qual o total de gastos em salários considerando os estados nos quais as equipes estão localizadas no trimestre 3 do ano de 2020?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipePK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2019 AND dataTrimestre = 3&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;filialEstadoNome&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;filialEstadoNome&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+----------+
|  filialEstadoNome|     Total|
+------------------+----------+
|        PERNAMBUCO| 438121.26|
|MATO GROSSO DO SUL|1013857.75|
|    RIO DE JANEIRO|1258479.58|
|         SAO PAULO|1931458.02|
+------------------+----------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id119">
<h2>7.3 Consulta 3<a class="headerlink" href="#id119" title="Permalink to this heading">#</a></h2>
<p>Qual o custo/benefício das equipes quando analisado o semestre 1 do ano de 2020?</p>
<p>A idea da consulta é relacionar os gastos em salários e os ganhos em receitas considerando cada equipe e o período especificado. Portanto, para se realizar essa consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como das tabelas de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code> e <code class="docutils literal notranslate"><span class="pre">negociacao</span></code>.</p>
<p>A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
</ul>
<p>Uma observação muito importante refere-se ao fato que, para evitar dubiedade nas respostas, elas devem ser feitas sempre considerando a chave primária, desde que a chave primária identifica univocamente cada linha. Depois de ser resolvida a consulta em termos da chave primária, então deve ser obtido os demais atributos a serem exibidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o primeiro bloco da consulta</span>
<span class="c1"># identificando para cada equipePK qual o total em gastos com salários</span>
<span class="n">pag</span> <span class="o">=</span> <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataSemestre = 1 AND dataAno = 2020&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>
<span class="n">pag</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+
|equipePK|      sum(salario)|
+--------+------------------+
|       1|1160327.4052734375|
|       2|1060981.1447753906|
|       3|  1177330.32421875|
|       4| 579893.9384765625|
|       5| 909107.1071777344|
|       6| 585430.8479003906|
|       7| 876084.0717773438|
|       8|1118608.3930664062|
|       9| 939827.4675292969|
|      10| 876242.5268554688|
+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o segundo bloco da consulta</span>
<span class="c1"># identificando para cada equipePK qual o total em ganhos com receitas</span>
<span class="n">neg</span> <span class="o">=</span> <span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataSemestre = 1 AND dataAno = 2020&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>
<span class="n">neg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+
|equipePK|      sum(receita)|
+--------+------------------+
|       1|1259907.2412109375|
|       2|1338994.3959960938|
|       3|     340461.296875|
|       4|340130.64990234375|
|       5| 614747.7039794922|
|       6| 736591.3486328125|
|       7| 722758.4526367188|
|       8| 538659.2993164062|
|       9|      4994717.6875|
|      10| 4664745.689453125|
+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de drill-across</span>
<span class="n">parte</span> <span class="o">=</span> <span class="n">pag</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">neg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>
<span class="n">parte</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+------------------+
|equipePK|      sum(salario)|      sum(receita)|
+--------+------------------+------------------+
|       1|1160327.4052734375|1259907.2412109375|
|       6| 585430.8479003906| 736591.3486328125|
|       3|  1177330.32421875|     340461.296875|
|       5| 909107.1071777344| 614747.7039794922|
|       9| 939827.4675292969|      4994717.6875|
|       4| 579893.9384765625|340130.64990234375|
|       8|1118608.3930664062| 538659.2993164062|
|       7| 876084.0717773438| 722758.4526367188|
|      10| 876242.5268554688| 4664745.689453125|
|       2|1060981.1447753906|1338994.3959960938|
+--------+------------------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># renomeando as colunas </span>
<span class="n">parte</span> <span class="o">=</span> <span class="n">parte</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalSalario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalReceita&quot;</span><span class="p">)</span>

<span class="c1">#criando a coluna Lucro solicitada</span>
<span class="n">parte</span> <span class="o">=</span> <span class="n">parte</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Lucro&quot;</span><span class="p">,</span> <span class="n">parte</span><span class="p">[</span><span class="s2">&quot;TotalReceita&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">parte</span><span class="p">[</span><span class="s2">&quot;TotalSalario&quot;</span><span class="p">])</span>
<span class="n">parte</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+------------------+-------------------+
|equipePK|      TotalSalario|      TotalReceita|              Lucro|
+--------+------------------+------------------+-------------------+
|       1|1160327.4052734375|1259907.2412109375|      99579.8359375|
|       6| 585430.8479003906| 736591.3486328125| 151160.50073242188|
|       3|  1177330.32421875|     340461.296875|   -836869.02734375|
|       5| 909107.1071777344| 614747.7039794922| -294359.4031982422|
|       9| 939827.4675292969|      4994717.6875|  4054890.219970703|
|       4| 579893.9384765625|340130.64990234375|-239763.28857421875|
|       8|1118608.3930664062| 538659.2993164062|      -579949.09375|
|       7| 876084.0717773438| 722758.4526367188|  -153325.619140625|
|      10| 876242.5268554688| 4664745.689453125| 3788503.1625976562|
|       2|1060981.1447753906|1338994.3959960938|  278013.2512207031|
+--------+------------------+------------------+-------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtendo de equipe os dados semânticos a serem exibidos no resultado</span>
<span class="c1"># exibindo somente as colunas solicitadas</span>
<span class="n">equipe</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parte</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;equipeNome&quot;</span><span class="p">,</span> <span class="s2">&quot;filialNome&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;Lucro&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;Lucro&quot;</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+---------------+
|    equipeNome|          filialNome|round(Lucro, 2)|
+--------------+--------------------+---------------+
|BI &amp; ANALYTICS|SAO PAULO - AV. P...|     4054890.22|
|BI &amp; ANALYTICS|     RECIFE - CENTRO|     3788503.16|
| APP - DESKTOP|RIO DE JANEIRO - ...|      278013.25|
|  APP - MOBILE|SAO PAULO - AV. P...|       151160.5|
| APP - DESKTOP|SAO PAULO - AV. P...|       99579.84|
|  APP - MOBILE|RIO DE JANEIRO - ...|     -153325.62|
|           WEB|RIO DE JANEIRO - ...|     -239763.29|
|           WEB|CAMPO GRANDE - CE...|      -294359.4|
|  APP - MOBILE|CAMPO GRANDE - CE...|     -579949.09|
|           WEB|SAO PAULO - AV. P...|     -836869.03|
+--------------+--------------------+---------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-aula-08-lista-de-exercicios-explorando-o-modulo-pyspark-sql-span">
<h1><span style="color:blue"> Aula 08 - Lista de exercícios - Explorando o Módulo pyspark.sql</span><a class="headerlink" href="#span-style-color-blue-aula-08-lista-de-exercicios-explorando-o-modulo-pyspark-sql-span" title="Permalink to this heading">#</a></h1>
<section id="span-style-color-blue-respostas-dos-exercicios-span">
<h2><span style="color:blue">Respostas dos Exercícios</span><a class="headerlink" href="#span-style-color-blue-respostas-dos-exercicios-span" title="Permalink to this heading">#</a></h2>
<p>Esta lista contém os exercícios referentes à Aula 08. Por favor, procure por “Exercício” para encontrar a especificação dos exercícios e as suas respectivas respostas. Também é possível localizar os exercícios utilizando o menu de navegação. Por completude, o <em>notebook</em> possui todas as descrições apresentadas na parte prática da Aula 08. Recomenda-se fortemente que a lista de exercícios seja respondida antes de se consultar as respostas dos exercícios.</p>
<p><strong>IMPORTANTE: O uso do <em>framework</em> Spark requer diversas configurações no ambiente de desenvolvimento para executar o <em>notebook</em>. Dado que tal complexidade foge do escopo de nossa disciplina, recomenda-se que o <em>notebook</em> seja executado na plataforma de desenvolvimento COLAB. O uso do COLAB  proporciona um ambiente de desenvolvimento pré-configurado e remove a complexidade de instalação e configuração de pacotes e <em>frameworks</em> que são utilizados na disciplina.</strong></p>
<p>#1 Constelação de Fatos da BI Solutions</p>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma contelação de fatos, conforme descrita a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamentos)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacoes)</p></li>
</ul>
<p>#2 Obtenção dos Dados da BI Solutions</p>
</section>
<section id="id120">
<h2>2.1 Baixando o Módulo wget<a class="headerlink" href="#id120" title="Permalink to this heading">#</a></h2>
<p>Para baixar os dados referentes ao esquema relacional da constelação de fatos da BI Solutions, é utilizado o módulo  <strong>wget</strong>. O comando a seguir realiza a instalação desse módulo. <br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando o módulo wget
%%capture
!pip install -q wget
!mkdir data
</pre></div>
</div>
</div>
</div>
</section>
<section id="id121">
<h2>2.2 Obtenção dos Dados das Tabelas de Dimensão<a class="headerlink" href="#id121" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de dimensão.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de dimensão</span>
<span class="kn">import</span> <span class="nn">wget</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/data.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/cliente (1).csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="id122">
<h2>2.3 Obtenção dos Dados Tabelas de Fatos<a class="headerlink" href="#id122" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de fatos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de fatos</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/negociacao (1).csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id123">
<h1>3 Apache Spark Cluster<a class="headerlink" href="#id123" title="Permalink to this heading">#</a></h1>
<section id="id124">
<h2>3.1 Instalação<a class="headerlink" href="#id124" title="Permalink to this heading">#</a></h2>
<p>Neste <em>notebook</em> é criado um <em>cluster</em> Spark composto apenas por um <strong>nó mestre</strong>. Ou seja, o <em>cluster</em> não possui um ou mais <strong>nós de trabalho</strong> e o <strong>gerenciador de cluster</strong>. Nessa configuração, as tarefas (<em>tasks</em>) são realizadas no próprio <em>driver</em> localizado no <strong>nó mestre</strong>.</p>
<p>Para que o cluster possa ser criado, primeiramente é instalado o Java Runtime Environment (JRE) versão 8.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando Java Runtime Environment (JRE) versão 8
%%capture
!apt-get remove openjdk*
!apt-get update --fix-missing
!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<p>Na sequência, é feito o <em>download</em> do Apache Spark versão 3.0.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#baixando Apache Spark versão 3.0.0
%%capture
!wget -q https://archive.apache.org/dist/spark/spark-3.0.0/spark-3.0.0-bin-hadoop2.7.tgz
!tar xf spark-3.0.0-bin-hadoop2.7.tgz &amp;&amp; rm spark-3.0.0-bin-hadoop2.7.tgz
</pre></div>
</div>
</div>
</div>
<p>Na sequência, são configuradas as variáveis de ambiente JAVA_HOME e SPARK_HOME. Isto permite que tanto o Java quanto o Spark possam ser encontrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#configurando a variável de ambiente JAVA_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="c1">#configurando a variável de ambiente SPARK_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.0.0-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, são instalados dois pacotes da linguagem de programação Python, cujas funcionalidades são descritas a seguir.</p>
<blockquote>
<div><p><strong>Pacote findspark:</strong> Usado para ler a variável de ambiente SPARK_HOME e armazenar seu valor na variável dinâmica de ambiente PYTHONPATH. Como resultado, Python pode encontrar a instalação do Spark.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Pacote pyspark:</strong> PySpark é a API do Python para Spark. Ela possibilita o uso de Python, considerando que o <em>framework</em> Apache Spark encontra-se desenvolvido na linguagem de programação Scala.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
#instalando o pacote findspark
!pip install -q findspark==1.4.2
#instalando o pacote pyspark
!pip install -q pyspark==3.0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="id125">
<h2>3.2 Conexão<a class="headerlink" href="#id125" title="Permalink to this heading">#</a></h2>
<p>PySpark não é adicionado ao <em>sys.path</em> por padrão. Isso significa que não é possível importá-lo, pois o interpretador da linguagem Python não sabe onde encontrá-lo.</p>
<p>Para resolver esse aspecto, é necessário instalar o módulo <code class="docutils literal notranslate"><span class="pre">findspark</span></code>. Esse módulo mostra onde PySpark está localizado. Os comandos a seguir têm essa finalidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#importando o módulo findspark</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="c1">#carregando a variávels SPARK_HOME na variável dinâmica PYTHONPATH</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Depois de configurados os pacotes e módulos e inicializadas as variáveis de ambiente, é possível iniciar o uso do Spark na aplicação de <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">warehousing</span></code>. Para tanto, é necessário importar o comando <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code> do módulo <code class="docutils literal notranslate"><span class="pre">pyspark.sql</span></code>. São utilizados os seguintes conceitos: <br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SparkSession</span></code>: permite a criação de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, as tabelas relacionais podem ser manipuladas por meio de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> e é possível realizar consultas OLAP por meio de comandos SQL. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">builder</span></code>: cria uma instância de SparkSession. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">appName</span></code>: define um nome para a aplicação, o qual pode ser visto na interface de usuário web do Spark. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master</span></code>: define onde está o nó mestre do <em>cluster</em>. Como a aplicação é executada localmente e não em um <em>cluster</em>, indica-se isso pela <em>string</em> <code class="docutils literal notranslate"><span class="pre">local</span></code> seguida do parâmetro <code class="docutils literal notranslate"><span class="pre">[*]</span></code>. Ou seja, define-se que apenas núcleos locais são utilizados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getOrCreate</span></code>: cria uma SparkSession. Caso ela já exista, retorna a instância existente.</p></li>
</ul>
<p><strong>Observação</strong>: A lista completa de todos os parâmetros que podem ser utilizados na inicialização do <em>cluster</em> pode ser encontrada neste <a class="reference external" href="https://spark.apache.org/docs/latest/spark-standalone.html#cluster-launch-scripts">link</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;pyspark-notebook&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id126">
<h1>4 Geração dos DataFrames da BI Solutions<a class="headerlink" href="#id126" title="Permalink to this heading">#</a></h1>
<p>Um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> em Spark é equivalente a uma tabela relacional. Portanto, um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> possui um esquema, uma ou mais linhas (ou tuplas) e uma ou mais colunas (ou atributos).</p>
<section id="id127">
<h2>4.1 Métodos para Leitura e Escrita<a class="headerlink" href="#id127" title="Permalink to this heading">#</a></h2>
<section id="id128">
<h3>Método spark.read.csv()<a class="headerlink" href="#id128" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">spark.read.csv()</span></code></p>
<p>Realiza a leitura dos dados de um arquivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code> e armazena esses dados em um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Alguns parâmetros do método são:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: indica o endereço do arquivo que é lido.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code>: indica se o arquivo possui um cabeçalho.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code>: especifica o caractere que separa os campos do arquivo.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inferSchema</span></code>: infere o tipo de dados de cada atributo automaticamente a partir dos dados do arquivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code>. Para que isto seja possível, existe a necessidade de se ler os dados mais uma vez. Se esse parâmetro não for especificado, seu valor padrão é <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
</ul>
<p>Entretanto, vários parâmetros podem ser especificados. Uma lista completa desses parâmetros pode ser encontrada neste <a class="reference external" href="https://docs.databricks.com/data/data-sources/read-csv.html">link</a>.</p>
</section>
<section id="id129">
<h3>Método show()<a class="headerlink" href="#id129" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">show(number=20,</span> <span class="pre">truncate=True,</span> <span class="pre">vertical=False)</span></code></p>
<p>Mostra o conteúdo do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Caso o parâmetro <code class="docutils literal notranslate"><span class="pre">number</span></code> seja especificado, é mostrado o número de linhas especificado. Caso contrário, são exibidas as 20 primeiras linhas.  O parâmetro <code class="docutils literal notranslate"><span class="pre">truncate</span></code> indica que  <em>strings</em> com tamanho maior do que 20 caracteres são truncadas. O último parâmetro, <code class="docutils literal notranslate"><span class="pre">vertical</span></code>, indica que a saída é composta por um conjunto de linhas divididas em colunas (forma de uma tabela). Caso seja especificado <code class="docutils literal notranslate"><span class="pre">vertical=True</span></code>, cada coluna de cada linha é exibida em uma linha diferente.</p>
</section>
<section id="id130">
<h3>Método printSchema()<a class="headerlink" href="#id130" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">printSchema()</span></code></p>
<p>Mostra o esquema do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> no formato de uma árvore. São exibidos os nomes das colunas e os tipos de dados dessas colunas. <code class="docutils literal notranslate"><span class="pre">nullable</span> <span class="pre">=</span> <span class="pre">true</span></code> indica que o valor nulo é usado para indicar valores que não são conhecidos ou que são foram preenchidos quando o arquivo foi lido em um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
</section>
<section id="id131">
<h3>Método write.csv()<a class="headerlink" href="#id131" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">write.csv()</span></code></p>
<p>Realiza a escrita dos dados de um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> em um arquivo <code class="docutils literal notranslate"><span class="pre">.csv</span></code>. Podem ser definidos vários parâmetros, como <code class="docutils literal notranslate"><span class="pre">path</span></code> para indicar o endereço do arquivo que é escrito, <code class="docutils literal notranslate"><span class="pre">header</span></code> para armazenar os nomes das colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> como um cabeçalho do arquivo e <code class="docutils literal notranslate"><span class="pre">sep</span></code> para especificar o caractere que separa os campos do arquivo. Uma lista completa desses parâmetros pode ser encontrada neste <a class="reference external" href="https://docs.databricks.com/data/data-sources/read-csv.html">link</a>.</p>
</section>
</section>
<section id="id132">
<h2>4.2 Criação dos DataFrames<a class="headerlink" href="#id132" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cargo</span>
<span class="n">cargo</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|cargoPK|           cargoNome|cargoRegimeTrabalho|cargoJornadaTrabalho|cargoEscolaridadeMinima|cargoNivel|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
|      1|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                  MEDIO|    JUNIOR|
|      2|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|               SUPERIOR|     PLENO|
|      3|PROGRAMADOR DE SI...|         TEMPORARIO|                 20H|                    POS|    SENIOR|
|      4|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|                  MEDIO|    JUNIOR|
|      5|PROGRAMADOR DE SI...|         TEMPORARIO|                 40H|               SUPERIOR|     PLENO|
+-------+--------------------+-------------------+--------------------+-----------------------+----------+
only showing top 5 rows

root
 |-- cargoPK: string (nullable = true)
 |-- cargoNome: string (nullable = true)
 |-- cargoRegimeTrabalho: string (nullable = true)
 |-- cargoJornadaTrabalho: string (nullable = true)
 |-- cargoEscolaridadeMinima: string (nullable = true)
 |-- cargoNivel: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão cliente</span>
<span class="n">cliente</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|clientePK|clienteNomeFantasia|       clienteSetor|clienteCidade|clienteEstadoNome|clienteEstadoSigla|clienteRegiaoNome|clienteRegiaoSigla|clientePaisNome|clientePaisSigla|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
|        1|           VIA FOOD|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        2|          VIA PIZZA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        3|           VIA JAPA|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        4|            VIA VEG|BEBIDAS E ALIMENTOS|    SAO PAULO|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
|        5|          VIA DRINK|BEBIDAS E ALIMENTOS|   SAO CARLOS|        SAO PAULO|                SP|          SUDESTE|                SE|         BRASIL|              BR|
+---------+-------------------+-------------------+-------------+-----------------+------------------+-----------------+------------------+---------------+----------------+
only showing top 5 rows

root
 |-- clientePK: string (nullable = true)
 |-- clienteNomeFantasia: string (nullable = true)
 |-- clienteSetor: string (nullable = true)
 |-- clienteCidade: string (nullable = true)
 |-- clienteEstadoNome: string (nullable = true)
 |-- clienteEstadoSigla: string (nullable = true)
 |-- clienteRegiaoNome: string (nullable = true)
 |-- clienteRegiaoSigla: string (nullable = true)
 |-- clientePaisNome: string (nullable = true)
 |-- clientePaisSigla: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/data.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> 
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+------------+-------+-------+------------+-------------+------------+-------+
|dataPK|dataCompleta|dataDia|dataMes|dataBimestre|dataTrimestre|dataSemestre|dataAno|
+------+------------+-------+-------+------------+-------------+------------+-------+
|     1|    1/1/2016|      1|      1|           1|            1|           1|   2016|
|     2|    2/1/2016|      2|      1|           1|            1|           1|   2016|
|     3|    3/1/2016|      3|      1|           1|            1|           1|   2016|
|     4|    4/1/2016|      4|      1|           1|            1|           1|   2016|
|     5|    5/1/2016|      5|      1|           1|            1|           1|   2016|
+------+------------+-------+-------+------------+-------------+------------+-------+
only showing top 5 rows

root
 |-- dataPK: string (nullable = true)
 |-- dataCompleta: string (nullable = true)
 |-- dataDia: string (nullable = true)
 |-- dataMes: string (nullable = true)
 |-- dataBimestre: string (nullable = true)
 |-- dataTrimestre: string (nullable = true)
 |-- dataSemestre: string (nullable = true)
 |-- dataAno: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de dimensão equipe</span>
<span class="n">equipe</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|equipePK|   equipeNome|          filialNome|  filialCidade|  filialEstadoNome|filialEstadoSigla|filialRegiaoNome|filialRegiaoSigla|filialPaisNome|filialPaisSigla|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
|       1|APP - DESKTOP|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       2|APP - DESKTOP|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       3|          WEB|SAO PAULO - AV. P...|     SAO PAULO|         SAO PAULO|               SP|         SUDESTE|               SE|        BRASIL|             BR|
|       4|          WEB|RIO DE JANEIRO - ...|RIO DE JANEIRO|    RIO DE JANEIRO|               RJ|         SUDESTE|               SE|        BRASIL|             BR|
|       5|          WEB|CAMPO GRANDE - CE...|  CAMPO GRANDE|MATO GROSSO DO SUL|               MS|    CENTRO-OESTE|               CO|        BRASIL|             BR|
+--------+-------------+--------------------+--------------+------------------+-----------------+----------------+-----------------+--------------+---------------+
only showing top 5 rows

root
 |-- equipePK: string (nullable = true)
 |-- equipeNome: string (nullable = true)
 |-- filialNome: string (nullable = true)
 |-- filialCidade: string (nullable = true)
 |-- filialEstadoNome: string (nullable = true)
 |-- filialEstadoSigla: string (nullable = true)
 |-- filialRegiaoNome: string (nullable = true)
 |-- filialRegiaoSigla: string (nullable = true)
 |-- filialPaisNome: string (nullable = true)
 |-- filialPaisSigla: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos funcionario</span>
<span class="n">funcionario</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 5 rows

root
 |-- funcPK: string (nullable = true)
 |-- funcMatricula: string (nullable = true)
 |-- funcNome: string (nullable = true)
 |-- funcSexo: string (nullable = true)
 |-- funcDataNascimento: string (nullable = true)
 |-- funcDiaNascimento: string (nullable = true)
 |-- funcMesNascimento: string (nullable = true)
 |-- funcAnoNascimento: string (nullable = true)
 |-- funcCidade: string (nullable = true)
 |-- funcEstadoNome: string (nullable = true)
 |-- funcEstadoSigla: string (nullable = true)
 |-- funcRegiaoNome: string (nullable = true)
 |-- funcRegiaoSigla: string (nullable = true)
 |-- funcPaisNome: string (nullable = true)
 |-- funcPaisSigla: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos negociacao</span>
<span class="n">negociacao</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+---------+------+--------+---------------------+
|equipePK|clientePK|dataPK| receita|quantidadeNegociacoes|
+--------+---------+------+--------+---------------------+
|       2|        9|    22|11564.75|                    1|
|       2|       24|    11| 17990.5|                    1|
|       2|       28|    21| 16335.9|                    1|
|       1|       30|    23| 8495.55|                    1|
|       2|       43|    30|24748.75|                    1|
+--------+---------+------+--------+---------------------+
only showing top 5 rows

root
 |-- equipePK: string (nullable = true)
 |-- clientePK: string (nullable = true)
 |-- dataPK: string (nullable = true)
 |-- receita: string (nullable = true)
 |-- quantidadeNegociacoes: string (nullable = true)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando e exibindo o DataFrame para a tabela de fatos pagamento</span>
<span class="n">pagamento</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+--------+---------------------+
|funcPK|equipePK|dataPK|cargoPK| salario|quantidadeLancamentos|
+------+--------+------+-------+--------+---------------------+
|   147|       2|     5|     64| 1559.94|                    1|
|   124|       2|     5|    329| 8102.77|                    1|
|   175|       1|     5|    328| 2532.51|                    1|
|   171|       1|     5|    245|  7882.7|                    1|
|   148|       2|     5|     65| 4404.59|                    1|
|     5|       2|     5|    112| 2226.66|                    1|
|   128|       1|     5|    341| 6157.04|                    1|
|    82|       2|     5|     43| 1585.51|                    1|
|    28|       1|     5|    253| 1594.02|                    1|
|    46|       1|     5|    390| 9880.16|                    1|
|    91|       2|     5|    233|10931.47|                    1|
|   176|       2|     5|    241| 2005.49|                    1|
|   172|       1|     5|    351|14218.28|                    1|
|   155|       1|     5|    121| 2002.57|                    1|
|    19|       2|     5|    223| 1778.26|                    1|
|    94|       1|     5|    394|  2505.1|                    1|
|    26|       2|     5|    350| 9162.46|                    1|
|    55|       2|     5|    313| 3215.53|                    1|
|    29|       1|     5|     62| 4128.44|                    1|
|   181|       1|     5|    249|11082.75|                    1|
+------+--------+------+-------+--------+---------------------+
only showing top 20 rows

root
 |-- funcPK: string (nullable = true)
 |-- equipePK: string (nullable = true)
 |-- dataPK: string (nullable = true)
 |-- cargoPK: string (nullable = true)
 |-- salario: string (nullable = true)
 |-- quantidadeLancamentos: string (nullable = true)
</pre></div>
</div>
</div>
</div>
</section>
<section id="id133">
<h2>4.3 Manipulação da Tipagem dos Dados<a class="headerlink" href="#id133" title="Permalink to this heading">#</a></h2>
<p>Como pode ser observado nos comandos relativos ao método <code class="docutils literal notranslate"><span class="pre">printSchema()</span></code> aplicado a cada um dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> gerados, todos os tipos de dados importados são <em>string</em>. Entretanto, alguns valores devem ser do tipo de dado <em>numérico</em>. Portanto, primeiramente é usado o método <code class="docutils literal notranslate"><span class="pre">cast()</span></code> para a conversão entre os tipos de dados e depois o método <code class="docutils literal notranslate"><span class="pre">withColumn()</span></code> para substituir a colunas existentes por novas colunas contendo os valores convertidos.</p>
<p>É importante salientar que, mesmo que o parâmetro <code class="docutils literal notranslate"><span class="pre">inferSchema</span></code> fosse especificado como <code class="docutils literal notranslate"><span class="pre">true</span></code> no método <code class="docutils literal notranslate"><span class="pre">spark.read.csv()</span></code>, ainda existiria a necessidade de se verificar os tipos de dados e realizar a conversão caso necessário.</p>
<section id="id134">
<h3>Método cast()<a class="headerlink" href="#id134" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cast(tipoDeDado)</span></code></p>
<p>Converte o atributo para o <code class="docutils literal notranslate"><span class="pre">tipoDeDado</span></code> passado como parâmetro. Podem ser definidos os seguintes valores para <code class="docutils literal notranslate"><span class="pre">tipoDeDado</span></code>: DataType, NullType, StringType, BinaryType, BooleanType, DateType, TimestampType, DecimalType, DoubleType, FloatType, ByteType, IntegerType, LongType, ShortType, ArrayType, MapType, StructField, StructType.</p>
</section>
<section id="id135">
<h3>Método withColumn()<a class="headerlink" href="#id135" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">withColumn(nomeColuna,</span> <span class="pre">exprColuna)</span></code></p>
<p>Retorna um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> adicionando uma coluna de <code class="docutils literal notranslate"><span class="pre">nomeColuna</span></code> ou substituindo uma coluna existente que possui o mesmo nome <code class="docutils literal notranslate"><span class="pre">nomeColuna</span></code>, usando o parâmetro <code class="docutils literal notranslate"><span class="pre">exprColuna</span></code> para o preenchimento dos valores daquela coluna.</p>
<p>Este comando considera o <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> sobre o qual ele foi aplicado, não permitindo adicionar a esse <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> colunas de um segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
</section>
</section>
<section id="id136">
<h2>4.4 Atualização dos Tipos de Dados<a class="headerlink" href="#id136" title="Permalink to this heading">#</a></h2>
<p>Nos comandos a seguir, primeiro são identificados quais colunas de quais <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser do tipo de dado inteiro. Na sequência, ocorre a conversão. Por fim, são exibidos os esquemas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, possibilitando visualizar a mudança de tipo de dados das colunas especificadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># identificando quais colunas de quais DataFrames devem ser do tipo de dado inteiro</span>
<span class="n">colunas_cargo</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">]</span>
<span class="n">colunas_cliente</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;clientePK&quot;</span><span class="p">]</span>
<span class="n">colunas_data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dataPk&quot;</span><span class="p">,</span> <span class="s2">&quot;dataDia&quot;</span><span class="p">,</span> <span class="s2">&quot;dataMes&quot;</span><span class="p">,</span> <span class="s2">&quot;dataBimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">]</span>
<span class="n">colunas_equipe</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;equipePK&quot;</span><span class="p">]</span>
<span class="n">colunas_funcionario</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;funcDiaNascimento&quot;</span><span class="p">,</span> <span class="s2">&quot;funcMesNascimento&quot;</span><span class="p">,</span> <span class="s2">&quot;funcAnoNascimento&quot;</span><span class="p">]</span>
<span class="n">colunas_negociacao</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;clientePK&quot;</span><span class="p">,</span> <span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeNegociacoes&quot;</span><span class="p">]</span>
<span class="n">colunas_pagamento</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importando o tipo de dado desejado</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span>


<span class="c1"># atualizando o tipo de dado das colunas especificadas </span>
<span class="c1"># substituindo as colunas já existentes </span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_cargo</span><span class="p">:</span>
  <span class="n">cargo</span> <span class="o">=</span> <span class="n">cargo</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">cargo</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_cliente</span><span class="p">:</span>
  <span class="n">cliente</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">cliente</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_data</span><span class="p">:</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_equipe</span><span class="p">:</span>
  <span class="n">equipe</span> <span class="o">=</span> <span class="n">equipe</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">equipe</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_funcionario</span><span class="p">:</span>
  <span class="n">funcionario</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">funcionario</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_negociacao</span><span class="p">:</span>
  <span class="n">negociacao</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">negociacao</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_pagamento</span><span class="p">:</span>
  <span class="n">pagamento</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo o esquema dos DataFrames após as alterações realizadas</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>root
 |-- cargoPK: integer (nullable = true)
 |-- cargoNome: string (nullable = true)
 |-- cargoRegimeTrabalho: string (nullable = true)
 |-- cargoJornadaTrabalho: string (nullable = true)
 |-- cargoEscolaridadeMinima: string (nullable = true)
 |-- cargoNivel: string (nullable = true)

root
 |-- clientePK: integer (nullable = true)
 |-- clienteNomeFantasia: string (nullable = true)
 |-- clienteSetor: string (nullable = true)
 |-- clienteCidade: string (nullable = true)
 |-- clienteEstadoNome: string (nullable = true)
 |-- clienteEstadoSigla: string (nullable = true)
 |-- clienteRegiaoNome: string (nullable = true)
 |-- clienteRegiaoSigla: string (nullable = true)
 |-- clientePaisNome: string (nullable = true)
 |-- clientePaisSigla: string (nullable = true)

root
 |-- dataPk: integer (nullable = true)
 |-- dataCompleta: string (nullable = true)
 |-- dataDia: integer (nullable = true)
 |-- dataMes: integer (nullable = true)
 |-- dataBimestre: integer (nullable = true)
 |-- dataTrimestre: integer (nullable = true)
 |-- dataSemestre: integer (nullable = true)
 |-- dataAno: integer (nullable = true)

root
 |-- equipePK: integer (nullable = true)
 |-- equipeNome: string (nullable = true)
 |-- filialNome: string (nullable = true)
 |-- filialCidade: string (nullable = true)
 |-- filialEstadoNome: string (nullable = true)
 |-- filialEstadoSigla: string (nullable = true)
 |-- filialRegiaoNome: string (nullable = true)
 |-- filialRegiaoSigla: string (nullable = true)
 |-- filialPaisNome: string (nullable = true)
 |-- filialPaisSigla: string (nullable = true)

root
 |-- funcPK: integer (nullable = true)
 |-- funcMatricula: string (nullable = true)
 |-- funcNome: string (nullable = true)
 |-- funcSexo: string (nullable = true)
 |-- funcDataNascimento: string (nullable = true)
 |-- funcDiaNascimento: integer (nullable = true)
 |-- funcMesNascimento: integer (nullable = true)
 |-- funcAnoNascimento: integer (nullable = true)
 |-- funcCidade: string (nullable = true)
 |-- funcEstadoNome: string (nullable = true)
 |-- funcEstadoSigla: string (nullable = true)
 |-- funcRegiaoNome: string (nullable = true)
 |-- funcRegiaoSigla: string (nullable = true)
 |-- funcPaisNome: string (nullable = true)
 |-- funcPaisSigla: string (nullable = true)

root
 |-- funcPK: integer (nullable = true)
 |-- equipePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- cargoPK: integer (nullable = true)
 |-- salario: string (nullable = true)
 |-- quantidadeLancamentos: integer (nullable = true)

root
 |-- equipePK: integer (nullable = true)
 |-- clientePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- receita: string (nullable = true)
 |-- quantidadeNegociacoes: integer (nullable = true)
</pre></div>
</div>
</div>
</div>
<p>Nos comandos a seguir, primeiro são identificados quais colunas de quais <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser do tipo de dado número de ponto flutuante. Na sequência, ocorre a conversão. Por fim, são exibidos os esquemas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, possibilitando visualizar a mudança de tipo de dados das colunas especificadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># identificando quais colunas de quais DataFrames devem ser do tipo de dado número de ponto flutuante</span>
<span class="n">colunas_negociacao</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;receita&quot;</span><span class="p">]</span>
<span class="n">colunas_pagamento</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;salario&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importando o tipo de dado desejado</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">FloatType</span>


<span class="c1"># atualizando o tipo de dado das colunas especificadas </span>
<span class="c1"># substituindo as colunas já existentes </span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_negociacao</span><span class="p">:</span>
  <span class="n">negociacao</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">negociacao</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">FloatType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_pagamento</span><span class="p">:</span>
  <span class="n">pagamento</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">FloatType</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo o esquema dos DataFrames após as alterações realizadas</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>root
 |-- funcPK: integer (nullable = true)
 |-- equipePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- cargoPK: integer (nullable = true)
 |-- salario: float (nullable = true)
 |-- quantidadeLancamentos: integer (nullable = true)

root
 |-- equipePK: integer (nullable = true)
 |-- clientePK: integer (nullable = true)
 |-- dataPK: integer (nullable = true)
 |-- receita: float (nullable = true)
 |-- quantidadeNegociacoes: integer (nullable = true)
</pre></div>
</div>
</div>
</div>
<p>Note que outras conversões de formato também poderiam ser realizadas, como mudar as colunas referentes às datas para o tipo de dado <code class="docutils literal notranslate"><span class="pre">DateType</span></code>.</p>
<p>#5 Métodos Similares às Cláusulas SQL</p>
<p>O módulo <code class="docutils literal notranslate"><span class="pre">pyspark.sql</span></code> oferece diversos métodos com funcionalidades similares às cláusulas da linguagem SQL. Esses métodos são descritos considerando as similaridades com a estrutura básica do comando SELECT, com as funções de agregação e agrupamento e com as operações sobre conjuntos.</p>
</section>
<section id="id137">
<h2>5.1 Estrutura Básica do Comando SELECT<a class="headerlink" href="#id137" title="Permalink to this heading">#</a></h2>
<section id="id138">
<h3>Método select()<a class="headerlink" href="#id138" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">(coluna_1,</span> <span class="pre">...,</span> <span class="pre">coluna_n)</span></code></p>
<p>Lista as colunas definidas, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. É possível utilizar o caractere <code class="docutils literal notranslate"><span class="pre">*</span></code> para indicar que todas as colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> devem ser exibidas.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> da linguagem SQL.</p>
<p>Os comandos a seguir selecionam as duas primeiras colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span> <span class="pre">funcionario</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exemplo que mostra o esquema selecionado</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataFrame[funcPK: int, funcMatricula: string]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo os dados usando o método .take</span>
<span class="c1">#exibindo linha a linha</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Row(funcPK=1, funcMatricula=&#39;M-1&#39;),
 Row(funcPK=2, funcMatricula=&#39;M-2&#39;),
 Row(funcPK=3, funcMatricula=&#39;M-3&#39;),
 Row(funcPK=4, funcMatricula=&#39;M-4&#39;),
 Row(funcPK=5, funcMatricula=&#39;M-5&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo as linhas na forma de tabela</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+
|funcPK|funcMatricula|
+------+-------------+
|     1|          M-1|
|     2|          M-2|
|     3|          M-3|
|     4|          M-4|
|     5|          M-5|
+------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo as linhas na forma de tabela</span>
<span class="c1">#forma de representação alternativa</span>
<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">funcionario</span><span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">],</span> <span class="n">funcionario</span><span class="p">[</span><span class="s2">&quot;funcMatricula&quot;</span><span class="p">])</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+
|funcPK|funcMatricula|
+------+-------------+
|     1|          M-1|
|     2|          M-2|
|     3|          M-3|
|     4|          M-4|
|     5|          M-5|
+------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id139">
<h3>Método selectExpr()<a class="headerlink" href="#id139" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">selectExpr</span> <span class="pre">(expressao_1,</span> <span class="pre">...,</span> <span class="pre">expressao_n)</span></code></p>
<p>Lista as expressões definidas, as quais podem ser nomes de colunas, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Este método é uma variação do método <code class="docutils literal notranslate"><span class="pre">select()</span></code> que permite a especificação de expressões SQL.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona as duas primeiras colunas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span> <span class="pre">funcionario</span></code>, multiplicando a primeira coluna por 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&quot;funcPK * 2&quot;</span><span class="p">,</span> <span class="s2">&quot;funcMatricula&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------+-------------+
|(funcPK * 2)|funcMatricula|
+------------+-------------+
|           2|          M-1|
|           4|          M-2|
|           6|          M-3|
|           8|          M-4|
|          10|          M-5|
+------------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id140">
<h3>Método distinct()<a class="headerlink" href="#id140" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">distinct()</span></code></p>
<p>Retorna um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> contendo apenas linhas cujos valores são diferentes entre si.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, primeiro é listada somente a coluna <code class="docutils literal notranslate"><span class="pre">funcSexo</span></code> de funcionário, mostrando valores repetidos para os sexos. Na sequência, é listada a coluna <code class="docutils literal notranslate"><span class="pre">funcSexo</span></code> de funcionário, porém sem listar valores repetidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+
|funcSexo|
+--------+
|       F|
|       M|
|       M|
|       F|
|       M|
|       M|
|       F|
|       M|
|       M|
|       M|
+--------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcSexo&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+
|funcSexo|
+--------+
|       F|
|       M|
+--------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id141">
<h3>Método filter()<a class="headerlink" href="#id141" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">filter</span> <span class="pre">(condição)</span></code></p>
<p>Filtra as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de acordo com a <code class="docutils literal notranslate"><span class="pre">condição</span></code> especificada, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">where()</span></code>.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona os funcionários do sexo feminino cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> é maior do que 160.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK &gt; 160 AND funcSexo = &#39;F&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|    funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|   161|        M-161|  ABINOA ALMEIDA|       F|          9/5/1990|                9|                5|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   162|        M-162|   ABINOAN ALVES|       F|         10/6/1990|               10|                6|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   166|        M-166|ABIQUEILA BARROS|       F|        14/10/1990|               14|               10|             1990|   SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   169|        M-169|ABISAGUE CARDOSO|       F|         17/1/1990|               17|                1|             1990|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   179|        M-179|   ABKEILA GOMES|       F|        27/11/1957|               27|               11|             1957|BELO HORIZONTE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   180|        M-180|     ADELAR LIMA|       F|        28/12/1958|               28|               12|             1958|      ARAGUARI|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|    OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|     GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|    SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id142">
<h3>Método where()<a class="headerlink" href="#id142" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">where</span> <span class="pre">(condição)</span></code></p>
<p>Filtra as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> de acordo com a condição especificada, criando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">filter()</span></code>.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona os funcionários do sexo feminino cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> é maior do que 160.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;funcPK &gt; 160 AND funcSexo = &#39;F&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|    funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|   161|        M-161|  ABINOA ALMEIDA|       F|          9/5/1990|                9|                5|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   162|        M-162|   ABINOAN ALVES|       F|         10/6/1990|               10|                6|             1990|        RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   166|        M-166|ABIQUEILA BARROS|       F|        14/10/1990|               14|               10|             1990|   SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   169|        M-169|ABISAGUE CARDOSO|       F|         17/1/1990|               17|                1|             1990|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   179|        M-179|   ABKEILA GOMES|       F|        27/11/1957|               27|               11|             1957|BELO HORIZONTE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   180|        M-180|     ADELAR LIMA|       F|        28/12/1958|               28|               12|             1958|      ARAGUARI|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|    OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|     GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|    SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id143">
<h3>Método between()<a class="headerlink" href="#id143" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">between</span> <span class="pre">(valorInferior,</span> <span class="pre">valorSuperior)</span></code></p>
<p>Retorna as linhas cujos valores são maiores ou iguais ao <code class="docutils literal notranslate"><span class="pre">valorInferior</span></code> e menores ou iguais ao <code class="docutils literal notranslate"><span class="pre">valorSuperior</span></code>.</p>
<p>Este método é equivalente ao operador de comparação <code class="docutils literal notranslate"><span class="pre">BETWEEN</span> <span class="pre">...</span> <span class="pre">AND</span></code> da linguagem SQL.</p>
<p>O comando a seguir seleciona os funcionários cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> é maior ou igual a 10 e menor ou igual a 15.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK BETWEEN 10 AND 15&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+---------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|       funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|    funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+---------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
|    10|         M-10| ADETE CARVALHO|       M|        10/10/1990|               10|               10|             1990|        OSASCO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    11|         M-11|     ABD CASTRO|       M|        11/11/1990|               11|               11|             1990|    ARARAQUARA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    12|         M-12|     ABDA COSTA|       F|        12/12/1990|               12|               12|             1990|       BARUERI|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    13|         M-13|    ABDIEL DIAS|       M|         13/1/1990|               13|                1|             1990|RIO DE JANEIRO|RIO DE JANEIRO|             RJ|       SUDESTE|             SE|      BRASIL|           BR|
|    14|         M-14|  ABDALA DUARTE|       M|         14/2/1990|               14|                2|             1990| VOLTA REDONDA|RIO DE JANEIRO|             RJ|       SUDESTE|             SE|      BRASIL|           BR|
|    15|         M-15|ABDALLA FREITAS|       M|         15/3/1990|               15|                3|             1990|ANGRA DOS REIS|RIO DE JANEIRO|             RJ|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+---------------+--------+------------------+-----------------+-----------------+-----------------+--------------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id144">
<h3>Métodos isNull() e isNotNull()<a class="headerlink" href="#id144" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">isNull()</span></code> e <code class="docutils literal notranslate"><span class="pre">isNotNull()</span></code> estão relacionados com a verificação de valores nulos, da seguinte forma:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">isNull()</span></code>: Retorna verdadeiro se o valor do atributo for nulo.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isNotNull()</span></code>: Retorna verdadeiro se o valor do atributo não for nulo.</p></li>
</ul>
<p>Estes métodos são equivalentes aos operadores de comparação <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NULL</span></code> e <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, primeiramente solicita-se a listagem de todas as linhas cujo valor do atributo <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> seja nulo. Nenhuma linha é retornada. Na sequência, são retornadas todas as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">funcionario</span></code>, desde que todos os valores do atributo <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> não são nulos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>

<span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcPK</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+--------+--------+------------------+-----------------+-----------------+-----------------+----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+--------+--------+------------------+-----------------+-----------------+-----------------+----------+--------------+---------------+--------------+---------------+------------+-------------+
+------+-------------+--------+--------+------------------+-----------------+-----------------+-----------------+----------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcPK</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id145">
<h3>Método isin()<a class="headerlink" href="#id145" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">isin(listaDeValores)</span></code></p>
<p>Retorna verdadeiro se o valor do atributo estiver contido na <code class="docutils literal notranslate"><span class="pre">listaDeValores</span></code> passada como parâmetro.</p>
<p>Este método é equivalente ao operador de comparação <code class="docutils literal notranslate"><span class="pre">IN</span></code> da linguagem SQL.</p>
<p>No comando a seguir, são listados os dados dos funcionários cujo valor de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> está contido na lista identificada pelos valores <code class="docutils literal notranslate"><span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="p">[</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcPK</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])]</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|     funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     1|          M-1|ALINE ALMEIDA|       F|          1/1/1990|                1|                1|             1990|  SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     2|          M-2|   ARAO ALVES|       M|          2/2/1990|                2|                2|             1990|   CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     3|          M-3| ARON ANDRADE|       M|          3/3/1990|                3|                3|             1990|     SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     4|          M-4|  ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|     5|          M-5|ABADE BATISTA|       M|          5/5/1990|                5|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+-------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id146">
<h3>Método like()<a class="headerlink" href="#id146" title="Permalink to this heading">#</a></h3>
<p>like(expressão)</p>
<p>Quando aplicado a uma coluna de um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, retorna as linhas que são similares à <code class="docutils literal notranslate"><span class="pre">expressão</span></code> definida como parâmetro.</p>
<p>A comparação é sensível ao caso. Pode ser utilizado % para substituir qualquer <em>string</em>.</p>
<p>Este método é equivalente ao operador de comparação <code class="docutils literal notranslate"><span class="pre">LIKE</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">funcionario</span><span class="o">.</span><span class="n">funcNome</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">&#39;ADA%&#39;</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+--------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|      funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento| funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+--------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
|     4|          M-4|   ADA BARBOSA|       F|          4/4/1990|                4|                4|             1990|SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|    52|         M-52|ADAILTON COSTA|       M|         21/4/1951|               21|                4|             1951|     RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   113|        M-113|    ADAIR DIAS|       F|         21/5/1990|               21|                5|             1990| PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+--------------+--------+------------------+-----------------+-----------------+-----------------+-----------+--------------+---------------+--------------+---------------+------------+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id147">
<h3>Método withColumnRenamed()<a class="headerlink" href="#id147" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">withColumnRenamed(nomeColunaAtual,</span> <span class="pre">novoNomeColuna)</span></code></p>
<p>Renomeia o nome de uma coluna já existente, identificado pelo parâmetro <code class="docutils literal notranslate"><span class="pre">nomeColunaAtual</span></code>, para o novo nome identificado pelo parâmetro <code class="docutils literal notranslate"><span class="pre">novoNomeColuna</span></code>.</p>
<p>Este método é equivalente à cláusula AS da linguagem SQL quando utilizada para renomear atributos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+-------+---------------------+
|funcPK|equipePK|dataPK|cargoPK|salario|quantidadeLancamentos|
+------+--------+------+-------+-------+---------------------+
|   147|       2|     5|     64|1559.94|                    1|
|   124|       2|     5|    329|8102.77|                    1|
+------+--------+------+-------+-------+---------------------+
only showing top 2 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">,</span> <span class="s2">&quot;Salário do funcionário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+------+-------+----------------------+---------------------+
|funcPK|equipePK|dataPK|cargoPK|Salário do funcionário|quantidadeLancamentos|
+------+--------+------+-------+----------------------+---------------------+
|   147|       2|     5|     64|               1559.94|                    1|
|   124|       2|     5|    329|               8102.77|                    1|
+------+--------+------+-------+----------------------+---------------------+
only showing top 2 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id148">
<h3>Método crossJoin()<a class="headerlink" href="#id148" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">crossJoin(segundoDataFrame)</span></code></p>
<p>Retorna o produto cartesiano de dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, criando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. É passado como parâmetro o segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>No produto cartesiano, quaisquer duas linhas são combinadas, independentemente da integridade referencial existente entre elas. Portanto, como resultado, são produzidas todas as combinações de linhas possíveis entre os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> participantes.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">FROM</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, é feito o produto cartesiano dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> relacionados a <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>, mostrando que <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> pode ser diferente de <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcSelecionado</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
<span class="n">pagSelecionado</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">select</span> <span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;salario&#39;</span><span class="p">)</span>
<span class="n">funcSelecionado</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">pagSelecionado</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+------+-------+
|funcPK|funcMatricula|funcPK|salario|
+------+-------------+------+-------+
|     1|          M-1|   147|1559.94|
|     2|          M-2|   147|1559.94|
|     3|          M-3|   147|1559.94|
|     4|          M-4|   147|1559.94|
|     5|          M-5|   147|1559.94|
|     6|          M-6|   147|1559.94|
|     7|          M-7|   147|1559.94|
|     8|          M-8|   147|1559.94|
|     9|          M-9|   147|1559.94|
|    10|         M-10|   147|1559.94|
+------+-------------+------+-------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id149">
<h3>Método join()<a class="headerlink" href="#id149" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">join(segundoDataFrame,</span> <span class="pre">on=None,</span> <span class="pre">how=None)</span></code></p>
<p>Retorna a junção de dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, criando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. O primeiro parâmetro indica qual o segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> a ser considerado na junção. O parâmetro <code class="docutils literal notranslate"><span class="pre">on</span></code> indica a condição de junção. O terceiro parâmetro, <code class="docutils literal notranslate"><span class="pre">how</span></code>, especifica como a junção deve ser feita. O valor padrão é <code class="docutils literal notranslate"><span class="pre">inner</span></code>. Também pode ser: <code class="docutils literal notranslate"><span class="pre">cross</span></code>, <code class="docutils literal notranslate"><span class="pre">outer</span></code>, <code class="docutils literal notranslate"><span class="pre">full</span></code>, <code class="docutils literal notranslate"><span class="pre">fullouter</span></code>, <code class="docutils literal notranslate"><span class="pre">full_outer</span></code>, <code class="docutils literal notranslate"><span class="pre">left</span></code>, <code class="docutils literal notranslate"><span class="pre">leftouter</span></code>, <code class="docutils literal notranslate"><span class="pre">left_outer</span></code>, <code class="docutils literal notranslate"><span class="pre">right</span></code>, <code class="docutils literal notranslate"><span class="pre">rightouter</span></code>, <code class="docutils literal notranslate"><span class="pre">right_outer</span></code>.</p>
<p>Na junção,  as linhas são combinadas de acordo com a integridade referencial existente entre elas, a qual deve ser definida no parâmetro <code class="docutils literal notranslate"><span class="pre">on</span></code>.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> da linguagem SQL.</p>
<p>Nos comandos a seguir, é feita a junção interna (<code class="docutils literal notranslate"><span class="pre">inner</span> <span class="pre">join</span></code>) dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> relacionados a <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>, mostrando que <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de funcionario é igual à <code class="docutils literal notranslate"><span class="pre">funcPK</span></code> de <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a junção passo a passo</span>
<span class="n">funcSelecionado</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;funcMatricula&#39;</span><span class="p">)</span>
<span class="n">pagSelecionado</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;salario&#39;</span><span class="p">)</span>
<span class="n">funcSelecionado</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagSelecionado</span><span class="p">,</span> <span class="n">funcSelecionado</span><span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pagSelecionado</span><span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">],</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+------+-------+
|funcPK|funcMatricula|funcPK|salario|
+------+-------------+------+-------+
|   147|        M-147|   147|1559.94|
|   124|        M-124|   124|8102.77|
|   175|        M-175|   175|2532.51|
|   171|        M-171|   171| 7882.7|
|   148|        M-148|   148|4404.59|
|     5|          M-5|     5|2226.66|
|   128|        M-128|   128|6157.04|
|    82|         M-82|    82|1585.51|
|    28|         M-28|    28|1594.02|
|    46|         M-46|    46|9880.16|
+------+-------------+------+-------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># eliminando a coluna funcPK repetida</span>
<span class="n">funcSelecionado</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagSelecionado</span><span class="p">,</span> <span class="s1">&#39;funcPK&#39;</span><span class="p">,</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+-------+
|funcPK|funcMatricula|salario|
+------+-------------+-------+
|   147|        M-147|1559.94|
|   124|        M-124|8102.77|
|   175|        M-175|2532.51|
|   171|        M-171| 7882.7|
|   148|        M-148|4404.59|
|     5|          M-5|2226.66|
|   128|        M-128|6157.04|
|    82|         M-82|1585.51|
|    28|         M-28|1594.02|
|    46|         M-46|9880.16|
+------+-------------+-------+
only showing top 10 rows
</pre></div>
</div>
</div>
</div>
</section>
<section id="id150">
<h3>Método orderBy()<a class="headerlink" href="#id150" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">orderBy</span> <span class="pre">(colunas,</span> <span class="pre">ordena)</span></code></p>
<p>Ordena as linhas resultantes, gerando um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Deve ser especificada uma lista de colunas ou os nomes de colunas a serem considerados na ordenação. Pode ser especificada também a ordenação ascendente ou descendente.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">funcionario</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|          funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|   200|        M-200|     ABRAAO LIMA|       M|         19/8/1978|               19|                8|             1978|          ARARAQUARA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   199|        M-199|   ABRAHAM GOMES|       M|         18/7/1977|               18|                7|             1977|              OSASCO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   198|        M-198|     ADRA GARCIA|       M|         17/6/1976|               17|                6|             1976|SAO JOSE DO RIO P...|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   197|        M-197| ADNAEL FERREIRA|       M|         16/5/1975|               16|                5|             1975|           ILHA BELA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|      RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|          SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   194|        M-194|    ABNER DUARTE|       M|         13/2/1972|               13|                2|             1972|          PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   193|        M-193|    ADNALDO DIAS|       M|         12/1/1971|               12|                1|             1971|         SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   192|        M-192|     ADNEI COSTA|       M|        11/12/1970|               11|               12|             1970|              SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   191|        M-191|    ABNER CASTRO|       M|        10/11/1969|               10|               11|             1969|            CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   190|        M-190| ADNAEL CARVALHO|       M|         9/10/1968|                9|               10|             1968|           SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   189|        M-189|   ABNER CARDOSO|       M|          8/9/1967|                8|                9|             1967|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   188|        M-188|   ADNAEL CAMPOS|       M|          7/8/1966|                7|                8|             1966|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   187|        M-187| ABNADABE BORGES|       M|          6/7/1965|                6|                7|             1965|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   186|        M-186|  ABNADAB BARROS|       M|          5/6/1964|                5|                6|             1964|            MORRETES|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|           GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   184|        M-184| ADMARIO BARBOSA|       M|          3/4/1962|                3|                4|             1962|            LONDRINA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   183|        M-183|   ADMAR ANDRADE|       M|          2/3/1961|                2|                3|             1961|            CURITIBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   182|        M-182|    ABMAEL ALVES|       M|          1/2/1960|                1|                2|             1960|         MONTE VERDE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|          OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funcionario</span><span class="o">.</span><span class="n">orderBy</span><span class="p">([</span><span class="s2">&quot;funcPK&quot;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|funcPK|funcMatricula|        funcNome|funcSexo|funcDataNascimento|funcDiaNascimento|funcMesNascimento|funcAnoNascimento|          funcCidade|funcEstadoNome|funcEstadoSigla|funcRegiaoNome|funcRegiaoSigla|funcPaisNome|funcPaisSigla|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
|   200|        M-200|     ABRAAO LIMA|       M|         19/8/1978|               19|                8|             1978|          ARARAQUARA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   199|        M-199|   ABRAHAM GOMES|       M|         18/7/1977|               18|                7|             1977|              OSASCO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   198|        M-198|     ADRA GARCIA|       M|         17/6/1976|               17|                6|             1976|SAO JOSE DO RIO P...|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   197|        M-197| ADNAEL FERREIRA|       M|         16/5/1975|               16|                5|             1975|           ILHA BELA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   196|        M-196|ABNOAN FERNANDES|       F|         15/4/1974|               15|                4|             1974|      RIBEIRAO PRETO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   195|        M-195|  ABNOAN FREITAS|       F|         14/3/1973|               14|                3|             1973|          SAO CARLOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   194|        M-194|    ABNER DUARTE|       M|         13/2/1972|               13|                2|             1972|          PIRACICABA|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   193|        M-193|    ADNALDO DIAS|       M|         12/1/1971|               12|                1|             1971|         SANTO ANDRE|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   192|        M-192|     ADNEI COSTA|       M|        11/12/1970|               11|               12|             1970|              SANTOS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   191|        M-191|    ABNER CASTRO|       M|        10/11/1969|               10|               11|             1969|            CAMPINAS|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   190|        M-190| ADNAEL CARVALHO|       M|         9/10/1968|                9|               10|             1968|           SAO PAULO|     SAO PAULO|             SP|       SUDESTE|             SE|      BRASIL|           BR|
|   189|        M-189|   ABNER CARDOSO|       M|          8/9/1967|                8|                9|             1967|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   188|        M-188|   ADNAEL CAMPOS|       M|          7/8/1966|                7|                8|             1966|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   187|        M-187| ABNADABE BORGES|       M|          6/7/1965|                6|                7|             1965|              RECIFE|    PERNAMBUCO|             PE|      NORDESTE|             NE|      BRASIL|           BR|
|   186|        M-186|  ABNADAB BARROS|       M|          5/6/1964|                5|                6|             1964|            MORRETES|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   185|        M-185|    ADNA BATISTA|       F|          4/5/1963|                4|                5|             1963|           GUARATUBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   184|        M-184| ADMARIO BARBOSA|       M|          3/4/1962|                3|                4|             1962|            LONDRINA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   183|        M-183|   ADMAR ANDRADE|       M|          2/3/1961|                2|                3|             1961|            CURITIBA|        PARANA|             PR|           SUL|              S|      BRASIL|           BR|
|   182|        M-182|    ABMAEL ALVES|       M|          1/2/1960|                1|                2|             1960|         MONTE VERDE|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
|   181|        M-181| ADILENE ALMEIDA|       F|         29/1/1959|               29|                1|             1959|          OURO PRETO|  MINAS GERAIS|             MG|       SUDESTE|             SE|      BRASIL|           BR|
+------+-------------+----------------+--------+------------------+-----------------+-----------------+-----------------+--------------------+--------------+---------------+--------------+---------------+------------+-------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id151">
<h2>5.2 Agregação e Agrupamento<a class="headerlink" href="#id151" title="Permalink to this heading">#</a></h2>
<p>As funções de agregação e agrupamento somente podem ser aplicadas a tipos de dados numéricos.</p>
<section id="id152">
<h3>Método sum()<a class="headerlink" href="#id152" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">sum(listaDeColunas)</span></code></p>
<p>Calcula a soma dos valores para cada coluna especificada no parâmetro  <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada agrupamento.</p>
<p>Este método é equivalente à função <code class="docutils literal notranslate"><span class="pre">SUM()</span></code> do SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando a soma dos salários e a soma da quantidade de lancamentos</span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">,</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">,</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Soma dos salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+-------------------------------+
|  Soma dos salários|Quantidade Total de Lançamentos|
+-------------------+-------------------------------+
|6.628875631347656E7|                           8640|
+-------------------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id153">
<h3>Método min()<a class="headerlink" href="#id153" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">min(listaDeColunas)</span></code></p>
<p>Calcula o menor valor para cada coluna especificada no parâmetro  <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada agrupamento.</p>
<p>Este método é equivalente à função <code class="docutils literal notranslate"><span class="pre">MIN()</span></code> do SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando o menor salário </span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;min(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Menor Salário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------+
|Menor Salário|
+-------------+
|      1501.57|
+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id154">
<h3>Método max()<a class="headerlink" href="#id154" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">max(listaDeColunas)</span></code></p>
<p>Calcula o maior valor para cada coluna especificada no parâmetro  <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada agrupamento.</p>
<p>Este método é equivalente à função <code class="docutils literal notranslate"><span class="pre">MAX()</span></code> do SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando o maior salário </span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;max(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Maior Salário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------+
|Maior Salário|
+-------------+
|     47140.17|
+-------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id155">
<h3>Método avg()<a class="headerlink" href="#id155" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">avg(listaDeColunas)</span></code></p>
<p>Calcula o valor médio para cada coluna especificada no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada grupo.  Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">mean()</span></code>.</p>
<p>Este método é equivalente à função de agregação <code class="docutils literal notranslate"><span class="pre">AVG()</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+
|Média dos Salários|
+------------------+
|           7672.31|
+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id156">
<h3>Método mean()<a class="headerlink" href="#id156" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">mean(listaDeColunas)</span></code></p>
<p>Calcula o valor médio para cada coluna especificada no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code>, considerando cada grupo.  Este método é equivalente ao método <code class="docutils literal notranslate"><span class="pre">avg()</span></code>.</p>
<p>Este método é equivalente à função de agregação <code class="docutils literal notranslate"><span class="pre">AVG()</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando a média dos salários </span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+
|Média dos Salários|
+------------------+
|           7672.31|
+------------------+
</pre></div>
</div>
</div>
</div>
<p>Método count()</p>
<p><code class="docutils literal notranslate"><span class="pre">count()</span></code></p>
<p>Retorna o número de linhas de um <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Este método é equivalente à função de agregação <code class="docutils literal notranslate"><span class="pre">COUNT()</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retornando a quantidade de linhas de pagamento</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8640
</pre></div>
</div>
</div>
</div>
</section>
<section id="id157">
<h3>Método agg()<a class="headerlink" href="#id157" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">agg(listaDeExpressões)</span></code></p>
<p>Aplica um método de agregação a todas as linhas do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, sem considerar agrupamentos. O parâmetro listaDeExpressões indica, para cada atributo sendo considerado, qual o método de agregação que deve ser aplicado. O método <code class="docutils literal notranslate"><span class="pre">agg()</span></code> representa uma sintaxe resumida para <code class="docutils literal notranslate"><span class="pre">groupBy.agg()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># listando o maior salário e a soma das quantidades de lançamentos</span>
<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;salario&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;max(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Maior Salário&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------+-------------------------------+
|Maior Salário|Quantidade Total de Lançamentos|
+-------------+-------------------------------+
|     47140.17|                           8640|
+-------------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id158">
<h3>Método groupBy()<a class="headerlink" href="#id158" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">groupBy(listaDeColunas)</span></code></p>
<p>Aplica um método de agregação a um grupo de conjunto de linhas, retornando para cada grupo do conjunto de linhas um único valor.</p>
<p>Este método é equivalente à cláusula <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> da linguagem SQL.</p>
<p>O comando a seguir lista, para cada funcPK, a soma dos salários recebidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Soma dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+-----------------+
|funcPK|Soma dos Salários|
+------+-----------------+
|     1|   864589.2890625|
|     2|    80109.1171875|
|     3|   284531.2734375|
|     4|    503910.703125|
|     5|133599.5947265625|
|     6|   248232.9609375|
|     7|     347159.53125|
|     8| 43802.3994140625|
|     9|    628010.859375|
|    10|  332712.01171875|
|    11|   331538.8828125|
|    12|  72875.759765625|
|    13|      289336.3125|
|    14| 150465.603515625|
|    15|    218086.078125|
|    16|  41527.201171875|
|    17| 309711.005859375|
|    18| 45548.3994140625|
|    19|106695.6005859375|
|    20|  95876.162109375|
+------+-----------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id159">
<h2>5.3 Métodos sobre Conjuntos<a class="headerlink" href="#id159" title="Permalink to this heading">#</a></h2>
<section id="id160">
<h3>Métodos union(), unionAll() e unionByName()<a class="headerlink" href="#id160" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">union()</span></code>, <code class="docutils literal notranslate"><span class="pre">unionAll()</span></code> e <code class="docutils literal notranslate"><span class="pre">unionByName()</span></code> têm como objetivo realizar a operação de <code class="docutils literal notranslate"><span class="pre">união</span></code> entre conjuntos considerando dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, tem-se um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que contém todas as linhas pertencentes ao primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, ao segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> ou a ambos os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>.</p>
<p>Os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser compatíveis entre si. Ou seja, eles precisam ter o mesmo número de colunas.</p>
<p>A sintaxe de cada um dos métodos é:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">union(segundoDataFrame)</span></code>: Realiza a união considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. As linhas repetidas não são eliminadas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unionAll(segundoDataFrame)</span></code>: Realiza a união considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. As linhas repetidas não são eliminadas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unionByName(segundoDataFrame)</span></code>: Realiza a união considerando o nome das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente do posicionamento dessas colunas. As linhas repetidas não são eliminadas do resultado final.</p></li>
</ul>
<p>Estes métodos são equipalentes à operação <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code> da linguagem SQL.</p>
<p>Caso haja a necessidade de se eliminar as linhas repetidas do resultado final, é necessário utilizar primeiro um dos métodos de união e, na sequência, aplicar o método <code class="docutils literal notranslate"><span class="pre">distinct()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método union(), sem eliminar linhas repetidas do resultado </span>
<span class="n">pagFiltro</span> <span class="o">=</span> <span class="n">pagamento</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK = 30 AND dataPK BETWEEN 50 AND 100&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">negFiltro</span> <span class="o">=</span> <span class="n">negociacao</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;equipePK = 2 AND dataPK BETWEEN 90 AND 110&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagFiltro</span>\
   <span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">negFiltro</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
|    90|
|    96|
|    96|
|    99|
|    99|
|   109|
+------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método union(), eliminando as linhas repetidas do resultado </span>
<span class="n">pagFiltro</span>\
   <span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">negFiltro</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
|    90|
|    96|
|    99|
|   109|
+------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id161">
<h3>Métodos intersect() e intersectAll()<a class="headerlink" href="#id161" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">intersect()</span></code> e <code class="docutils literal notranslate"><span class="pre">intersectAll()</span></code> têm como objetivo realizar a operação de <code class="docutils literal notranslate"><span class="pre">intersecção</span></code> entre conjuntos considerando dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, tem-se um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que contém todas as linhas presentes simultaneamente no primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> e no segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Os dois DataFrames devem ser compatíveis entre si. Ou seja, eles precisam ter o mesmo número de colunas.</p>
<p>A sintaxe de cada um dos métodos é:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intersect(segundoDataFrame)</span></code>: Realiza a intersecção considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método elimina as linhas repetidas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intersectAll(segundoDataFrame)</span></code>: Realiza a intersecção considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método não elimina as linhas repetidas do resultado final.</p></li>
</ul>
<p>O método <code class="docutils literal notranslate"><span class="pre">intersect()</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">INTERSECT</span></code> da linguagem SQL, enquanto o método <code class="docutils literal notranslate"><span class="pre">intersectAll()</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">INTERSECT</span> <span class="pre">ALL</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método intersect()</span>
<span class="n">pagIntersect</span> <span class="o">=</span> <span class="n">pagamento</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;funcPK = 30 AND dataPK BETWEEN 50 AND 100&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">pagIntersect</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
|    96|
+------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">negIntersect</span> <span class="o">=</span> <span class="n">negociacao</span>\
               <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;equipePK = 2 AND dataPK BETWEEN 90 AND 110&quot;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>
<span class="n">negIntersect</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    90|
|    99|
|    96|
|   109|
|    99|
+------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagIntersect</span>\
   <span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">negIntersect</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    96|
+------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id162">
<h3>Métodos subtract() e exceptAll()<a class="headerlink" href="#id162" title="Permalink to this heading">#</a></h3>
<p>Os métodos <code class="docutils literal notranslate"><span class="pre">subtract()</span></code> e <code class="docutils literal notranslate"><span class="pre">exceptAll()</span></code> têm como objetivo realizar a operação de <code class="docutils literal notranslate"><span class="pre">diferença</span></code> de conjuntos considerando dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, tem-se um novo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> que contém todas as linhas presentes no primeiro <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, mas que não estão no segundo <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Os dois <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser compatíveis entre si. Ou seja, eles precisam ter o mesmo número de colunas.</p>
<p>A sintaxe de cada um dos métodos é:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">subtract(segundoDataFrame)</span></code>: Realiza a diferença entre conjuntos considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método elimina as linhas repetidas do resultado final.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exceptAll(segundoDataFrame)</span></code>: Realiza a diferença entre conjuntos considerando o posicionamento das colunas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, independentemente dos nomes dessas colunas. Esse método não elimina as linhas repetidas do resultado final.</p></li>
</ul>
<p>O método <code class="docutils literal notranslate"><span class="pre">subtract(segundoDataFrame)</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">MINUS</span></code> da linguagem SQL, enquanto que o método <code class="docutils literal notranslate"><span class="pre">exceptAll(segundoDataFrame)</span></code> é equivalente à operação <code class="docutils literal notranslate"><span class="pre">MINUS</span> <span class="pre">ALL</span></code> da linguagem SQL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo do método exceptAll()</span>
<span class="n">pagIntersect</span>\
   <span class="o">.</span><span class="n">exceptAll</span><span class="p">(</span><span class="n">negIntersect</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|    65|
+------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id163">
<h1>6 Execução de Consultas com Foco nas Operações OLAP<a class="headerlink" href="#id163" title="Permalink to this heading">#</a></h1>
<section id="id164">
<h2>6.1 Operação Slice and Dice<a class="headerlink" href="#id164" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Restringe os dados sendo analisados a um subconjunto desses dados.</p>
<ul class="simple">
<li><p>Slice: corte para um valor fixo, diminuindo a dimensionalidade do cubo.</p></li>
<li><p>Dice: seleção de faixas de valores.</p></li>
</ul>
<p><strong>Exemplo de consulta</strong>: Qual a quantidade de pagamentos realizados no mês de setembro de 2020?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de slice and dice utilizando o método filter() ou where()</span>
<span class="c1"># selecionando apenas as colunas necessárias ao processamento da consulta </span>
<span class="n">dataSelecionada</span> <span class="o">=</span> \
   <span class="n">data</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;dataAno = 2020 AND dataMes=9&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>
<span class="n">dataSelecionada</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|  1706|
|  1707|
|  1708|
|  1709|
|  1710|
+------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias ao processamento da consulta</span>
<span class="n">pagamentoSelecionado</span> <span class="o">=</span> \
   <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>
<span class="n">pagamentoSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+---------------------+
|dataPK|quantidadeLancamentos|
+------+---------------------+
|     5|                    1|
|     5|                    1|
|     5|                    1|
|     5|                    1|
|     5|                    1|
+------+---------------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a junção entre os resultados obtidos</span>
<span class="n">dataPagamento</span> <span class="o">=</span>\
   <span class="n">dataSelecionada</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamentoSelecionado</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>
<span class="n">dataPagamento</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+---------------------+
|dataPK|quantidadeLancamentos|
+------+---------------------+
|  1710|                    1|
|  1710|                    1|
|  1710|                    1|
|  1710|                    1|
|  1710|                    1|
+------+---------------------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo o resultado desejado</span>
<span class="n">dataPagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------------------+
|Quantidade Total de Lançamentos|
+-------------------------------+
|                            200|
+-------------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo uma forma alternativa, e considerando apenas um único comando </span>
<span class="n">data</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2020 AND dataMes=9&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">()</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeLancamentos)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantidade Total de Lançamentos&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------------------+
|Quantidade Total de Lançamentos|
+-------------------------------+
|                            200|
+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id165">
<h2>6.2 Operações Drill-Down e Roll-Up<a class="headerlink" href="#id165" title="Permalink to this heading">#</a></h2>
<p><strong>Definição</strong>: Analisam os dados considerando níveis progressivos de agregação.</p>
<ul class="simple">
<li><p>Drill-down: níveis de agregação progressivamente mais detalhados, ou de menor granularidade.</p></li>
<li><p>Roll-up: níveis de agregação progressivamente menos detalhados, ou de maior granularidade.</p></li>
</ul>
<p>Para ilustrar as operações de drill-down e roll-up, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>semestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exibindo a resposta considerando cada semestre</span>

<span class="n">data</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Valor gasto em salários por semestre&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------+------------------------------------+
|dataAno|dataSemestre|Valor gasto em salários por semestre|
+-------+------------+------------------------------------+
|   2016|           1|                          2221308.55|
|   2016|           2|                          2221308.55|
|   2017|           1|                          4887639.92|
|   2017|           2|                          4887639.92|
|   2018|           1|                          7467763.23|
|   2018|           2|                          7467763.23|
|   2019|           1|                          9283833.23|
|   2019|           2|                          9283833.23|
|   2020|           1|                          9283833.23|
|   2020|           2|                          9283833.23|
+-------+------------+------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta drill-down:</strong> Qual o valor gasto em salários por ano, considerando cada <strong>trimestre</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exibindo a resposta considerando cada trimestre (mais detalhes)</span>

<span class="n">data</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Valor gasto em salários por trimestre&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------+-------------------------------------+
|dataAno|dataTrimestre|Valor gasto em salários por trimestre|
+-------+-------------+-------------------------------------+
|   2016|            1|                           1110654.28|
|   2016|            2|                           1110654.28|
|   2016|            3|                           1110654.28|
|   2016|            4|                           1110654.28|
|   2017|            1|                           2443819.96|
|   2017|            2|                           2443819.96|
|   2017|            3|                           2443819.96|
|   2017|            4|                           2443819.96|
|   2018|            1|                           3733881.62|
|   2018|            2|                           3733881.62|
|   2018|            3|                           3733881.62|
|   2018|            4|                           3733881.62|
|   2019|            1|                           4641916.61|
|   2019|            2|                           4641916.61|
|   2019|            3|                           4641916.61|
|   2019|            4|                           4641916.61|
|   2020|            1|                           4641916.61|
|   2020|            2|                           4641916.61|
|   2020|            3|                           4641916.61|
|   2020|            4|                           4641916.61|
+-------+-------------+-------------------------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta roll-up:</strong> Qual o valor gasto em salários por <strong>ano</strong>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exibindo a resposta considerando cada ano (menos detalhes)</span>

<span class="n">data</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Valor gasto em salários por ano&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+-------------------------------+
|dataAno|Valor gasto em salários por ano|
+-------+-------------------------------+
|   2016|                      4442617.1|
|   2017|                     9775279.84|
|   2018|                  1.493552647E7|
|   2019|                  1.856766645E7|
|   2020|                  1.856766645E7|
+-------+-------------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id166">
<h2>6.3 Operação Pivot<a class="headerlink" href="#id166" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Reorienta a visão multidimensional dos dados, oferecendo diferentes perspectivas dos mesmos dados.</p>
<p>Para ilustrar a operação pivot, considere a consulta base definida a seguir.</p>
<p><strong>Consulta base:</strong>  Qual o valor gasto em salários por ano, considerando cada nível de cargo?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span>  <span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Gastos em Salários&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+----------+------------------+
|dataAno|cargoNivel|Gastos em Salários|
+-------+----------+------------------+
|   2016|    JUNIOR|         489456.84|
|   2016|     PLENO|        1454152.44|
|   2016|    SENIOR|        2499007.82|
|   2017|    JUNIOR|         1030642.8|
|   2017|     PLENO|        3791593.94|
|   2017|    SENIOR|         4953043.1|
|   2018|    JUNIOR|         1393282.2|
|   2018|     PLENO|        5357227.46|
|   2018|    SENIOR|        8185016.81|
|   2019|    JUNIOR|        1755714.36|
|   2019|     PLENO|        6132228.26|
|   2019|    SENIOR|     1.067972384E7|
|   2020|    JUNIOR|        1755714.36|
|   2020|     PLENO|        6132228.26|
|   2020|    SENIOR|     1.067972384E7|
+-------+----------+------------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta pivot:</strong> Qual o valor gasto em salários por nível de cargo, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Gastos em Salários&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+-------+------------------+
|cargoNivel|dataAno|Gastos em Salários|
+----------+-------+------------------+
|    JUNIOR|   2016|         489456.84|
|    JUNIOR|   2017|         1030642.8|
|    JUNIOR|   2018|         1393282.2|
|    JUNIOR|   2019|        1755714.36|
|    JUNIOR|   2020|        1755714.36|
|     PLENO|   2016|        1454152.44|
|     PLENO|   2017|        3791593.94|
|     PLENO|   2018|        5357227.46|
|     PLENO|   2019|        6132228.26|
|     PLENO|   2020|        6132228.26|
|    SENIOR|   2016|        2499007.82|
|    SENIOR|   2017|         4953043.1|
|    SENIOR|   2018|        8185016.81|
|    SENIOR|   2019|     1.067972384E7|
|    SENIOR|   2020|     1.067972384E7|
+----------+-------+------------------+
</pre></div>
</div>
</div>
</div>
<section id="id167">
<h3>Método pivot()<a class="headerlink" href="#id167" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pivot(coluna,</span> <span class="pre">valores=None)</span></code></p>
<p>Rotaciona uma <code class="docutils literal notranslate"><span class="pre">coluna</span></code> do <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, e exibe os valores de acordo com o parâmetro <code class="docutils literal notranslate"><span class="pre">valores</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#metodo pivot()</span>

<span class="n">pagamento</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span>  <span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;sum(salario)&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Gastos em Salários&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------------+------------------+------------------+------------------+
|dataAno|Gastos em Salários|            JUNIOR|             PLENO|            SENIOR|
+-------+------------------+------------------+------------------+------------------+
|   2017|         4953043.1|              null|              null|   4953043.1015625|
|   2018|         1393282.2|1393282.1967773438|              null|              null|
|   2020|     1.067972384E7|              null|              null|1.06797238359375E7|
|   2018|        5357227.46|              null|5357227.4560546875|              null|
|   2016|        1454152.44|              null|  1454152.44140625|              null|
|   2019|        6132228.26|              null|6132228.2607421875|              null|
|   2016|         489456.84|489456.84228515625|              null|              null|
|   2017|        3791593.94|              null|3791593.9423828125|              null|
|   2019|     1.067972384E7|              null|              null|1.06797238359375E7|
|   2018|        8185016.81|              null|              null|      8185016.8125|
|   2020|        1755714.36| 1755714.357421875|              null|              null|
|   2020|        6132228.26|              null|6132228.2607421875|              null|
|   2016|        2499007.82|              null|              null|  2499007.81640625|
|   2017|         1030642.8|1030642.7958984375|              null|              null|
|   2019|        1755714.36| 1755714.357421875|              null|              null|
+-------+------------------+------------------+------------------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id168">
<h2>6.4 Operação Drill-Across<a class="headerlink" href="#id168" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Compara medidas numéricas de tabelas de fatos diferentes, utilizando pelo menos uma dimensão em comum.</p>
<p><strong>Exemplo de consulta:</strong> Qual o total gasto com salários e qual o total de receitas recebidas, considerando cada ano?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o primeiro bloco da consulta</span>
<span class="c1"># qual o total de gastos em salários, considerando cada ano? </span>
<span class="n">pag</span> <span class="o">=</span> <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>
<span class="n">pag</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+
|dataAno|        sum(salario)|
+-------+--------------------+
|   2018|1.4935526465332031E7|
|   2019|1.8567666454101562E7|
|   2020|1.8567666454101562E7|
|   2016|   4442617.100097656|
|   2017|    9775279.83984375|
+-------+--------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o segundo bloco da consulta</span>
<span class="n">neg</span> <span class="o">=</span> <span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>
<span class="n">neg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+--------------------+
|dataAno|        sum(receita)|
+-------+--------------------+
|   2018|1.1593539659606934E7|
|   2019| 3.535331833154297E7|
|   2020| 3.022217587109375E7|
|   2016|   4614246.968261719|
|   2017|  7200423.3539123535|
+-------+--------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de drill-across</span>
<span class="c1"># exibindo o resultado final</span>
<span class="n">pag</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">neg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;sum(receita)&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Gasto com Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total de Receitas Recebidas&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------------------------+---------------------------+
|dataAno|Total Gasto com Salários|Total de Receitas Recebidas|
+-------+------------------------+---------------------------+
|   2016|               4442617.1|                 4614246.97|
|   2017|              9775279.84|                 7200423.35|
|   2018|           1.493552647E7|              1.159353966E7|
|   2019|           1.856766645E7|              3.535331833E7|
|   2020|           1.856766645E7|              3.022217587E7|
+-------+------------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id169">
<h2>5.5 Extensões ROLLUP e CUBE<a class="headerlink" href="#id169" title="Permalink to this heading">#</a></h2>
<p><strong>Definição:</strong> Constrém vários níveis de agregação.</p>
<ul class="simple">
<li><p>ROLLUP: criação de subtotais para as combinações dos atributos da lista de agrupamento de acordo com a ordem desses atributos. São criados n+1 níveis de agregação, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
<li><p>CUBE: criação de subtotais para todas as combinações dos atributos da lista de agrupamento. São criados 2ˆn (2 elevado a n) níveis, sendo n o número de atributos especificados na lista de agrupamento.</p></li>
</ul>
<section id="id170">
<h3>Método rollup()<a class="headerlink" href="#id170" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">rollup(listaDeColunas)</span></code></p>
<p>Cria vários níveis de agregação de acordo com a extensão ROLLUP usando as colunas especificadas no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code> e possibilita a definição de um método de agregação sobre essas colunas.</p>
</section>
<section id="id171">
<h3>Método cube()<a class="headerlink" href="#id171" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cube(listaDeColunas)</span></code></p>
<p>Cria vários níveis de agregação de acordo com a extensão CUBE usando as colunas especificadas no parâmetro <code class="docutils literal notranslate"><span class="pre">listaDeColunas</span></code> e possibilita a definição de um método de agregação sobre essas colunas.</p>
<p><strong>Exemplo de consulta com ROLLUP:</strong> Liste as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00. Crie subtotais considerando a ordem dos atributos na lista de agrupamento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cliente</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span>  <span class="s2">&quot;clienteCidade&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">rollup</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;sum(receita) &gt; 3000000&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total de Receitas&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|    8.898370418E7|
|BEBIDAS E ALIMENTOS|          null|    3.540878588E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|       3899358.31|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.96|
|BEBIDAS E ALIMENTOS|     SAO PAULO|       6177945.47|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.57|
|            CREDITO|          null|       6621387.69|
|              SAUDE|          null|    1.831261245E7|
|              SAUDE|        MANAUS|       3329638.24|
|              SAUDE|     SAO PAULO|       3963055.35|
|         TECNOLOGIA|          null|    1.656803299E7|
|         TECNOLOGIA|     SAO PAULO|       9200352.79|
|          VESTUARIO|          null|    1.207288518E7|
|          VESTUARIO|RIO DE JANEIRO|       5948448.13|
|          VESTUARIO|     SAO PAULO|        4686200.3|
+-------------------+--------------+-----------------+
</pre></div>
</div>
</div>
</div>
<p><strong>Exemplo de consulta com CUBE:</strong> Liste todas as agregações que podem ser geradas a partir da soma da receita por setor do cliente e por cidade do cliente, para totais de receita superiores a 3.000.000,00.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cliente</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">cube</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;sum(receita) &gt; 3000000&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;clienteCidade&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
  <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total de Receitas&quot;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+--------------+-----------------+
|       clienteSetor| clienteCidade|Total de Receitas|
+-------------------+--------------+-----------------+
|               null|          null|    8.898370418E7|
|               null|BELO HORIZONTE|       4379523.84|
|               null|  CAMPO GRANDE|       3422117.04|
|               null|      CURITIBA|       3697625.37|
|               null|     FORTALEZA|       3391233.25|
|               null|        MANAUS|       5234539.23|
|               null|       MARILIA|       7289146.09|
|               null|  PORTO ALEGRE|       4319625.71|
|               null|        RECIFE|       4717719.46|
|               null|RIO DE JANEIRO|    1.525596269E7|
|               null|    SAO CARLOS|       4192741.95|
|               null|     SAO PAULO|    2.464599961E7|
|               null|    UBERLANDIA|        4357595.2|
|BEBIDAS E ALIMENTOS|          null|    3.540878588E7|
|BEBIDAS E ALIMENTOS|BELO HORIZONTE|        4206811.8|
|BEBIDAS E ALIMENTOS|       MARILIA|        4033680.5|
|BEBIDAS E ALIMENTOS|        RECIFE|       3899358.31|
|BEBIDAS E ALIMENTOS|RIO DE JANEIRO|       7351629.96|
|BEBIDAS E ALIMENTOS|     SAO PAULO|       6177945.47|
|BEBIDAS E ALIMENTOS|    UBERLANDIA|       3283351.57|
+-------------------+--------------+-----------------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id172">
<h1>7 Execução de Consultas com Foco na Tomada de Decisão<a class="headerlink" href="#id172" title="Permalink to this heading">#</a></h1>
<p>As consultas OLAP requisitadas por usuários de sistemas de suporte à decisão usualmente requerem que várias operações OLAP sejam realizadas simultaneamente. A seguir são ilustrados exemplos de consultas OLAP que podem ser requisitadas para a tomada de decisão estratégica.</p>
<section id="id173">
<h2>7.1 Consulta 1<a class="headerlink" href="#id173" title="Permalink to this heading">#</a></h2>
<p>Qual é a média dos salários recebidos por nível do cargo e por sexo no ano de 2019?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">cargo</span></code>, <code class="docutils literal notranslate"><span class="pre">funcionario</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.cargoPK</span> <span class="pre">=</span> <span class="pre">cargo.cargoPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.funcPK</span> <span class="pre">=</span> <span class="pre">funcionario.funcPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de slice and dice utilizando o método filter()</span>
<span class="c1"># selecionando apenas as colunas necessárias ao processamento da consulta </span>
<span class="n">dataSelecionada</span> <span class="o">=</span>\
   <span class="n">data</span>\
   <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;dataAno = 2019&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>
<span class="n">dataSelecionada</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+
|dataPK|
+------+
|  1097|
|  1098|
|  1099|
|  1100|
|  1101|
+------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias de funcionario </span>
<span class="n">funcionarioSelecionado</span> <span class="o">=</span>\
   <span class="n">funcionario</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>
<span class="n">funcionarioSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+--------+
|funcPK|funcSexo|
+------+--------+
|     1|       F|
|     2|       M|
|     3|       M|
|     4|       F|
|     5|       M|
+------+--------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias de cargo</span>
<span class="n">cargoSelecionado</span> <span class="o">=</span> \
   <span class="n">cargo</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoNivel&quot;</span><span class="p">)</span>
<span class="n">cargoSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+----------+
|cargoPK|cargoNivel|
+-------+----------+
|      1|    JUNIOR|
|      2|     PLENO|
|      3|    SENIOR|
|      4|    JUNIOR|
|      5|     PLENO|
|      6|    SENIOR|
|      7|    JUNIOR|
|      8|     PLENO|
|      9|    SENIOR|
|     10|    JUNIOR|
|     11|     PLENO|
|     12|    SENIOR|
|     13|    JUNIOR|
|     14|     PLENO|
|     15|    SENIOR|
|     16|    JUNIOR|
|     17|     PLENO|
|     18|    SENIOR|
|     19|    JUNIOR|
|     20|     PLENO|
+-------+----------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># selecionando apenas as colunas necessárias de pagamento</span>
<span class="n">pagamentoSelecionado</span> <span class="o">=</span> \
   <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoPK&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>
<span class="n">pagamentoSelecionado</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------+------+-------+--------+
|dataPK|funcPK|cargoPK| salario|
+------+------+-------+--------+
|     5|   147|     64| 1559.94|
|     5|   124|    329| 8102.77|
|     5|   175|    328| 2532.51|
|     5|   171|    245|  7882.7|
|     5|   148|     65| 4404.59|
|     5|     5|    112| 2226.66|
|     5|   128|    341| 6157.04|
|     5|    82|     43| 1585.51|
|     5|    28|    253| 1594.02|
|     5|    46|    390| 9880.16|
|     5|    91|    233|10931.47|
|     5|   176|    241| 2005.49|
|     5|   172|    351|14218.28|
|     5|   155|    121| 2002.57|
|     5|    19|    223| 1778.26|
|     5|    94|    394|  2505.1|
|     5|    26|    350| 9162.46|
|     5|    55|    313| 3215.53|
|     5|    29|     62| 4128.44|
|     5|   181|    249|11082.75|
+------+------+-------+--------+
only showing top 20 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#realizando as junções par a par</span>
<span class="n">pagamentoData</span> <span class="o">=</span> \
   <span class="n">pagamentoSelecionado</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataSelecionada</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>

<span class="n">pagamentoDataFunc</span> <span class="o">=</span> \
   <span class="n">pagamentoData</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">funcionarioSelecionado</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>

<span class="n">pagamentoDataFuncCargo</span> <span class="o">=</span> \
   <span class="n">pagamentoDataFunc</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargoSelecionado</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>
   
<span class="n">pagamentoDataFuncCargo</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------+------+------+-------+--------+----------+
|cargoPK|funcPK|dataPK|salario|funcSexo|cargoNivel|
+-------+------+------+-------+--------+----------+
|     64|   147|  1101|1559.94|       F|    JUNIOR|
|    329|   124|  1101|8102.77|       M|     PLENO|
|    328|   175|  1101|2532.51|       M|    JUNIOR|
|    245|   171|  1101| 7882.7|       M|     PLENO|
|     65|   148|  1101|4404.59|       M|     PLENO|
+-------+------+------+-------+--------+----------+
only showing top 5 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#exibindo e calculando o resultado final</span>
<span class="n">pagamentoDataFuncCargo</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span><span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a consulta em um único comando</span>

<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">funcionario</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;funcPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2019&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span> <span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;cargoNivel&quot;</span><span class="p">,</span><span class="s2">&quot;funcSexo&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Média dos Salários&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----------+--------+------------------+
|cargoNivel|funcSexo|Média dos Salários|
+----------+--------+------------------+
|    JUNIOR|       F|           2440.23|
|    JUNIOR|       M|           2437.86|
|     PLENO|       F|           7641.94|
|     PLENO|       M|           6259.61|
|    SENIOR|       F|          12994.19|
|    SENIOR|       M|           14480.5|
+----------+--------+------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id174">
<h2>7.2 Consulta 2<a class="headerlink" href="#id174" title="Permalink to this heading">#</a></h2>
<p>Qual o total de gastos em salários considerando os estados nos quais as equipes estão localizadas no trimestre 3 do ano de 2020?</p>
<p>Para se realizar esta consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como da tabela de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code>. A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipePK</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2019 AND dataTrimestre = 3&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;filialEstadoNome&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;filialEstadoNome&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;Total&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+------------------+----------+
|  filialEstadoNome|     Total|
+------------------+----------+
|        PERNAMBUCO| 438121.26|
|MATO GROSSO DO SUL|1013857.75|
|    RIO DE JANEIRO|1258479.58|
|         SAO PAULO|1931458.02|
+------------------+----------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id175">
<h2>7.3 Consulta 3<a class="headerlink" href="#id175" title="Permalink to this heading">#</a></h2>
<p>Qual o custo/benefício das equipes quando analisado o semestre 1 do ano de 2020?</p>
<p>A idea da consulta é relacionar os gastos em salários e os ganhos em receitas considerando cada equipe e o período especificado. Portanto, para se realizar essa consulta, é necessário obter dados das tabelas de dimensão <code class="docutils literal notranslate"><span class="pre">equipe</span></code> e <code class="docutils literal notranslate"><span class="pre">data</span></code>, bem como das tabelas de fatos <code class="docutils literal notranslate"><span class="pre">pagamento</span></code> e <code class="docutils literal notranslate"><span class="pre">negociacao</span></code>.</p>
<p>A junção estrela deve ocorrer considerando as seguintes integridades referenciais:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pagamento.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.dataPK</span> <span class="pre">=</span> <span class="pre">data.dataPK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">negociacao.equipePK</span> <span class="pre">=</span> <span class="pre">equipe.equipe.PK</span></code></p></li>
</ul>
<p>Uma observação muito importante refere-se ao fato que, para evitar dubiedade nas respostas, elas devem ser feitas sempre considerando a chave primária, desde que a chave primária identifica univocamente cada linha. Depois de ser resolvida a consulta em termos da chave primária, então deve ser obtido os demais atributos a serem exibidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o primeiro bloco da consulta</span>
<span class="c1"># identificando para cada equipePK qual o total em gastos com salários</span>
<span class="n">pag</span> <span class="o">=</span> <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataSemestre = 1 AND dataAno = 2020&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>
<span class="n">pag</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+
|equipePK|      sum(salario)|
+--------+------------------+
|       1|1160327.4052734375|
|       2|1060981.1447753906|
|       3|  1177330.32421875|
|       4| 579893.9384765625|
|       5| 909107.1071777344|
|       6| 585430.8479003906|
|       7| 876084.0717773438|
|       8|1118608.3930664062|
|       9| 939827.4675292969|
|      10| 876242.5268554688|
+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolvendo o segundo bloco da consulta</span>
<span class="c1"># identificando para cada equipePK qual o total em ganhos com receitas</span>
<span class="n">neg</span> <span class="o">=</span> <span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataSemestre = 1 AND dataAno = 2020&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>
<span class="n">neg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+
|equipePK|      sum(receita)|
+--------+------------------+
|       1|1259907.2412109375|
|       2|1338994.3959960938|
|       3|     340461.296875|
|       4|340130.64990234375|
|       5| 614747.7039794922|
|       6| 736591.3486328125|
|       7| 722758.4526367188|
|       8| 538659.2993164062|
|       9|      4994717.6875|
|      10| 4664745.689453125|
+--------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># realizando a operação de drill-across</span>
<span class="n">parte</span> <span class="o">=</span> <span class="n">pag</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">neg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>
<span class="n">parte</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+------------------+
|equipePK|      sum(salario)|      sum(receita)|
+--------+------------------+------------------+
|       1|1160327.4052734375|1259907.2412109375|
|       6| 585430.8479003906| 736591.3486328125|
|       3|  1177330.32421875|     340461.296875|
|       5| 909107.1071777344| 614747.7039794922|
|       9| 939827.4675292969|      4994717.6875|
|       4| 579893.9384765625|340130.64990234375|
|       8|1118608.3930664062| 538659.2993164062|
|       7| 876084.0717773438| 722758.4526367188|
|      10| 876242.5268554688| 4664745.689453125|
|       2|1060981.1447753906|1338994.3959960938|
+--------+------------------+------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># renomeando as colunas </span>
<span class="n">parte</span> <span class="o">=</span> <span class="n">parte</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalSalario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalReceita&quot;</span><span class="p">)</span>

<span class="c1">#criando a coluna Lucro solicitada</span>
<span class="n">parte</span> <span class="o">=</span> <span class="n">parte</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Lucro&quot;</span><span class="p">,</span> <span class="n">parte</span><span class="p">[</span><span class="s2">&quot;TotalReceita&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">parte</span><span class="p">[</span><span class="s2">&quot;TotalSalario&quot;</span><span class="p">])</span>
<span class="n">parte</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------+------------------+------------------+-------------------+
|equipePK|      TotalSalario|      TotalReceita|              Lucro|
+--------+------------------+------------------+-------------------+
|       1|1160327.4052734375|1259907.2412109375|      99579.8359375|
|       6| 585430.8479003906| 736591.3486328125| 151160.50073242188|
|       3|  1177330.32421875|     340461.296875|   -836869.02734375|
|       5| 909107.1071777344| 614747.7039794922| -294359.4031982422|
|       9| 939827.4675292969|      4994717.6875|  4054890.219970703|
|       4| 579893.9384765625|340130.64990234375|-239763.28857421875|
|       8|1118608.3930664062| 538659.2993164062|      -579949.09375|
|       7| 876084.0717773438| 722758.4526367188|  -153325.619140625|
|      10| 876242.5268554688| 4664745.689453125| 3788503.1625976562|
|       2|1060981.1447753906|1338994.3959960938|  278013.2512207031|
+--------+------------------+------------------+-------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtendo de equipe os dados semânticos a serem exibidos no resultado</span>
<span class="c1"># exibindo somente as colunas solicitadas</span>
<span class="n">equipe</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parte</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;equipeNome&quot;</span><span class="p">,</span> <span class="s2">&quot;filialNome&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;Lucro&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;Lucro&quot;</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+---------------+
|    equipeNome|          filialNome|round(Lucro, 2)|
+--------------+--------------------+---------------+
|BI &amp; ANALYTICS|SAO PAULO - AV. P...|     4054890.22|
|BI &amp; ANALYTICS|     RECIFE - CENTRO|     3788503.16|
| APP - DESKTOP|RIO DE JANEIRO - ...|      278013.25|
|  APP - MOBILE|SAO PAULO - AV. P...|       151160.5|
| APP - DESKTOP|SAO PAULO - AV. P...|       99579.84|
|  APP - MOBILE|RIO DE JANEIRO - ...|     -153325.62|
|           WEB|RIO DE JANEIRO - ...|     -239763.29|
|           WEB|CAMPO GRANDE - CE...|      -294359.4|
|  APP - MOBILE|CAMPO GRANDE - CE...|     -579949.09|
|           WEB|SAO PAULO - AV. P...|     -836869.03|
+--------------+--------------------+---------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id176">
<h1>8 Exercícios<a class="headerlink" href="#id176" title="Permalink to this heading">#</a></h1>
<section id="id177">
<h2>Exercício 1<a class="headerlink" href="#id177" title="Permalink to this heading">#</a></h2>
<p>Liste, para cada ano, a quantidade de negociações realizadas pelos clientes residentes no estado de Pernambuco.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">resposta</span> <span class="o">=</span> <span class="n">data</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cliente</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;clienteEstadoNome = &#39;PERNAMBUCO&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeNegociacoes&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;quantidadeNegociacoes&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;Ano&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(quantidadeNegociacoes)&quot;</span><span class="p">,</span> <span class="s2">&quot;Soma Quantidade Negociacoes&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>

<span class="n">resposta</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+---------------------------+
| Ano|Soma Quantidade Negociacoes|
+----+---------------------------+
|2016|                         26|
|2017|                         48|
|2018|                         46|
|2019|                         72|
|2020|                         63|
+----+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id178">
<h2>Exercício 2<a class="headerlink" href="#id178" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 1 usando um gráfico de barra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">resposta</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Ano&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Soma Quantidade Negociacoes&#39;</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2cc5f35850&gt;
</pre></div>
</div>
<img alt="../_images/43f830e33790167dbe4936fc80266f97f28016a308415620156d2d45f97219f2.png" src="../_images/43f830e33790167dbe4936fc80266f97f28016a308415620156d2d45f97219f2.png" />
</div>
</div>
</section>
<section id="id179">
<h2>Exercício 3<a class="headerlink" href="#id179" title="Permalink to this heading">#</a></h2>
<p>Qual o total de despesas em salários nos anos de 2016 a 2020 em cada região na qual a equipe está localizada, considerando o cargo de nível junior? Arredonde a soma dos salários para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “REGIAO”, “TOTALDESPESA”. Ordene as linhas exibidas primeiro pelo total de despesa em ordem descendente, e depois pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">resposta</span> <span class="o">=</span> <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;cargoNivel = &#39;JUNIOR&#39; AND dataAno &gt;= 2016 AND dataAno &lt;= 2020&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;filialRegiaoNome&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;filialRegiaoNome&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;sum(salario)&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s1">&#39;sum(salario)&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;ANO&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;filialRegiaoNome&quot;</span><span class="p">,</span> <span class="s2">&quot;REGIAO&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;TOTALDESPESA&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;TOTALDESPESA&quot;</span><span class="p">),</span> <span class="n">desc</span><span class="p">(</span><span class="s2">&quot;ANO&quot;</span><span class="p">))</span>

<span class="n">resposta</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+------------+------------+
| ANO|      REGIAO|TOTALDESPESA|
+----+------------+------------+
|2020|     SUDESTE|  1257808.67|
|2019|     SUDESTE|  1257808.67|
|2018|     SUDESTE|  1056208.91|
|2017|     SUDESTE|   876154.55|
|2016|     SUDESTE|   489456.84|
|2020|CENTRO-OESTE|   337073.28|
|2019|CENTRO-OESTE|   337073.28|
|2018|CENTRO-OESTE|   337073.28|
|2020|    NORDESTE|    160832.4|
|2019|    NORDESTE|    160832.4|
|2017|CENTRO-OESTE|   154488.24|
+----+------------+------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id180">
<h2>Exercício 4<a class="headerlink" href="#id180" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 3 usando um diagrama de barras que permite a visualização dos resultados por região.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">legend</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CENTRO-OESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;NORDESTE&#39;</span><span class="p">,</span> <span class="s1">&#39;SUDESTE&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">resposta</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ANO&#39;</span><span class="p">,</span> <span class="s1">&#39;REGIAO&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6ca13f2ddcf2c6eafe362faac22e07d566f7c3103abd0a12757e414e7161f7ae.png" src="../_images/6ca13f2ddcf2c6eafe362faac22e07d566f7c3103abd0a12757e414e7161f7ae.png" />
</div>
</div>
</section>
<section id="id181">
<h2>Exercício 5<a class="headerlink" href="#id181" title="Permalink to this heading">#</a></h2>
<p>Liste o total dos salários e o total de receitas recebidas, considerando os anos de 2017, 2018 e 2019. Arredonde o total dos salários para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “TOTAL GASTO EM SALARIOS”, “TOTAL DE RECEITAS RECEBIDAS”. Ordene as linhas exibidas pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Resolvendo o primeiro bloco da consulta</span>
<span class="c1"># Qual o total de gastos em salários, considerando cada ano? </span>
<span class="n">pag</span> <span class="o">=</span> <span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno BETWEEN 2017 AND 2019&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>

<span class="c1"># Resolvendo o segundo bloco da consulta</span>
<span class="c1"># Qual o total de receitas recebidas, considerando cada ano?</span>
<span class="n">neg</span> <span class="o">=</span> <span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno BETWEEN 2017 AND 2019&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>

<span class="c1"># Realizando a operação de drill across e fazendo as formatações necessárias</span>
<span class="n">resposta</span> <span class="o">=</span> <span class="n">pag</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">neg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataAno&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;ANO&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;TOTAL GASTO EM SALARIOS&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;TOTAL DE RECEITAS RECEBIDAS&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;Ano&quot;</span><span class="p">),</span> <span class="n">desc</span><span class="p">(</span><span class="s2">&quot;ANO&quot;</span><span class="p">))</span>
   
<span class="n">resposta</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+-----------------------+---------------------------+
| ANO|TOTAL GASTO EM SALARIOS|TOTAL DE RECEITAS RECEBIDAS|
+----+-----------------------+---------------------------+
|2019|          1.856766645E7|              3.535331833E7|
|2018|          1.493552647E7|              1.159353966E7|
|2017|             9775279.84|                 7200423.35|
+----+-----------------------+---------------------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id182">
<h2>Exercício 6<a class="headerlink" href="#id182" title="Permalink to this heading">#</a></h2>
<p>Mostre o resultado do Exercício 5 usando um diagrama de barras.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">resposta</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ANO&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2cc5da2a10&gt;
</pre></div>
</div>
<img alt="../_images/c77be4ef8f5f4ec2509e005f8b9d7f03db9dbd92b04e97650534ff8ff416dcd2.png" src="../_images/c77be4ef8f5f4ec2509e005f8b9d7f03db9dbd92b04e97650534ff8ff416dcd2.png" />
</div>
</div>
</section>
<section id="id183">
<h2>Exercício 7<a class="headerlink" href="#id183" title="Permalink to this heading">#</a></h2>
<p>Compare a quantidade de negociações que cada uma das equipes realizou nos anos de 2018 e 2019. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “NOME DA EQUIPE”, “NOME DA FILIAL”, “NEGOCIACOES 2018”, “NEGOCIACOES 2019”. Ordene as linhas exibidas pelo nome da equipe em ordem ascendente e depois pelo nome da filial em ordem ascendente. Liste as primeiras 25 linhas da resposta, sem truncamento das strings.</p>
<p>Dica: Considere relacionar as equipes por meio da operação drill-across.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="c1"># Resolvendo o primeiro bloco da consulta</span>
<span class="c1"># Qual a quantidade de negociações no ano de 2018? </span>
<span class="n">neg_2018</span> <span class="o">=</span> <span class="n">data</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;equipePK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;dataAno = 2018&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;quantidadeNegociacoes&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;quantidadeNegociacoes&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s1">&#39;sum(quantidadeNegociacoes)&#39;</span><span class="p">,</span> <span class="s1">&#39;NEGOCIACOES2018&#39;</span><span class="p">)</span>

<span class="c1"># Resolvendo o segundo bloco da consulta</span>
<span class="c1"># Qual a quantidade de negociações no ano de 2019? </span>
<span class="n">neg_2019</span> <span class="o">=</span> <span class="n">data</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negociacao</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;dataPK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;equipePK&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;dataAno=2019&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;quantidadeNegociacoes&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;quantidadeNegociacoes&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s1">&#39;sum(quantidadeNegociacoes)&#39;</span><span class="p">,</span> <span class="s1">&#39;NEGOCIACOES2019&#39;</span><span class="p">)</span>

<span class="n">neg_2018</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">neg_2019</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;filialNome&#39;</span><span class="p">])</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s1">&#39;equipeNome&#39;</span><span class="p">,</span> <span class="s1">&#39;NOME DA EQUIPE&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s1">&#39;filialNome&#39;</span><span class="p">,</span> <span class="s1">&#39;NOME DA FILIAL&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;NEGOCIACOES2018&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s1">&#39;NEGOCIACOES2018&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;NEGOCIACOES2019&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s1">&#39;NEGOCIACOES2019&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;NOME DA EQUIPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NOME DA FILIAL&#39;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+---------------+---------------+
|NOME DA EQUIPE|      NOME DA FILIAL|NEGOCIACOES2018|NEGOCIACOES2019|
+--------------+--------------------+---------------+---------------+
| APP - DESKTOP|RIO DE JANEIRO - ...|            149|            135|
| APP - DESKTOP|SAO PAULO - AV. P...|            132|            135|
|  APP - MOBILE|CAMPO GRANDE - CE...|             98|             88|
|  APP - MOBILE|RIO DE JANEIRO - ...|             99|            112|
|  APP - MOBILE|SAO PAULO - AV. P...|            104|            108|
|           WEB|CAMPO GRANDE - CE...|            100|             95|
|           WEB|RIO DE JANEIRO - ...|             91|            106|
|           WEB|SAO PAULO - AV. P...|             76|             87|
+--------------+--------------------+---------------+---------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id184">
<h2>Exercício 8<a class="headerlink" href="#id184" title="Permalink to this heading">#</a></h2>
<p>Liste os setores dos clientes e a soma de suas respectivas receitas para o segundo semestre do ano de 2020. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “SETOR DO CLIENTE”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo total de receitas em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cliente</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2020 AND dataSemestre = 2&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;clienteSetor&quot;</span><span class="p">,</span> <span class="s2">&quot;SETOR DO CLIENTE&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-------------------+-----------------+
|   SETOR DO CLIENTE|TOTAL DE RECEITAS|
+-------------------+-----------------+
|BEBIDAS E ALIMENTOS|       5749704.68|
|              SAUDE|        3119775.3|
|         TECNOLOGIA|       2465926.05|
|          VESTUARIO|       2336266.49|
|            CREDITO|         998789.6|
+-------------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id185">
<h2>Exercício 9<a class="headerlink" href="#id185" title="Permalink to this heading">#</a></h2>
<p>Analise a resposta do Exercício 8 para identificar qual o setor do cliente que obteve o maior total de receitas. Mostre o total de receitas por mês para esse setor do cliente, considerando o segundo semestre do ano de 2020. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “MES”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo total de receitas em ordem descendente e depois pelo mês em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cliente</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2020 AND dataSemestre = 2 AND clienteSetor = &#39;BEBIDAS E ALIMENTOS&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataMes&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;dataMes&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;dataMes&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;dataMes&quot;</span><span class="p">,</span> <span class="s2">&quot;MES&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">),</span> <span class="n">desc</span><span class="p">(</span><span class="s2">&quot;MES&quot;</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---+-----------------+
|MES|TOTAL DE RECEITAS|
+---+-----------------+
| 11|        1156403.3|
| 10|       1091389.49|
| 12|         899122.7|
|  9|        877223.55|
|  8|        875934.29|
|  7|        849631.35|
+---+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id186">
<h2>Exercício 10<a class="headerlink" href="#id186" title="Permalink to this heading">#</a></h2>
<p>Analise a resposta do Exercício 9 para identificar qual mês gerou o maior total de receitas para o setor de cliente identificado no Exercício 8. Mostre o total de receitas das equipes, considerando o segundo semestre do ano de 2020, o setor de cliente identificado no Exercício 8 e o mês identificado no Exercício 9. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “NOME DA EQUIPE”, “NOME DA FILIAL”, “TOTAL DE RECEITAS”. Ordene as linhas exibidas pelo nome da equipe em ordem ascendente, e depois pelo nome da filial em ordem ascendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">negociacao</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cliente</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;clientePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;dataAno = 2020 AND dataMes = 11 AND clienteSetor = &#39;BEBIDAS E ALIMENTOS&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;equipeNome&quot;</span><span class="p">,</span> <span class="s2">&quot;filialNome&quot;</span><span class="p">,</span> <span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;equipeNome&quot;</span><span class="p">,</span> <span class="s2">&quot;filialNome&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;receita&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;equipeNome&quot;</span><span class="p">,</span> <span class="s2">&quot;NOME DA EQUIPE&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;filialNome&quot;</span><span class="p">,</span> <span class="s2">&quot;NOME DA FILIAL&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;sum(receita)&quot;</span><span class="p">,</span> <span class="s2">&quot;TOTAL DE RECEITAS&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;NOME DA EQUIPE&quot;</span><span class="p">,</span> <span class="s2">&quot;NOME DA FILIAL&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+-----------------+
|NOME DA EQUIPE|      NOME DA FILIAL|TOTAL DE RECEITAS|
+--------------+--------------------+-----------------+
| APP - DESKTOP|RIO DE JANEIRO - ...|         35645.65|
| APP - DESKTOP|SAO PAULO - AV. P...|         129409.4|
|  APP - MOBILE|CAMPO GRANDE - CE...|         48714.45|
|  APP - MOBILE|RIO DE JANEIRO - ...|          62138.7|
|  APP - MOBILE|SAO PAULO - AV. P...|         26571.85|
|BI &amp; ANALYTICS|     RECIFE - CENTRO|        527169.75|
|BI &amp; ANALYTICS|SAO PAULO - AV. P...|        149490.15|
|           WEB|CAMPO GRANDE - CE...|         20042.75|
|           WEB|RIO DE JANEIRO - ...|          68596.1|
|           WEB|SAO PAULO - AV. P...|          88624.5|
+--------------+--------------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="id187">
<h2>Exercício 11<a class="headerlink" href="#id187" title="Permalink to this heading">#</a></h2>
<p>Liste todas as agregações que podem ser geradas a partir da média dos salários por ano por nome do estado da filial, considerando as equipes localizadas na região de nome SUDESTE. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: “ANO”, “ESTADO DA FILIAL”, “MEDIA DE SALARIOS”. Ordene as linhas exibidas pelo estado da filial em ordem descendente, e depois pelo ano em ordem descendente. Liste as primeiras 25 linhas da resposta, sem truncamento das <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta do exercício</span>

<span class="n">pagamento</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;dataPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equipe</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;equipePK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cargo</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;filialRegiaoNome = &#39;SUDESTE&#39;&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;filialEstadoNome&quot;</span><span class="p">,</span> <span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">cube</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;filialEstadoNome&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&quot;salario&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;dataAno&quot;</span><span class="p">,</span> <span class="s2">&quot;ANO&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;filialEstadoNome&quot;</span><span class="p">,</span> <span class="s2">&quot;ESTADO DA FILIAL&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;avg(salario)&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIA DE SALARIOS&quot;</span><span class="p">)</span>\
   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;ESTADO DA FILIAL&quot;</span><span class="p">),</span> <span class="n">desc</span><span class="p">(</span><span class="s2">&quot;ANO&quot;</span><span class="p">))</span>\
   <span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+----------------+-----------------+
| ANO|ESTADO DA FILIAL|MEDIA DE SALARIOS|
+----+----------------+-----------------+
|2020|       SAO PAULO|          7948.39|
|2019|       SAO PAULO|          7948.39|
|2018|       SAO PAULO|          7986.58|
|2017|       SAO PAULO|           7639.4|
|2016|       SAO PAULO|          7735.52|
|null|       SAO PAULO|          7885.68|
|2020|  RIO DE JANEIRO|          7914.97|
|2019|  RIO DE JANEIRO|          7914.97|
|2018|  RIO DE JANEIRO|          7914.97|
|2017|  RIO DE JANEIRO|          7596.64|
|2016|  RIO DE JANEIRO|          7073.21|
|null|  RIO DE JANEIRO|          7767.22|
|2020|            null|          7935.17|
|2019|            null|          7935.17|
|2018|            null|          7953.29|
|2017|            null|          7621.71|
|2016|            null|          7404.36|
|null|            null|          7835.47|
+----+----------------+-----------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="span-style-color-blue-avaliacao-final-notebook-span">
<h1><span style="color:blue">Avaliação Final - Notebook </span><a class="headerlink" href="#span-style-color-blue-avaliacao-final-notebook-span" title="Permalink to this heading">#</a></h1>
<p>Este <em>notebook</em> deve conter as respostas para as consultas analíticas solicitadas nas Questões 8, 9 e 10. É possível especificar as consultas analíticas usando Pandas, o método spark.sql() ou os métodos do módulo pyspark.sql. As consultas devem ser especificadas na seção 6, na célula indicada para resposta.</p>
<p><strong>IMPORTANTE</strong></p>
<ul class="simple">
<li><p><strong>As respostas para as Questões 8, 9 e 10 somente serão consideradas se forem especificadas no <em>notebook</em>. Portanto, independentemente da alternativa estar certa ou errada, se a consulta analítica correspondente não for especificada, a alternativa será considerada errada.</strong></p></li>
<li><p><strong>Caso uma alternativa esteja certa, porém a especificação da consulta analítica correspondente estiver errada no <em>notebook</em>, a alternativa será considerada errada.</strong></p></li>
</ul>
<p>O <em>notebook</em> contém a constelação de fatos da BI Solutions que deve ser utilizada para responder às questões e também todas as bibliotecas, bases de dados, inicializações, instalações, importações, geração de dataFrames, geração de visões temporárias e conversão dos tipos de dados necessárias para a realização da questão. Portanto, o <em>notebook</em> está preparado para ser executado usando Pandas, o método spark.sql() e os métodos do módulo pyspark.sql.</p>
<p>O uso do <em>framework</em> Spark requer diversas configurações no ambiente de desenvolvimento para executar o <em>notebook</em>. Dado que tal complexidade foge do escopo de nossa disciplina, recomenda-se que o <em>notebook</em> seja executado na plataforma de desenvolvimento COLAB. O uso do COLAB  proporciona um ambiente de desenvolvimento pré-configurado e remove a complexidade de instalação e configuração de pacotes e <em>frameworks</em> que são utilizados na disciplina.</p>
<p><strong>INSTRUÇÕES DE ENTREGA</strong></p>
<p><strong>O que deve ser entregue:</strong></p>
<ul class="simple">
<li><p><strong>O notebook com as respostas no formato .ipynb</strong></p></li>
<li><p><strong>O notebook com as respostas no formato .pdf</strong></p></li>
</ul>
<p><strong>Ambos arquivos devem ser nomeados usando o primeiro nome e o último sobrenome do aluno. Por exemplo: CristinaAguiar.ipynb e CristinaAguiar.pdf.</strong></p>
<p>Boa avaliação!</p>
<p>#1 Constelação de Fatos da BI Solutions</p>
<p>A aplicação de <em>data warehousing</em> da BI Solutions utiliza como base uma constelação de fatos, conforme descrita a seguir.</p>
<p><strong>Tabelas de dimensão</strong></p>
<ul class="simple">
<li><p>data (dataPK, dataCompleta, dataDia, dataMes, dataBimestre, dataTrimestre, dataSemestre, dataAno)</p></li>
<li><p>funcionario (funcPK, funcMatricula, funcNome, funcSexo, funcDataNascimento, funcDiaNascimento, funcMesNascimento, funcAnoNascimento, funcCidade, funcEstadoNome, funcEstadoSigla, funcRegiaoNome, funcRegiaoSigla, funcPaisNome, funcPaisSigla)</p></li>
<li><p>equipe (equipePK, equipeNome, filialNome, filialCidade, filialEstadoNome, filialEstadoSigla, filialRegiaoNome, filialRegiaoSigla, filialPaisNome, filialPaisSigla)</p></li>
<li><p>cargo (cargoPK, cargoNome, cargoRegimeTrabalho, cargoEscolaridadeMinima, cargoNivel)</p></li>
<li><p>cliente (clientePK, clienteNomeFantasia, clienteSetor, clienteCidade, clienteEstadoNome, clienteEstadoSigla, clienteRegiaoNome, clienteRegiaoSigla, clientePaisNome, clientePaisSigla)</p></li>
</ul>
<p><strong>Tabelas de fatos</strong></p>
<ul class="simple">
<li><p>pagamento (dataPK, funcPK, equipePK, cargoPK, salario, quantidadeLancamentos)</p></li>
<li><p>negociacao (dataPK, equipePK, clientePK, receita, quantidadeNegociacoes)</p></li>
</ul>
<p>#2 Obtenção dos Dados da BI Solutions</p>
<section id="id188">
<h2>2.1 Baixando o Módulo wget<a class="headerlink" href="#id188" title="Permalink to this heading">#</a></h2>
<p>Para baixar os dados referentes ao esquema relacional da constelação de fatos da BI Solutions, é utilizado o módulo  <strong>wget</strong>. O comando a seguir realiza a instalação desse módulo. <br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando o módulo wget
%%capture
!pip install -q wget
!mkdir data
</pre></div>
</div>
</div>
</div>
</section>
<section id="id189">
<h2>2.2 Obtenção dos Dados das Tabelas de Dimensão<a class="headerlink" href="#id189" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de dimensão.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de dimensão</span>
<span class="kn">import</span> <span class="nn">wget</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/data.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/cliente (1).csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="id190">
<h2>2.3 Obtenção dos Dados Tabelas de Fatos<a class="headerlink" href="#id190" title="Permalink to this heading">#</a></h2>
<p>Os comandos a seguir baixam os dados que povoam as tabelas de fatos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#baixando os dados das tabelas de fatos</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&quot;</span>
<span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;data/negociacao (1).csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id191">
<h1>3 Apache Spark Cluster<a class="headerlink" href="#id191" title="Permalink to this heading">#</a></h1>
<section id="id192">
<h2>3.1 Instalação<a class="headerlink" href="#id192" title="Permalink to this heading">#</a></h2>
<p>Neste <em>notebook</em> é criado um <em>cluster</em> Spark composto apenas por um <strong>nó mestre</strong>. Ou seja, o <em>cluster</em> não possui um ou mais <strong>nós de trabalho</strong> e o <strong>gerenciador de cluster</strong>. Nessa configuração, as tarefas (<em>tasks</em>) são realizadas no próprio <em>driver</em> localizado no <strong>nó mestre</strong>.</p>
<p>Para que o cluster possa ser criado, primeiramente é instalado o Java Runtime Environment (JRE) versão 8.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#instalando Java Runtime Environment (JRE) versão 8
%%capture
!apt-get remove openjdk*
!apt-get update --fix-missing
!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<p>Na sequência, é feito o <em>download</em> do Apache Spark versão 3.0.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#baixando Apache Spark versão 3.0.0
%%capture
!wget -q https://archive.apache.org/dist/spark/spark-3.0.0/spark-3.0.0-bin-hadoop2.7.tgz
!tar xf spark-3.0.0-bin-hadoop2.7.tgz &amp;&amp; rm spark-3.0.0-bin-hadoop2.7.tgz
</pre></div>
</div>
</div>
</div>
<p>Na sequência, são configuradas as variáveis de ambiente JAVA_HOME e SPARK_HOME. Isto permite que tanto o Java quanto o Spark possam ser encontrados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#configurando a variável de ambiente JAVA_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="c1">#configurando a variável de ambiente SPARK_HOME</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-3.0.0-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Por fim, são instalados dois pacotes da linguagem de programação Python, cujas funcionalidades são descritas a seguir.</p>
<blockquote>
<div><p><strong>Pacote findspark:</strong> Usado para ler a variável de ambiente SPARK_HOME e armazenar seu valor na variável dinâmica de ambiente PYTHONPATH. Como resultado, Python pode encontrar a instalação do Spark.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Pacote pyspark:</strong> PySpark é a API do Python para Spark. Ela possibilita o uso de Python, considerando que o <em>framework</em> Apache Spark encontra-se desenvolvido na linguagem de programação Scala.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
#instalando o pacote findspark
!pip install -q findspark==1.4.2
#instalando o pacote pyspark
!pip install -q pyspark==3.0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="id193">
<h2>3.2 Conexão<a class="headerlink" href="#id193" title="Permalink to this heading">#</a></h2>
<p>PySpark não é adicionado ao <em>sys.path</em> por padrão. Isso significa que não é possível importá-lo, pois o interpretador da linguagem Python não sabe onde encontrá-lo.</p>
<p>Para resolver esse aspecto, é necessário instalar o módulo <code class="docutils literal notranslate"><span class="pre">findspark</span></code>. Esse módulo mostra onde PySpark está localizado. Os comandos a seguir têm essa finalidade.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#importando o módulo findspark</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="c1">#carregando a variávels SPARK_HOME na variável dinâmica PYTHONPATH</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Depois de configurados os pacotes e módulos e inicializadas as variáveis de ambiente, é possível iniciar o uso do Spark na aplicação de <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">warehousing</span></code>. Para tanto, é necessário importar o comando <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code> do módulo <code class="docutils literal notranslate"><span class="pre">pyspark.sql</span></code>. São utilizados os seguintes conceitos: <br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SparkSession</span></code>: permite a criação de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>. Como resultado, as tabelas relacionais podem ser manipuladas por meio de <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> e é possível realizar consultas OLAP por meio de comandos SQL. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">builder</span></code>: cria uma instância de SparkSession. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">appName</span></code>: define um nome para a aplicação, o qual pode ser visto na interface de usuário web do Spark. <br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">master</span></code>: define onde está o nó mestre do <em>cluster</em>. Como a aplicação é executada localmente e não em um <em>cluster</em>, indica-se isso pela <em>string</em> <code class="docutils literal notranslate"><span class="pre">local</span></code> seguida do parâmetro <code class="docutils literal notranslate"><span class="pre">[*]</span></code>. Ou seja, define-se que apenas núcleos locais são utilizados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getOrCreate</span></code>: cria uma SparkSession. Caso ela já exista, retorna a instância existente.</p></li>
</ul>
<p><strong>Observação</strong>: A lista completa de todos os parâmetros que podem ser utilizados na inicialização do <em>cluster</em> pode ser encontrada neste <a class="reference external" href="https://spark.apache.org/docs/latest/spark-standalone.html#cluster-launch-scripts">link</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;pyspark-notebook&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="geracao-dos-dataframes-em-pandas-da-bi-solutions">
<h1>4 Geração dos DataFrames em Pandas da BI Solutions<a class="headerlink" href="#geracao-dos-dataframes-em-pandas-da-bi-solutions" title="Permalink to this heading">#</a></h1>
<p>Nesta seção são gerados os DataFrames em Pandas. Atenção aos nomes desses DataFrames.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.float_format&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cargoPandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cargo.csv&#39;</span><span class="p">)</span>
<span class="n">clientePandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/cliente.csv&#39;</span><span class="p">)</span>
<span class="n">dataPandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/data.csv&#39;</span><span class="p">)</span>
<span class="n">equipePandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/equipe.csv&#39;</span><span class="p">)</span>
<span class="n">funcionarioPandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/funcionario.csv&#39;</span><span class="p">)</span>
<span class="n">negociacaoPandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/negociacao.csv&#39;</span><span class="p">)</span>
<span class="n">pagamentoPandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/GuiMuzziUSP/Data_Mart_BI_Solutions/main/pagamento.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="geracao-dos-dataframes-em-spark-da-bi-solutions">
<h1>5 Geração dos DataFrames em Spark da BI Solutions<a class="headerlink" href="#geracao-dos-dataframes-em-spark-da-bi-solutions" title="Permalink to this heading">#</a></h1>
<p>Nesta seção são gerados dos DataFrames em Spark. Atenção aos nomes desses DataFrames.</p>
<section id="id194">
<h2>5.1 Criação dos DataFrames<a class="headerlink" href="#id194" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando os DataFrames em Spark</span>
<span class="n">cargo</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cargo.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">cliente</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/cliente.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/data.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">equipe</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/equipe.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">funcionario</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/funcionario.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">negociacao</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/negociacao.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">pagamento</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/pagamento.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id195">
<h2>5.2 Atualização dos Tipos de Dados<a class="headerlink" href="#id195" title="Permalink to this heading">#</a></h2>
<p>Nos comandos a seguir, primeiro são identificados quais colunas de quais <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser do tipo de dado inteiro. Na sequência, ocorre a conversão. Por fim, são exibidos os esquemas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, possibilitando visualizar a mudança de tipo de dados das colunas especificadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># identificando quais colunas de quais DataFrames devem ser do tipo de dado inteiro</span>
<span class="n">colunas_cargo</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cargoPK&quot;</span><span class="p">]</span>
<span class="n">colunas_cliente</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;clientePK&quot;</span><span class="p">]</span>
<span class="n">colunas_data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;dataDia&quot;</span><span class="p">,</span> <span class="s2">&quot;dataMes&quot;</span><span class="p">,</span> <span class="s2">&quot;dataBimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataTrimestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataSemestre&quot;</span><span class="p">,</span> <span class="s2">&quot;dataAno&quot;</span><span class="p">]</span>
<span class="n">colunas_equipe</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;equipePK&quot;</span><span class="p">]</span>
<span class="n">colunas_funcionario</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;funcDiaNascimento&quot;</span><span class="p">,</span> <span class="s2">&quot;funcMesNascimento&quot;</span><span class="p">,</span> <span class="s2">&quot;funcAnoNascimento&quot;</span><span class="p">]</span>
<span class="n">colunas_negociacao</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;clientePK&quot;</span><span class="p">,</span> <span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeNegociacoes&quot;</span><span class="p">]</span>
<span class="n">colunas_pagamento</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;funcPK&quot;</span><span class="p">,</span> <span class="s2">&quot;equipePK&quot;</span><span class="p">,</span> <span class="s2">&quot;dataPK&quot;</span><span class="p">,</span> <span class="s2">&quot;cargoPK&quot;</span><span class="p">,</span> <span class="s2">&quot;quantidadeLancamentos&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importando o tipo de dado desejado</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span>


<span class="c1"># atualizando o tipo de dado das colunas especificadas</span>
<span class="c1"># substituindo as colunas já existentes</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_cargo</span><span class="p">:</span>
  <span class="n">cargo</span> <span class="o">=</span> <span class="n">cargo</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">cargo</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_cliente</span><span class="p">:</span>
  <span class="n">cliente</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">cliente</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_data</span><span class="p">:</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_equipe</span><span class="p">:</span>
  <span class="n">equipe</span> <span class="o">=</span> <span class="n">equipe</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">equipe</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_funcionario</span><span class="p">:</span>
  <span class="n">funcionario</span> <span class="o">=</span> <span class="n">funcionario</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">funcionario</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_negociacao</span><span class="p">:</span>
  <span class="n">negociacao</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">negociacao</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_pagamento</span><span class="p">:</span>
  <span class="n">pagamento</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<p>Nos comandos a seguir, primeiro são identificados quais colunas de quais <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> devem ser do tipo de dado número de ponto flutuante. Na sequência, ocorre a conversão. Por fim, são exibidos os esquemas dos <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>, possibilitando visualizar a mudança de tipo de dados das colunas especificadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># identificando quais colunas de quais DataFrames devem ser do tipo de dado número de ponto flutuante</span>
<span class="n">colunas_negociacao</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;receita&quot;</span><span class="p">]</span>
<span class="n">colunas_pagamento</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;salario&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importando o tipo de dado desejado</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">FloatType</span>


<span class="c1"># atualizando o tipo de dado das colunas especificadas</span>
<span class="c1"># substituindo as colunas já existentes</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_negociacao</span><span class="p">:</span>
  <span class="n">negociacao</span> <span class="o">=</span> <span class="n">negociacao</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">negociacao</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">FloatType</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">coluna</span> <span class="ow">in</span> <span class="n">colunas_pagamento</span><span class="p">:</span>
  <span class="n">pagamento</span> <span class="o">=</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">coluna</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">[</span><span class="n">coluna</span><span class="p">]</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">FloatType</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importando funções adicionais</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="nb">round</span><span class="p">,</span> <span class="n">desc</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id196">
<h2>5.3 Criação de Visões Temporárias<a class="headerlink" href="#id196" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#criando as visões temporárias</span>
<span class="n">cargo</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;cargo&quot;</span><span class="p">)</span>
<span class="n">cliente</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">equipe</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;equipe&quot;</span><span class="p">)</span>
<span class="n">funcionario</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;funcionario&quot;</span><span class="p">)</span>
<span class="n">negociacao</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;negociacao&quot;</span><span class="p">)</span>
<span class="n">pagamento</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s2">&quot;pagamento&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="respostas">
<h1>6 Respostas<a class="headerlink" href="#respostas" title="Permalink to this heading">#</a></h1>
<p>Lembre-se que é possível especificar as consultas analíticas usando Pandas, o método spark.sql() ou os métodos do módulo pyspark.sql.</p>
<section id="especificacao-da-consulta-analitica-da-questao-8">
<h2>Especificação da Consulta Analítica da Questão 8<a class="headerlink" href="#especificacao-da-consulta-analitica-da-questao-8" title="Permalink to this heading">#</a></h2>
<p>Considere a constelação de fatos da BI Solutions e a seguinte solicitação de consulta:</p>
<p>“Qual a quantidade de negociações por ano e pela cidade da equipe, considerando equipes localizadas na mesma cidade de seus clientes?” Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: ANO, CIDADE e TOTALNEGOCIACOES. Ordene as linhas exibidas primeiro por ano em ordem ascendente e depois por cidade em ordem ascendente.</p>
<p>Considerando a resposta para a consulta analítica, assinale a alternativa correta:</p>
<p>a.
Com exceção do ano de 2020, as negociações realizadas pelas equipes localizadas na cidade de SAO PAULO aumentaram paulatinamente.</p>
<p>b.
As equipes localizadas na cidade do RIO DE JANEIRO possuem menos negociações do que as demais equipes em todos os anos.</p>
<p>c.
Três cidades distintas possuem equipes que negociaram mais de uma vez em 2019.</p>
<p>d.
Quatro cidades distintas possuem equipes que negociaram mais de uma vez em 2018.</p>
<p>e.
As equipes localizadas na cidade de SAO PAULO possuem mais negociações do que as demais equipes em todos os anos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta da Questão 8</span>

<span class="c1"># Letra: A</span>
<span class="c1"># a.Com exceção do ano de 2020, as negociações realizadas pelas equipes localizadas na cidade de SAO PAULO aumentaram paulatinamente.</span>

<span class="c1"># método utilizado - Spark SQL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">d.dataAno AS ANO,</span>
<span class="s2">e.filialCidade AS CIDADE,</span>
<span class="s2">SUM(n.quantidadeNegociacoes) AS TOTALNEGOCIACOES</span>
<span class="s2">FROM</span>
<span class="s2">negociacao n</span>
<span class="s2">JOIN equipe e ON (n.equipePK = e.equipePK)</span>
<span class="s2">JOIN data d ON (n.dataPK = d.dataPK)</span>
<span class="s2">JOIN cliente c ON (n.clientePK = c.clientePK)</span>
<span class="s2">WHERE</span>
<span class="s2">c.clienteCidade = e.filialCidade</span>
<span class="s2">GROUP BY</span>
<span class="s2">d.dataAno,</span>
<span class="s2">e.filialCidade</span>
<span class="s2">ORDER BY</span>
<span class="s2">d.dataAno,</span>
<span class="s2">e.filialCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+--------------+----------------+
| ANO|        CIDADE|TOTALNEGOCIACOES|
+----+--------------+----------------+
|2016|RIO DE JANEIRO|              20|
|2016|     SAO PAULO|              17|
|2017|  CAMPO GRANDE|               4|
|2017|RIO DE JANEIRO|              35|
|2017|     SAO PAULO|              41|
|2018|  CAMPO GRANDE|               4|
|2018|RIO DE JANEIRO|              51|
|2018|     SAO PAULO|              69|
|2019|  CAMPO GRANDE|               6|
|2019|        RECIFE|               9|
|2019|RIO DE JANEIRO|              67|
|2019|     SAO PAULO|             146|
|2020|  CAMPO GRANDE|               5|
|2020|        RECIFE|               5|
|2020|RIO DE JANEIRO|              45|
|2020|     SAO PAULO|             112|
+----+--------------+----------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CONFERINDO A RESPOSTA</span>

<span class="n">query_sp</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">d.dataAno AS ANO,</span>
<span class="s2">e.filialCidade AS CIDADE,</span>
<span class="s2">SUM(n.quantidadeNegociacoes) AS TOTALNEGOCIACOES</span>
<span class="s2">FROM</span>
<span class="s2">negociacao n</span>
<span class="s2">JOIN equipe e ON (n.equipePK = e.equipePK)</span>
<span class="s2">JOIN data d ON (n.dataPK = d.dataPK)</span>
<span class="s2">JOIN cliente c ON (n.clientePK = c.clientePK)</span>
<span class="s2">WHERE</span>
<span class="s2">c.clienteCidade = e.filialCidade AND</span>
<span class="s2">e.filialCidade = &#39;SAO PAULO&#39;</span>
<span class="s2">GROUP BY</span>
<span class="s2">d.dataAno,</span>
<span class="s2">e.filialCidade</span>
<span class="s2">ORDER BY</span>
<span class="s2">d.dataAno,</span>
<span class="s2">e.filialCidade</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query_sp</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+---------+----------------+
| ANO|   CIDADE|TOTALNEGOCIACOES|
+----+---------+----------------+
|2016|SAO PAULO|              17|
|2017|SAO PAULO|              41|
|2018|SAO PAULO|              69|
|2019|SAO PAULO|             146|
|2020|SAO PAULO|             112|
+----+---------+----------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="especificacao-da-consulta-analitica-da-questao-9">
<h2>Especificação da Consulta Analítica da Questão 9<a class="headerlink" href="#especificacao-da-consulta-analitica-da-questao-9" title="Permalink to this heading">#</a></h2>
<p>Considere a constelação de fatos da BI Solutions e a seguinte solicitação de consulta:</p>
<p>“Liste todas as agregações que podem ser geradas a partir da média dos salários dos funcionários que moram na região SUDESTE por sexo e por ano.” Arredonde a média dos salários para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: SEXO, ANO e MEDIASALARIO. Ordene as linhas exibidas primeiro por sexo, depois por ano, depois por média dos salários, todos em ordem ascendente.</p>
<p>Considerando a resposta para a consulta analítica, assinale a alternativa correta:</p>
<p>a.
São retornadas 18 linhas, das quais 6 linhas são referentes ao sexo feminino e 6 linhas são referentes ao sexo masculino.</p>
<p>b.
A quarta e a quinta linhas retornadas contêm o mesmo valor de média dos salários e referem-se a anos diferentes.</p>
<p>c.
São retornadas 10 linhas, das quais 5 linhas são referentes ao sexo feminino e 5 linhas são referentes ao sexo masculino.</p>
<p>d.
São retornadas 13 linhas, das quais 6 linhas são referentes ao sexo feminino e 6 linhas são referentes ao sexo masculino.</p>
<p>e.
As médias dos salários das funcionárias de sexo feminino para os anos de 2017 e 2018 são menores do que as médias dos salários dos funcionários do sexo masculino para os anos de 2017 e 2018, respectivamente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta da Questão 9</span>

<span class="c1"># LETRA A</span>
<span class="c1"># a.São retornadas 18 linhas, das quais 6 linhas são referentes ao sexo feminino e 6 linhas são referentes ao sexo masculino.</span>

<span class="c1"># método utilizado - Spark SQL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">f.funcSexo AS SEXO,</span>
<span class="s2">d.dataAno AS ANO,</span>
<span class="s2">ROUND(AVG(p.salario),2) AS MEDIASALARIO</span>
<span class="s2">FROM</span>
<span class="s2">funcionario f</span>
<span class="s2">JOIN pagamento p ON (f.funcPK = p.funcPK)</span>
<span class="s2">JOIN data d ON (p.dataPK = d.dataPK)</span>
<span class="s2">WHERE</span>
<span class="s2">f.funcRegiaoNome =&#39;SUDESTE&#39;</span>
<span class="s2">GROUP BY CUBE</span>
<span class="s2">(f.funcSexo,</span>
<span class="s2">d.dataAno)</span>
<span class="s2">ORDER BY</span>
<span class="s2">SEXO,</span>
<span class="s2">ANO,</span>
<span class="s2">MEDIASALARIO</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+----+------------+
|SEXO| ANO|MEDIASALARIO|
+----+----+------------+
|null|null|     7446.14|
|null|2016|     6542.64|
|null|2017|     7181.86|
|null|2018|     7582.23|
|null|2019|     7596.89|
|null|2020|     7596.89|
|   F|null|     7821.46|
|   F|2016|      8587.4|
|   F|2017|     8575.92|
|   F|2018|     8333.57|
|   F|2019|     7329.74|
|   F|2020|     7329.74|
|   M|null|     7322.23|
|   M|2016|     5903.65|
|   M|2017|     6763.65|
|   M|2018|      7345.4|
|   M|2019|     7689.92|
|   M|2020|     7689.92|
+----+----+------------+
</pre></div>
</div>
</div>
</div>
</section>
<section id="especificacao-da-consulta-analitica-da-questao-10">
<h2>Especificação da Consulta Analítica da Questão 10<a class="headerlink" href="#especificacao-da-consulta-analitica-da-questao-10" title="Permalink to this heading">#</a></h2>
<p>Considere a constelação de fatos da BI Solutions e a seguinte solicitação de consulta:</p>
<p>“Qual o lucro ou prejuízo médio de cada equipe localizada na região SUDESTE do BRASIL?”, sendo que lucro representa a diferença entre a média das receitas e a média dos salários. Arredonde o lucro ou prejuízo para até duas casas decimais. Devem ser exibidas as colunas na ordem e com os nomes especificados a seguir: NOME DA EQUIPE, NOME DA FILIAL, CIDADE DA FILIAL, LUCRO OU PREJUÍZO.</p>
<p>Considerando a resposta para a consulta analítica, assinale a alternativa correta:</p>
<p>a.
As equipes localizadas na cidade de RIO DE JANEIRO garantem mais lucro à BI Solutions do que as equipes localizadas na cidade de SAO PAULO.</p>
<p>b.
A soma dos lucros gerados pelas equipes que possuem APP - MOBILE em seu nome são maiores do que a soma dos lucros gerados pelas equipes que possuem APP - DESKTOP em seu nome, independentemente da filial e da cidade na qual estão localizadas.</p>
<p>c.
Equipes que possuem WEB em seu nome, independentemente da filial e da cidade na qual estão localizadas, proveem mais lucro à BI Solutions do que as demais equipes.</p>
<p>d.
Todas as equipes tiveram lucro, independentemente da cidade na qual elas estão localizadas.</p>
<p>e.
Os lucros gerados pelas equipes que possuem BI &amp; ANALYTICS em seu nome, independentemente da filial e da cidade na qual estão localizadas, são maiores do que a soma dos lucros gerados pelas demais equipes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Resposta da Questão 10</span>

<span class="c1"># LETRA E</span>
<span class="c1"># e. Os lucros gerados pelas equipes que possuem BI &amp; ANALYTICS em seu nome, independentemente da filial e da cidade na qual estão localizadas, são maiores do que a soma dos lucros gerados pelas demais equipes.</span>

<span class="c1"># método utilizado - Spark SQL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">  NOMEDAEQUIPE,</span>
<span class="s2">  NOMEDAFILIAL,</span>
<span class="s2">  CIDADEDAFILIAL,</span>
<span class="s2">  ROUND(AVG(LUCROOUPREJUIZO),2) AS LUCROOUPREJUIZO</span>
<span class="s2">FROM (</span>
<span class="s2">  SELECT</span>
<span class="s2">    d.dataAno AS ANO,</span>
<span class="s2">    e.equipeNome AS NOMEDAEQUIPE,</span>
<span class="s2">    e.filialNome AS NOMEDAFILIAL,</span>
<span class="s2">    e.filialCidade AS CIDADEDAFILIAL,</span>
<span class="s2">    n.receita - p.salario AS LUCROOUPREJUIZO</span>
<span class="s2">  FROM</span>
<span class="s2">    equipe e</span>
<span class="s2">  JOIN</span>
<span class="s2">    negociacao n ON (e.equipePK = n.equipePK)</span>
<span class="s2">  JOIN</span>
<span class="s2">    pagamento p ON (e.equipePK = p.equipePK)</span>
<span class="s2">  JOIN</span>
<span class="s2">    data d ON (p.dataPK = d.dataPK)</span>
<span class="s2">  WHERE</span>
<span class="s2">    e.filialRegiaoNome = &#39;SUDESTE&#39;</span>
<span class="s2">) AS subquery</span>
<span class="s2">GROUP BY</span>
<span class="s2">  NOMEDAEQUIPE,</span>
<span class="s2">  NOMEDAFILIAL,</span>
<span class="s2">  CIDADEDAFILIAL</span>
<span class="s2">ORDER BY</span>
<span class="s2">  NOMEDAEQUIPE,</span>
<span class="s2">  NOMEDAFILIAL,</span>
<span class="s2">  CIDADEDAFILIAL;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------+--------------------+--------------+---------------+
|  NOMEDAEQUIPE|        NOMEDAFILIAL|CIDADEDAFILIAL|LUCROOUPREJUIZO|
+--------------+--------------------+--------------+---------------+
| APP - DESKTOP|RIO DE JANEIRO - ...|RIO DE JANEIRO|       10452.61|
| APP - DESKTOP|SAO PAULO - AV. P...|     SAO PAULO|         9511.4|
|  APP - MOBILE|RIO DE JANEIRO - ...|RIO DE JANEIRO|        5828.01|
|  APP - MOBILE|SAO PAULO - AV. P...|     SAO PAULO|        5642.31|
|BI &amp; ANALYTICS|SAO PAULO - AV. P...|     SAO PAULO|       55019.53|
|           WEB|RIO DE JANEIRO - ...|RIO DE JANEIRO|        -370.04|
|           WEB|SAO PAULO - AV. P...|     SAO PAULO|         680.37|
+--------------+--------------------+--------------+---------------+
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="6-ECD-Estatistica.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Estatística para Ciência de Dados</p>
      </div>
    </a>
    <a class="right-next"
       href="7.1-ADBPMP-Slides%2BASs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">7.1-ADBPMP-Slides+ASs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#"><span style="color:blue">Análise de Dados com Base em Processamento Massivo em Paralelo</span></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-03-processo-de-etl-elt-span"><span style="color:blue">Aula 03: Processo de ETL/ELT</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-exemplo-usando-pandas-span"><span style="color:blue">Exemplo usando Pandas</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fontes-de-dados">1 Fontes de Dados</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-do-data-mart">2 Projeto do <em>Data Mart</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importacao-usando-pandas">3 Importação usando Pandas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integracao-de-esquemas">4 Integração de Esquemas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conflitos-de-nome-sinonimo">4.1 Conflitos de nome (sinônimo)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conflito-semantico">4.2 Conflito semântico</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#padronizacao-das-colunas">4.3 Padronização das colunas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integracao-de-instancias">5 Integração de Instâncias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerando-a-fonte-de-dados-funcionariorelacional">5.1 Considerando a fonte de dados funcionarioRelacional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerando-a-fonte-de-dados-colaboradorjson">5.2 Considerando a fonte de dados colaboradorJSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrando-as-instancias">5.4 Integrando as instâncias</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-dos-dados-no-data-mart">6 Carga dos Dados no <em>Data Mart</em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-03-lista-exercicios-processo-de-etl-elt-span"><span style="color:blue">Aula 03: Lista exercícios - Processo de ETL/ELT</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><span style="color:blue">Exemplo usando Pandas</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1 Fontes de Dados</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2 Projeto do <em>Data Mart</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">3 Importação usando Pandas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-1">Exercício 1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">4 Integração de Esquemas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">4.1 Conflitos de nome (sinônimo)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-2">Exercício 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">4.2 Conflito semântico</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-3">Exercício 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">4.3 Padronização das colunas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-4">Exercício 4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">5 Integração de Instâncias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">5.1 Considerando a fonte de dados funcionarioRelacional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">5.2 Considerando a fonte de dados colaboradorJSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerando-a-fonte-de-dados-empregadoplanilha">5.3 Considerando a fonte de dados empregadoPlanilha</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-5">Exercício 5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">5.4 Integrando as instâncias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-6">Exercício 6</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-7">Exercício 7</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">6 Carga dos Dados no <em>Data Mart</em></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-8">Exercício 8</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-9">Exercício 9</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-10">Exercício 10</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-03-plantao-edesio-processo-de-etl-elt-span"><span style="color:blue">Aula 03: Plantão Edesio - Processo de ETL/ELT</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-retomando-conceitos-de-classe-e-a-ferramenta-pandas-merge-span"><span style="color:blue">Retomando conceitos de Classe e a ferramenta Pandas (merge)</span></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-05-consultas-olap-span"><span style="color:blue">Aula 05: Consultas OLAP</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14"><span style="color:blue">Exemplo usando Pandas</span></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introducao">1 Introdução</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esquema-estrela-pagamento">1.1 Esquema Estrela Pagamento</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esquema-estrela-negociacao">1.2 Esquema Estrela Negociacao</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constelacao-de-fatos">1.3 Constelação de Fatos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#juncao-estrela">1.4 Junção Estrela</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-das-tabelas-de-dimensao-e-das-tabelas-de-fatos">2 Carregamento das Tabelas de Dimensão e das Tabelas de Fatos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-das-tabelas-de-dimensao">2.1 Carregamento das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-das-tabelas-de-fatos">2.2 Carregamento das Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#execucao-de-consultas-com-foco-nas-operacoes-olap">3 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacao-slice-and-dice">3.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacoes-drill-down-e-roll-up">3.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacao-pivot">3.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#operacao-drill-across">3.4 Operação Drill-Across</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#execucao-de-consultas-com-foco-na-tomada-de-decisao">3 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-1">3.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-2">3.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-3">3.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-05-lista-de-exercicios-consultas-olap-span"><span style="color:blue">Aula 05: Lista de exercícios - Consultas OLAP</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15"><span style="color:blue">Exemplo usando Pandas</span></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">1 Introdução</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">1.1 Esquema Estrela Pagamento</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">1.2 Esquema Estrela Negociacao</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">1.3 Constelação de Fatos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">1.4 Junção Estrela</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">2 Carregamento das Tabelas de Dimensão e das Tabelas de Fatos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">2.1 Carregamento das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">2.2 Carregamento das Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">3 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">3.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">3.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">3.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">3.4 Operação Drill-Across</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">3 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">3.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">3.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">3.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicios">4 Exercícios</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">Exercício 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">Exercício 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">Exercício 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">Exercício 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">Exercício 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">Exercício 6</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">Exercício 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">Exercício 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">Exercício 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">Exercício 10</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-dados-com-base-em-processamento-massivo-em-paralelo">Análise de Dados com Base em Processamento Massivo em Paralelo</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#aula-05-plantao-leonardo-pipeline-utilizando-luigi">Aula 05 - Plantão Leonardo - Pipeline utilizando Luigi</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#luigi">Luigi</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pros-e-contras">Prós e Contras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pros">Prós</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contras">Contras</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-do-luigi">Estrutura do Luigi</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-pipeline">do Pipeline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-codigo">do Código</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exemplo-1">Exemplo 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exemplo-2">Exemplo 2</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-06-processamento-paralelo-e-distribuido-span"><span style="color:blue">Aula 06: Processamento Paralelo e Distribuído</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-apache-spark-rdd-span"><span style="color:blue">Apache Spark RDD</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id43"><strong>1 Introdução</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apache-spark-cluster"><strong>2 Apache Spark Cluster</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arquitetura">2.1 Arquitetura</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-uma-aplicacao-spark">2.2 Criação de uma Aplicação Spark</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#instalacao">2.3 Instalação</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conexao">2.4 Conexão</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-apache-spark-rdd"><strong>3 API Apache Spark RDD</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conjuntos-de-dados">3.1 Conjuntos de Dados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-rdds">3.2 Criação de RDDs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-parallelize">Método parallelize()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-textfile">Método textFile()</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacoes">3.2 Transformações</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-map">Método map()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-flatmap">Método flatMap()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-mapvalues">Método mapValues()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-filter">Método filter()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-join">Método join()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-reducebykey">Método reduceByKey()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-sortbykey">Método sortByKey()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-sortby">Método sortBy()</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acoes">3.3 Ações</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-collect-take-e-first">Métodos collect(), take() e first()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-max-min-mean-count">Métodos  max(), min(), mean(), count()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-reduce">Método reduce()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contador-de-palavras"><strong>4 Contador de Palavras</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#persistencia-dos-rdds">5 Persistência dos RDDs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#aula-06-lista-de-exercicios-processamento-paralelo-e-distribuido">Aula 06 - Lista de Exercícios - Processamento Paralelo e Distribuído</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id44">1 Introdução</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#apache-spark-cluster-instalacao-e-configuracao">2 Apache Spark Cluster: instalação e configuração</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#carregamento-dos-dados-da-aplicacao-da-bi-solutions">3 Carregamento dos Dados da Aplicação da BI Solutions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id45"><strong>Exercícios</strong></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id46"><strong>Exercício 1</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id47"><strong>Exercício 2</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id48"><strong>Exercício 3</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id49"><strong>Exercício 4</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id50"><strong>Exercício 5</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id51"><strong>Exercício 6</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id52"><strong>Exercício 7</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id53"><strong>Exercício 8</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id54"><strong>Exercício 9</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id55"><strong>Exercício 10</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercicio-11"><strong>Exercício 11</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-07-consultas-olap-usando-spark-sql-span"><span style="color:blue">Aula 07: Consultas OLAP usando Spark SQL</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-apache-spark-sql-span"><span style="color:blue">Apache Spark SQL</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plano-de-consulta">1.1 Plano de Consulta</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#constelacao-de-fatos-da-bi-solutions">2 Constelação de Fatos da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baixando-o-modulo-wget">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtencao-dos-dados-das-tabelas-de-dimensao">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtencao-dos-dados-tabelas-de-fatos">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id56">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id57">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id58">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preparacao-dos-dados">4 Preparação dos Dados</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes">4.1 Geração dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-de-visoes-temporarias">4.2 Criação de Visões Temporárias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id59">5 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id60">5.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id61">5.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id62">5.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id63">5.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extensoes-rollup-cube-e-grouping-sets">5.5 Extensões ROLLUP, CUBE e GROUPING SETS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id64">6 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id65">6.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id66">6.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id67">6.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id68"><span style="color:blue">Aula 07: Consultas OLAP usando Spark SQL</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id69"><span style="color:blue">Apache Spark SQL</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id70">1.1 Plano de Consulta</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id71">2 Constelação de Fatos da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id72">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id73">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id74">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id75">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id76">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id77">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id78">4 Preparação dos Dados</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id79">4.1 Geração dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id80">4.2 Criação de Visões Temporárias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id81">5 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id82">5.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id83">5.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id84">5.3 Operação Pivot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id85">5.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id86">5.5 Extensões ROLLUP, CUBE e GROUPING SETS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id87">6 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id88">6.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id89">6.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id90">6.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id91">7 Exercícios</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id92">Exercício 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id93">Exercício 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id94">Exercício 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id95">Exercício 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id96">Exercício 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id97">Exercício 6</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id98">Exercício 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id99">Exercício 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id100">Exercício 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id101">Exercício 10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id102">Exercício 11</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criando-uma-base-de-dados">Criando uma Base de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criando-tabela">Criando tabela</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inserindo-dados">Inserindo Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consultando-tabela">Consultando Tabela</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-tabela">Update Tabela</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete-linha">Delete linha</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deletar-tabela">Deletar Tabela</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-08-explorando-o-modulo-pyspark-sql-span"><span style="color:blue">Aula 08: Explorando o Módulo pyspark.sql</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-metodos-de-interesse-e-consultas-olap-span"><span style="color:blue">Métodos de Interesse e Consultas OLAP</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id103">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id104">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id105">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id106">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id107">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id108">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes-da-bi-solutions">4 Geração dos DataFrames da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-para-leitura-e-escrita">4.1 Métodos para Leitura e Escrita</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-spark-read-csv">Método spark.read.csv()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-show">Método show()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-printschema">Método printSchema()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-write-csv">Método write.csv()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criacao-dos-dataframes">4.2 Criação dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulacao-da-tipagem-dos-dados">4.3 Manipulação da Tipagem dos Dados</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-cast">Método cast()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-withcolumn">Método withColumn()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#atualizacao-dos-tipos-de-dados">4.4 Atualização dos Tipos de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-basica-do-comando-select">5.1 Estrutura Básica do Comando SELECT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-select">Método select()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-selectexpr">Método selectExpr()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-distinct">Método distinct()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id109">Método filter()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-where">Método where()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-between">Método between()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-isnull-e-isnotnull">Métodos isNull() e isNotNull()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-isin">Método isin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-like">Método like()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-withcolumnrenamed">Método withColumnRenamed()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-crossjoin">Método crossJoin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id110">Método join()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-orderby">Método orderBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agregacao-e-agrupamento">5.2 Agregação e Agrupamento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-sum">Método sum()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-min">Método min()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-max">Método max()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-avg">Método avg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-mean">Método mean()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-agg">Método agg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-groupby">Método groupBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-sobre-conjuntos">5.3 Métodos sobre Conjuntos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-union-unionall-e-unionbyname">Métodos union(), unionAll() e unionByName()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-intersect-e-intersectall">Métodos intersect() e intersectAll()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodos-subtract-e-exceptall">Métodos subtract() e exceptAll()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id111">6 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id112">6.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id113">6.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id114">6.3 Operação Pivot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-pivot">Método pivot()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id115">6.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extensoes-rollup-e-cube">5.5 Extensões ROLLUP e CUBE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-rollup">Método rollup()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-cube">Método cube()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id116">7 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id117">7.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id118">7.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id119">7.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-aula-08-lista-de-exercicios-explorando-o-modulo-pyspark-sql-span"><span style="color:blue"> Aula 08 - Lista de exercícios - Explorando o Módulo pyspark.sql</span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-respostas-dos-exercicios-span"><span style="color:blue">Respostas dos Exercícios</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id120">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id121">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id122">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id123">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id124">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id125">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id126">4 Geração dos DataFrames da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id127">4.1 Métodos para Leitura e Escrita</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id128">Método spark.read.csv()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id129">Método show()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id130">Método printSchema()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id131">Método write.csv()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id132">4.2 Criação dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id133">4.3 Manipulação da Tipagem dos Dados</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id134">Método cast()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id135">Método withColumn()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id136">4.4 Atualização dos Tipos de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id137">5.1 Estrutura Básica do Comando SELECT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id138">Método select()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id139">Método selectExpr()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id140">Método distinct()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id141">Método filter()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id142">Método where()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id143">Método between()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id144">Métodos isNull() e isNotNull()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id145">Método isin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id146">Método like()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id147">Método withColumnRenamed()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id148">Método crossJoin()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id149">Método join()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id150">Método orderBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id151">5.2 Agregação e Agrupamento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id152">Método sum()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id153">Método min()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id154">Método max()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id155">Método avg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id156">Método mean()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id157">Método agg()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id158">Método groupBy()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id159">5.3 Métodos sobre Conjuntos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id160">Métodos union(), unionAll() e unionByName()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id161">Métodos intersect() e intersectAll()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id162">Métodos subtract() e exceptAll()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id163">6 Execução de Consultas com Foco nas Operações OLAP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id164">6.1 Operação Slice and Dice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id165">6.2 Operações Drill-Down e Roll-Up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id166">6.3 Operação Pivot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id167">Método pivot()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id168">6.4 Operação Drill-Across</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id169">5.5 Extensões ROLLUP e CUBE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id170">Método rollup()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id171">Método cube()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id172">7 Execução de Consultas com Foco na Tomada de Decisão</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id173">7.1 Consulta 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id174">7.2 Consulta 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id175">7.3 Consulta 3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id176">8 Exercícios</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id177">Exercício 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id178">Exercício 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id179">Exercício 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id180">Exercício 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id181">Exercício 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id182">Exercício 6</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id183">Exercício 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id184">Exercício 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id185">Exercício 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id186">Exercício 10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id187">Exercício 11</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-blue-avaliacao-final-notebook-span"><span style="color:blue">Avaliação Final - Notebook </span></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id188">2.1 Baixando o Módulo wget</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id189">2.2 Obtenção dos Dados das Tabelas de Dimensão</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id190">2.3 Obtenção dos Dados Tabelas de Fatos</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id191">3 Apache Spark Cluster</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id192">3.1 Instalação</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id193">3.2 Conexão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes-em-pandas-da-bi-solutions">4 Geração dos DataFrames em Pandas da BI Solutions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#geracao-dos-dataframes-em-spark-da-bi-solutions">5 Geração dos DataFrames em Spark da BI Solutions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id194">5.1 Criação dos DataFrames</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id195">5.2 Atualização dos Tipos de Dados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id196">5.3 Criação de Visões Temporárias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#respostas">6 Respostas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacao-da-consulta-analitica-da-questao-8">Especificação da Consulta Analítica da Questão 8</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacao-da-consulta-analitica-da-questao-9">Especificação da Consulta Analítica da Questão 9</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacao-da-consulta-analitica-da-questao-10">Especificação da Consulta Analítica da Questão 10</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>